(function(ee,pt){typeof exports=="object"&&typeof module<"u"?pt(exports,require("maplibre-gl")):typeof define=="function"&&define.amd?define(["exports","maplibre-gl"],pt):(ee=typeof globalThis<"u"?globalThis:ee||self,pt(ee.Geoman={},ee.maplibregl))})(this,function(ee,pt){"use strict";var PS=Object.defineProperty;var OS=(ee,pt,xr)=>pt in ee?PS(ee,pt,{enumerable:!0,configurable:!0,writable:!0,value:xr}):ee[pt]=xr;var O=(ee,pt,xr)=>OS(ee,typeof pt!="symbol"?pt+"":pt,xr);var wd,kd,Sd;const xr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mLYpUHOwgopChOtlFRRxrFYpQIdQKrTqYXPoHTRqSFBdHwbXg4M9i1cHFWVcHV0EQ/AFxdnBSdJESv0sKLWK847iH97735e47QGhWmWaFEoCm22YmlRRz+VWx5xUhmmGMIi4zy5iTpDR8x9c9Any/i/Ms/7o/R79asBgQEIkTzDBt4g3imU3b4LxPHGVlWSU+J54w6YLEj1xXPH7jXHJZ4JlRM5uZJ44Si6UuVrqYlU2NeJo4pmo65Qs5j1XOW5y1ap2178lfGCnoK8tcpzWCFBaxBAkiFNRRQRU24rTrpFjI0HnSxz/s+iVyKeSqgJFjATVokF0/+B/87q1VnJr0kiJJIPziOB9jQM8u0Go4zvex47ROgOAzcKV3/LUmMPtJeqOjxY6AgW3g4rqjKXvA5Q4w9GTIpuxKQVpCsQi8n9E35YHBW6Bvzetb+xynD0CWepW+AQ4OgfESZa/7vLu3u2//1rT79wN2rHKoBaSKHQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+gEBAUlKJesuC4AABWbSURBVHja7Z3fcxTHEce/t1ohYekA2QaBDBgocGLHNmW7Kg4pV9l5SeUleci/4b9H/0aeU3mJXXEF5yEmEOw4hgKFH7JBtpEQwhLS3eVhunV9w+7tHWh3e2Z7q64OyZJ18+Mz3+7pme4W7Bn6tBdXWwD4lYj3FMA0gCkAswCOAJihrw8AOAfgdwDOAmgDmKDf3YunB6ADYB3AdQB/BnANwEMAWwA2ANwH8Ii+3gSwA6BLv8vvvfWPD/VslPOflnVBLhQQYKQCiEl6zQCYB/AigGMA3gBwGMB+guQQgFfpfZKg2sunC2AbwCqA/9H7FoCfAKwA+ArAtwB+BHCPoNmmFwOzw6AAgMFigIyrFhMChgMERJu+PkJQHCNI5un7qfi9F+i9VUJf88TeBvCY3js06TcIih8Jkq9IUTZIde6R2myI3zNVMUBGAiOlST1NrwMAjgM4BeAtAUKbIJklxZim35WAJSXB4UPSlROcINkkRXlEcKwLcP4NYAnAHQJlk17bUlUMlIYDkgHGPpr8BwEcJWVYAPA2AXKcwGAza0ooRiL6s1Vx//Yy3rtCUbaEebVOYCwBuAJgmZTmOwBrBNETA6XBgAwBYw7ACYLhbYLjRYLlIP3MpOest2oAYhxgep5zvk0QrBEUPxIkVwia2wAeGCgNBGQEME4DeIcAOUHm1bRwztMaVWIv1WVHOOubZGbdJkAuAbhpoDQIELErlRSAcZq+nhNqMeEpReh91vOUpSNU5QGBcbMAlG5Tdr1aDYGjRROdYxZFYOzzHO4Y+8o3w3YIgCJQOLbSaYKatBoAR0JKsB/Ay2Q+nRkRjKaYoL0RQblBZtj3cPGWbQDdmCFpRQyGVI0DcFuybwL4FVx0+6SBMRYot+Ci9p8DuAq3dfwwdjVpRQxHCheoO0xKcY7geJNgaRsYY4GyTlBcJUiukbKswAUqd2KEpBUhHBM06WfgotznAVwgQE6TmbWffiYxMEYCpUsA/ETm1U0C5CKAy3DR+g36mU5MkLQiAsM3qeYJjg/pfZ6+P4X+wUEDYzxQOmRSPYSLyF8G8Cm934vR5GpFBEeWSXWB4DiGwXNSMDieCRJg8LzXtwTHxVhNrlZEcMzCRb59k+owgZOaauypmuwQCCsZJtcy3HZw8JCkEcHxCoB3AXxkJlUli2oqVHmGFqIZsRDdZUjai6vBBhXTwOHgo+gMx2/ofcEzqQyMvYfEP7YzhcGjOCBINgBshwpJGigciYBjwYPjFQFHYnCUDgovQKzi/rMsIAkuqJgGCscU+kfSz5NZxXDMmr9ROSS8YPmQsLrwUfqt0CBpBQrHS+SE/xzArwmSBYNDjfP+iJTjMoC/A/ianPgf4LaBg4GkFRAcLbjI9xyA1wH8Fu6G31m4yLjtVOmC5DFc5P063A3GvwD4D9yxlScIZHcrCQgO9jmOknK8Re9Hvd0Tg6N+5z0tGKtJAC1xDcEAeU44UuGQnyez6iz6x0ZsG1cfJBPon6A+65nCuwuadkiSQODIinMcMTiCgeTIsM0UzZCkyjvZh0PGOV4wOILwbydorBbQP67Cz24wMeO/GSAF6iE71o9z2G5VWJDIhc536u8A2Ggvrqp02lPFcEzBHV+wOEeckPBu1xYrSHtxVd1R+UQhHGxaHYA7bHghy7kzOIL0SfzNlgs0xge0+iOpwo7kTpyHCwaew2BaT4MjfCXxx3eFlKSrzR9RoyCe33EsZ4Wxs1XhQ5LkWAjHeONFk4okiuBIPL+DbwIexuCRdXvCh2SiYKwTLZAkSuDgSHnuqmJwRAlJnrWgJtKuxcSSAaU8v8Oe+CDJ8kdkALjZCuKZVi+jn7dqYGcDcWY19EsX5L3kz8YGiL9jyWmZXtZiaqVKVpFZuIyHfgfFYlrllSfojdFPdZZXqMIf4QVyDS5Dyjr6JRt6jQMk4wj7GfSPrquR2D2Cwi9BwAEyruxUpPI8ieROntbSC89rYp+luXAHlGurvbjaqiuAmNa8erANegIuV+5JuIyHIZtWWdnT/SI2G/DS4xT0Eacz4qPiecV7QuwzGR9p0xx4By5TCt8dqU1FagEkQz1O02uOvhdivMNP18n1N7LKoN2HuzwkA2S9HLOKt0NfR7+Sblb5t0mEm0aV2+rPh9t1q0haY4f46nEi0F2rvITPsoJTViHNFfTTdfZG6KcryC8gKitghZpvOGtO1K4ilQMygnqEMqhFJQOWMFgD0C/FvAWvDPOQnZ4HBJQsQX0VT9dQDLmUQ968qFVFUiUrRWjqIZ3tvFoaS/S1rCK74znrow42A8WmyAO4JNJchfc6ATKs5kkSCCSqVKRSQCJQDz+J8yMUly3z65Dv7nCNuhpSv3VF32yLv79GCnWL/nZW1Sz2VbRfMFOnIqmCFSIU9cjKSbsEV3WpsPDlOED4j/i9ngcM1xfMUjEG5Qypi8xRDOWQqFGRyjpJRM33w12a+RDAH+HO4cyhX15Zs0nVwWDOp4tk3txCTRVhCyr3noSLK8g7NbN4uq67tofLVT+gfv4TXJmFu3A1SirLq1W1giRkNx8lxzIE9fDriy8D+ALAJzR4XIqsllLJ9Hd6BMq25xc9FDtn/Nn44tmkYkh8FXkbwH8hEs/FaGLxsYJpsfuye3JT6UCxv8G1xLlozCcEyTKZW9vsY9QV8c0AhQOUm56pt4N+5vtp6DzO45/wXqA5M00K3qnKzKoEkIwj7bLBE8rh4AyBN5BdA6MDRak0BShyQ+GugGMD7tTsGfQzUmqFJGtBXYNLhF2Js55W2FiWzOMkmUep8YlSOLq0+t4H8E8AnwH4BoFUUVr/+FCvvbjKO2eP4M42bdFnfw3ABwDeo3HYr9Tc8k3ya7RjV5mzXvrkzEjEcIpeB5WaV9LneEjK8RmAfwD4EoMFK1Xnl2U1wWDJtC+pLZ9R2x5KE1GpmXVQzJtKEzykFa8E83B5Wo8rdc6lWbJBPsc1Uo5lAKu0CgdTyTXD5OLP/Q21ja+5tqHvZLBvebwFd4btB1KRbhUTt8qVoE2QtBWrh5++/yKZVWuhwZEBCgc416hNmTUFlapILXOnKvtfVoSSW4xanXJ/K3clZDhyIFlB9o5cB/puL9Y2f0r9IxnZ2Y8oVQ/2O4ZOnBjqfgtIhi0EmvwRX0WOoMLs8GlFELL/8QY1cEqZgkjTaikA02OvTcmsBWxS0QLG92L4mP9VuMOapQcNkwro5+uiL8LdX9CWW5cd1ydwRxtuwB0fuS9NjhjUI2N3S8Z5rlPbdytAKVkU/DIYfAemkpwFpQGSUd+j0oY9w2q6AXfQ7xLc2ard7c+Y4PAgkdvZt6jtuydnlZlZuQttmWZW2QriS+M8dAUHffW4icGTo1HCkQFJXvs1pRuqxVSvwsRi+/Yw9CWgzlIPjSto0/ugVTCXggSEG8WX8aehKzBYpB69mNUjwx8JQUUYkmkMJvcI1sSqvEGmHtGrSKULbimAZMQ/KpPEMdVjGy6qvESvRqnHEBXh/lhD/1CgFkgy51RZjnpSMnwyp9Nh6Ip/8Gnd7+CyjzRVPfJU5Ar1zSYqvKCkbU6V7YNwinttDro8cvEjXLCMt3UbpR4ZKsLbvpyuiFOk1t0nWVZJ6XdZkhIbw///FP00mZrMK44kf0sTYRM6zyHVsXBsop/wTp4k0GRmyVzFKGtuVXWaV5NzzubVFlwE+Su4Y+2aTAkNpuc99LNBbinqmxaeznYflpM+RFG0rJJsSqzDS2rQRPMqw8xiX4TzCWty1CudU0lD54LMUsLJ3Uw9rH8aD0hIK6RKhW1aHzVRQeS9D78EgT3WR40HRB7zXjH/o9AP4Qwujdzha6KJxSskV31qamBwlL6SfdT1+tAAacAE6JrvUeiLdJvcP4lNAnusjwwQe+wxQOyxxwCxp+qnZYDY4NuT3TeVnXkyQHROAG2HKLX1T2WnZg0QXYqh8Ri+iifnNqjWGiIGSEmQZF7kqiKdfkDzQvNtUAPEBl+FeaU1XVN0gGhLhKw9mbYW51xjuqZK51RSUUO0HekIoRyDBgXRmq6psiMwScl0azwUWGs6/QAddG2VwCo9RJmU3JDMY+UKQNGeM7juvtFYrqKWY/hlNlrrpZu8rPOaS1JX2Tey9LK2chWVz6lSAMm5dKMtjaVMp881uCebamYNqWWvqVxF7pwq67JbUlGDNtGvSqrFWfdrcJ+Azsq7VTvmM9QX2mrZS+f8Cc2p0hfcJLYGPYOjLmtwz9GuTaNURKjHPuoD7g9ttewrX3CrUpANhY66v2K+02AV0d4XtZnsZQOiOTuGv2qeplejVCRDPZ7qByWLRS1zqTRAAsnSZyoSRh/Ulg0zqYh8rVn6ilbPJGYVobYlAahHbfMoqZN8xSpyEv1t3yghEXDwtu5J5epRiyVSlYJoztLnq8gZAGfhIsi79yBigkT4HXzs/wi1+Yxi9ahlDpUKSEDZwmVk/RSACwDOwwXLZiP0R2R7F6itF6jt2tpbazb+pMIVQHO2cDY3+J7IeQAfAXiXJtALACZiUBFqAyvHArXxI2qzvBujqa21zZ+0xhVgjuzfnpLB8CeOVL/d08jtxdVOqDl8BRxDFwKF6lGbBVKlgoRQ0SnP9DgNF1WeClVJPDgOUptCMCVrrXhVuoKsf3yo115czasJOKtsxeLPMUE7OfMAzgF4Da48MuBKI2+1F1c7CCAjvOeQMxwL1KZz1MYZMQ7aqoHl1kysou+TihuaWVUW+kp7ye3PMwA+APA+gF/AHQEP4oJVxgWoY9SG96lNZyC2s6G3VF5tVXerPKXp1yW/A711yRmSabgt0PcA/B7AHwD8EsBxYZKojJOIOAebjMfps/+B2vIetW0aOpPDSd/jDmqq216Fky7NrG0yUZbo9aqYaD1lgySd9qPIrve+DHerbbu9uNrVYHIJ1WAVzNqtmifl0HpJTKqHnC9rqLiWfVrzivAzAC9Bb9odhmQ/nk40x6bLfTIBngDYoYWgclAEGPy59hEERzJ2q2aUmlXqLI7KAPFURNqUGp31PJ+kDeAVz66/DuAWOfEbVYOSA8YM3Db6SbgIub9bNaEcDt85H/BZq1x80pobzrsSh6ArJpIHSUvY85z04QaASwBuAridBwovEnsIBYaAcQJuG/cdcsRPoZ9CVHsCuDznfBM11ElMa+gAua/9Je2qvAz92Q1bos/YD2kTLKcJkCxQtmlguwQLxgXGA0ICO4F+fi8fjNP09RxBLe+Wa47jqHDOawEksJhIHiS+E+xPTgZliUB5SO3jK8d8TVQCM46C8c7UNL0O0N8+lQHGDClLijDKGKhxzutUkDz78qByMyvPL8kzb5Zo9WMT4Z5QlG0MJtPrFQDJGwSTAsp59DOyvE2AZIHRQlhpVVWFA1IlnXCWBnsf+kkCEAAkLRq0LFBepV069rX4mMQG3HmiUe5V+1kO2+jnFH4D/ZxeR2mBCRkMVc55bYAMiYmcFLZ9L6CBzQNlFm4Le4vMybcIDD50599r6OWolMxEz2lSOWUq+xbT4m+HCIY657xuBZGO2G2y2eVVz8kABzgLlCka3IO0EcHm1QaZRY9HVBAZpGQzi2Mycss25Az1/pyo1TmvFRChIk9ot+cmvU4EqiJ5oMidpin084TN0YTvjDD4/P+Y8pxtP+N6yHdVWD14PtTunNetILGqiA8KPFh4kCUw4+5iIRIoiubCbSg4q1db3EFcx/VV5AF9T9sp371QlUS8UmGKDXtNCuVIEF/h0cJ5UOf5tlThyhGTihSpC2BVrdSqR60K0kAVsScw9agdkBBWEHuaPfa1A2IqYuqhVT20KIipiKmH2jFXAYipiKmHRvXQpCCmIqYeKsdaDSCmIqYe2tRDm4KYiph6qBtjVYCMoCJdgyR4OLqhqIdGBclbYW7BHRXXVFfEnmczrXZoLG+FYCGoAyRDRW7AZQ65D+AnuBOw9oT5dGgM79OY3tCsHkD9Z7GKVOQR3LHnz9G/Mcf5nEK4Y23PoGm1BeB7AFdpTJcgcu1q/OAqs4jQShJkh9oz8oJ3lcZ2C0BXaxLwRHnHDpNkc9jDdMyDMpnVAuKVb5NOnTns4TvmA2OouYSEagURppY57HE65l3t9VXSADrYHHZzzE1BnsFhvwm9RXjsCdgxDwqQHKm+Ri8ztcwxN0CEw85JxW5mrUimIuaYN1ZBLDZijrkBsgedb5DUrh6dmBaxoAApiI2Yw67HtMo1g0NSjyAVpCA2UpTr1p5yAeFT2Pdi2UhJAx8M3kK8iH5cZIL+HVP2wVBMq8dwpR4u05gMbMWHph6h+iC+w75CA/IpvQ8rKWBPOXAUjkWIcAQLiICkcNUySCrxO+T2+0Uai29pbDqhwhE0IDHbvYE9WQFcLjcXvD8YNCDerpYFEOszrbKOAAUVEIxVQaSpZWe16jWt/IWpEzocUQBSIPVmall/GyAjntWqrRBkhOpRqNgxqEdUCjLCsXi7gbh3plVU0fJhTxrhIGZJ/2G4moBc+swCiM8OSKN2DWPyQfJMraf25U1Fnsu0ii5a3hhAMkytvMiuQfLsfkd00fJGASIgGbbamT/yfH5HVNHypvkgRfay+SN704/RRMsbpyCeP7Jj/khpfkcU0fJGAuKZWuaPlON3dGKGI3pAzB8xv8N8EPNHzO8wBTF/xPwOA8T8EfM7DJAA/JGm3h/hAGvj/Y7GAjKifd1poNPeE+rReL+j0YAU+CPLaGaWRpklZrnpfkfTFSTPH/kEwBc0QZrktEuzc5n64JMm+x3ySdHQZ/3jQ7324qqcGJxHK4Xb+uVt3wnEu/070kLRVDgaDUiOaZHCJZ07TO8MSYwFeoY55U01Nc3EyvFHRnFOe5HBMdJmRZPVo/GACEiGraSxQeLDkeeUd5sOhwEymtN+NzJzQ5qVd80pNx/keZx2floAjiP8pNhZO1Z/NafcAHnW1ZXhiGFnq0kqaSZWyU57oX0e2EQa2c8y9TBAxoUk9J2tkdtjcBgg40ASw86W7VgZIKVCMqrN3lMOh+1YmZNeDiRDdrYA4BUAs6IfW8rhsB0rA6SUyebvbOVB0lL6mSUctmNlgOy5imAIJNpiJMNiHQNwmHoYIGVDoi1GMrLfZHCYk16G0645RmKxDgNEHSRaYiQW6zBAVEGiKUZisQ4DRCUkGmIkFuswJ121415njMRiHQaI+mecGMleQlIEh8U6DBA1KoKKIRkLDlMPA6RJkBgcBohBYnAYIAbJeJAYHAaIQWJwGCAGyXiQGBwGiEGSA4nBYYAYJDmQGBwGiEGSAwkMDgPEIBkOicFhgBgkGZDM0L83DA4DxCDpP1xi4Sh9/R2ASwaHAdJkSPjuRgJgEv167QBwFcDfAPwLdhuw1sfug9QAiXDCH8Pd+Psa7v7GHXpdpu/do58xOGp6/g9eQPkxBqxc0wAAAABJRU5ErkJggg==",bl={draw:{marker:{type:"draw",eventType:"toggle",targetMode:"marker",settings:{exclusive:!0}},circle_marker:{type:"draw",eventType:"toggle",targetMode:"circle_marker",settings:{exclusive:!0}},text_marker:{type:"draw",eventType:"toggle",targetMode:"text_marker",settings:{exclusive:!0}},circle:{type:"draw",eventType:"toggle",targetMode:"circle",settings:{exclusive:!0}},ellipse:{type:"draw",eventType:"toggle",targetMode:"ellipse",settings:{exclusive:!0}},line:{type:"draw",eventType:"toggle",targetMode:"line",settings:{exclusive:!0}},rectangle:{type:"draw",eventType:"toggle",targetMode:"rectangle",settings:{exclusive:!0}},polygon:{type:"draw",eventType:"toggle",targetMode:"polygon",settings:{exclusive:!0}},freehand:{type:"draw",eventType:"toggle",targetMode:"freehand",settings:{exclusive:!0}},custom_shape:{type:"draw",eventType:"toggle",targetMode:"custom_shape",settings:{exclusive:!0}}},edit:{drag:{type:"edit",eventType:"toggle",targetMode:"drag",settings:{exclusive:!0}},change:{type:"edit",eventType:"toggle",targetMode:"change",settings:{exclusive:!0}},rotate:{type:"edit",eventType:"toggle",targetMode:"rotate",settings:{exclusive:!0}},scale:{type:"edit",eventType:"toggle",targetMode:"scale",settings:{exclusive:!0}},copy:{type:"edit",eventType:"toggle",targetMode:"copy",settings:{exclusive:!0}},cut:{type:"edit",eventType:"toggle",targetMode:"cut",settings:{exclusive:!0}},split:{type:"edit",eventType:"toggle",targetMode:"split",settings:{exclusive:!0}},union:{type:"edit",eventType:"toggle",targetMode:"union",settings:{exclusive:!0}},difference:{type:"edit",eventType:"toggle",targetMode:"difference",settings:{exclusive:!0}},line_simplification:{type:"edit",eventType:"toggle",targetMode:"line_simplification",settings:{exclusive:!0}},lasso:{type:"edit",eventType:"toggle",targetMode:"lasso",settings:{exclusive:!0}},delete:{type:"edit",eventType:"toggle",targetMode:"delete",settings:{exclusive:!0}}},helper:{shape_markers:{type:"helper",eventType:"toggle",targetMode:"shape_markers",settings:{exclusive:!1,enabledBy:["drag","change","rotate","scale","line_simplification"]}},snapping:{type:"helper",eventType:"toggle",targetMode:"snapping",settings:{exclusive:!1}},pin:{type:"helper",eventType:"toggle",targetMode:"pin",settings:{exclusive:!1}},snap_guides:{type:"helper",eventType:"toggle",targetMode:"snap_guides",settings:{exclusive:!1}},measurements:{type:"helper",eventType:"toggle",targetMode:"measurements",settings:{exclusive:!1}},auto_trace:{type:"helper",eventType:"toggle",targetMode:"auto_trace",settings:{exclusive:!1}},geofencing:{type:"helper",eventType:"toggle",targetMode:"geofencing",settings:{exclusive:!1}},zoom_to_features:{type:"helper",eventType:"click",targetMode:"zoom_to_features",settings:{exclusive:!1}},click_to_edit:{type:"helper",eventType:"toggle",targetMode:"click_to_edit",settings:{exclusive:!1}}}},cp=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m22.775 29.562 6.75-6.75-5.625-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.626-5.55-6.75 6.75zm25.95 26.101 6.75-6.825-5.624-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.55-5.55-6.75 6.75zm.6-46.126 5.25 5.25ZM16.7 59.039H5v-11.7l14.55-14.551L2 15.237l13.05-13.2 17.7 17.624L46.1 6.312q.676-.676 1.5-.976.826-.3 1.65-.3.826 0 1.65.3.826.3 1.5.976l5.326 5.325q.675.675.975 1.5.3.825.3 1.65t-.3 1.65q-.3.825-.975 1.5l-13.35 13.35L62 48.913l-13.125 13.05-17.551-17.55Zm-7.2-4.5h5.25l29.476-29.552-5.25-5.25L9.5 49.288Zm32.1-32.178-2.625-2.625 5.25 5.25Z"/>
</svg>`,Al=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" stroke-width="7"/>
    <circle cx="32" cy="32" r="5" fill="currentColor"/>
</svg>`,ht={marker:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M32 62.81s23.107-21.898 23.107-38.512a23.107 23.107 0 0 0-46.214 0C8.893 40.912 32 62.809 32 62.809m0-26.958a11.554 11.554 0 1 1 0-23.107 11.554 11.554 0 0 1 0 23.107"/>
</svg>
`,circle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" stroke-width="7"/>
    <path stroke="currentColor" stroke-dasharray="3" stroke-width="4" d="M6 32h52M32 6v52"/>
</svg>`,ellipse:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 64 64"
   version="1.1"
   id="svg2"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <defs
     id="defs2" />
  <path
     fill="none"
     d="M 0,0 H 24 V 24 H 0 Z"
     id="path1"
     style="display:inline" />
  <ellipse
     cx="32"
     cy="32"
     fill="currentColor"
     fill-opacity="0.15"
     stroke="currentColor"
     stroke-width="7"
     id="circle1"
     rx="26.787416"
     ry="15.158148" />
  <path
     stroke="currentColor"
     stroke-dasharray="3"
     stroke-width="4"
     d="M 6.4966994,32 H 58 M 32,18.552705 v 30.15073"
     id="path2"
     style="stroke-width:3;stroke-dasharray:3;stroke-dashoffset:0" />
</svg>
`,circle_marker:Al,text_marker:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <path fill="currentColor"
          d="M6.962 3.385h50.076a3.577 3.577 0 0 1 3.577 3.577v50.076a3.577 3.577 0 0 1-3.577 3.577H6.962a3.577 3.577 0 0 1-3.577-3.577V6.962a3.577 3.577 0 0 1 3.577-3.577Zm3.577 7.154v42.922h42.922V10.539Zm7.154 7.154h28.614v7.153H17.693Zm0 14.307h28.614v7.154H17.693Z"/>
</svg>
`,line:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <line x1="8" y1="50" x2="24" y2="20" stroke="currentColor" stroke-width="8"/>
    <line x1="24" y1="20" x2="40" y2="54" stroke="currentColor" stroke-width="8"/>
    <line x1="40" y1="54" x2="54" y2="10" stroke="currentColor" stroke-width="8"/>
    <circle cx="8" cy="50" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="24" cy="20" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,rectangle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Rectangle -->
    <polygon points="10,10 54,10 54,54 10,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="10" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="10" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,polygon:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Polygon -->
    <polygon points="8,28 40,6 55,35 51,55 18,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="9" cy="28" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="8" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="55" cy="35" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="50" cy="55" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="18" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,freehand:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M44.698 2.661a1.644 1.644 0 0 1 2.328 0l9.866 9.866a1.644 1.644 0 0 1 0 2.329L24.004 47.744a1.644 1.644 0 0 1-.552.362L7.008 54.683a1.644 1.644 0 0 1-2.138-2.138l6.578-16.444a1.644 1.644 0 0 1 .362-.552zm-3.089 7.742 7.542 7.541 4.252-4.252-7.541-7.541zm5.216 9.866-7.54-7.54-21.378 21.376v.964h1.644a1.644 1.644 0 0 1 1.645 1.644v1.645h1.644a1.644 1.644 0 0 1 1.645 1.644v1.644h.963zM14.724 37.29l-.35.348L9.35 50.204l12.566-5.025.349-.35a1.644 1.644 0 0 1-1.07-1.538v-1.645h-1.644a1.644 1.644 0 0 1-1.644-1.644v-1.644h-1.644a1.644 1.644 0 0 1-1.54-1.07"/>
    <path stroke="currentColor" stroke-width="5.107"
          d="M6.298 59.53c3.44-1.692 6.88-3.384 10.558-4.319s7.594-1.111 11.719-.298c4.125.814 8.459 2.617 13.483 2.655 5.023.038 10.737-1.689 16.45-3.415"/>
</svg>
`,custom_shape:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <circle cx="49.754" cy="50.219" r="10.098" fill="none" stroke="currentColor" stroke-width="5.1"/>
    <path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4.491"
          d="M44.516 26.657H17.842l6.669-11.55 6.668-11.55 6.669 11.55Z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="4.683" d="M4.481 40.605h20.761v19.093H4.481z"/>
</svg>
`,drag:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path
            fill="currentColor"
            d="M32 61.4 19.85 49.42l3.28-3.235 6.634 6.542V34.205H10.98l6.26 6.174-3.279 3.234L2.185 32l11.852-11.686 3.28 3.234-6.336 6.247h18.783V11.273l-6.261 6.174-3.28-3.234L32 2.6l11.777 11.613-3.28 3.234-6.26-6.174v18.522h18.782l-6.26-6.174 3.279-3.234L61.815 32 50.038 43.613l-3.28-3.234 6.261-6.174H34.236v18.522l6.634-6.542 3.28 3.234z"
    />
</svg>
`,change:cp,rotate:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M58.709 17.724c-.3-.6-.601-.901-.902-1.502l-.3-.601c-.301-.601-.602-.902-.902-1.503l-.3-.601c-.301-.601-.602-.902-1.203-1.503l-.6-.901 8.414-9.317-13.825.3-13.824.301 1.502 13.524 1.503 13.524 9.617-10.819v.3l.3.602c.301.3.301.6.602.6l.3.602c0 .6 0 .901.3 1.202.903 2.104 1.804 4.208 2.105 6.311.6 4.208 0 8.716-1.804 12.623l-.6 1.202-.301.3-.902 1.503-.3.601c-.601.601-1.202 1.503-1.804 2.104-1.502 1.503-3.305 3.005-5.109 3.907-1.803 1.202-3.907 1.803-6.311 2.404-2.104.301-4.508.601-6.612.301-2.404-.3-4.508-.902-6.612-1.503-2.103-.901-3.907-2.104-5.71-3.606l-1.202-1.202-.601-.902-.601-.601c-.3-.3-.601-.601-.601-.902l-.902-1.202-.3-.3-.602-1.203c0-.3-.3-.3-.3-.6l-.902-1.503-.3-.601-.902-2.705q-.901-3.607-.901-7.213V27.04c0-.601 0-.901.3-1.202l.3-1.803.602-1.803c.901-2.405 2.103-4.509 3.606-6.612q2.254-3.156 5.41-5.41c.6-.3.901-1.202.3-1.803-.3-.3-.6-.601-.901-.601h-.601l-.3.3c-2.706 1.202-4.81 3.006-6.913 4.809-2.104 2.104-3.607 4.508-5.11 7.213-2.704 5.41-3.606 11.42-2.404 17.431.3 1.503.601 2.705.902 4.207l.902 2.405c.3.3.6.6.6 1.202l.602 1.202c0 .3.3.601.3.601l.902 1.503c.3.601.6.901.901 1.503l.301.6c.3.301.601.902.902 1.203l2.103 1.803c2.104 2.104 4.809 3.907 7.514 5.41q4.057 2.254 9.016 2.705c1.503.3 3.005.3 4.508.3 1.803 0 3.306 0 4.809-.3 3.005-.602 6.311-1.503 9.016-3.006l.6-.3c.602-.3.903-.601 1.504-.902l2.103-1.202c.601-.3.902-.601 1.203-.902l.6-.6a3.622 3.622 0 0 0 1.503-1.504l.3-.3c.902-.902 2.105-2.104 2.706-3.005l1.803-2.705 1.202-1.804c3.005-5.71 4.208-12.322 3.306-18.633-.601-3.306-1.503-6.612-3.005-9.317z"/>
</svg>
`,scale:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor" stroke="currentColor">
        <path d="m37.62 5.028-.337.284-4.039 4.068 3.547 3.523L39.875 9.8l2.846.596 1.025-4.893-4.176-.877Zm9.995 6.393 9.787 2.053 1.026-4.895-9.787-2.05zm14.68 3.078 9.787 2.05 1.025-4.892-9.787-2.053zm-39.623 5.522 3.547 3.523 7.049-7.094-3.547-3.523zm-10.57 10.642 3.546 3.524 7.047-7.094-3.547-3.524zM1.529 41.306l3.55 3.523 7.046-7.096-3.547-3.523Zm70.977 4.027 3.91 3.115 3.44-4.387-1.118-6.55zM.947 48.319l5.617 8.274 4.137-2.809-5.617-8.273Zm62.211 8.744 3.91 3.116 6.233-7.82-3.91-3.116zM9.373 60.73l5.62 8.272 4.134-2.809-5.617-8.271zm44.438 8.067 3.91 3.115 6.232-7.82-3.91-3.117zM17.8 73.138l5.617 8.273 4.137-2.808-5.617-8.274zm26.662 7.388 3.91 3.116 6.232-7.82-3.91-3.116zm-18.236 5.022 5.617 8.273 4.136-2.81-5.617-8.272zm8.888 6.709 3.91 3.117 6.233-7.822-3.91-3.115z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="M22.672 20.02a3.5 3.5 0 0 0-2.506 1.034L-.514 41.872a3.5 3.5 0 0 0-.412 4.434L18 74.176a3.5 3.5 0 0 0 5.633.216l33.494-42.038a3.5 3.5 0 0 0-2.018-5.605l-31.742-6.654a3.5 3.5 0 0 0-.695-.074zm1.121 7.317 24.32 5.098-26.992 33.877L6.484 44.759Z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="m78.734 7.668 2.61 11.396-18.145 4.154 2.705 11.816L84.05 30.88l2.609 11.396L100 21.011Z"
              stroke-width="3"
              transform="translate(1.586 1.586) scale(.60827)"/>
    </g>
</svg>
`,copy:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.687.926a2.173 2.173 0 0 0-.433.045c-4.075.232-7.358 3.618-7.358 7.747 0 .084.01.164.012.246l-12.987 4.261a7.842 7.842 0 0 0-6.126-3.563 2.173 2.173 0 0 0-.424-.043 2.173 2.173 0 0 0-.435.044c-4.073.232-7.358 3.618-7.358 7.747 0 3.143 1.901 5.869 4.604 7.097L8.377 35.11a2.173 2.173 0 0 0-.028.007C4.274 35.35.99 38.736.99 42.865c0 4.277 3.514 7.791 7.791 7.791 2.497 0 4.727-1.201 6.157-3.048l12.887 6.235a7.67 7.67 0 0 0-.139 1.44c0 4.277 3.515 7.791 7.792 7.791 4.278 0 7.793-3.514 7.793-7.792a7.67 7.67 0 0 0-1.885-5.027l.508-1.05-3.263-1.579 4.505-29.969.888-.29-.368-1.122a7.78 7.78 0 0 0 2.28-1.018l.447 1.364 4.72-1.547-.774-2.359-2.522.826a7.73 7.73 0 0 0 1.672-4.793c0-4.132-3.288-7.52-7.368-7.748a2.173 2.173 0 0 0-.424-.044zm0 4.346a3.414 3.414 0 0 1 3.447 3.446 3.415 3.415 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.446-3.447 3.414 3.414 0 0 1 3.445-3.446zm20.076 3.725a1.242 1.242 0 0 0-.382.062l-1.612.528.578 1.76-.293 1.94 2.456.37.486-3.234a1.242 1.242 0 0 0-1.233-1.426Zm-4.354 1.364-4.72 1.548.775 2.36 4.719-1.548-.774-2.36zm-22.153 2.732a7.877 7.877 0 0 0 3.735 2.922l-.062.408-.397.13.26.793-4.255 28.298-3.818-1.847-1.082 2.235 3.718 1.798a7.841 7.841 0 0 0-3.543 2.147l-13.272-6.42c.02-.23.035-.458.035-.692 0-2.888-1.609-5.408-3.969-6.745l2.912-11.012c3.74-.562 6.645-3.81 6.645-7.698l-.001-.02 13.094-4.297zm-20.885.87a3.414 3.414 0 0 1 3.445 3.447 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm45.314 1.78-.738 4.912 2.456.37.738-4.912zM36.172 17.33l-1.793.588a1.242 1.242 0 0 0-.813.862l-.788 2.978 2.401.634.615-2.325 1.15-.377-.773-2.36zm22.405 5.781-.737 4.913 2.455.368.739-4.91zm-26.432 1.048-1.27 4.802 2.401.634 1.27-4.802zm25.325 6.32-.739 4.913 2.457.368.738-4.911-2.456-.37zm-27.23.882-1.27 4.802 2.402.634 1.27-4.801zm26.124 6.486-.739 4.91 2.455.37.74-4.912-2.457-.368zm-28.027.717-1.27 4.803 2.4.634 1.27-4.802-2.401-.634zm-19.555.856a3.414 3.414 0 0 1 3.446 3.446 3.414 3.414 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.445-3.447 3.414 3.414 0 0 1 3.445-3.446zm46.473 5.795-.739 4.91 2.456.37.74-4.911zm-11.124 5.072-1.082 2.236 4.47 2.164 1.083-2.237zm-8.651 1.55a3.414 3.414 0 0 1 3.445 3.446 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm18.669.745-.358 2.378-2.953-1.428-1.083 2.236 4.472 2.163.541-1.117 1.228.183.608-4.046-2.455-.37z"/>
</svg>
`,cut:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor" fill="currentColor" stroke-width="2"
          d="M44.095 2.247a2.285 2.285 0 0 0-.135.04L12.025 12.762a2.285 2.285 0 0 0-1.497 1.588l-7.772 29.4a2.285 2.285 0 0 0 1.213 2.641L35.397 61.6a2.285 2.285 0 0 0 2.873-.754l22.64-32.582a2.285 2.285 0 0 0 .05-2.534L46.6 3.23a2.285 2.285 0 0 0-2.504-.982ZM43.7 7.182l12.203 19.12-5.167 1.76 1.052 3.09 2.031-.693L38.07 53.122l.01-1.375-3.262-.023-.034 4.5-27.13-13.127 6.975-26.38Zm3.946 21.932-6.18 2.105 1.052 3.09 6.18-2.105zm-9.27 3.157-2.329.793a1.632 1.632 0 0 0-1.105 1.534l-.03 4.068 3.265.024.02-2.91 1.232-.419zm-3.488 9.66-.047 6.529 3.264.023.048-6.528z"/>
</svg>
`,split:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor">
        <path d="m4.879 2.684-2.832 2.8L7.65 11.15l2.832-2.801Zm8.403 8.495-2.832 2.802 5.603 5.662 2.831-2.802zm8.404 8.494-2.832 2.8 5.602 5.664 2.832-2.802z"
        />
        <path d="M27.814 7.408a3.576 3.576 0 0 0-1.161-.176 3.2 3.2 0 0 0-.878.138l7.963 26.068L7.18 27.3c-.543 2.352 1.67 6.055 4.962 6.816l23.054 5.297 2.326 6.42c-2.27-.175-4.279 1.912-4.908 3.805-.535 1.698-.512 3.656.085 5.61.597 1.954 1.671 3.59 3.064 4.7 1.393 1.11 3.238 1.71 5.023 1.164 8.064-3.039 2.135-15.793.467-20.58 5.917 1.023 18.77 5.88 20.578-1.979.42-1.819-.306-3.616-1.509-4.929-1.203-1.313-2.909-2.27-4.9-2.73-1.99-.46-3.866-.547-5.602.303-1.737.849-3.768 2.642-3.468 4.73a6.17 6.17 0 0 0 .012.43l-6.563-1.794-6.88-22.632c-.702-2.297-3.445-3.99-5.108-4.523Zm26.824 26.88c1.36.315 2.472.99 3.116 1.692.644.703.795 1.307.684 1.79-.112.482-.511.956-1.399 1.305-.887.348-2.182.467-3.542.152-1.361-.314-2.472-.99-3.116-1.693-.644-.703-.797-1.304-.686-1.787.112-.482.513-.956 1.4-1.305a5.198 5.198 0 0 1 1.594-.327 6.98 6.98 0 0 1 1.949.173zM37.846 49.174c.333.069.71.25 1.13.585.746.594 1.497 1.654 1.905 2.99.408 1.335.379 2.635.092 3.545-.287.91-.731 1.34-1.205 1.484-.473.145-1.085.036-1.831-.558-.746-.594-1.496-1.655-1.904-2.99-.407-1.336-.378-2.637-.092-3.546.287-.91.732-1.342 1.206-1.486.118-.036.245-.057.38-.058.102 0 .207.011.319.034z"
        />
    </g>
</svg>
`,delete:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M39.063 42.14 22.288 28.12 7.96 44.603l11.338 9.854h9.059zm-3.498 12.317h25.941v5.465h-44.25L4.377 48.726a5.465 5.465 0 0 1-.542-7.711L34.311 5.958a5.465 5.465 0 0 1 7.712-.538l16.496 14.343a5.465 5.465 0 0 1 .541 7.709z"/>
</svg>`,union:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.233 7.917c-5.5 0-10.519 2.077-14.328 5.482a21.443 21.443 0 0 0-4.138-.404c-11.88 0-21.544 9.664-21.544 21.544s9.664 21.544 21.544 21.544c5.5 0 10.519-2.077 14.328-5.482 1.34.263 2.722.404 4.138.404 11.88 0 21.544-9.664 21.544-21.544S53.113 7.917 41.233 7.917zm-9.969 6.791a21.61 21.61 0 0 1 5.598 3.499l-2.01 2.33a18.557 18.557 0 0 0-4.8-2.999Zm-7.927 2.765 2.557 1.714a18.558 18.558 0 0 0-2.396 5.128l-2.955-.86a21.614 21.614 0 0 1 2.794-5.982zm15.86 3.08a21.413 21.413 0 0 1 3.46 5.628l-2.839 1.188a18.357 18.357 0 0 0-2.963-4.817zm-19.334 6.142 3.053.399a18.348 18.348 0 0 0 .144 5.654l-3.027.552a21.407 21.407 0 0 1-.17-6.605Zm23.834 2.63a21.81 21.81 0 0 1 .548 3.263c.1 1.1.115 2.207.044 3.31l-3.07-.195c.12-1.888-.056-3.8-.511-5.64zm-19.918 6.172a18.37 18.37 0 0 0 2.64 5.003l-2.466 1.84a21.427 21.427 0 0 1-3.083-5.84Zm17.042 3.016 3.004.666a21.486 21.486 0 0 1-2.404 6.15l-2.66-1.547a18.434 18.434 0 0 0 2.06-5.27zm-12.535 4.124a18.554 18.554 0 0 0 4.6 3.302l-1.392 2.744a21.611 21.611 0 0 1-5.363-3.85Z"/>
</svg>
`,difference:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m41.478 7.967-.033 3.069c1.887.02 3.772.337 5.561.933l.97-2.913a21.337 21.337 0 0 0-6.498-1.09Zm-3.294.215a21.567 21.567 0 0 0-6.298 1.915l1.332 2.766a18.518 18.518 0 0 1 5.401-1.641zm12.836 2.155-1.402 2.73a18.497 18.497 0 0 1 4.572 3.312l2.16-2.179a21.548 21.548 0 0 0-5.331-3.863ZM22.783 13.06c-11.848 0-21.486 9.638-21.486 21.486 0 11.849 9.638 21.486 21.486 21.486a21.37 21.37 0 0 0 14.288-5.466c.003 0 .006 0 .009.002.04-.036.078-.075.117-.11l.077-.072a21.285 21.285 0 0 0 1.51-1.532 22.128 22.128 0 0 0 .867-1.025 19.557 19.557 0 0 1-.88-.095c-.196-.025-.389-.058-.582-.09-.097-.015-.194-.028-.29-.045a18.378 18.378 0 0 1-1.576-.359l-.118-.03c-7.753-2.172-13.422-9.271-13.422-17.728a18.34 18.34 0 0 1 5.867-13.478c.1-.093.199-.185.3-.276.153-.136.31-.268.467-.4.097-.08.193-.163.291-.242.255-.203.514-.402.78-.592a21.534 21.534 0 0 0-1.76-.592l-.018-.005c-.176-.05-.355-.095-.533-.141-.132-.035-.263-.073-.397-.105-.213-.051-.43-.095-.646-.14-.077-.016-.153-.035-.231-.05H26.9a21.37 21.37 0 0 0-4.118-.4Zm35.728 3.64-2.472 1.82a18.424 18.424 0 0 1 2.61 5.004l2.907-.986a21.474 21.474 0 0 0-3.045-5.839Zm3.864 9.034-3.022.534c.328 1.86.37 3.772.118 5.642l3.042.409a21.448 21.448 0 0 0-.138-6.585zm-3.496 8.943a18.539 18.539 0 0 1-2.416 5.104l2.543 1.72a21.586 21.586 0 0 0 2.815-5.952zM54.703 42a18.288 18.288 0 0 1-4.428 3.492l1.505 2.675a21.348 21.348 0 0 0 5.173-4.08zm-6.995 4.69a18.512 18.512 0 0 1-5.526 1.158l.163 3.065a21.56 21.56 0 0 0 6.444-1.35z"/>
</svg>
`,line_simplification:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.947 25.554c-2.176 3.77-.867 8.656 2.903 10.832 2.126 1.229 4.607 1.346 6.757.539l8.252 12.152a7.79 7.79 0 0 0-.701 1.005c-2.176 3.77-.867 8.656 2.903 10.833 3.77 2.177 8.655.867 10.832-2.903 2.1-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.404-.181 7.955 7.955 0 0 0-6.086-.432l-8.348-12.292c.19-.252.369-.512.53-.79 1.457-2.526 1.339-5.537-.03-7.907l8.202-8.256c3.494 1.335 7.562.025 9.575-3.229l13.899 2.913c.266 2.435 1.634 4.721 3.899 6.03 3.77 2.176 8.655.866 10.832-2.904 2.101-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.403-.181c-3.71-1.87-8.328-.556-10.429 3.083-.084.147-.155.297-.228.446l-13.5-2.83c-.053-2.55-1.329-5.023-3.58-6.499a2.211 2.211 0 0 0-.358-.259 2.211 2.211 0 0 0-.405-.181c-3.708-1.87-8.326-.556-10.428 3.083-1.61 2.79-1.307 6.19.486 8.652l-7.84 7.892a2.211 2.211 0 0 0-.094-.036c-3.71-1.87-8.328-.556-10.429 3.084zm3.83 2.211a3.473 3.473 0 0 1 4.79-1.282 3.472 3.472 0 0 1 1.284 4.789 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.79ZM23.656 8.173a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.789 1.284 3.475 3.475 0 0 1-1.284-4.791zm-.666 44.12a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791zm29.166-37.88a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791z"/>
    <path fill="currentColor"
          d="M12.9 13.516c-.63.177-.685.37-.88.95l-1.069 3.18 2.995 1.006.844-2.506 2.074-.882-1.236-2.908zm19.209 5.25 4.378 4.554 2.277-2.19-4.379-4.554zm8.132 3.106 1.441 2.812 5.623-2.882-1.441-2.812zM5.448 46.082l3.144.304.608-6.29-3.145-.303zm4.623 3.728 5.762 2.592 1.297-2.88-5.762-2.593z"/>
</svg>
`,lasso:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <ellipse cx="4.907" cy="-32.051" fill="none" stroke="currentColor" stroke-dasharray="13.7543, 6.87718"
             stroke-width="5.489" rx="20.4" ry="13.713" transform="matrix(-.71127 .70292 -.86047 -.5095 0 0)"/>
    <path fill="currentColor"
          d="M34.597 25.275a1.934 1.934 0 0 0-2.04 2.165l2.922 31.37c.188 1.523 1.989 2.235 3.165 1.249l6.169-5.004 2.765 4.79c1.59 2.756 4.115 3.431 6.87 1.841 2.756-1.59 3.433-4.114 1.841-6.87l-2.755-4.773 7.31-2.803c1.443-.525 1.728-2.44.503-3.365L35.64 25.66a1.93 1.93 0 0 0-1.042-.383z"/>
</svg>
`,shape_markers:null,snapping:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor" fill-rule="evenodd"
          d="M19.435 3.417c-4.478 0-8.96 1.693-12.343 5.076-6.766 6.766-6.766 17.913 0 24.679h.006c2.754 2.749 5.563 5.561 8.357 8.357 1.857 1.859 3.696 3.696 5.553 5.553l.949.949 1.892 1.898 9.496-9.49-1.898-1.898-6.502-6.502c-2.796-2.797-5.6-5.606-8.363-8.362-1.65-1.653-1.652-4.042 0-5.694 1.653-1.653 4.047-1.653 5.7 0l8.357 8.362 6.502 6.502 1.898 1.893 9.49-9.49-1.893-1.893-6.507-6.502-8.357-8.362c-3.384-3.383-7.86-5.076-12.337-5.076Zm0 2.68c3.789 0 7.577 1.432 10.439 4.294l8.357 8.362-5.694 5.694-8.357-8.362a6.7 6.7 0 0 0-9.496 0 6.697 6.697 0 0 0 0 9.49c2.76 2.755 5.566 5.564 8.363 8.362l-5.694 5.694c-2.795-2.796-5.601-5.607-8.357-8.357H8.99c-5.724-5.724-5.724-15.16 0-20.883 2.861-2.862 6.655-4.294 10.444-4.294ZM57.709 29.03a4.266 4.266 0 0 0-4.268 4.268c0 1.594.881 2.973 2.176 3.707-.714 4.997-1.424 10.107-2.176 15.037-.934 0-1.792.309-2.495.818l-7.115-5.07a4.25 4.25 0 0 0 .115-.965 4.27 4.27 0 1 0-4.268 4.268 4.23 4.23 0 0 0 2.732-1.012l6.973 4.965a4.22 4.22 0 0 0-.215 1.269 4.27 4.27 0 0 0 4.273 4.268 4.266 4.266 0 0 0 4.268-4.268 4.247 4.247 0 0 0-1.657-3.356l2.208-15.446c2.095-.273 3.722-2.045 3.722-4.215a4.27 4.27 0 0 0-4.273-4.268z"
    />
</svg>
`,pin:`\uFEFF<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M42.012 2.106a4.092 4.092 0 0 0-5.741.735 4.092 4.092 0 0 0 .572 5.607L23.964 23.45a8.185 8.185 0 0 0-10.458 2.142l5.18 4.005 5.454 4.218L7.87 59.22a1.124 7.304 37.712 0 0 1.54 1.19l20.494-22.138 5.454 4.217 5.18 4.005a8.185 8.185 0 0 0-.558-10.66l11.277-16.24a4.092 4.092 0 0 0 5.572-.858 4.092 4.092 0 0 0-.735-5.74z"/>
</svg>
`,snap_guides:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor"
          stroke-width="3.8"
          d="m2.155 32.345 42.35-29.82M18.963 60.919l42.35-29.82M31.443 2.332l29.82 42.35M2.207 19.515l29.82 42.35"/>
</svg>
`,measurements:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.717 38.645a2.675 2.668 79.7 0 0-.307 3.769L16.754 60.55a2.675 2.668 79.7 0 0 3.76.312l41.769-35.508a2.675 2.668 79.7 0 0 .307-3.769L47.246 3.45a2.675 2.668 79.7 0 0-3.76-.312zm5.486 2.352 37.702-32.05 11.892 14.056-2.717 2.31-4.458-5.269-2.033 1.729 4.457 5.269-3.11 2.643-4.457-5.268-2.034 1.728 4.458 5.27-3.106 2.64-4.458-5.27-2.033 1.73 4.457 5.268-3.11 2.644-6.194-7.32-2.033 1.728 6.193 7.32-3.11 2.645-4.457-5.269-2.034 1.729 4.458 5.268-3.106 2.64-4.458-5.268-2.033 1.73 4.457 5.268-3.11 2.643-4.457-5.268-2.034 1.729 4.458 5.268-2.098 1.783z"/>
</svg>
`,auto_trace:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M16.862 2.13 7.297 21.17a2.091 2.091 0 0 0-.193 1.288l4.107 24.166-7.618 13.15 3.619 2.096 7.997-13.804a2.091 2.091 0 0 0 .252-1.397l-4.119-24.235 9.256-18.428Zm40.876.255-1.25 2.49 2.668 1.341 1.25-2.49zm-2.593 5.16-2.68 5.337 2.668 1.341 2.682-5.338zm-4.022 8.007-2.682 5.338 2.67 1.34 2.681-5.337zm-18.67 5.83.055 6.984-11.118.087.056 7.242 11.12-.088.054 6.985 10.521-10.688zm18.927 2.817-2.945.5 1.001 5.89 2.945-.5zm1.502 8.835-2.945.5 1.001 5.89 2.945-.5zm1.502 8.834-2.945.5.74 4.355-.24.413 2.585 1.499.51-.881a1.494 1.494 0 0 0 .18-1zm-3.943 7.854-2.994 5.17 2.584 1.496 2.994-5.169zm-4.492 7.754-1.497 2.584 2.584 1.497 1.498-2.584z"/>
</svg>
`,geofencing:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M31.226 17.87c-4.69 0-8.532 3.832-8.532 8.508 0 1.812.58 3.495 1.558 4.88l5.932 10.255c.831 1.085 1.383.879 2.074-.058l6.543-11.135c.132-.24.236-.493.327-.753a8.396 8.396 0 0 0 .628-3.19c0-4.675-3.841-8.506-8.53-8.506zm0 3.987a4.5 4.5 0 0 1 4.532 4.52 4.5 4.5 0 0 1-4.532 4.521 4.5 4.5 0 0 1-4.534-4.52 4.5 4.5 0 0 1 4.533-4.52z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="5" d="M8.97 53.509 4.423 19.145 35.698 4.199l23.88 25.127L43.06 59.801Z"/>
</svg>
`,zoom_to_features:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.585 1.585V13.75h5.17v1.52H8.58v-1.52h5.17V1.585Zm3.041 3.041h6.083v6.083H4.626Zm9.429 2.13V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0v1.597a1.521 1.521 0 0 0-.325.152l-15.686 9.758a1.52 1.52 0 0 0-.199 2.437l23.512 20.553a1.52 1.52 0 0 0 2.477-.78l4.212-17.037v.352h1.825v-3.65H55.42v1.524a1.52 1.52 0 0 0-.222-.296L43.002 8.741a1.521 1.521 0 0 0-.182-.16h2.259V6.754Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm3.042 2.432v3.65h1.825v-3.65Zm-13.752 2.549 10.757 11.137-3.57 14.446-20.087-17.559Zm13.752 2.926v3.65h1.825v-3.65ZM6.755 17.096v3.65H8.58v-3.65zm0 5.475v3.65h1.628a1.52 1.52 0 0 0 1.02.909l12.683 3.406 7.905 12.694c.168.27.417.481.712.602l13.39 4.576a1.52 1.52 0 0 0 1.157-2.814l-12.936-4.389L24.35 28.42a1.52 1.52 0 0 0-.896-.664L10.19 24.193a1.52 1.52 0 0 0-1.61.557v-2.178zm48.665 3.042v3.65h1.825v-3.65ZM6.755 28.046v3.65H8.58v-3.65zm48.665 3.042v3.65h1.825v-3.65ZM6.755 33.52v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65ZM6.755 38.996v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65zm-35.382.913c-3.454 0-6.287 2.833-6.287 6.287 0 3.076 2.248 5.654 5.179 6.183h-1.225v1.825h3.65V55.42h-.206c2.712-.5 4.777-2.796 5.055-5.59l.002-.002a1.52 1.52 0 0 0 0-1.18c-.314-3.168-2.922-5.698-6.168-5.698zM6.755 44.47v3.65H8.58v-3.65zm13.283 1.521a3.223 3.223 0 0 1 3.246 3.246 3.223 3.223 0 0 1-3.246 3.246 3.223 3.223 0 0 1-3.246-3.246 3.223 3.223 0 0 1 3.246-3.246zm35.382 1.52v2.738h-5.17v12.166h12.165V50.25h-5.17v-2.737ZM6.755 49.946v3.65H8.58v-3.65zm46.536 3.346h6.083v6.083H53.29ZM6.755 55.42v1.825h3.65V55.42H7.668Zm5.475 0v1.825h3.65V55.42zm10.95 0v1.825h3.65V55.42zm5.474 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42z"/>
</svg>
`,click_to_edit:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.839 34.833c-7.104-9.763-5.332-23.33 4.2-30.266C21.572-2.369 35.03.123 42.13 9.882L56.166 29.17c7.098 9.755 5.329 23.325-4.204 30.262-9.533 6.936-22.989 4.444-30.09-5.315L7.841 34.836Zm5.063-25.476c-6.079 5.766-7.006 15.598-1.634 22.98l.778 1.07 12.002-8.732zm3.43-2.495L27.476 22.18l12.002-8.733-.781-1.073c-5.37-7.38-15.01-9.522-22.367-5.512m25.643 10.014L14.54 36.836l10.762 14.79c5.818 7.997 16.653 9.842 24.163 4.378 7.51-5.465 9.088-16.342 3.267-24.342z"/>
</svg>
`},hp=["mode_start","mode_started","mode_end","mode_ended"],ot=n=>Object.keys(n),Ti=n=>Object.values(n),er=(n,r)=>r.includes(n);function Cl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ps={exports:{}},fp=Ps.exports,Tl;function gp(){return Tl||(Tl=1,function(n){(function(r,e){n.exports?n.exports=e():r.log=e()})(fp,function(){var r=function(){},e="undefined",s=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),u=["trace","debug","info","warn","error"],l={},f=null;function h(D,U){var G=D[U];if(typeof G.bind=="function")return G.bind(D);try{return Function.prototype.bind.call(G,D)}catch{return function(){return Function.prototype.apply.apply(G,[D,arguments])}}}function m(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(D){return D==="debug"&&(D="log"),typeof console===e?!1:D==="trace"&&s?m:console[D]!==void 0?h(console,D):console.log!==void 0?h(console,"log"):r}function v(){for(var D=this.getLevel(),U=0;U<u.length;U++){var G=u[U];this[G]=U<D?r:this.methodFactory(G,D,this.name)}if(this.log=this.debug,typeof console===e&&D<this.levels.SILENT)return"No console available for logging"}function y(D){return function(){typeof console!==e&&(v.call(this),this[D].apply(this,arguments))}}function E(D,U,G){return d(D)||y.apply(this,arguments)}function S(D,U){var G=this,I,H,J,X="loglevel";typeof D=="string"?X+=":"+D:typeof D=="symbol"&&(X=void 0);function W(A){var T=(u[A]||"silent").toUpperCase();if(!(typeof window===e||!X)){try{window.localStorage[X]=T;return}catch{}try{window.document.cookie=encodeURIComponent(X)+"="+T+";"}catch{}}}function $(){var A;if(!(typeof window===e||!X)){try{A=window.localStorage[X]}catch{}if(typeof A===e)try{var T=window.document.cookie,F=encodeURIComponent(X),P=T.indexOf(F+"=");P!==-1&&(A=/^([^;]+)/.exec(T.slice(P+F.length+1))[1])}catch{}return G.levels[A]===void 0&&(A=void 0),A}}function x(){if(!(typeof window===e||!X)){try{window.localStorage.removeItem(X)}catch{}try{window.document.cookie=encodeURIComponent(X)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function k(A){var T=A;if(typeof T=="string"&&G.levels[T.toUpperCase()]!==void 0&&(T=G.levels[T.toUpperCase()]),typeof T=="number"&&T>=0&&T<=G.levels.SILENT)return T;throw new TypeError("log.setLevel() called with invalid level: "+A)}G.name=D,G.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},G.methodFactory=U||E,G.getLevel=function(){return J??H??I},G.setLevel=function(A,T){return J=k(A),T!==!1&&W(J),v.call(G)},G.setDefaultLevel=function(A){H=k(A),$()||G.setLevel(A,!1)},G.resetLevel=function(){J=null,x(),v.call(G)},G.enableAll=function(A){G.setLevel(G.levels.TRACE,A)},G.disableAll=function(A){G.setLevel(G.levels.SILENT,A)},G.rebuild=function(){if(f!==G&&(I=k(f.getLevel())),v.call(G),f===G)for(var A in l)l[A].rebuild()},I=k(f?f.getLevel():"WARN");var b=$();b!=null&&(J=k(b)),v.call(G)}f=new S,f.getLogger=function(U){if(typeof U!="symbol"&&typeof U!="string"||U==="")throw new TypeError("You must supply a name when creating a logger.");var G=l[U];return G||(G=l[U]=new S(U,f.methodFactory)),G};var M=typeof window!==e?window.log:void 0;return f.noConflict=function(){return typeof window!==e&&window.log===f&&(window.log=M),f},f.getLoggers=function(){return l},f.default=f,f})}(Ps)),Ps.exports}var dp=gp();const ie=Cl(dp);class Os{isMarkerInstanceAvailable(){return this.markerInstance?!0:(ie.error("Marker instance is not available"),!1)}}var tt=63710088e-1,Nl={centimeters:tt*100,centimetres:tt*100,degrees:360/(2*Math.PI),feet:tt*3.28084,inches:tt*39.37,kilometers:tt/1e3,kilometres:tt/1e3,meters:tt,metres:tt,miles:tt/1609.344,millimeters:tt*1e3,millimetres:tt*1e3,nauticalmiles:tt/1852,radians:1,yards:tt*1.0936};function tn(n,r,e={}){const s={type:"Feature"};return(e.id===0||e.id)&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.properties=r||{},s.geometry=n,s}function vn(n,r,e={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Rs(n[0])||!Rs(n[1]))throw new Error("coordinates must contain numbers");return tn({type:"Point",coordinates:n},r,e)}function Dn(n,r,e={}){for(const u of n){if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(u[u.length-1].length!==u[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<u[u.length-1].length;l++)if(u[u.length-1][l]!==u[0][l])throw new Error("First and last Position are not equivalent.")}return tn({type:"Polygon",coordinates:n},r,e)}function qr(n,r,e={}){if(n.length<2)throw new Error("coordinates must be an array of two or more positions");return tn({type:"LineString",coordinates:n},r,e)}function $e(n,r={}){const e={type:"FeatureCollection"};return r.id&&(e.id=r.id),r.bbox&&(e.bbox=r.bbox),e.features=n,e}function pp(n,r,e={}){return tn({type:"MultiLineString",coordinates:n},r,e)}function xo(n,r,e={}){return tn({type:"MultiPolygon",coordinates:n},r,e)}function wo(n,r="kilometers"){const e=Nl[r];if(!e)throw new Error(r+" units is invalid");return n*e}function ko(n,r="kilometers"){const e=Nl[r];if(!e)throw new Error(r+" units is invalid");return n/e}function wr(n){return n%(2*Math.PI)*180/Math.PI}function nt(n){return n%360*Math.PI/180}function Pl(n,r="kilometers",e="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return wo(ko(n,r),e)}function Rs(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Ds(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function tr(n,r,e){if(n!==null)for(var s,u,l,f,h,m,d,v=0,y=0,E,S=n.type,M=S==="FeatureCollection",D=S==="Feature",U=M?n.features.length:1,G=0;G<U;G++){d=M?n.features[G].geometry:D?n.geometry:n,E=d?d.type==="GeometryCollection":!1,h=E?d.geometries.length:1;for(var I=0;I<h;I++){var H=0,J=0;if(f=E?d.geometries[I]:d,f!==null){m=f.coordinates;var X=f.type;switch(v=e&&(X==="Polygon"||X==="MultiPolygon")?1:0,X){case null:break;case"Point":if(r(m,y,G,H,J)===!1)return!1;y++,H++;break;case"LineString":case"MultiPoint":for(s=0;s<m.length;s++){if(r(m[s],y,G,H,J)===!1)return!1;y++,X==="MultiPoint"&&H++}X==="LineString"&&H++;break;case"Polygon":case"MultiLineString":for(s=0;s<m.length;s++){for(u=0;u<m[s].length-v;u++){if(r(m[s][u],y,G,H,J)===!1)return!1;y++}X==="MultiLineString"&&H++,X==="Polygon"&&J++}X==="Polygon"&&H++;break;case"MultiPolygon":for(s=0;s<m.length;s++){for(J=0,u=0;u<m[s].length;u++){for(l=0;l<m[s][u].length-v;l++){if(r(m[s][u][l],y,G,H,J)===!1)return!1;y++}J++}H++}break;case"GeometryCollection":for(s=0;s<f.geometries.length;s++)if(tr(f.geometries[s],r,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function yn(n,r){if(n.type==="Feature")r(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&r(n.features[e],e)!==!1;e++);}function mp(n,r,e){var s=e;return yn(n,function(u,l){l===0&&e===void 0?s=u:s=r(s,u,l)}),s}function nr(n,r){var e,s,u,l,f,h,m,d,v,y,E=0,S=n.type==="FeatureCollection",M=n.type==="Feature",D=S?n.features.length:1;for(e=0;e<D;e++){for(h=S?n.features[e].geometry:M?n.geometry:n,d=S?n.features[e].properties:M?n.properties:{},v=S?n.features[e].bbox:M?n.bbox:void 0,y=S?n.features[e].id:M?n.id:void 0,m=h?h.type==="GeometryCollection":!1,f=m?h.geometries.length:1,u=0;u<f;u++){if(l=m?h.geometries[u]:h,l===null){if(r(null,E,d,v,y)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(l,E,d,v,y)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<l.geometries.length;s++)if(r(l.geometries[s],E,d,v,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function vp(n,r,e){var s=e;return nr(n,function(u,l,f,h,m){s=r(s,u,l,f,h,m)}),s}function rr(n,r){nr(n,function(e,s,u,l,f){var h=e===null?null:e.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return r(tn(e,u,{bbox:l,id:f}),s,0)===!1?!1:void 0}var m;switch(h){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var d=0;d<e.coordinates.length;d++){var v=e.coordinates[d],y={type:m,coordinates:v};if(r(tn(y,u),s,d)===!1)return!1}})}function _n(n,r={}){if(n.bbox!=null&&r.recompute!==!0)return n.bbox;const e=[1/0,1/0,-1/0,-1/0];return tr(n,s=>{e[0]>s[0]&&(e[0]=s[0]),e[1]>s[1]&&(e[1]=s[1]),e[2]<s[0]&&(e[2]=s[0]),e[3]<s[1]&&(e[3]=s[1])}),e}var Ol=_n;function We(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ct(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ni(n){return n.type==="Feature"?n.geometry:n}function Rl(n,r){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Dl(n,r,e,s={}){const u=We(n),l=nt(u[0]),f=nt(u[1]),h=nt(e),m=ko(r,s.units),d=Math.asin(Math.sin(f)*Math.cos(m)+Math.cos(f)*Math.sin(m)*Math.cos(h)),v=l+Math.atan2(Math.sin(h)*Math.sin(m)*Math.cos(f),Math.cos(m)-Math.sin(f)*Math.sin(d)),y=wr(v),E=wr(d);return vn([y,E],s.properties)}function yp(n,r,e={}){const s=e.steps||64,u=e.properties?e.properties:!Array.isArray(n)&&n.type==="Feature"&&n.properties?n.properties:{},l=[];for(let f=0;f<s;f++)l.push(Dl(n,r,f*-360/s,e).geometry.coordinates);return l.push(l[0]),Dn([l],u)}var _p=yp;function Fl(n,r={}){let e=0,s=0,u=0;return tr(n,function(l){e+=l[0],s+=l[1],u++},!0),vn([e/u,s/u],r.properties)}var Gl=Fl;function Ep(n,r,e={}){let s;return e.final?s=Bl(We(r),We(n)):s=Bl(We(n),We(r)),s>180?-(360-s):s}function Bl(n,r){const e=nt(n[1]),s=nt(r[1]);let u=nt(r[0]-n[0]);u>Math.PI&&(u-=2*Math.PI),u<-Math.PI&&(u+=2*Math.PI);const l=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(e/2+Math.PI/4)),f=Math.atan2(u,l);return(wr(f)+360)%360}function xp(n,r,e={}){const s=We(n),u=We(r);u[0]+=u[0]-s[0]>180?-360:s[0]-u[0]>180?360:0;const l=wp(s,u);return Pl(l,"meters",e.units)}function wp(n,r,e){e=e===void 0?tt:Number(e);const s=e,u=n[1]*Math.PI/180,l=r[1]*Math.PI/180,f=l-u;let h=Math.abs(r[0]-n[0])*Math.PI/180;h>Math.PI&&(h-=2*Math.PI);const m=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(u/2+Math.PI/4)),d=Math.abs(m)>1e-11?f/m:Math.cos(u);return Math.sqrt(f*f+d*d*h*h)*s}function kp(n,r,e,s={}){const u=r<0;let l=Pl(Math.abs(r),s.units,"meters");u&&(l=-Math.abs(l));const f=We(n),h=Sp(f,l,e);return h[0]+=h[0]-f[0]>180?-360:f[0]-h[0]>180?360:0,vn(h,s.properties)}function Sp(n,r,e,s){s=s===void 0?tt:Number(s);const u=r/s,l=n[0]*Math.PI/180,f=nt(n[1]),h=nt(e),m=u*Math.cos(h);let d=f+m;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);const v=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(f/2+Math.PI/4)),y=Math.abs(v)>1e-11?m/v:Math.cos(f),E=u*Math.sin(h)/y;return[((l+E)*180/Math.PI+540)%360-180,d*180/Math.PI]}function Fs(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return Ul(n);case"FeatureCollection":return Mp(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return So(n);default:throw new Error("unknown GeoJSON type")}}function Ul(n){const r={type:"Feature"};return Object.keys(n).forEach(e=>{switch(e){case"type":case"properties":case"geometry":return;default:r[e]=n[e]}}),r.properties=zl(n.properties),n.geometry==null?r.geometry=null:r.geometry=So(n.geometry),r}function zl(n){const r={};return n&&Object.keys(n).forEach(e=>{const s=n[e];typeof s=="object"?s===null?r[e]=null:Array.isArray(s)?r[e]=s.map(u=>u):r[e]=zl(s):r[e]=s}),r}function Mp(n){const r={type:"FeatureCollection"};return Object.keys(n).forEach(e=>{switch(e){case"type":case"features":return;default:r[e]=n[e]}}),r.features=n.features.map(e=>Ul(e)),r}function So(n){const r={type:n.type};return n.bbox&&(r.bbox=n.bbox),n.type==="GeometryCollection"?(r.geometries=n.geometries.map(e=>So(e)),r):(r.coordinates=ql(n.coordinates),r)}function ql(n){const r=n;return typeof r[0]!="object"?r.slice():r.map(e=>ql(e))}var Yl=Fs;function Hl(n,r,e){if(e=e||{},!Ds(e))throw new Error("options is invalid");const s=e.pivot,u=e.mutate;if(!n)throw new Error("geojson is required");if(r==null||isNaN(r))throw new Error("angle is required");if(r===0)return n;const l=s??Fl(n);return(u===!1||u===void 0)&&(n=Fs(n)),tr(n,function(f){const m=Ep(l,f)+r,d=xp(l,f),v=Ct(kp(l,d,m));f[0]=v[0],f[1]=v[1]}),n}var Ip=Hl;function Jl(n,r,e,s){s=s||{};let u=s.steps||64;const l=s.units||"kilometers";let f=s.angle||0;const h=s.pivot||n,m=s.properties||{};if(!n)throw new Error("center is required");if(!r)throw new Error("xSemiAxis is required");if(!e)throw new Error("ySemiAxis is required");if(!Ds(s))throw new Error("options must be an object");if(!Rs(u))throw new Error("steps must be a number");if(!Rs(f))throw new Error("angle must be a number");const d=We(Hl(vn(We(n)),f,{pivot:h}));f=-90+f,u=Math.ceil(u/4);const v=[],y=[],E=r,S=e,M=S,D=(E-S)/(Math.PI/2),U=(E+S)*Math.PI/4,G=.5,I=u;let H=0,J=0;for(let W=0;W<u;W++)J+=H,D===0?H=U/I/M:H=(-(D*J+M)+Math.sqrt(Math.pow(D*J+M,2)-4*(G*D)*-(U/I)))/(2*(G*D)),J!=0&&v.push(J);y.push(0);for(let W=0;W<v.length;W++)y.push(v[W]);y.push(Math.PI/2);for(let W=0;W<v.length;W++)y.push(Math.PI-v[v.length-W-1]);y.push(Math.PI);for(let W=0;W<v.length;W++)y.push(Math.PI+v[W]);y.push(3*Math.PI/2);for(let W=0;W<v.length;W++)y.push(2*Math.PI-v[v.length-W-1]);y.push(0);const X=[];for(const W of y){const $=Math.atan2(S*Math.sin(W),E*Math.cos(W)),x=Math.sqrt(Math.pow(E,2)*Math.pow(S,2)/(Math.pow(E*Math.sin($),2)+Math.pow(S*Math.cos($),2)));X.push(Dl(d,x,f+wr($),{units:l}).geometry.coordinates)}return Dn([X],m)}function Vl(n,r,e={}){if(e.final===!0)return Lp(n,r);const s=We(n),u=We(r),l=nt(s[0]),f=nt(u[0]),h=nt(s[1]),m=nt(u[1]),d=Math.sin(f-l)*Math.cos(m),v=Math.cos(h)*Math.sin(m)-Math.sin(h)*Math.cos(m)*Math.cos(f-l);return wr(Math.atan2(d,v))}function Lp(n,r){let e=Vl(r,n);return e=(e+180)%360,e}var Gs=Vl;function Tt(n,r,e={}){var s=We(n),u=We(r),l=nt(u[1]-s[1]),f=nt(u[0]-s[0]),h=nt(s[1]),m=nt(u[1]),d=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(h)*Math.cos(m);return wo(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),e.units)}var Xl=Tt;function Mo(n,r={}){const e=Ni(n);switch(!r.properties&&n.type==="Feature"&&(r.properties=n.properties),e.type){case"Polygon":return Wl(e,r);case"MultiPolygon":return Zl(e,r);default:throw new Error("invalid poly")}}function Wl(n,r={}){const s=Ni(n).coordinates,u=r.properties?r.properties:n.type==="Feature"?n.properties:{};return jl(s,u)}function Zl(n,r={}){const s=Ni(n).coordinates,u=r.properties?r.properties:n.type==="Feature"?n.properties:{},l=[];return s.forEach(f=>{l.push(jl(f,u))}),$e(l)}function jl(n,r){return n.length>1?pp(n,r):qr(n[0],r)}var $l=typeof global=="object"&&global&&global.Object===Object&&global,bp=typeof self=="object"&&self&&self.Object===Object&&self,nn=$l||bp||Function("return this")(),Ut=nn.Symbol,Kl=Object.prototype,Ap=Kl.hasOwnProperty,Cp=Kl.toString,Pi=Ut?Ut.toStringTag:void 0;function Tp(n){var r=Ap.call(n,Pi),e=n[Pi];try{n[Pi]=void 0;var s=!0}catch{}var u=Cp.call(n);return s&&(r?n[Pi]=e:delete n[Pi]),u}var Np=Object.prototype,Pp=Np.toString;function Op(n){return Pp.call(n)}var Rp="[object Null]",Dp="[object Undefined]",Ql=Ut?Ut.toStringTag:void 0;function kr(n){return n==null?n===void 0?Dp:Rp:Ql&&Ql in Object(n)?Tp(n):Op(n)}function En(n){return n!=null&&typeof n=="object"}var Fp="[object Symbol]";function Yr(n){return typeof n=="symbol"||En(n)&&kr(n)==Fp}function Hr(n,r){for(var e=-1,s=n==null?0:n.length,u=Array(s);++e<s;)u[e]=r(n[e],e,n);return u}var mt=Array.isArray,ec=Ut?Ut.prototype:void 0,tc=ec?ec.toString:void 0;function nc(n){if(typeof n=="string")return n;if(mt(n))return Hr(n,nc)+"";if(Yr(n))return tc?tc.call(n):"";var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}var Gp=/\s/;function Bp(n){for(var r=n.length;r--&&Gp.test(n.charAt(r)););return r}var Up=/^\s+/;function zp(n){return n&&n.slice(0,Bp(n)+1).replace(Up,"")}function Nt(n){var r=typeof n;return n!=null&&(r=="object"||r=="function")}var rc=NaN,qp=/^[-+]0x[0-9a-f]+$/i,Yp=/^0b[01]+$/i,Hp=/^0o[0-7]+$/i,Jp=parseInt;function ic(n){if(typeof n=="number")return n;if(Yr(n))return rc;if(Nt(n)){var r=typeof n.valueOf=="function"?n.valueOf():n;n=Nt(r)?r+"":r}if(typeof n!="string")return n===0?n:+n;n=zp(n);var e=Yp.test(n);return e||Hp.test(n)?Jp(n.slice(2),e?2:8):qp.test(n)?rc:+n}function Bs(n){return n}var Vp="[object AsyncFunction]",Xp="[object Function]",Wp="[object GeneratorFunction]",Zp="[object Proxy]";function Io(n){if(!Nt(n))return!1;var r=kr(n);return r==Xp||r==Wp||r==Vp||r==Zp}var Lo=nn["__core-js_shared__"],sc=function(){var n=/[^.]+$/.exec(Lo&&Lo.keys&&Lo.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function jp(n){return!!sc&&sc in n}var $p=Function.prototype,Kp=$p.toString;function Sr(n){if(n!=null){try{return Kp.call(n)}catch{}try{return n+""}catch{}}return""}var Qp=/[\\^$.*+?()[\]{}|]/g,em=/^\[object .+?Constructor\]$/,tm=Function.prototype,nm=Object.prototype,rm=tm.toString,im=nm.hasOwnProperty,sm=RegExp("^"+rm.call(im).replace(Qp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function am(n){if(!Nt(n)||jp(n))return!1;var r=Io(n)?sm:em;return r.test(Sr(n))}function om(n,r){return n==null?void 0:n[r]}function Mr(n,r){var e=om(n,r);return am(e)?e:void 0}var bo=Mr(nn,"WeakMap"),ac=Object.create,um=function(){function n(){}return function(r){if(!Nt(r))return{};if(ac)return ac(r);n.prototype=r;var e=new n;return n.prototype=void 0,e}}();function lm(n,r,e){switch(e.length){case 0:return n.call(r);case 1:return n.call(r,e[0]);case 2:return n.call(r,e[0],e[1]);case 3:return n.call(r,e[0],e[1],e[2])}return n.apply(r,e)}function cm(){}function hm(n,r){var e=-1,s=n.length;for(r||(r=Array(s));++e<s;)r[e]=n[e];return r}var fm=800,gm=16,dm=Date.now;function pm(n){var r=0,e=0;return function(){var s=dm(),u=gm-(s-e);if(e=s,u>0){if(++r>=fm)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}function mm(n){return function(){return n}}var Us=function(){try{var n=Mr(Object,"defineProperty");return n({},"",{}),n}catch{}}(),vm=Us?function(n,r){return Us(n,"toString",{configurable:!0,enumerable:!1,value:mm(r),writable:!0})}:Bs,ym=pm(vm);function _m(n,r){for(var e=-1,s=n==null?0:n.length;++e<s&&r(n[e],e,n)!==!1;);return n}function Em(n,r,e,s){for(var u=n.length,l=e+-1;++l<u;)if(r(n[l],l,n))return l;return-1}function xm(n){return n!==n}function wm(n,r,e){for(var s=e-1,u=n.length;++s<u;)if(n[s]===r)return s;return-1}function km(n,r,e){return r===r?wm(n,r,e):Em(n,xm,e)}function oc(n,r){var e=n==null?0:n.length;return!!e&&km(n,r,0)>-1}var Sm=9007199254740991,Mm=/^(?:0|[1-9]\d*)$/;function Ao(n,r){var e=typeof n;return r=r??Sm,!!r&&(e=="number"||e!="symbol"&&Mm.test(n))&&n>-1&&n%1==0&&n<r}function zs(n,r,e){r=="__proto__"&&Us?Us(n,r,{configurable:!0,enumerable:!0,value:e,writable:!0}):n[r]=e}function Oi(n,r){return n===r||n!==n&&r!==r}var Im=Object.prototype,Lm=Im.hasOwnProperty;function uc(n,r,e){var s=n[r];(!(Lm.call(n,r)&&Oi(s,e))||e===void 0&&!(r in n))&&zs(n,r,e)}function bm(n,r,e,s){var u=!e;e||(e={});for(var l=-1,f=r.length;++l<f;){var h=r[l],m=void 0;m===void 0&&(m=n[h]),u?zs(e,h,m):uc(e,h,m)}return e}var lc=Math.max;function Am(n,r,e){return r=lc(r===void 0?n.length-1:r,0),function(){for(var s=arguments,u=-1,l=lc(s.length-r,0),f=Array(l);++u<l;)f[u]=s[r+u];u=-1;for(var h=Array(r+1);++u<r;)h[u]=s[u];return h[r]=e(f),lm(n,this,h)}}function Co(n,r){return ym(Am(n,r,Bs),n+"")}var Cm=9007199254740991;function To(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=Cm}function Jr(n){return n!=null&&To(n.length)&&!Io(n)}function No(n,r,e){if(!Nt(e))return!1;var s=typeof r;return(s=="number"?Jr(e)&&Ao(r,e.length):s=="string"&&r in e)?Oi(e[r],n):!1}function cc(n){return Co(function(r,e){var s=-1,u=e.length,l=u>1?e[u-1]:void 0,f=u>2?e[2]:void 0;for(l=n.length>3&&typeof l=="function"?(u--,l):void 0,f&&No(e[0],e[1],f)&&(l=u<3?void 0:l,u=1),r=Object(r);++s<u;){var h=e[s];h&&n(r,h,s,l)}return r})}var Tm=Object.prototype;function Po(n){var r=n&&n.constructor,e=typeof r=="function"&&r.prototype||Tm;return n===e}function Nm(n,r){for(var e=-1,s=Array(n);++e<n;)s[e]=r(e);return s}var Pm="[object Arguments]";function hc(n){return En(n)&&kr(n)==Pm}var fc=Object.prototype,Om=fc.hasOwnProperty,Rm=fc.propertyIsEnumerable,Ri=hc(function(){return arguments}())?hc:function(n){return En(n)&&Om.call(n,"callee")&&!Rm.call(n,"callee")};function Dm(){return!1}var gc=typeof ee=="object"&&ee&&!ee.nodeType&&ee,dc=gc&&typeof module=="object"&&module&&!module.nodeType&&module,Fm=dc&&dc.exports===gc,pc=Fm?nn.Buffer:void 0,Gm=pc?pc.isBuffer:void 0,Di=Gm||Dm,Bm="[object Arguments]",Um="[object Array]",zm="[object Boolean]",qm="[object Date]",Ym="[object Error]",Hm="[object Function]",Jm="[object Map]",Vm="[object Number]",Xm="[object Object]",Wm="[object RegExp]",Zm="[object Set]",jm="[object String]",$m="[object WeakMap]",Km="[object ArrayBuffer]",Qm="[object DataView]",ev="[object Float32Array]",tv="[object Float64Array]",nv="[object Int8Array]",rv="[object Int16Array]",iv="[object Int32Array]",sv="[object Uint8Array]",av="[object Uint8ClampedArray]",ov="[object Uint16Array]",uv="[object Uint32Array]",qe={};qe[ev]=qe[tv]=qe[nv]=qe[rv]=qe[iv]=qe[sv]=qe[av]=qe[ov]=qe[uv]=!0,qe[Bm]=qe[Um]=qe[Km]=qe[zm]=qe[Qm]=qe[qm]=qe[Ym]=qe[Hm]=qe[Jm]=qe[Vm]=qe[Xm]=qe[Wm]=qe[Zm]=qe[jm]=qe[$m]=!1;function lv(n){return En(n)&&To(n.length)&&!!qe[kr(n)]}function qs(n){return function(r){return n(r)}}var mc=typeof ee=="object"&&ee&&!ee.nodeType&&ee,Fi=mc&&typeof module=="object"&&module&&!module.nodeType&&module,cv=Fi&&Fi.exports===mc,Oo=cv&&$l.process,Vr=function(){try{var n=Fi&&Fi.require&&Fi.require("util").types;return n||Oo&&Oo.binding&&Oo.binding("util")}catch{}}(),vc=Vr&&Vr.isTypedArray,Ro=vc?qs(vc):lv,hv=Object.prototype,fv=hv.hasOwnProperty;function yc(n,r){var e=mt(n),s=!e&&Ri(n),u=!e&&!s&&Di(n),l=!e&&!s&&!u&&Ro(n),f=e||s||u||l,h=f?Nm(n.length,String):[],m=h.length;for(var d in n)(r||fv.call(n,d))&&!(f&&(d=="length"||u&&(d=="offset"||d=="parent")||l&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||Ao(d,m)))&&h.push(d);return h}function _c(n,r){return function(e){return n(r(e))}}var gv=_c(Object.keys,Object),dv=Object.prototype,pv=dv.hasOwnProperty;function mv(n){if(!Po(n))return gv(n);var r=[];for(var e in Object(n))pv.call(n,e)&&e!="constructor"&&r.push(e);return r}function Ys(n){return Jr(n)?yc(n):mv(n)}function vv(n){var r=[];if(n!=null)for(var e in Object(n))r.push(e);return r}var yv=Object.prototype,_v=yv.hasOwnProperty;function Ev(n){if(!Nt(n))return vv(n);var r=Po(n),e=[];for(var s in n)s=="constructor"&&(r||!_v.call(n,s))||e.push(s);return e}function Ec(n){return Jr(n)?yc(n,!0):Ev(n)}var xv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wv=/^\w*$/;function Do(n,r){if(mt(n))return!1;var e=typeof n;return e=="number"||e=="symbol"||e=="boolean"||n==null||Yr(n)?!0:wv.test(n)||!xv.test(n)||r!=null&&n in Object(r)}var Gi=Mr(Object,"create");function kv(){this.__data__=Gi?Gi(null):{},this.size=0}function Sv(n){var r=this.has(n)&&delete this.__data__[n];return this.size-=r?1:0,r}var Mv="__lodash_hash_undefined__",Iv=Object.prototype,Lv=Iv.hasOwnProperty;function bv(n){var r=this.__data__;if(Gi){var e=r[n];return e===Mv?void 0:e}return Lv.call(r,n)?r[n]:void 0}var Av=Object.prototype,Cv=Av.hasOwnProperty;function Tv(n){var r=this.__data__;return Gi?r[n]!==void 0:Cv.call(r,n)}var Nv="__lodash_hash_undefined__";function Pv(n,r){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=Gi&&r===void 0?Nv:r,this}function Ir(n){var r=-1,e=n==null?0:n.length;for(this.clear();++r<e;){var s=n[r];this.set(s[0],s[1])}}Ir.prototype.clear=kv,Ir.prototype.delete=Sv,Ir.prototype.get=bv,Ir.prototype.has=Tv,Ir.prototype.set=Pv;function Ov(){this.__data__=[],this.size=0}function Hs(n,r){for(var e=n.length;e--;)if(Oi(n[e][0],r))return e;return-1}var Rv=Array.prototype,Dv=Rv.splice;function Fv(n){var r=this.__data__,e=Hs(r,n);if(e<0)return!1;var s=r.length-1;return e==s?r.pop():Dv.call(r,e,1),--this.size,!0}function Gv(n){var r=this.__data__,e=Hs(r,n);return e<0?void 0:r[e][1]}function Bv(n){return Hs(this.__data__,n)>-1}function Uv(n,r){var e=this.__data__,s=Hs(e,n);return s<0?(++this.size,e.push([n,r])):e[s][1]=r,this}function Fn(n){var r=-1,e=n==null?0:n.length;for(this.clear();++r<e;){var s=n[r];this.set(s[0],s[1])}}Fn.prototype.clear=Ov,Fn.prototype.delete=Fv,Fn.prototype.get=Gv,Fn.prototype.has=Bv,Fn.prototype.set=Uv;var Bi=Mr(nn,"Map");function zv(){this.size=0,this.__data__={hash:new Ir,map:new(Bi||Fn),string:new Ir}}function qv(n){var r=typeof n;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?n!=="__proto__":n===null}function Js(n,r){var e=n.__data__;return qv(r)?e[typeof r=="string"?"string":"hash"]:e.map}function Yv(n){var r=Js(this,n).delete(n);return this.size-=r?1:0,r}function Hv(n){return Js(this,n).get(n)}function Jv(n){return Js(this,n).has(n)}function Vv(n,r){var e=Js(this,n),s=e.size;return e.set(n,r),this.size+=e.size==s?0:1,this}function Gn(n){var r=-1,e=n==null?0:n.length;for(this.clear();++r<e;){var s=n[r];this.set(s[0],s[1])}}Gn.prototype.clear=zv,Gn.prototype.delete=Yv,Gn.prototype.get=Hv,Gn.prototype.has=Jv,Gn.prototype.set=Vv;var Xv="Expected a function";function Fo(n,r){if(typeof n!="function"||r!=null&&typeof r!="function")throw new TypeError(Xv);var e=function(){var s=arguments,u=r?r.apply(this,s):s[0],l=e.cache;if(l.has(u))return l.get(u);var f=n.apply(this,s);return e.cache=l.set(u,f)||l,f};return e.cache=new(Fo.Cache||Gn),e}Fo.Cache=Gn;var Wv=500;function Zv(n){var r=Fo(n,function(s){return e.size===Wv&&e.clear(),s}),e=r.cache;return r}var jv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$v=/\\(\\)?/g,Kv=Zv(function(n){var r=[];return n.charCodeAt(0)===46&&r.push(""),n.replace(jv,function(e,s,u,l){r.push(u?l.replace($v,"$1"):s||e)}),r});function Qv(n){return n==null?"":nc(n)}function xc(n,r){return mt(n)?n:Do(n,r)?[n]:Kv(Qv(n))}function Vs(n){if(typeof n=="string"||Yr(n))return n;var r=n+"";return r=="0"&&1/n==-1/0?"-0":r}function Go(n,r){r=xc(r,n);for(var e=0,s=r.length;n!=null&&e<s;)n=n[Vs(r[e++])];return e&&e==s?n:void 0}function Xr(n,r,e){var s=n==null?void 0:Go(n,r);return s===void 0?e:s}function wc(n,r){for(var e=-1,s=r.length,u=n.length;++e<s;)n[u+e]=r[e];return n}var kc=Ut?Ut.isConcatSpreadable:void 0;function ey(n){return mt(n)||Ri(n)||!!(kc&&n&&n[kc])}function ty(n,r,e,s,u){var l=-1,f=n.length;for(e||(e=ey),u||(u=[]);++l<f;){var h=n[l];e(h)?wc(u,h):u[u.length]=h}return u}var Sc=_c(Object.getPrototypeOf,Object),ny="[object Object]",ry=Function.prototype,iy=Object.prototype,Mc=ry.toString,sy=iy.hasOwnProperty,ay=Mc.call(Object);function oy(n){if(!En(n)||kr(n)!=ny)return!1;var r=Sc(n);if(r===null)return!0;var e=sy.call(r,"constructor")&&r.constructor;return typeof e=="function"&&e instanceof e&&Mc.call(e)==ay}function uy(){this.__data__=new Fn,this.size=0}function ly(n){var r=this.__data__,e=r.delete(n);return this.size=r.size,e}function cy(n){return this.__data__.get(n)}function hy(n){return this.__data__.has(n)}var fy=200;function gy(n,r){var e=this.__data__;if(e instanceof Fn){var s=e.__data__;if(!Bi||s.length<fy-1)return s.push([n,r]),this.size=++e.size,this;e=this.__data__=new Gn(s)}return e.set(n,r),this.size=e.size,this}function rn(n){var r=this.__data__=new Fn(n);this.size=r.size}rn.prototype.clear=uy,rn.prototype.delete=ly,rn.prototype.get=cy,rn.prototype.has=hy,rn.prototype.set=gy;var Ic=typeof ee=="object"&&ee&&!ee.nodeType&&ee,Lc=Ic&&typeof module=="object"&&module&&!module.nodeType&&module,dy=Lc&&Lc.exports===Ic,bc=dy?nn.Buffer:void 0,Ac=bc?bc.allocUnsafe:void 0;function Cc(n,r){if(r)return n.slice();var e=n.length,s=Ac?Ac(e):new n.constructor(e);return n.copy(s),s}function py(n,r){for(var e=-1,s=n==null?0:n.length,u=0,l=[];++e<s;){var f=n[e];r(f,e,n)&&(l[u++]=f)}return l}function my(){return[]}var vy=Object.prototype,yy=vy.propertyIsEnumerable,Tc=Object.getOwnPropertySymbols,_y=Tc?function(n){return n==null?[]:(n=Object(n),py(Tc(n),function(r){return yy.call(n,r)}))}:my;function Ey(n,r,e){var s=r(n);return mt(n)?s:wc(s,e(n))}function Bo(n){return Ey(n,Ys,_y)}var Uo=Mr(nn,"DataView"),zo=Mr(nn,"Promise"),Wr=Mr(nn,"Set"),Nc="[object Map]",xy="[object Object]",Pc="[object Promise]",Oc="[object Set]",Rc="[object WeakMap]",Dc="[object DataView]",wy=Sr(Uo),ky=Sr(Bi),Sy=Sr(zo),My=Sr(Wr),Iy=Sr(bo),sn=kr;(Uo&&sn(new Uo(new ArrayBuffer(1)))!=Dc||Bi&&sn(new Bi)!=Nc||zo&&sn(zo.resolve())!=Pc||Wr&&sn(new Wr)!=Oc||bo&&sn(new bo)!=Rc)&&(sn=function(n){var r=kr(n),e=r==xy?n.constructor:void 0,s=e?Sr(e):"";if(s)switch(s){case wy:return Dc;case ky:return Nc;case Sy:return Pc;case My:return Oc;case Iy:return Rc}return r});var Ly=Object.prototype,by=Ly.hasOwnProperty;function Ay(n){var r=n.length,e=new n.constructor(r);return r&&typeof n[0]=="string"&&by.call(n,"index")&&(e.index=n.index,e.input=n.input),e}var Xs=nn.Uint8Array;function qo(n){var r=new n.constructor(n.byteLength);return new Xs(r).set(new Xs(n)),r}function Cy(n,r){var e=qo(n.buffer);return new n.constructor(e,n.byteOffset,n.byteLength)}var Ty=/\w*$/;function Ny(n){var r=new n.constructor(n.source,Ty.exec(n));return r.lastIndex=n.lastIndex,r}var Fc=Ut?Ut.prototype:void 0,Gc=Fc?Fc.valueOf:void 0;function Py(n){return Gc?Object(Gc.call(n)):{}}function Bc(n,r){var e=r?qo(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)}var Oy="[object Boolean]",Ry="[object Date]",Dy="[object Map]",Fy="[object Number]",Gy="[object RegExp]",By="[object Set]",Uy="[object String]",zy="[object Symbol]",qy="[object ArrayBuffer]",Yy="[object DataView]",Hy="[object Float32Array]",Jy="[object Float64Array]",Vy="[object Int8Array]",Xy="[object Int16Array]",Wy="[object Int32Array]",Zy="[object Uint8Array]",jy="[object Uint8ClampedArray]",$y="[object Uint16Array]",Ky="[object Uint32Array]";function Qy(n,r,e){var s=n.constructor;switch(r){case qy:return qo(n);case Oy:case Ry:return new s(+n);case Yy:return Cy(n);case Hy:case Jy:case Vy:case Xy:case Wy:case Zy:case jy:case $y:case Ky:return Bc(n,e);case Dy:return new s;case Fy:case Uy:return new s(n);case Gy:return Ny(n);case By:return new s;case zy:return Py(n)}}function Uc(n){return typeof n.constructor=="function"&&!Po(n)?um(Sc(n)):{}}var e0="[object Map]";function t0(n){return En(n)&&sn(n)==e0}var zc=Vr&&Vr.isMap,n0=zc?qs(zc):t0,r0="[object Set]";function i0(n){return En(n)&&sn(n)==r0}var qc=Vr&&Vr.isSet,s0=qc?qs(qc):i0,a0=1,Yc="[object Arguments]",o0="[object Array]",u0="[object Boolean]",l0="[object Date]",c0="[object Error]",Hc="[object Function]",h0="[object GeneratorFunction]",f0="[object Map]",g0="[object Number]",Jc="[object Object]",d0="[object RegExp]",p0="[object Set]",m0="[object String]",v0="[object Symbol]",y0="[object WeakMap]",_0="[object ArrayBuffer]",E0="[object DataView]",x0="[object Float32Array]",w0="[object Float64Array]",k0="[object Int8Array]",S0="[object Int16Array]",M0="[object Int32Array]",I0="[object Uint8Array]",L0="[object Uint8ClampedArray]",b0="[object Uint16Array]",A0="[object Uint32Array]",Ue={};Ue[Yc]=Ue[o0]=Ue[_0]=Ue[E0]=Ue[u0]=Ue[l0]=Ue[x0]=Ue[w0]=Ue[k0]=Ue[S0]=Ue[M0]=Ue[f0]=Ue[g0]=Ue[Jc]=Ue[d0]=Ue[p0]=Ue[m0]=Ue[v0]=Ue[I0]=Ue[L0]=Ue[b0]=Ue[A0]=!0,Ue[c0]=Ue[Hc]=Ue[y0]=!1;function Ws(n,r,e,s,u,l){var f,h=r&a0;if(f!==void 0)return f;if(!Nt(n))return n;var m=mt(n);if(m)f=Ay(n);else{var d=sn(n),v=d==Hc||d==h0;if(Di(n))return Cc(n,h);if(d==Jc||d==Yc||v&&!u)f=v?{}:Uc(n);else{if(!Ue[d])return u?n:{};f=Qy(n,d,h)}}l||(l=new rn);var y=l.get(n);if(y)return y;l.set(n,f),s0(n)?n.forEach(function(M){f.add(Ws(M,r,e,M,n,l))}):n0(n)&&n.forEach(function(M,D){f.set(D,Ws(M,r,e,D,n,l))});var E=Bo,S=m?void 0:E(n);return _m(S||n,function(M,D){S&&(D=M,M=n[D]),uc(f,D,Ws(M,r,e,D,n,l))}),f}var C0=1,T0=4;function an(n){return Ws(n,C0|T0)}var N0="__lodash_hash_undefined__";function P0(n){return this.__data__.set(n,N0),this}function O0(n){return this.__data__.has(n)}function Zr(n){var r=-1,e=n==null?0:n.length;for(this.__data__=new Gn;++r<e;)this.add(n[r])}Zr.prototype.add=Zr.prototype.push=P0,Zr.prototype.has=O0;function R0(n,r){for(var e=-1,s=n==null?0:n.length;++e<s;)if(r(n[e],e,n))return!0;return!1}function Zs(n,r){return n.has(r)}var D0=1,F0=2;function Vc(n,r,e,s,u,l){var f=e&D0,h=n.length,m=r.length;if(h!=m&&!(f&&m>h))return!1;var d=l.get(n),v=l.get(r);if(d&&v)return d==r&&v==n;var y=-1,E=!0,S=e&F0?new Zr:void 0;for(l.set(n,r),l.set(r,n);++y<h;){var M=n[y],D=r[y];if(s)var U=f?s(D,M,y,r,n,l):s(M,D,y,n,r,l);if(U!==void 0){if(U)continue;E=!1;break}if(S){if(!R0(r,function(G,I){if(!Zs(S,I)&&(M===G||u(M,G,e,s,l)))return S.push(I)})){E=!1;break}}else if(!(M===D||u(M,D,e,s,l))){E=!1;break}}return l.delete(n),l.delete(r),E}function G0(n){var r=-1,e=Array(n.size);return n.forEach(function(s,u){e[++r]=[u,s]}),e}function Yo(n){var r=-1,e=Array(n.size);return n.forEach(function(s){e[++r]=s}),e}var B0=1,U0=2,z0="[object Boolean]",q0="[object Date]",Y0="[object Error]",H0="[object Map]",J0="[object Number]",V0="[object RegExp]",X0="[object Set]",W0="[object String]",Z0="[object Symbol]",j0="[object ArrayBuffer]",$0="[object DataView]",Xc=Ut?Ut.prototype:void 0,Ho=Xc?Xc.valueOf:void 0;function K0(n,r,e,s,u,l,f){switch(e){case $0:if(n.byteLength!=r.byteLength||n.byteOffset!=r.byteOffset)return!1;n=n.buffer,r=r.buffer;case j0:return!(n.byteLength!=r.byteLength||!l(new Xs(n),new Xs(r)));case z0:case q0:case J0:return Oi(+n,+r);case Y0:return n.name==r.name&&n.message==r.message;case V0:case W0:return n==r+"";case H0:var h=G0;case X0:var m=s&B0;if(h||(h=Yo),n.size!=r.size&&!m)return!1;var d=f.get(n);if(d)return d==r;s|=U0,f.set(n,r);var v=Vc(h(n),h(r),s,u,l,f);return f.delete(n),v;case Z0:if(Ho)return Ho.call(n)==Ho.call(r)}return!1}var Q0=1,e1=Object.prototype,t1=e1.hasOwnProperty;function n1(n,r,e,s,u,l){var f=e&Q0,h=Bo(n),m=h.length,d=Bo(r),v=d.length;if(m!=v&&!f)return!1;for(var y=m;y--;){var E=h[y];if(!(f?E in r:t1.call(r,E)))return!1}var S=l.get(n),M=l.get(r);if(S&&M)return S==r&&M==n;var D=!0;l.set(n,r),l.set(r,n);for(var U=f;++y<m;){E=h[y];var G=n[E],I=r[E];if(s)var H=f?s(I,G,E,r,n,l):s(G,I,E,n,r,l);if(!(H===void 0?G===I||u(G,I,e,s,l):H)){D=!1;break}U||(U=E=="constructor")}if(D&&!U){var J=n.constructor,X=r.constructor;J!=X&&"constructor"in n&&"constructor"in r&&!(typeof J=="function"&&J instanceof J&&typeof X=="function"&&X instanceof X)&&(D=!1)}return l.delete(n),l.delete(r),D}var r1=1,Wc="[object Arguments]",Zc="[object Array]",js="[object Object]",i1=Object.prototype,jc=i1.hasOwnProperty;function s1(n,r,e,s,u,l){var f=mt(n),h=mt(r),m=f?Zc:sn(n),d=h?Zc:sn(r);m=m==Wc?js:m,d=d==Wc?js:d;var v=m==js,y=d==js,E=m==d;if(E&&Di(n)){if(!Di(r))return!1;f=!0,v=!1}if(E&&!v)return l||(l=new rn),f||Ro(n)?Vc(n,r,e,s,u,l):K0(n,r,m,e,s,u,l);if(!(e&r1)){var S=v&&jc.call(n,"__wrapped__"),M=y&&jc.call(r,"__wrapped__");if(S||M){var D=S?n.value():n,U=M?r.value():r;return l||(l=new rn),u(D,U,e,s,l)}}return E?(l||(l=new rn),n1(n,r,e,s,u,l)):!1}function $s(n,r,e,s,u){return n===r?!0:n==null||r==null||!En(n)&&!En(r)?n!==n&&r!==r:s1(n,r,e,s,$s,u)}var a1=1,o1=2;function u1(n,r,e,s){var u=e.length,l=u;if(n==null)return!l;for(n=Object(n);u--;){var f=e[u];if(f[2]?f[1]!==n[f[0]]:!(f[0]in n))return!1}for(;++u<l;){f=e[u];var h=f[0],m=n[h],d=f[1];if(f[2]){if(m===void 0&&!(h in n))return!1}else{var v=new rn,y;if(!(y===void 0?$s(d,m,a1|o1,s,v):y))return!1}}return!0}function $c(n){return n===n&&!Nt(n)}function l1(n){for(var r=Ys(n),e=r.length;e--;){var s=r[e],u=n[s];r[e]=[s,u,$c(u)]}return r}function Kc(n,r){return function(e){return e==null?!1:e[n]===r&&(r!==void 0||n in Object(e))}}function c1(n){var r=l1(n);return r.length==1&&r[0][2]?Kc(r[0][0],r[0][1]):function(e){return e===n||u1(e,n,r)}}function h1(n,r){return n!=null&&r in Object(n)}function f1(n,r,e){r=xc(r,n);for(var s=-1,u=r.length,l=!1;++s<u;){var f=Vs(r[s]);if(!(l=n!=null&&e(n,f)))break;n=n[f]}return l||++s!=u?l:(u=n==null?0:n.length,!!u&&To(u)&&Ao(f,u)&&(mt(n)||Ri(n)))}function g1(n,r){return n!=null&&f1(n,r,h1)}var d1=1,p1=2;function m1(n,r){return Do(n)&&$c(r)?Kc(Vs(n),r):function(e){var s=Xr(e,n);return s===void 0&&s===r?g1(e,n):$s(r,s,d1|p1)}}function v1(n){return function(r){return r==null?void 0:r[n]}}function y1(n){return function(r){return Go(r,n)}}function _1(n){return Do(n)?v1(Vs(n)):y1(n)}function Qc(n){return typeof n=="function"?n:n==null?Bs:typeof n=="object"?mt(n)?m1(n[0],n[1]):c1(n):_1(n)}function E1(n,r,e,s){for(var u=-1,l=n==null?0:n.length;++u<l;){var f=n[u];r(s,f,e(f),n)}return s}function x1(n){return function(r,e,s){for(var u=-1,l=Object(r),f=s(r),h=f.length;h--;){var m=f[++u];if(e(l[m],m,l)===!1)break}return r}}var eh=x1();function w1(n,r){return n&&eh(n,r,Ys)}function k1(n,r){return function(e,s){if(e==null)return e;if(!Jr(e))return n(e,s);for(var u=e.length,l=-1,f=Object(e);++l<u&&s(f[l],l,f)!==!1;);return e}}var th=k1(w1);function S1(n,r,e,s){return th(n,function(u,l,f){r(s,u,e(u),f)}),s}function M1(n,r){return function(e,s){var u=mt(e)?E1:S1,l=r?r():{};return u(e,n,Qc(s),l)}}var Jo=function(){return nn.Date.now()},I1="Expected a function",L1=Math.max,b1=Math.min;function Vo(n,r,e){var s,u,l,f,h,m,d=0,v=!1,y=!1,E=!0;if(typeof n!="function")throw new TypeError(I1);r=ic(r)||0,Nt(e)&&(v=!!e.leading,y="maxWait"in e,l=y?L1(ic(e.maxWait)||0,r):l,E="trailing"in e?!!e.trailing:E);function S(W){var $=s,x=u;return s=u=void 0,d=W,f=n.apply(x,$),f}function M(W){return d=W,h=setTimeout(G,r),v?S(W):f}function D(W){var $=W-m,x=W-d,k=r-$;return y?b1(k,l-x):k}function U(W){var $=W-m,x=W-d;return m===void 0||$>=r||$<0||y&&x>=l}function G(){var W=Jo();if(U(W))return I(W);h=setTimeout(G,D(W))}function I(W){return h=void 0,E&&s?S(W):(s=u=void 0,f)}function H(){h!==void 0&&clearTimeout(h),d=0,s=m=u=h=void 0}function J(){return h===void 0?f:I(Jo())}function X(){var W=Jo(),$=U(W);if(s=arguments,u=this,m=W,$){if(h===void 0)return M(m);if(y)return clearTimeout(h),h=setTimeout(G,r),S(m)}return h===void 0&&(h=setTimeout(G,r)),f}return X.cancel=H,X.flush=J,X}function Xo(n,r,e){(e!==void 0&&!Oi(n[r],e)||e===void 0&&!(r in n))&&zs(n,r,e)}function nh(n){return En(n)&&Jr(n)}function Wo(n,r){if(!(r==="constructor"&&typeof n[r]=="function")&&r!="__proto__")return n[r]}function A1(n){return bm(n,Ec(n))}function C1(n,r,e,s,u,l,f){var h=Wo(n,e),m=Wo(r,e),d=f.get(m);if(d){Xo(n,e,d);return}var v=l?l(h,m,e+"",n,r,f):void 0,y=v===void 0;if(y){var E=mt(m),S=!E&&Di(m),M=!E&&!S&&Ro(m);v=m,E||S||M?mt(h)?v=h:nh(h)?v=hm(h):S?(y=!1,v=Cc(m,!0)):M?(y=!1,v=Bc(m,!0)):v=[]:oy(m)||Ri(m)?(v=h,Ri(h)?v=A1(h):(!Nt(h)||Io(h))&&(v=Uc(m))):y=!1}y&&(f.set(m,v),u(v,m,s,l,f),f.delete(m)),Xo(n,e,v)}function Zo(n,r,e,s,u){n!==r&&eh(r,function(l,f){if(u||(u=new rn),Nt(l))C1(n,r,f,e,Zo,s,u);else{var h=s?s(Wo(n,f),l,f+"",n,r,u):void 0;h===void 0&&(h=l),Xo(n,f,h)}},Ec)}var T1=cc(function(n,r,e,s){Zo(n,r,e,s)});function N1(n,r,e){for(var s=-1,u=n==null?0:n.length;++s<u;)if(e(r,n[s]))return!0;return!1}function P1(n,r){var e=-1,s=Jr(n)?Array(n.length):[];return th(n,function(u,l,f){s[++e]=r(u,l,f)}),s}function O1(n,r){return Hr(r,function(e){return n[e]})}function R1(n){return n==null?[]:O1(n,Ys(n))}var D1=Math.min;function F1(n,r,e){for(var s=oc,u=n[0].length,l=n.length,f=l,h=Array(l),m=1/0,d=[];f--;){var v=n[f];m=D1(v.length,m),h[f]=u>=120&&v.length>=120?new Zr(f&&v):void 0}v=n[0];var y=-1,E=h[0];e:for(;++y<u&&d.length<m;){var S=v[y],M=S;if(S=S!==0?S:0,!(E?Zs(E,M):s(d,M))){for(f=l;--f;){var D=h[f];if(!(D?Zs(D,M):s(n[f],M)))continue e}E&&E.push(M),d.push(S)}}return d}function G1(n){return nh(n)?n:[]}var B1=Co(function(n){var r=Hr(n,G1);return r.length&&r[0]===n[0]?F1(r):[]});function Ks(n,r){return $s(n,r)}var U1=M1(function(n,r,e){zs(n,e,r)}),z1=cc(function(n,r,e){Zo(n,r,e)});function q1(n,r){var e=n.length;for(n.sort(r);e--;)n[e]=n[e].value;return n}function Y1(n,r){if(n!==r){var e=n!==void 0,s=n===null,u=n===n,l=Yr(n),f=r!==void 0,h=r===null,m=r===r,d=Yr(r);if(!h&&!d&&!l&&n>r||l&&f&&m&&!h&&!d||s&&f&&m||!e&&m||!u)return 1;if(!s&&!l&&!d&&n<r||d&&e&&u&&!s&&!l||h&&e&&u||!f&&u||!m)return-1}return 0}function H1(n,r,e){for(var s=-1,u=n.criteria,l=r.criteria,f=u.length,h=e.length;++s<f;){var m=Y1(u[s],l[s]);if(m){if(s>=h)return m;var d=e[s];return m*(d=="desc"?-1:1)}}return n.index-r.index}function J1(n,r,e){r.length?r=Hr(r,function(l){return mt(l)?function(f){return Go(f,l.length===1?l[0]:l)}:l}):r=[Bs];var s=-1;r=Hr(r,qs(Qc));var u=P1(n,function(l,f,h){var m=Hr(r,function(d){return d(l)});return{criteria:m,index:++s,value:l}});return q1(u,function(l,f){return H1(l,f,e)})}var rh=Co(function(n,r){if(n==null)return[];var e=r.length;return e>1&&No(n,r[0],r[1])?r=[]:e>2&&No(r[0],r[1],r[2])&&(r=[r[0]]),J1(n,ty(r),[])}),V1="Expected a function";function ih(n,r,e){var s=!0,u=!0;if(typeof n!="function")throw new TypeError(V1);return Nt(e)&&(s="leading"in e?!!e.leading:s,u="trailing"in e?!!e.trailing:u),Vo(n,r,{leading:s,maxWait:r,trailing:u})}var X1=1/0,W1=Wr&&1/Yo(new Wr([,-0]))[1]==X1?function(n){return new Wr(n)}:cm,Z1=200;function j1(n,r,e){var s=-1,u=oc,l=n.length,f=!0,h=[],m=h;if(e)f=!1,u=N1;else if(l>=Z1){var d=W1(n);if(d)return Yo(d);f=!1,u=Zs,m=new Zr}else m=h;e:for(;++s<l;){var v=n[s],y=v;if(v=e||v!==0?v:0,f&&y===y){for(var E=m.length;E--;)if(m[E]===y)continue e;h.push(v)}else u(m,y,e)||(m!==h&&m.push(y),h.push(v))}return h}function sh(n,r){return r=typeof r=="function"?r:void 0,n&&n.length?j1(n,void 0,r):[]}const jo=(n,r)=>n[0]===r[0]&&n[1]===r[1],Ui=n=>n.type==="Feature"&&n.geometry.type==="LineString",ah=n=>n.type==="Feature"&&n.geometry.type==="MultiLineString",Qs=n=>n.type==="Feature"&&n.geometry.type==="Polygon",ea=n=>n.type==="Feature"&&n.geometry.type==="MultiPolygon",oh=n=>({type:"FeatureCollection",features:n.geometry.coordinates.map(r=>({type:"Feature",properties:n.properties,geometry:{type:"LineString",coordinates:r}}))}),ta=(n,r)=>({lng:r[0]-n[0],lat:r[1]-n[1]}),na=n=>Array.isArray(n)&&n.length>=2&&n.length<=3&&n.every(r=>typeof r=="number"),jr=(n,r,e=!1)=>{let s=0;const u=["features","geometries","geometry","coordinates"],l=(f,h,m=!1)=>{na(f)?(r({coordinate:f,path:h},s),s+=1):Array.isArray(f)?f.forEach((d,v)=>{m&&e&&v===f.length-1&&na(d)||l(d,[...h,v],m)}):typeof f=="object"&&f!==null&&ot(f).forEach(d=>{const v=f[d];if(u.includes(d)&&v){const y="type"in f&&f.type,E=y==="Polygon"||y==="MultiPolygon";l(v,[...h,d],E)}})};l(n,[])},uh=(n,r)=>{let e={coordinate:[0,0],path:[]},s=-1;try{jr(n,(u,l)=>{if(r[0]===u.coordinate[0]&&r[1]===u.coordinate[1])throw s=l,e=u,new Error("stop")})}catch{if(e)return{index:s,coordinate:e.coordinate,path:e.path}}return null},ra=(n,r)=>{let e=0;const s=["features","geometries","geometry","coordinates"],u=(l,f,h,m)=>{na(l)&&na(f)?(r({start:{coordinate:[...l],path:h},end:{coordinate:[...f],path:m}},e),e+=1):Array.isArray(l)?l.forEach((d,v)=>{u(d,l[v+1],[...h,v],[...h,v+1])}):typeof l=="object"&&l!==null&&ot(l).forEach(d=>{const v=l[d];s.includes(d)&&v&&u(v,void 0,[...h,d],[])})};u(n,void 0,[],[])},ia=(n,r)=>{let e={absCoordIndex:-1,featureIndex:-1,multiFeatureIndex:-1,geometryIndex:-1};try{tr(n,(s,u,l,f,h)=>{if(s[0]===r[0]&&s[1]===r[1])throw e={absCoordIndex:u,featureIndex:l,multiFeatureIndex:f,geometryIndex:h},new Error("found")})}catch{}return e},$1=(n,r,e={})=>({type:"Feature",properties:e,geometry:{type:"LineString",coordinates:[n,r]}}),$r=(n,r)=>{const[e,s]=n,[u,l]=r,f=Math.min(e,u),h=Math.min(s,l),m=Math.max(e,u),d=Math.max(s,l);return[f,h,m,d]},$o=(n,r)=>{const e=$r(n,r),s=[e[0],e[1]],u=[e[2],e[3]],l=s[0],f=s[1],h=u[0],m=u[1];return{type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[l,f],[h,f],[h,m],[l,m],[l,f]]]}}},Ko=n=>[n.geometry.coordinates[0],n.geometry.coordinates[1]],Qo=n=>{const r=Ol(n);return[[r[0],r[1]],[r[2],r[3]]]},lh=n=>[n[0][0],n[0][1],n[1][0],n[1][1]],K1=(n,r)=>{const[e,s,u,l]=n,[f,h]=r;return f>=e&&f<=u&&h>=s&&h<=l},Q1=(n,r)=>{const e=lh(n);return K1(e,r)},sa=n=>{let r=0;return tr(n,()=>{r+=1},!0),r},e_=n=>{const r=[];return tr(n,e=>{r.push([e[0],e[1]])},!0),r},eu=n=>{const r=e_(n);return r.some(e=>!Ks(r[0],e))},tu=n=>{let r=null;try{jr(n,e=>{throw r=e.coordinate,new Error("found")})}catch{return r}return null},zi=(n,r)=>Math.sqrt((n[0]-r[0])**2+(n[1]-r[1])**2),ch=(n,r,e)=>{const[s,u]=[n[0],n[1]],[l,f]=[r[0],r[1]],[h,m]=[e[0],e[1]],d=l-s,v=f-u,y=h-s,E=m-u,S=y*d+E*v,M=d*d+v*v;let D=S/M;return D=Math.max(0,Math.min(1,D)),[s+D*d,u+D*v]},t_=(n,r)=>{const{absCoordIndex:e}=ia(n,r);return e!==-1?(n.geometry.coordinates.splice(e,1),!0):!1},n_=(n,r)=>{const e=ia(n,r);if(e.absCoordIndex!==-1){const s=[e.geometryIndex],u=Xr(n.geometry.coordinates,s),l=u.findIndex(f=>Ks(f,r));return u.length<=4?(n.geometry.coordinates.splice(e.geometryIndex,1),!0):(u.splice(l,1),l===0&&(u[u.length-1]=[...u[0]]),!0)}return!1},r_=(n,r)=>{const e=ia(n,r);if(e.absCoordIndex!==-1){const s=[e.multiFeatureIndex,e.geometryIndex],u=Xr(n.geometry.coordinates,s),l=u.findIndex(f=>Ks(f,r));if(u.length<=4){s.pop();const f=Xr(n.geometry.coordinates,e.multiFeatureIndex);return f.splice(e.geometryIndex,1),f.length===0&&n.geometry.coordinates.splice(e.multiFeatureIndex,1),!0}return u.splice(l,1),l===0&&(u[u.length-1]=[...u[0]]),!0}return!1},i_=(n,r)=>Ui(n)?t_(n,r):Qs(n)?n_(n,r):ea(n)?r_(n,r):!1,s_=n=>{let r=0;return ra(n,e=>{r+=Tt(e.start.coordinate,e.end.coordinate,{units:"meters"})}),r},a_=n=>{const r={type:"FeatureCollection",features:[]};return n.features.forEach(e=>{if(Ui(e))r.features.push(e);else if(Qs(e)){const s=Wl(e);Ui(s)?r.features.push(s):ah(s)&&oh(s).features.forEach(l=>{r.features.push(l)})}else ea(e)?Zl(e).features.forEach(u=>{Ui(u)?r.features.push(u):ah(u)&&oh(u).features.forEach(f=>{r.features.push(f)})}):ie.warn("AutoTraceHelper.getFeaturesGeoJsonAsLines: Feature is not supported",e)}),r},hh=(n,r="marker")=>({type:"Feature",properties:{shape:r},geometry:{type:"Point",coordinates:n}}),nu=({center:n,radius:r,steps:e=80})=>{const s=_p(n,r,{steps:e,units:"meters"});return s.geometry.coordinates[0][0]=[...s.geometry.coordinates[0][0]],s},fh=({center:n,xSemiAxisLngLat:r,rimLngLat:e})=>{let s=Tt(n,r,{units:"meters"});s===0&&(s=1);const u=Gs(n,r)-90;let l=0;if(e){const h=-u*Math.PI/180,d=-(Gs(n,e)-90)*Math.PI/180,v=Tt(n,e,{units:"meters"}),y=v*Math.cos(d),E=v*Math.sin(d),S=y*Math.cos(h)+E*Math.sin(h),M=y*-Math.sin(h)+E*Math.cos(h),D=S*S/(s*s);l=Math.abs(M)/Math.sqrt(1-D),isNaN(l)&&(l=0)}return{xSemiAxis:s,ySemiAxis:l,angle:u}},gh=80,aa=({center:n,xSemiAxis:r,ySemiAxis:e,angle:s,properties:u={}})=>{const l={steps:gh,angle:s,units:"meters"};if(e===void 0||e===0){const h=Jl(n,r,1,l);return qr(h.geometry.coordinates[0].slice(0,41),{shape:"line"})}const f=Jl(n,r,e,{...l,properties:{shape:"ellipse",_gm_shape_center:n,_gm_shape_xSemiAxis:r,_gm_shape_ySemiAxis:e,_gm_shape_angle:s,...u}});return f.geometry.coordinates[0][0]=[...f.geometry.coordinates[0][0]],f},Bn=11102230246251565e-32,ft=134217729,o_=(3+8*Bn)*Bn;function ru(n,r,e,s,u){let l,f,h,m,d=r[0],v=s[0],y=0,E=0;v>d==v>-d?(l=d,d=r[++y]):(l=v,v=s[++E]);let S=0;if(y<n&&E<e)for(v>d==v>-d?(f=d+l,h=l-(f-d),d=r[++y]):(f=v+l,h=l-(f-v),v=s[++E]),l=f,h!==0&&(u[S++]=h);y<n&&E<e;)v>d==v>-d?(f=l+d,m=f-l,h=l-(f-m)+(d-m),d=r[++y]):(f=l+v,m=f-l,h=l-(f-m)+(v-m),v=s[++E]),l=f,h!==0&&(u[S++]=h);for(;y<n;)f=l+d,m=f-l,h=l-(f-m)+(d-m),d=r[++y],l=f,h!==0&&(u[S++]=h);for(;E<e;)f=l+v,m=f-l,h=l-(f-m)+(v-m),v=s[++E],l=f,h!==0&&(u[S++]=h);return(l!==0||S===0)&&(u[S++]=l),S}function u_(n,r){let e=r[0];for(let s=1;s<n;s++)e+=r[s];return e}function qi(n){return new Float64Array(n)}const l_=(3+16*Bn)*Bn,c_=(2+12*Bn)*Bn,h_=(9+64*Bn)*Bn*Bn,Kr=qi(4),dh=qi(8),ph=qi(12),mh=qi(16),vt=qi(4);function f_(n,r,e,s,u,l,f){let h,m,d,v,y,E,S,M,D,U,G,I,H,J,X,W,$,x;const k=n-u,b=e-u,A=r-l,T=s-l;J=k*T,E=ft*k,S=E-(E-k),M=k-S,E=ft*T,D=E-(E-T),U=T-D,X=M*U-(J-S*D-M*D-S*U),W=A*b,E=ft*A,S=E-(E-A),M=A-S,E=ft*b,D=E-(E-b),U=b-D,$=M*U-(W-S*D-M*D-S*U),G=X-$,y=X-G,Kr[0]=X-(G+y)+(y-$),I=J+G,y=I-J,H=J-(I-y)+(G-y),G=H-W,y=H-G,Kr[1]=H-(G+y)+(y-W),x=I+G,y=x-I,Kr[2]=I-(x-y)+(G-y),Kr[3]=x;let F=u_(4,Kr),P=c_*f;if(F>=P||-F>=P||(y=n-k,h=n-(k+y)+(y-u),y=e-b,d=e-(b+y)+(y-u),y=r-A,m=r-(A+y)+(y-l),y=s-T,v=s-(T+y)+(y-l),h===0&&m===0&&d===0&&v===0)||(P=h_*f+o_*Math.abs(F),F+=k*v+T*h-(A*d+b*m),F>=P||-F>=P))return F;J=h*T,E=ft*h,S=E-(E-h),M=h-S,E=ft*T,D=E-(E-T),U=T-D,X=M*U-(J-S*D-M*D-S*U),W=m*b,E=ft*m,S=E-(E-m),M=m-S,E=ft*b,D=E-(E-b),U=b-D,$=M*U-(W-S*D-M*D-S*U),G=X-$,y=X-G,vt[0]=X-(G+y)+(y-$),I=J+G,y=I-J,H=J-(I-y)+(G-y),G=H-W,y=H-G,vt[1]=H-(G+y)+(y-W),x=I+G,y=x-I,vt[2]=I-(x-y)+(G-y),vt[3]=x;const N=ru(4,Kr,4,vt,dh);J=k*v,E=ft*k,S=E-(E-k),M=k-S,E=ft*v,D=E-(E-v),U=v-D,X=M*U-(J-S*D-M*D-S*U),W=A*d,E=ft*A,S=E-(E-A),M=A-S,E=ft*d,D=E-(E-d),U=d-D,$=M*U-(W-S*D-M*D-S*U),G=X-$,y=X-G,vt[0]=X-(G+y)+(y-$),I=J+G,y=I-J,H=J-(I-y)+(G-y),G=H-W,y=H-G,vt[1]=H-(G+y)+(y-W),x=I+G,y=x-I,vt[2]=I-(x-y)+(G-y),vt[3]=x;const R=ru(N,dh,4,vt,ph);J=h*v,E=ft*h,S=E-(E-h),M=h-S,E=ft*v,D=E-(E-v),U=v-D,X=M*U-(J-S*D-M*D-S*U),W=m*d,E=ft*m,S=E-(E-m),M=m-S,E=ft*d,D=E-(E-d),U=d-D,$=M*U-(W-S*D-M*D-S*U),G=X-$,y=X-G,vt[0]=X-(G+y)+(y-$),I=J+G,y=I-J,H=J-(I-y)+(G-y),G=H-W,y=H-G,vt[1]=H-(G+y)+(y-W),x=I+G,y=x-I,vt[2]=I-(x-y)+(G-y),vt[3]=x;const Y=ru(R,ph,4,vt,mh);return mh[Y-1]}function g_(n,r,e,s,u,l){const f=(r-l)*(e-u),h=(n-u)*(s-l),m=f-h,d=Math.abs(f+h);return Math.abs(m)>=l_*d?m:-f_(n,r,e,s,u,l,d)}function d_(n,r){var e,s,u=0,l,f,h,m,d,v,y,E=n[0],S=n[1],M=r.length;for(e=0;e<M;e++){s=0;var D=r[e],U=D.length-1;if(v=D[0],v[0]!==D[U][0]&&v[1]!==D[U][1])throw new Error("First and last coordinates in a ring must be the same");for(f=v[0]-E,h=v[1]-S,s;s<U;s++){if(y=D[s+1],m=y[0]-E,d=y[1]-S,h===0&&d===0){if(m<=0&&f>=0||f<=0&&m>=0)return 0}else if(d>=0&&h<=0||d<=0&&h>=0){if(l=g_(f,m,h,d,0,0),l===0)return 0;(l>0&&d>0&&h<=0||l<0&&d<=0&&h>0)&&u++}v=y,h=d,f=m}}return u%2!==0}function Lr(n,r,e={}){if(!n)throw new Error("point is required");if(!r)throw new Error("polygon is required");const s=We(n),u=Ni(r),l=u.type,f=r.bbox;let h=u.coordinates;if(f&&p_(s,f)===!1)return!1;l==="Polygon"&&(h=[h]);let m=!1;for(var d=0;d<h.length;++d){const v=d_(s,h[d]);if(v===0)return!e.ignoreBoundary;v&&(m=!0)}return m}function p_(n,r){return r[0]<=n[0]&&r[1]<=n[1]&&r[2]>=n[0]&&r[3]>=n[1]}class vh{constructor(r=[],e=m_){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:s}=this,u=e[r];for(;r>0;){const l=r-1>>1,f=e[l];if(s(u,f)>=0)break;e[r]=f,r=l}e[r]=u}_down(r){const{data:e,compare:s}=this,u=this.length>>1,l=e[r];for(;r<u;){let f=(r<<1)+1,h=e[f];const m=f+1;if(m<this.length&&s(e[m],h)<0&&(f=m,h=e[m]),s(h,l)>=0)break;e[r]=h,r=f}e[r]=l}}function m_(n,r){return n<r?-1:n>r?1:0}function yh(n,r){return n.p.x>r.p.x?1:n.p.x<r.p.x?-1:n.p.y!==r.p.y?n.p.y>r.p.y?1:-1:1}function v_(n,r){return n.rightSweepEvent.p.x>r.rightSweepEvent.p.x?1:n.rightSweepEvent.p.x<r.rightSweepEvent.p.x?-1:n.rightSweepEvent.p.y!==r.rightSweepEvent.p.y?n.rightSweepEvent.p.y<r.rightSweepEvent.p.y?1:-1:1}class _h{constructor(r,e,s,u){this.p={x:r[0],y:r[1]},this.featureId=e,this.ringId=s,this.eventId=u,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(r){return this.p.x===r.p.x&&this.p.y===r.p.y}}function y_(n,r){if(n.type==="FeatureCollection"){const e=n.features;for(let s=0;s<e.length;s++)Eh(e[s],r)}else Eh(n,r)}let oa=0,ua=0,la=0;function Eh(n,r){const e=n.type==="Feature"?n.geometry:n;let s=e.coordinates;(e.type==="Polygon"||e.type==="MultiLineString")&&(s=[s]),e.type==="LineString"&&(s=[[s]]);for(let u=0;u<s.length;u++)for(let l=0;l<s[u].length;l++){let f=s[u][l][0],h=null;ua=ua+1;for(let m=0;m<s[u][l].length-1;m++){h=s[u][l][m+1];const d=new _h(f,oa,ua,la),v=new _h(h,oa,ua,la+1);d.otherEvent=v,v.otherEvent=d,yh(d,v)>0?(v.isLeftEndpoint=!0,d.isLeftEndpoint=!1):(d.isLeftEndpoint=!0,v.isLeftEndpoint=!1),r.push(d),r.push(v),f=h,la=la+1}}oa=oa+1}let __=class{constructor(r){this.leftSweepEvent=r,this.rightSweepEvent=r.otherEvent}};function E_(n,r){if(n===null||r===null||n.leftSweepEvent.ringId===r.leftSweepEvent.ringId&&(n.rightSweepEvent.isSamePoint(r.leftSweepEvent)||n.rightSweepEvent.isSamePoint(r.leftSweepEvent)||n.rightSweepEvent.isSamePoint(r.rightSweepEvent)||n.leftSweepEvent.isSamePoint(r.leftSweepEvent)||n.leftSweepEvent.isSamePoint(r.rightSweepEvent)))return!1;const e=n.leftSweepEvent.p.x,s=n.leftSweepEvent.p.y,u=n.rightSweepEvent.p.x,l=n.rightSweepEvent.p.y,f=r.leftSweepEvent.p.x,h=r.leftSweepEvent.p.y,m=r.rightSweepEvent.p.x,d=r.rightSweepEvent.p.y,v=(d-h)*(u-e)-(m-f)*(l-s),y=(m-f)*(s-h)-(d-h)*(e-f),E=(u-e)*(s-h)-(l-s)*(e-f);if(v===0)return!1;const S=y/v,M=E/v;if(S>=0&&S<=1&&M>=0&&M<=1){const D=e+S*(u-e),U=s+S*(l-s);return[D,U]}return!1}function x_(n,r){r=r||!1;const e=[],s=new vh([],v_);for(;n.length;){const u=n.pop();if(u.isLeftEndpoint){const l=new __(u);for(let f=0;f<s.data.length;f++){const h=s.data[f];if(r&&h.leftSweepEvent.featureId===u.featureId)continue;const m=E_(l,h);m!==!1&&e.push(m)}s.push(l)}else u.isLeftEndpoint===!1&&s.pop()}return e}function w_(n,r){const e=new vh([],yh);return y_(n,e),x_(e,r)}var k_=w_;function Yi(n,r,e={}){const{removeDuplicates:s=!0,ignoreSelfIntersections:u=!0}=e;let l=[];n.type==="FeatureCollection"?l=l.concat(n.features):n.type==="Feature"?l.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&l.push(tn(n)),r.type==="FeatureCollection"?l=l.concat(r.features):r.type==="Feature"?l.push(r):(r.type==="LineString"||r.type==="Polygon"||r.type==="MultiLineString"||r.type==="MultiPolygon")&&l.push(tn(r));const f=k_($e(l),u);let h=[];if(s){const m={};f.forEach(d=>{const v=d.join(",");m[v]||(m[v]=!0,h.push(d))})}else h=f;return $e(h.map(m=>vn(m)))}var S_=Yi;function iu(n){const r=Ct(n);let e=0,s=1,u,l;for(;s<r.length;)u=l||r[0],l=r[s],e+=(l[0]-u[0])*(l[1]+u[1]),s++;return e>0}function M_(n,r={}){var e,s;if(r=r||{},!Ds(r))throw new Error("options is invalid");const u=(e=r.mutate)!=null?e:!1,l=(s=r.reverse)!=null?s:!1;if(!n)throw new Error("<geojson> is required");if(typeof l!="boolean")throw new Error("<reverse> must be a boolean");if(typeof u!="boolean")throw new Error("<mutate> must be a boolean");!u&&n.type!=="Point"&&n.type!=="MultiPoint"&&(n=Fs(n));const f=[];switch(n.type){case"GeometryCollection":return nr(n,function(h){ca(h,l)}),n;case"FeatureCollection":return yn(n,function(h){const m=ca(h,l);yn(m,function(d){f.push(d)})}),$e(f)}return ca(n,l)}function ca(n,r){switch(n.type==="Feature"?n.geometry.type:n.type){case"GeometryCollection":return nr(n,function(s){ca(s,r)}),n;case"LineString":return xh(Ct(n),r),n;case"Polygon":return wh(Ct(n),r),n;case"MultiLineString":return Ct(n).forEach(function(s){xh(s,r)}),n;case"MultiPolygon":return Ct(n).forEach(function(s){wh(s,r)}),n;case"Point":case"MultiPoint":return n}}function xh(n,r){iu(n)===r&&n.reverse()}function wh(n,r){iu(n[0])!==r&&n[0].reverse();for(let e=1;e<n.length;e++)iu(n[e])===r&&n[e].reverse()}var I_=M_;const L_=["Point","MultiPoint"],b_=["LineString","MultiLineString","Polygon","MultiPolygon"],kh=n=>L_.includes(n.geometry.type),su=n=>b_.includes(n.geometry.type);function A_(n,r={}){const e=_n(n),s=(e[0]+e[2])/2,u=(e[1]+e[3])/2;return vn([s,u],r.properties,r)}var ha={exports:{}},C_=ha.exports,Sh;function T_(){return Sh||(Sh=1,function(n,r){(function(e,s){n.exports=s()})(C_,function(){function e(o,t){(t==null||t>o.length)&&(t=o.length);for(var i=0,a=Array(t);i<t;i++)a[i]=o[i];return a}function s(o,t,i){return t=v(t),function(a,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}(a)}(o,E()?Reflect.construct(t,i||[],v(o).constructor):t.apply(o,i))}function u(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function l(o,t,i){if(E())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,t);var c=new(o.bind.apply(o,a));return i&&S(c,i.prototype),c}function f(o,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(o,U(a.key),a)}}function h(o,t,i){return t&&f(o.prototype,t),i&&f(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o}function m(o,t){var i=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(!i){if(Array.isArray(o)||(i=G(o))||t){i&&(o=i);var a=0,c=function(){};return{s:c,n:function(){return a>=o.length?{done:!0}:{done:!1,value:o[a++]}},e:function(w){throw w},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g,p=!0,_=!1;return{s:function(){i=i.call(o)},n:function(){var w=i.next();return p=w.done,w},e:function(w){_=!0,g=w},f:function(){try{p||i.return==null||i.return()}finally{if(_)throw g}}}}function d(){return d=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(o,t,i){var a=function(g,p){for(;!{}.hasOwnProperty.call(g,p)&&(g=v(g))!==null;);return g}(o,t);if(a){var c=Object.getOwnPropertyDescriptor(a,t);return c.get?c.get.call(arguments.length<3?o:i):c.value}},d.apply(null,arguments)}function v(o){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(o)}function y(o,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),Object.defineProperty(o,"prototype",{writable:!1}),t&&S(o,t)}function E(){try{var o=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(E=function(){return!!o})()}function S(o,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},S(o,t)}function M(o,t,i,a){var c=d(v(1&a?o.prototype:o),t,i);return 2&a&&typeof c=="function"?function(g){return c.apply(i,g)}:c}function D(o){return function(t){if(Array.isArray(t))return e(t)}(o)||function(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}(o)||G(o)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function U(o){var t=function(i,a){if(typeof i!="object"||!i)return i;var c=i[Symbol.toPrimitive];if(c!==void 0){var g=c.call(i,a);if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(o,"string");return typeof t=="symbol"?t:t+""}function G(o,t){if(o){if(typeof o=="string")return e(o,t);var i={}.toString.call(o).slice(8,-1);return i==="Object"&&o.constructor&&(i=o.constructor.name),i==="Map"||i==="Set"?Array.from(o):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(o,t):void 0}}function I(o){var t=typeof Map=="function"?new Map:void 0;return I=function(i){if(i===null||!function(c){try{return Function.toString.call(c).indexOf("[native code]")!==-1}catch{return typeof c=="function"}}(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(i))return t.get(i);t.set(i,a)}function a(){return l(i,arguments,v(this).constructor)}return a.prototype=Object.create(i.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),S(a,i)},I(o)}var H=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=o.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=o.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==o.JOIN_ROUND&&(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(t){this._joinStyle=t}},{key:"setSimplifyFactor",value:function(t){this._simplifyFactor=t<0?0:t}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(t){this._endCapStyle=t}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(t){this._mitreLimit=t}},{key:"setSingleSided",value:function(t){this._isSingleSided=t}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=o.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=o.CAP_ROUND,this._joinStyle=o.JOIN_ROUND,this._mitreLimit=o.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=o.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(a)}else if(arguments.length===4){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3];this.setQuadrantSegments(c),this.setEndCapStyle(g),this.setJoinStyle(p),this.setMitreLimit(_)}}}},{key:"bufferDistanceError",value:function(t){var i=Math.PI/2/t;return 1-Math.cos(i/2)}}])}();H.CAP_ROUND=1,H.CAP_FLAT=2,H.CAP_SQUARE=3,H.JOIN_ROUND=1,H.JOIN_MITRE=2,H.JOIN_BEVEL=3,H.DEFAULT_QUADRANT_SEGMENTS=8,H.DEFAULT_MITRE_LIMIT=5,H.DEFAULT_SIMPLIFY_FACTOR=.01;var J=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({Exception:t})[0],a}return y(t,o),h(t,[{key:"toString",value:function(){return this.message}}])}(I(Error)),X=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({IllegalArgumentException:t})[0],a}return y(t,o),h(t)}(J),W=function(){return h(function o(){u(this,o)},[{key:"filter",value:function(o){}}])}();function $(){}function x(){}function k(){}var b,A,T,F,P,N,R,Y,z=function(){return h(function o(){u(this,o)},null,[{key:"equalsWithTolerance",value:function(o,t,i){return Math.abs(o-t)<=i}}])}(),j=function(){return h(function o(t,i){u(this,o),this.low=i||0,this.high=t||0},null,[{key:"toBinaryString",value:function(o){var t,i="";for(t=2147483648;t>0;t>>>=1)i+=(o.high&t)===t?"1":"0";for(t=2147483648;t>0;t>>>=1)i+=(o.low&t)===t?"1":"0";return i}}])}();function K(){}function re(){}K.NaN=NaN,K.isNaN=function(o){return Number.isNaN(o)},K.isInfinite=function(o){return!Number.isFinite(o)},K.MAX_VALUE=Number.MAX_VALUE,K.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,K.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(N=2146435072,R=new Float64Array(1),Y=new Int32Array(R.buffer),K.doubleToLongBits=function(o){R[0]=o;var t=0|Y[0],i=0|Y[1];return(i&N)===N&&1048575&i&&t!==0&&(t=0,i=2146959360),new j(i,t)},K.longBitsToDouble=function(o){return Y[0]=o.low,Y[1]=o.high,R[0]}):(b=1023,A=Math.log2,T=Math.floor,F=Math.pow,P=function(){for(var o=53;o>0;o--){var t=F(2,o)-1;if(T(A(t))+1===o)return t}return 0}(),K.doubleToLongBits=function(o){var t,i,a,c,g,p,_,w,L;if(o<0||1/o===Number.NEGATIVE_INFINITY?(p=1<<31,o=-o):p=0,o===0)return new j(w=p,L=0);if(o===1/0)return new j(w=2146435072|p,L=0);if(o!=o)return new j(w=2146959360,L=0);if(c=0,L=0,(t=T(o))>1)if(t<=P)(c=T(A(t)))<=20?(L=0,w=t<<20-c&1048575):(L=t%(i=F(2,a=c-20))<<32-a,w=t/i&1048575);else for(a=t,L=0;(a=T(i=a/2))!==0;)c++,L>>>=1,L|=(1&w)<<31,w>>>=1,i!==a&&(w|=524288);if(_=c+b,g=t===0,t=o-t,c<52&&t!==0)for(a=0;;){if((i=2*t)>=1?(t=i-1,g?(_--,g=!1):(a<<=1,a|=1,c++)):(t=i,g?--_==0&&(c++,g=!1):(a<<=1,c++)),c===20)w|=a,a=0;else if(c===52){L|=a;break}if(i===1){c<20?w|=a<<20-c:c<52&&(L|=a<<52-c);break}}return w|=_<<20,new j(w|=p,L)},K.longBitsToDouble=function(o){var t,i,a,c,g=o.high,p=o.low,_=g&1<<31?-1:1;for(a=((2146435072&g)>>20)-b,c=0,i=1<<19,t=1;t<=20;t++)g&i&&(c+=F(2,-t)),i>>>=1;for(i=1<<31,t=21;t<=52;t++)p&i&&(c+=F(2,-t)),i>>>=1;if(a===-1023){if(c===0)return 0*_;a=-1022}else{if(a===1024)return c===0?_/0:NaN;c+=1}return _*c*F(2,a)});var me=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({RuntimeException:t})[0],a}return y(t,o),h(t)}(J),he=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,null,[{key:"constructor_",value:function(){if(arguments.length===0)me.constructor_.call(this);else if(arguments.length===1){var i=arguments[0];me.constructor_.call(this,i)}}}])}(me),oe=function(){function o(){u(this,o)}return h(o,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)o.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new he("Should never reach here"+(t!==null?": "+t:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var t=arguments[0];o.isTrue(t,null)}else if(arguments.length===2){var i=arguments[1];if(!arguments[0])throw i===null?new he:new he(i)}}},{key:"equals",value:function(){if(arguments.length===2){var t=arguments[0],i=arguments[1];o.equals(t,i,null)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];if(!c.equals(a))throw new he("Expected "+a+" but encountered "+c+(g!==null?": "+g:""))}}}])}(),le=new ArrayBuffer(8),we=new Float64Array(le),Ne=new Int32Array(le),V=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getM",value:function(){return K.NaN}},{key:"setOrdinate",value:function(t,i){switch(t){case o.X:this.x=i;break;case o.Y:this.y=i;break;case o.Z:this.setZ(i);break;default:throw new X("Invalid ordinate index: "+t)}}},{key:"equals2D",value:function(){if(arguments.length===1){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(arguments.length===2){var i=arguments[0],a=arguments[1];return!!z.equalsWithTolerance(this.x,i.x,a)&&!!z.equalsWithTolerance(this.y,i.y,a)}}},{key:"setM",value:function(t){throw new X("Invalid ordinate index: "+o.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(t){switch(t){case o.X:return this.x;case o.Y:return this.y;case o.Z:return this.getZ()}throw new X("Invalid ordinate index: "+t)}},{key:"equals3D",value:function(t){return this.x===t.x&&this.y===t.y&&(this.getZ()===t.getZ()||K.isNaN(this.getZ())&&K.isNaN(t.getZ()))}},{key:"equals",value:function(t){return t instanceof o&&this.equals2D(t)}},{key:"equalInZ",value:function(t,i){return z.equalsWithTolerance(this.getZ(),t.getZ(),i)}},{key:"setX",value:function(t){this.x=t}},{key:"compareTo",value:function(t){var i=t;return this.x<i.x?-1:this.x>i.x?1:this.y<i.y?-1:this.y>i.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(t){this.z=t}},{key:"clone",value:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return oe.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(t){var i=this.x-t.x,a=this.y-t.y,c=this.getZ()-t.getZ();return Math.sqrt(i*i+a*a+c*c)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(t){this.y=t}},{key:"distance",value:function(t){var i=this.x-t.x,a=this.y-t.y;return Math.sqrt(i*i+a*a)}},{key:"hashCode",value:function(){var t=17;return t=37*(t=37*t+o.hashCode(this.x))+o.hashCode(this.y)}},{key:"setCoordinate",value:function(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}},{key:"interfaces_",get:function(){return[$,x,k]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)o.constructor_.call(this,0,0);else if(arguments.length===1){var t=arguments[0];o.constructor_.call(this,t.x,t.y,t.getZ())}else if(arguments.length===2){var i=arguments[0],a=arguments[1];o.constructor_.call(this,i,a,o.NULL_ORDINATE)}else if(arguments.length===3){var c=arguments[0],g=arguments[1],p=arguments[2];this.x=c,this.y=g,this.z=p}}},{key:"hashCode",value:function(t){return we[0]=t,Ne[0]^Ne[1]}}])}(),fn=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compare",value:function(t,i){var a=o.compare(t.x,i.x);if(a!==0)return a;var c=o.compare(t.y,i.y);return c!==0?c:this._dimensionsToTest<=2?0:o.compare(t.getZ(),i.getZ())}},{key:"interfaces_",get:function(){return[re]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)o.constructor_.call(this,2);else if(arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new X("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}},{key:"compare",value:function(t,i){return t<i?-1:t>i?1:K.isNaN(t)?K.isNaN(i)?0:-1:K.isNaN(i)?1:0}}])}();V.DimensionalComparator=fn,V.NULL_ORDINATE=K.NaN,V.X=0,V.Y=1,V.Z=2,V.M=3;var be=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(t){if(!(t instanceof o))return!1;var i=t;return this.isNull()?i.isNull():this._maxx===i.getMaxX()&&this._maxy===i.getMaxY()&&this._minx===i.getMinX()&&this._miny===i.getMinY()}},{key:"intersection",value:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new o;var i=this._minx>t._minx?this._minx:t._minx,a=this._miny>t._miny?this._miny:t._miny;return new o(i,this._maxx<t._maxx?this._maxx:t._maxx,a,this._maxy<t._maxy?this._maxy:t._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof o){var i=arguments[0];return!this.isNull()&&!i.isNull()&&i.getMinX()>=this._minx&&i.getMaxX()<=this._maxx&&i.getMinY()>=this._miny&&i.getMaxY()<=this._maxy}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return!this.isNull()&&a>=this._minx&&a<=this._maxx&&c>=this._miny&&c<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof V){var i=arguments[0];return this.intersects(i.x,i.y)}}else if(arguments.length===2){if(arguments[0]instanceof V&&arguments[1]instanceof V){var a=arguments[0],c=arguments[1];return!this.isNull()&&!((a.x<c.x?a.x:c.x)>this._maxx)&&!((a.x>c.x?a.x:c.x)<this._minx)&&!((a.y<c.y?a.y:c.y)>this._maxy)&&!((a.y>c.y?a.y:c.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var g=arguments[0],p=arguments[1];return!this.isNull()&&!(g>this._maxx||g<this._minx||p>this._maxy||p<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var t=this.getWidth(),i=this.getHeight();return Math.sqrt(t*t+i*i)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof o){var i=arguments[0];if(i.isNull())return null;this.isNull()?(this._minx=i.getMinX(),this._maxx=i.getMaxX(),this._miny=i.getMinY(),this._maxy=i.getMaxY()):(i._minx<this._minx&&(this._minx=i._minx),i._maxx>this._maxx&&(this._maxx=i._maxx),i._miny<this._miny&&(this._miny=i._miny),i._maxy>this._maxy&&(this._maxy=i._maxy))}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.isNull()?(this._minx=a,this._maxx=a,this._miny=c,this._maxy=c):(a<this._minx&&(this._minx=a),a>this._maxx&&(this._maxx=a),c<this._miny&&(this._miny=c),c>this._maxy&&(this._maxy=c))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var t=this.getWidth(),i=this.getHeight();return t<i?t:i}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(t){var i=t;return this.isNull()?i.isNull()?0:-1:i.isNull()?1:this._minx<i._minx?-1:this._minx>i._minx?1:this._miny<i._miny?-1:this._miny>i._miny?1:this._maxx<i._maxx?-1:this._maxx>i._maxx?1:this._maxy<i._maxy?-1:this._maxy>i._maxy?1:0}},{key:"translate",value:function(t,i){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+i,this.getMaxY()+i)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(t){return!(!this.isNull()&&!t.isNull())||t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var t=this.getWidth(),i=this.getHeight();return t>i?t:i}},{key:"expandBy",value:function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];if(this.isNull())return null;this._minx-=i,this._maxx+=i,this._miny-=a,this._maxy+=a,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof V){var i=arguments[0];return this.covers(i)}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return this.covers(a,c)}}},{key:"centre",value:function(){return this.isNull()?null:new V((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof o){var i=arguments[0];this._minx=i._minx,this._maxx=i._maxx,this._miny=i._miny,this._maxy=i._maxy}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.init(a.x,c.x,a.y,c.y)}else if(arguments.length===4){var g=arguments[0],p=arguments[1],_=arguments[2],w=arguments[3];g<p?(this._minx=g,this._maxx=p):(this._minx=p,this._maxx=g),_<w?(this._miny=_,this._maxy=w):(this._miny=w,this._maxy=_)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(t){if(this.intersects(t))return 0;var i=0;this._maxx<t._minx?i=t._minx-this._maxx:this._minx>t._maxx&&(i=this._minx-t._maxx);var a=0;return this._maxy<t._miny?a=t._miny-this._maxy:this._miny>t._maxy&&(a=this._miny-t._maxy),i===0?a:a===0?i:Math.sqrt(i*i+a*a)}},{key:"hashCode",value:function(){var t=17;return t=37*(t=37*(t=37*(t=37*t+V.hashCode(this._minx))+V.hashCode(this._maxx))+V.hashCode(this._miny))+V.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[$,k]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof o){var i=arguments[0];this.init(i)}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.init(a.x,c.x,a.y,c.y)}else if(arguments.length===4){var g=arguments[0],p=arguments[1],_=arguments[2],w=arguments[3];this.init(g,p,_,w)}}},{key:"intersects",value:function(){if(arguments.length===3){var t=arguments[0],i=arguments[1],a=arguments[2];return a.x>=(t.x<i.x?t.x:i.x)&&a.x<=(t.x>i.x?t.x:i.x)&&a.y>=(t.y<i.y?t.y:i.y)&&a.y<=(t.y>i.y?t.y:i.y)}if(arguments.length===4){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3],w=Math.min(p.x,_.x),L=Math.max(p.x,_.x),q=Math.min(c.x,g.x),Z=Math.max(c.x,g.x);return!(q>L)&&!(Z<w)&&(w=Math.min(p.y,_.y),L=Math.max(p.y,_.y),q=Math.min(c.y,g.y),Z=Math.max(c.y,g.y),!(q>L)&&!(Z<w))}}}])}(),fe=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(t){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(t){return this===t||this.equalsExact(t,0)}},{key:"geometryChanged",value:function(){this.apply(o.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(t){return t!==null&&this.norm().equalsExact(t.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var t;if(arguments.length===1){var i=arguments[0];return t=i,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(i)}if(arguments.length===2){var a=arguments[0],c=arguments[1];return t=a,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(a,c)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(t){if(t.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION)throw new X("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(t,i,a){return a===0?t.equals(i):t.distance(i)<=a}},{key:"norm",value:function(){var t=this.copy();return t.normalize(),t}},{key:"reverse",value:function(){var t=this.reverseInternal();return this.envelope!=null&&(t.envelope=this.envelope.copy()),t.setSRID(this.getSRID()),t}},{key:"copy",value:function(){var t=this.copyInternal();return t.envelope=this._envelope==null?null:this._envelope.copy(),t._SRID=this._SRID,t._userData=this._userData,t}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new be(this._envelope)}},{key:"setSRID",value:function(t){this._SRID=t}},{key:"setUserData",value:function(t){this._userData=t}},{key:"compare",value:function(t,i){for(var a=t.iterator(),c=i.iterator();a.hasNext()&&c.hasNext();){var g=a.next(),p=c.next(),_=g.compareTo(p);if(_!==0)return _}return a.hasNext()?1:c.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(t){return this.getClass()===t.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===o.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===o.TYPECODE_MULTIPOINT||this.getTypeCode()===o.TYPECODE_MULTILINESTRING||this.getTypeCode()===o.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[x,$,k]}},{key:"getClass",value:function(){return o}}],[{key:"hasNonEmptyElements",value:function(t){for(var i=0;i<t.length;i++)if(!t[i].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(t){for(var i=0;i<t.length;i++)if(t[i]===null)return!0;return!1}}])}();fe.constructor_=function(o){o&&(this._envelope=null,this._userData=null,this._factory=o,this._SRID=o.getSRID())},fe.TYPECODE_POINT=0,fe.TYPECODE_MULTIPOINT=1,fe.TYPECODE_LINESTRING=2,fe.TYPECODE_LINEARRING=3,fe.TYPECODE_MULTILINESTRING=4,fe.TYPECODE_POLYGON=5,fe.TYPECODE_MULTIPOLYGON=6,fe.TYPECODE_GEOMETRYCOLLECTION=7,fe.TYPENAME_POINT="Point",fe.TYPENAME_MULTIPOINT="MultiPoint",fe.TYPENAME_LINESTRING="LineString",fe.TYPENAME_LINEARRING="LinearRing",fe.TYPENAME_MULTILINESTRING="MultiLineString",fe.TYPENAME_POLYGON="Polygon",fe.TYPENAME_MULTIPOLYGON="MultiPolygon",fe.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",fe.geometryChangedFilter={get interfaces_(){return[W]},filter:function(o){o.geometryChangedAction()}};var C=function(){function o(){u(this,o)}return h(o,null,[{key:"toLocationSymbol",value:function(t){switch(t){case o.EXTERIOR:return"e";case o.BOUNDARY:return"b";case o.INTERIOR:return"i";case o.NONE:return"-"}throw new X("Unknown location value: "+t)}}])}();C.INTERIOR=0,C.BOUNDARY=1,C.EXTERIOR=2,C.NONE=-1;var De=function(){return h(function o(){u(this,o)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Oe=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({NoSuchElementException:t})[0],a}return y(t,o),h(t)}(J),Ie=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({UnsupportedOperationException:t})[0],a}return y(t,o),h(t)}(J),vi=function(o){function t(){return u(this,t),s(this,t,arguments)}return y(t,o),h(t,[{key:"contains",value:function(){}}])}(De),Cn=function(o){function t(i){var a;return u(this,t),(a=s(this,t)).map=new Map,i instanceof De&&a.addAll(i),a}return y(t,o),h(t,[{key:"contains",value:function(i){var a=i.hashCode?i.hashCode():i;return!!this.map.has(a)}},{key:"add",value:function(i){var a=i.hashCode?i.hashCode():i;return!this.map.has(a)&&!!this.map.set(a,i)}},{key:"addAll",value:function(i){var a,c=m(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.add(g)}}catch(p){c.e(p)}finally{c.f()}return!0}},{key:"remove",value:function(){throw new Ie}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new yi(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(vi),yi=function(){return h(function o(t){u(this,o),this.iterator=t.values();var i=this.iterator.next(),a=i.done,c=i.value;this.done=a,this.value=c},[{key:"next",value:function(){if(this.done)throw new Oe;var o=this.value,t=this.iterator.next(),i=t.done,a=t.value;return this.done=i,this.value=a,o}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Ie}}])}(),ne=function(){function o(){u(this,o)}return h(o,null,[{key:"opposite",value:function(t){return t===o.LEFT?o.RIGHT:t===o.RIGHT?o.LEFT:t}}])}();ne.ON=0,ne.LEFT=1,ne.RIGHT=2;var vs=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({EmptyStackException:t})[0],a}return y(t,o),h(t)}(J),ys=function(o){function t(i){var a;return u(this,t),(a=s(this,t,[i])).name=Object.keys({IndexOutOfBoundsException:t})[0],a}return y(t,o),h(t)}(J),Zn=function(o){function t(){return u(this,t),s(this,t,arguments)}return y(t,o),h(t,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(De),_s=function(o){function t(){var i;return u(this,t),(i=s(this,t)).array=[],i}return y(t,o),h(t,[{key:"add",value:function(i){return this.array.push(i),!0}},{key:"get",value:function(i){if(i<0||i>=this.size())throw new ys;return this.array[i]}},{key:"push",value:function(i){return this.array.push(i),i}},{key:"pop",value:function(){if(this.array.length===0)throw new vs;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new vs;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(i){return this.array.indexOf(i)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(Zn);function xe(o,t){return o.interfaces_&&o.interfaces_.indexOf(t)>-1}var Wt=function(){return h(function o(t){u(this,o),this.str=t},[{key:"append",value:function(o){this.str+=o}},{key:"setCharAt",value:function(o,t){this.str=this.str.substr(0,o)+t+this.str.substr(o+1)}},{key:"toString",value:function(){return this.str}}])}(),gn=function(){function o(t){u(this,o),this.value=t}return h(o,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(t){return this.value<t?-1:this.value>t?1:0}}],[{key:"compare",value:function(t,i){return t<i?-1:t>i?1:0}},{key:"isNan",value:function(t){return Number.isNaN(t)}},{key:"valueOf",value:function(t){return new o(t)}}])}(),_i=function(){return h(function o(){u(this,o)},null,[{key:"isWhitespace",value:function(o){return o<=32&&o>=0||o===127}},{key:"toUpperCase",value:function(o){return o.toUpperCase()}}])}(),_e=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"le",value:function(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<=t._lo}},{key:"extractSignificantDigits",value:function(t,i){var a=this.abs(),c=o.magnitude(a._hi),g=o.TEN.pow(c);(a=a.divide(g)).gt(o.TEN)?(a=a.divide(o.TEN),c+=1):a.lt(o.ONE)&&(a=a.multiply(o.TEN),c-=1);for(var p=c+1,_=new Wt,w=o.MAX_PRINT_DIGITS-1,L=0;L<=w;L++){t&&L===p&&_.append(".");var q=Math.trunc(a._hi);if(q<0)break;var Z=!1,Q=0;q>9?(Z=!0,Q="9"):Q="0"+q,_.append(Q),a=a.subtract(o.valueOf(q)).multiply(o.TEN),Z&&a.selfAdd(o.TEN);var ce=!0,ge=o.magnitude(a._hi);if(ge<0&&Math.abs(ge)>=w-L&&(ce=!1),!ce)break}return i[0]=c,_.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return this.add(t.negate())}if(typeof arguments[0]=="number"){var i=arguments[0];return this.add(-i)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof o){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(t){return this.le(t)?this:t}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.selfDivide(i,0)}}else if(arguments.length===2){var a,c,g,p,_=arguments[0],w=arguments[1],L=null,q=null,Z=null,Q=null;return g=this._hi/_,Q=(L=(Z=o.SPLIT*g)-(L=Z-g))*(q=(Q=o.SPLIT*_)-(q=Q-_))-(p=g*_)+L*(c=_-q)+(a=g-L)*q+a*c,Q=g+(Z=(this._hi-p-Q+this._lo-g*w)/_),this._hi=Q,this._lo=g-Q+Z,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof o){var t,i,a,c,g=arguments[0],p=null,_=null,w=null,L=null;return t=(a=this._hi/g._hi)-(p=(w=o.SPLIT*a)-(p=w-a)),L=p*(_=(L=o.SPLIT*g._hi)-(_=L-g._hi))-(c=a*g._hi)+p*(i=g._hi-_)+t*_+t*i,new o(L=a+(w=(this._hi-c-L+this._lo-a*g._lo)/g._hi),a-L+w)}if(typeof arguments[0]=="number"){var q=arguments[0];return K.isNaN(q)?o.createNaN():o.copy(this).selfDivide(q,0)}}},{key:"ge",value:function(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>=t._lo}},{key:"pow",value:function(t){if(t===0)return o.valueOf(1);var i=new o(this),a=o.valueOf(1),c=Math.abs(t);if(c>1)for(;c>0;)c%2==1&&a.selfMultiply(i),(c/=2)>0&&(i=i.sqr());else a=i;return t<0?a.reciprocal():a}},{key:"ceil",value:function(){if(this.isNaN())return o.NaN;var t=Math.ceil(this._hi),i=0;return t===this._hi&&(i=Math.ceil(this._lo)),new o(t,i)}},{key:"compareTo",value:function(t){var i=t;return this._hi<i._hi?-1:this._hi>i._hi?1:this._lo<i._lo?-1:this._lo>i._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return this.init(t),this}if(typeof arguments[0]=="number"){var i=arguments[0];return this.init(i),this}}},{key:"max",value:function(t){return this.ge(t)?this:t}},{key:"sqrt",value:function(){if(this.isZero())return o.valueOf(0);if(this.isNegative())return o.NaN;var t=1/Math.sqrt(this._hi),i=this._hi*t,a=o.valueOf(i),c=this.subtract(a.sqr())._hi*(.5*t);return a.add(c)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if(typeof arguments[0]=="number"){var i,a,c,g,p,_=arguments[0],w=null;return w=(c=this._hi+_)-(g=c-this._hi),a=(p=(w=_-g+(this._hi-w))+this._lo)+(c-(i=c+p)),this._hi=i+a,this._lo=a+(i-this._hi),this}}else if(arguments.length===2){var L,q,Z,Q,ce=arguments[0],ge=arguments[1],ye=null,Ae=null,Le=null;Z=this._hi+ce,q=this._lo+ge,Ae=Z-(Le=Z-this._hi),ye=q-(Q=q-this._lo);var Be=(L=Z+(Le=(Ae=ce-Le+(this._hi-Ae))+q))+(Le=(ye=ge-Q+(this._lo-ye))+(Le+(Z-L))),ct=Le+(L-Be);return this._hi=Be,this._lo=ct,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof o){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if(typeof arguments[0]=="number"){var i=arguments[0];return this.selfMultiply(i,0)}}else if(arguments.length===2){var a,c,g=arguments[0],p=arguments[1],_=null,w=null,L=null,q=null;_=(L=o.SPLIT*this._hi)-this._hi,q=o.SPLIT*g,_=L-_,a=this._hi-_,w=q-g;var Z=(L=this._hi*g)+(q=_*(w=q-w)-L+_*(c=g-w)+a*w+a*c+(this._hi*p+this._lo*g)),Q=q+(_=L-Z);return this._hi=Z,this._lo=Q,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return o.NaN;var t=Math.floor(this._hi),i=0;return t===this._hi&&(i=Math.floor(this._lo)),new o(t,i)}},{key:"negate",value:function(){return this.isNaN()?this:new o(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}}},{key:"multiply",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return t.isNaN()?o.createNaN():o.copy(this).selfMultiply(t)}if(typeof arguments[0]=="number"){var i=arguments[0];return K.isNaN(i)?o.createNaN():o.copy(this).selfMultiply(i,0)}}},{key:"isNaN",value:function(){return K.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var t=o.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var t=this.getSpecialNumberString();if(t!==null)return t;var i=new Array(1).fill(null),a=this.extractSignificantDigits(!0,i),c=i[0]+1,g=a;if(a.charAt(0)===".")g="0"+a;else if(c<0)g="0."+o.stringOfChar("0",-c)+a;else if(a.indexOf(".")===-1){var p=c-a.length;g=a+o.stringOfChar("0",p)+".0"}return this.isNegative()?"-"+g:g}},{key:"reciprocal",value:function(){var t,i,a,c,g=null,p=null,_=null,w=null;t=(a=1/this._hi)-(g=(_=o.SPLIT*a)-(g=_-a)),p=(w=o.SPLIT*this._hi)-this._hi;var L=a+(_=(1-(c=a*this._hi)-(w=g*(p=w-p)-c+g*(i=this._hi-p)+t*p+t*i)-a*this._lo)/this._hi);return new o(L,a-L+_)}},{key:"toSciNotation",value:function(){if(this.isZero())return o.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var i=new Array(1).fill(null),a=this.extractSignificantDigits(!1,i),c=o.SCI_NOT_EXPONENT_CHAR+i[0];if(a.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+a);var g="";a.length>1&&(g=a.substring(1));var p=a.charAt(0)+"."+g;return this.isNegative()?"-"+p+c:p+c}},{key:"abs",value:function(){return this.isNaN()?o.NaN:this.isNegative()?this.negate():new o(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<t._lo}},{key:"add",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return o.copy(this).selfAdd(t)}if(typeof arguments[0]=="number"){var i=arguments[0];return o.copy(this).selfAdd(i)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof o){var i=arguments[0];this._hi=i._hi,this._lo=i._lo}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this._hi=a,this._lo=c}}},{key:"gt",value:function(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>t._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?o.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[k,$,x]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof o){var i=arguments[0];this.init(i)}else if(typeof arguments[0]=="string"){var a=arguments[0];o.constructor_.call(this,o.parse(a))}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.init(c,g)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],i=arguments[1],a=arguments[2],c=arguments[3];return o.determinant(o.valueOf(t),o.valueOf(i),o.valueOf(a),o.valueOf(c))}if(arguments[3]instanceof o&&arguments[2]instanceof o&&arguments[0]instanceof o&&arguments[1]instanceof o){var g=arguments[1],p=arguments[2],_=arguments[3];return arguments[0].multiply(_).selfSubtract(g.multiply(p))}}},{key:"sqr",value:function(t){return o.valueOf(t).selfMultiply(t)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var t=arguments[0];return o.parse(t)}if(typeof arguments[0]=="number")return new o(arguments[0])}},{key:"sqrt",value:function(t){return o.valueOf(t).sqrt()}},{key:"parse",value:function(t){for(var i=0,a=t.length;_i.isWhitespace(t.charAt(i));)i++;var c=!1;if(i<a){var g=t.charAt(i);g!=="-"&&g!=="+"||(i++,g==="-"&&(c=!0))}for(var p=new o,_=0,w=0,L=0,q=!1;!(i>=a);){var Z=t.charAt(i);if(i++,_i.isDigit(Z)){var Q=Z-"0";p.selfMultiply(o.TEN),p.selfAdd(Q),_++}else{if(Z!=="."){if(Z==="e"||Z==="E"){var ce=t.substring(i);try{L=gn.parseInt(ce)}catch(Be){throw Be instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+ce+" in string "+t):Be}break}throw new NumberFormatException("Unexpected character '"+Z+"' at position "+i+" in string "+t)}w=_,q=!0}}var ge=p;q||(w=_);var ye=_-w-L;if(ye===0)ge=p;else if(ye>0){var Ae=o.TEN.pow(ye);ge=p.divide(Ae)}else if(ye<0){var Le=o.TEN.pow(-ye);ge=p.multiply(Le)}return c?ge.negate():ge}},{key:"createNaN",value:function(){return new o(K.NaN,K.NaN)}},{key:"copy",value:function(t){return new o(t)}},{key:"magnitude",value:function(t){var i=Math.abs(t),a=Math.log(i)/Math.log(10),c=Math.trunc(Math.floor(a));return 10*Math.pow(10,c)<=i&&(c+=1),c}},{key:"stringOfChar",value:function(t,i){for(var a=new Wt,c=0;c<i;c++)a.append(t);return a.toString()}}])}();_e.PI=new _e(3.141592653589793,12246467991473532e-32),_e.TWO_PI=new _e(6.283185307179586,24492935982947064e-32),_e.PI_2=new _e(1.5707963267948966,6123233995736766e-32),_e.E=new _e(2.718281828459045,14456468917292502e-32),_e.NaN=new _e(K.NaN,K.NaN),_e.EPS=123259516440783e-46,_e.SPLIT=134217729,_e.MAX_PRINT_DIGITS=32,_e.TEN=_e.valueOf(10),_e.ONE=_e.valueOf(1),_e.SCI_NOT_EXPONENT_CHAR="E",_e.SCI_NOT_ZERO="0.0E0";var Ei=function(){function o(){u(this,o)}return h(o,null,[{key:"orientationIndex",value:function(t,i,a){var c=o.orientationIndexFilter(t,i,a);if(c<=1)return c;var g=_e.valueOf(i.x).selfAdd(-t.x),p=_e.valueOf(i.y).selfAdd(-t.y),_=_e.valueOf(a.x).selfAdd(-i.x),w=_e.valueOf(a.y).selfAdd(-i.y);return g.selfMultiply(w).selfSubtract(p.selfMultiply(_)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof _e&&arguments[2]instanceof _e&&arguments[0]instanceof _e&&arguments[1]instanceof _e){var t=arguments[1],i=arguments[2],a=arguments[3];return arguments[0].multiply(a).selfSubtract(t.multiply(i)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3],w=_e.valueOf(c),L=_e.valueOf(g),q=_e.valueOf(p),Z=_e.valueOf(_);return w.multiply(Z).selfSubtract(L.multiply(q)).signum()}}},{key:"intersection",value:function(t,i,a,c){var g=new _e(t.y).selfSubtract(i.y),p=new _e(i.x).selfSubtract(t.x),_=new _e(t.x).selfMultiply(i.y).selfSubtract(new _e(i.x).selfMultiply(t.y)),w=new _e(a.y).selfSubtract(c.y),L=new _e(c.x).selfSubtract(a.x),q=new _e(a.x).selfMultiply(c.y).selfSubtract(new _e(c.x).selfMultiply(a.y)),Z=p.multiply(q).selfSubtract(L.multiply(_)),Q=w.multiply(_).selfSubtract(g.multiply(q)),ce=g.multiply(L).selfSubtract(w.multiply(p)),ge=Z.selfDivide(ce).doubleValue(),ye=Q.selfDivide(ce).doubleValue();return K.isNaN(ge)||K.isInfinite(ge)||K.isNaN(ye)||K.isInfinite(ye)?null:new V(ge,ye)}},{key:"orientationIndexFilter",value:function(t,i,a){var c=null,g=(t.x-a.x)*(i.y-a.y),p=(t.y-a.y)*(i.x-a.x),_=g-p;if(g>0){if(p<=0)return o.signum(_);c=g+p}else{if(!(g<0)||p>=0)return o.signum(_);c=-g-p}var w=o.DP_SAFE_EPSILON*c;return _>=w||-_>=w?o.signum(_):2}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}}])}();Ei.DP_SAFE_EPSILON=1e-15;var Se=function(){return h(function o(){u(this,o)},[{key:"getM",value:function(o){if(this.hasM()){var t=this.getDimension()-this.getMeasures();return this.getOrdinate(o,t)}return K.NaN}},{key:"setOrdinate",value:function(o,t,i){}},{key:"getZ",value:function(o){return this.hasZ()?this.getOrdinate(o,2):K.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(o,t){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(o){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(o){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(o){}},{key:"copy",value:function(){}},{key:"getY",value:function(o){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[x]}}])}();Se.X=0,Se.Y=1,Se.Z=2,Se.M=3;var Ee=function(){function o(){u(this,o)}return h(o,null,[{key:"index",value:function(t,i,a){return Ei.orientationIndex(t,i,a)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var t=arguments[0],i=t.length-1;if(i<3)throw new X("Ring has fewer than 4 points, so orientation cannot be determined");for(var a=t[0],c=0,g=1;g<=i;g++){var p=t[g];p.y>a.y&&(a=p,c=g)}var _=c;do(_-=1)<0&&(_=i);while(t[_].equals2D(a)&&_!==c);var w=c;do w=(w+1)%i;while(t[w].equals2D(a)&&w!==c);var L=t[_],q=t[w];if(L.equals2D(a)||q.equals2D(a)||L.equals2D(q))return!1;var Z=o.index(L,a,q);return Z===0?L.x>q.x:Z>0}if(xe(arguments[0],Se)){var Q=arguments[0],ce=Q.size()-1;if(ce<3)throw new X("Ring has fewer than 4 points, so orientation cannot be determined");for(var ge=Q.getCoordinate(0),ye=0,Ae=1;Ae<=ce;Ae++){var Le=Q.getCoordinate(Ae);Le.y>ge.y&&(ge=Le,ye=Ae)}var Be=null,ct=ye;do(ct-=1)<0&&(ct=ce),Be=Q.getCoordinate(ct);while(Be.equals2D(ge)&&ct!==ye);var dt=null,zr=ye;do zr=(zr+1)%ce,dt=Q.getCoordinate(zr);while(dt.equals2D(ge)&&zr!==ye);if(Be.equals2D(ge)||dt.equals2D(ge)||Be.equals2D(dt))return!1;var Ts=o.index(Be,ge,dt);return Ts===0?Be.x>dt.x:Ts>0}}}])}();Ee.CLOCKWISE=-1,Ee.RIGHT=Ee.CLOCKWISE,Ee.COUNTERCLOCKWISE=1,Ee.LEFT=Ee.COUNTERCLOCKWISE,Ee.COLLINEAR=0,Ee.STRAIGHT=Ee.COLLINEAR;var xi=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(o,t){var i=this.getRightmostSideOfSegment(o,t);return i<0&&(i=this.getRightmostSideOfSegment(o,t-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(o)),i}},{key:"findRightmostEdgeAtVertex",value:function(){var o=this._minDe.getEdge().getCoordinates();oe.isTrue(this._minIndex>0&&this._minIndex<o.length,"rightmost point expected to be interior vertex of edge");var t=o[this._minIndex-1],i=o[this._minIndex+1],a=Ee.index(this._minCoord,i,t),c=!1;(t.y<this._minCoord.y&&i.y<this._minCoord.y&&a===Ee.COUNTERCLOCKWISE||t.y>this._minCoord.y&&i.y>this._minCoord.y&&a===Ee.CLOCKWISE)&&(c=!0),c&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(o,t){var i=o.getEdge().getCoordinates();if(t<0||t+1>=i.length||i[t].y===i[t+1].y)return-1;var a=ne.LEFT;return i[t].y<i[t+1].y&&(a=ne.RIGHT),a}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(o){for(var t=o.getEdge().getCoordinates(),i=0;i<t.length-1;i++)(this._minCoord===null||t[i].x>this._minCoord.x)&&(this._minDe=o,this._minIndex=i,this._minCoord=t[i])}},{key:"findRightmostEdgeAtNode",value:function(){var o=this._minDe.getNode().getEdges();this._minDe=o.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(o){for(var t=o.iterator();t.hasNext();){var i=t.next();i.isForward()&&this.checkForRightmostCoordinate(i)}oe.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ne.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),It=function(o){function t(i,a){var c;return u(this,t),(c=s(this,t,[a?i+" [ "+a+" ]":i])).pt=a?new V(a):void 0,c.name=Object.keys({TopologyException:t})[0],c}return y(t,o),h(t,[{key:"getCoordinate",value:function(){return this.pt}}])}(me),dn=function(){return h(function o(){u(this,o),this.array=[]},[{key:"addLast",value:function(o){this.array.push(o)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),ve=function(o){function t(i){var a;return u(this,t),(a=s(this,t)).array=[],i instanceof De&&a.addAll(i),a}return y(t,o),h(t,[{key:"interfaces_",get:function(){return[Zn,De]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(i){return arguments.length===1?this.array.push(i):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(i){var a,c=m(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.array.push(g)}}catch(p){c.e(p)}finally{c.f()}}},{key:"set",value:function(i,a){var c=this.array[i];return this.array[i]=a,c}},{key:"iterator",value:function(){return new Es(this)}},{key:"get",value:function(i){if(i<0||i>=this.size())throw new ys;return this.array[i]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(i){i?this.array.sort(function(a,c){return i.compare(a,c)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(i){for(var a=0,c=this.array.length;a<c;a++)if(this.array[a]===i)return!!this.array.splice(a,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(Zn),Es=function(){return h(function o(t){u(this,o),this.arrayList=t,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Oe;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(o){return this.arrayList.set(this.position-1,o)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),xs=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var o=this._dirEdgeList.iterator();o.hasNext();)o.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(o){for(var t=null,i=o.getEdges().iterator();i.hasNext();){var a=i.next();if(a.isVisited()||a.getSym().isVisited()){t=a;break}}if(t===null)throw new It("unable to find edge to compute depths at "+o.getCoordinate());o.getEdges().computeDepths(t);for(var c=o.getEdges().iterator();c.hasNext();){var g=c.next();g.setVisited(!0),this.copySymDepths(g)}}},{key:"computeDepth",value:function(o){this.clearVisitedEdges();var t=this._finder.getEdge();t.getNode(),t.getLabel(),t.setEdgeDepths(ne.RIGHT,o),this.copySymDepths(t),this.computeDepths(t)}},{key:"create",value:function(o){this.addReachable(o),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var o=this._dirEdgeList.iterator();o.hasNext();){var t=o.next();t.getDepth(ne.RIGHT)>=1&&t.getDepth(ne.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}}},{key:"computeDepths",value:function(o){var t=new Cn,i=new dn,a=o.getNode();for(i.addLast(a),t.add(a),o.setVisited(!0);!i.isEmpty();){var c=i.removeFirst();t.add(c),this.computeNodeDepth(c);for(var g=c.getEdges().iterator();g.hasNext();){var p=g.next().getSym();if(!p.isVisited()){var _=p.getNode();t.contains(_)||(i.addLast(_),t.add(_))}}}}},{key:"compareTo",value:function(o){var t=o;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var o=new be,t=this._dirEdgeList.iterator();t.hasNext();)for(var i=t.next().getEdge().getCoordinates(),a=0;a<i.length-1;a++)o.expandToInclude(i[a]);this._env=o}return this._env}},{key:"addReachable",value:function(o){var t=new _s;for(t.add(o);!t.empty();){var i=t.pop();this.add(i,t)}}},{key:"copySymDepths",value:function(o){var t=o.getSym();t.setDepth(ne.LEFT,o.getDepth(ne.RIGHT)),t.setDepth(ne.RIGHT,o.getDepth(ne.LEFT))}},{key:"add",value:function(o,t){o.setVisited(!0),this._nodes.add(o);for(var i=o.getEdges().iterator();i.hasNext();){var a=i.next();this._dirEdgeList.add(a);var c=a.getSym().getNode();c.isVisited()||t.push(c)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new ve,this._nodes=new ve,this._rightMostCoord=null,this._env=null,this._finder=new xi}}])}(),ws=function(){return h(function o(){u(this,o)},null,[{key:"intersection",value:function(o,t,i,a){var c=o.x<t.x?o.x:t.x,g=o.y<t.y?o.y:t.y,p=o.x>t.x?o.x:t.x,_=o.y>t.y?o.y:t.y,w=i.x<a.x?i.x:a.x,L=i.y<a.y?i.y:a.y,q=i.x>a.x?i.x:a.x,Z=i.y>a.y?i.y:a.y,Q=((c>w?c:w)+(p<q?p:q))/2,ce=((g>L?g:L)+(_<Z?_:Z))/2,ge=o.x-Q,ye=o.y-ce,Ae=t.x-Q,Le=t.y-ce,Be=i.x-Q,ct=i.y-ce,dt=a.x-Q,zr=a.y-ce,Ts=ye-Le,rp=Ae-ge,ip=ge*Le-Ae*ye,sp=ct-zr,ap=dt-Be,op=Be*zr-dt*ct,up=Ts*ap-sp*rp,Ml=(rp*op-ap*ip)/up,Il=(sp*ip-Ts*op)/up;return K.isNaN(Ml)||K.isInfinite(Ml)||K.isNaN(Il)||K.isInfinite(Il)?null:new V(Ml+Q,Il+ce)}}])}(),lt=function(){return h(function o(){u(this,o)},null,[{key:"arraycopy",value:function(o,t,i,a,c){for(var g=0,p=t;p<t+c;p++)i[a+g]=o[p],g++}},{key:"getProperty",value:function(o){return{"line.separator":`
`}[o]}}])}(),Tn=function(){function o(){u(this,o)}return h(o,null,[{key:"log10",value:function(t){var i=Math.log(t);return K.isInfinite(i)||K.isNaN(i)?i:i/o.LOG_10}},{key:"min",value:function(t,i,a,c){var g=t;return i<g&&(g=i),a<g&&(g=a),c<g&&(g=c),g}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],i=arguments[1],a=arguments[2];return t<i?i:t>a?a:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var c=arguments[0],g=arguments[1],p=arguments[2];return c<g?g:c>p?p:c}}},{key:"wrap",value:function(t,i){return t<0?i- -t%i:t%i}},{key:"max",value:function(){if(arguments.length===3){var t=arguments[1],i=arguments[2],a=arguments[0];return t>a&&(a=t),i>a&&(a=i),a}if(arguments.length===4){var c=arguments[1],g=arguments[2],p=arguments[3],_=arguments[0];return c>_&&(_=c),g>_&&(_=g),p>_&&(_=p),_}}},{key:"average",value:function(t,i){return(t+i)/2}}])}();Tn.LOG_10=Math.log(10);var Zt=function(){function o(){u(this,o)}return h(o,null,[{key:"segmentToSegment",value:function(t,i,a,c){if(t.equals(i))return o.pointToSegment(t,a,c);if(a.equals(c))return o.pointToSegment(c,t,i);var g=!1;if(be.intersects(t,i,a,c)){var p=(i.x-t.x)*(c.y-a.y)-(i.y-t.y)*(c.x-a.x);if(p===0)g=!0;else{var _=(t.y-a.y)*(c.x-a.x)-(t.x-a.x)*(c.y-a.y),w=((t.y-a.y)*(i.x-t.x)-(t.x-a.x)*(i.y-t.y))/p,L=_/p;(L<0||L>1||w<0||w>1)&&(g=!0)}}else g=!0;return g?Tn.min(o.pointToSegment(t,a,c),o.pointToSegment(i,a,c),o.pointToSegment(a,t,i),o.pointToSegment(c,t,i)):0}},{key:"pointToSegment",value:function(t,i,a){if(i.x===a.x&&i.y===a.y)return t.distance(i);var c=(a.x-i.x)*(a.x-i.x)+(a.y-i.y)*(a.y-i.y),g=((t.x-i.x)*(a.x-i.x)+(t.y-i.y)*(a.y-i.y))/c;if(g<=0)return t.distance(i);if(g>=1)return t.distance(a);var p=((i.y-t.y)*(a.x-i.x)-(i.x-t.x)*(a.y-i.y))/c;return Math.abs(p)*Math.sqrt(c)}},{key:"pointToLinePerpendicular",value:function(t,i,a){var c=(a.x-i.x)*(a.x-i.x)+(a.y-i.y)*(a.y-i.y),g=((i.y-t.y)*(a.x-i.x)-(i.x-t.x)*(a.y-i.y))/c;return Math.abs(g)*Math.sqrt(c)}},{key:"pointToSegmentString",value:function(t,i){if(i.length===0)throw new X("Line array must contain at least one vertex");for(var a=t.distance(i[0]),c=0;c<i.length-1;c++){var g=o.pointToSegment(t,i[c],i[c+1]);g<a&&(a=g)}return a}}])}(),mr=function(){return h(function o(){u(this,o)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||xe(arguments[0],Se);else if(arguments.length!==2){if(arguments.length===3){var o=arguments[0],t=arguments[1];return this.create(o,t)}}}}])}(),wi=function(){return h(function o(){u(this,o)},[{key:"filter",value:function(o){}}])}(),dl=function(){return h(function o(){u(this,o)},null,[{key:"ofLine",value:function(o){var t=o.size();if(t<=1)return 0;var i=0,a=new V;o.getCoordinate(0,a);for(var c=a.x,g=a.y,p=1;p<t;p++){o.getCoordinate(p,a);var _=a.x,w=a.y,L=_-c,q=w-g;i+=Math.sqrt(L*L+q*q),c=_,g=w}return i}}])}(),je=h(function o(){u(this,o)}),Lt=function(){function o(){u(this,o)}return h(o,null,[{key:"copyCoord",value:function(t,i,a,c){for(var g=Math.min(t.getDimension(),a.getDimension()),p=0;p<g;p++)a.setOrdinate(c,p,t.getOrdinate(i,p))}},{key:"isRing",value:function(t){var i=t.size();return i===0||!(i<=3)&&t.getOrdinate(0,Se.X)===t.getOrdinate(i-1,Se.X)&&t.getOrdinate(0,Se.Y)===t.getOrdinate(i-1,Se.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(xe(arguments[0],Se)&&Number.isInteger(arguments[1])){var t=arguments[0],i=arguments[1];o.scroll(t,i,o.isRing(t))}else if(xe(arguments[0],Se)&&arguments[1]instanceof V){var a=arguments[0],c=arguments[1],g=o.indexOf(c,a);if(g<=0)return null;o.scroll(a,g)}}else if(arguments.length===3){var p=arguments[0],_=arguments[1],w=arguments[2];if(_<=0)return null;for(var L=p.copy(),q=w?p.size()-1:p.size(),Z=0;Z<q;Z++)for(var Q=0;Q<p.getDimension();Q++)p.setOrdinate(Z,Q,L.getOrdinate((_+Z)%q,Q));if(w)for(var ce=0;ce<p.getDimension();ce++)p.setOrdinate(q,ce,p.getOrdinate(0,ce))}}},{key:"isEqual",value:function(t,i){var a=t.size();if(a!==i.size())return!1;for(var c=Math.min(t.getDimension(),i.getDimension()),g=0;g<a;g++)for(var p=0;p<c;p++){var _=t.getOrdinate(g,p),w=i.getOrdinate(g,p);if(t.getOrdinate(g,p)!==i.getOrdinate(g,p)&&(!K.isNaN(_)||!K.isNaN(w)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var t=arguments[0];return o.minCoordinateIndex(t,0,t.size()-1)}if(arguments.length===3){for(var i=arguments[0],a=arguments[2],c=-1,g=null,p=arguments[1];p<=a;p++){var _=i.getCoordinate(p);(g===null||g.compareTo(_)>0)&&(g=_,c=p)}return c}}},{key:"extend",value:function(t,i,a){var c=t.create(a,i.getDimension()),g=i.size();if(o.copy(i,0,c,0,g),g>0)for(var p=g;p<a;p++)o.copy(i,g-1,c,p,1);return c}},{key:"reverse",value:function(t){for(var i=t.size()-1,a=Math.trunc(i/2),c=0;c<=a;c++)o.swap(t,c,i-c)}},{key:"swap",value:function(t,i,a){if(i===a)return null;for(var c=0;c<t.getDimension();c++){var g=t.getOrdinate(i,c);t.setOrdinate(i,c,t.getOrdinate(a,c)),t.setOrdinate(a,c,g)}}},{key:"copy",value:function(t,i,a,c,g){for(var p=0;p<g;p++)o.copyCoord(t,i+p,a,c+p)}},{key:"ensureValidRing",value:function(t,i){var a=i.size();return a===0?i:a<=3?o.createClosedRing(t,i,4):i.getOrdinate(0,Se.X)===i.getOrdinate(a-1,Se.X)&&i.getOrdinate(0,Se.Y)===i.getOrdinate(a-1,Se.Y)?i:o.createClosedRing(t,i,a+1)}},{key:"indexOf",value:function(t,i){for(var a=0;a<i.size();a++)if(t.x===i.getOrdinate(a,Se.X)&&t.y===i.getOrdinate(a,Se.Y))return a;return-1}},{key:"createClosedRing",value:function(t,i,a){var c=t.create(a,i.getDimension()),g=i.size();o.copy(i,0,c,0,g);for(var p=g;p<a;p++)o.copy(i,0,c,p,1);return c}},{key:"minCoordinate",value:function(t){for(var i=null,a=0;a<t.size();a++){var c=t.getCoordinate(a);(i===null||i.compareTo(c)>0)&&(i=c)}return i}}])}(),ae=function(){function o(){u(this,o)}return h(o,null,[{key:"toDimensionSymbol",value:function(t){switch(t){case o.FALSE:return o.SYM_FALSE;case o.TRUE:return o.SYM_TRUE;case o.DONTCARE:return o.SYM_DONTCARE;case o.P:return o.SYM_P;case o.L:return o.SYM_L;case o.A:return o.SYM_A}throw new X("Unknown dimension value: "+t)}},{key:"toDimensionValue",value:function(t){switch(_i.toUpperCase(t)){case o.SYM_FALSE:return o.FALSE;case o.SYM_TRUE:return o.TRUE;case o.SYM_DONTCARE:return o.DONTCARE;case o.SYM_P:return o.P;case o.SYM_L:return o.L;case o.SYM_A:return o.A}throw new X("Unknown dimension symbol: "+t)}}])}();ae.P=0,ae.L=1,ae.A=2,ae.FALSE=-1,ae.TRUE=-2,ae.DONTCARE=-3,ae.SYM_FALSE="F",ae.SYM_TRUE="T",ae.SYM_DONTCARE="*",ae.SYM_P="0",ae.SYM_L="1",ae.SYM_A="2";var Fr=function(){return h(function o(){u(this,o)},[{key:"filter",value:function(o){}}])}(),vr=function(){return h(function o(){u(this,o)},[{key:"filter",value:function(o,t){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),yr=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new be:this._points.expandEnvelope(new be)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new t(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._points.size()!==c._points.size())return!1;for(var g=0;g<this._points.size();g++)if(!this.equal(this._points.getCoordinate(g),c._points.getCoordinate(g),a))return!1;return!0}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var i=0;i<Math.trunc(this._points.size()/2);i++){var a=this._points.size()-1-i;if(!this._points.getCoordinate(i).equals(this._points.getCoordinate(a))){if(this._points.getCoordinate(i).compareTo(this._points.getCoordinate(a))>0){var c=this._points.copy();Lt.reverse(c),this._points=c}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ae.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var i=this._points.copy();return Lt.reverse(i),this.getFactory().createLineString(i)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return dl.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var i=arguments[0],a=0,c=0;a<this._points.size()&&c<i._points.size();){var g=this._points.getCoordinate(a).compareTo(i._points.getCoordinate(c));if(g!==0)return g;a++,c++}return a<this._points.size()?1:c<i._points.size()?-1:0}if(arguments.length===2){var p=arguments[0];return arguments[1].compare(this._points,p._points)}}},{key:"apply",value:function(){if(xe(arguments[0],wi))for(var i=arguments[0],a=0;a<this._points.size();a++)i.filter(this._points.getCoordinate(a));else if(xe(arguments[0],vr)){var c=arguments[0];if(this._points.size()===0)return null;for(var g=0;g<this._points.size()&&(c.filter(this._points,g),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else xe(arguments[0],Fr)?arguments[0].filter(this):xe(arguments[0],W)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Ie}},{key:"isEquivalentClass",value:function(i){return i instanceof t}},{key:"getCoordinateN",value:function(i){return this._points.getCoordinate(i)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new X("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i}},{key:"isCoordinate",value:function(i){for(var a=0;a<this._points.size();a++)if(this._points.getCoordinate(a).equals(i))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))}},{key:"interfaces_",get:function(){return[je]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var i=arguments[0],a=arguments[1];fe.constructor_.call(this,a),this.init(i)}}}}])}(fe),ks=h(function o(){u(this,o)}),Ss=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new be;var i=new be;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new t(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&(!(!this.isEmpty()||!i.isEmpty())||this.isEmpty()===i.isEmpty()&&this.equal(i.getCoordinate(),this.getCoordinate(),a))}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0];return this.getCoordinate().compareTo(i.getCoordinate())}if(arguments.length===2){var a=arguments[0];return arguments[1].compare(this._coordinates,a._coordinates)}}},{key:"apply",value:function(){if(xe(arguments[0],wi)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(xe(arguments[0],vr)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else xe(arguments[0],Fr)?arguments[0].filter(this):xe(arguments[0],W)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),oe.isTrue(i.size()<=1),this._coordinates=i}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[ks]}}],[{key:"constructor_",value:function(){this._coordinates=null;var i=arguments[0],a=arguments[1];fe.constructor_.call(this,a),this.init(i)}}])}(fe),Ft=function(){function o(){u(this,o)}return h(o,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(o.ofRingSigned(t))}if(xe(arguments[0],Se)){var i=arguments[0];return Math.abs(o.ofRingSigned(i))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var i=0,a=t[0].x,c=1;c<t.length-1;c++){var g=t[c].x-a,p=t[c+1].y;i+=g*(t[c-1].y-p)}return i/2}if(xe(arguments[0],Se)){var _=arguments[0],w=_.size();if(w<3)return 0;var L=new V,q=new V,Z=new V;_.getCoordinate(0,q),_.getCoordinate(1,Z);var Q=q.x;Z.x-=Q;for(var ce=0,ge=1;ge<w-1;ge++)L.y=q.y,q.x=Z.x,q.y=Z.y,_.getCoordinate(ge+1,Z),Z.x-=Q,ce+=q.x*(L.y-Z.y);return ce/2}}}])}(),jt=function(){return h(function o(){u(this,o)},null,[{key:"sort",value:function(){var o=arguments,t=arguments[0];if(arguments.length===1)t.sort(function(Q,ce){return Q.compareTo(ce)});else if(arguments.length===2)t.sort(function(Q,ce){return o[1].compare(Q,ce)});else if(arguments.length===3){var i=t.slice(arguments[1],arguments[2]);i.sort();var a=t.slice(0,arguments[1]).concat(i,t.slice(arguments[2],t.length));t.splice(0,t.length);var c,g=m(a);try{for(g.s();!(c=g.n()).done;){var p=c.value;t.push(p)}}catch(Q){g.e(Q)}finally{g.f()}}else if(arguments.length===4){var _=t.slice(arguments[1],arguments[2]);_.sort(function(Q,ce){return o[3].compare(Q,ce)});var w=t.slice(0,arguments[1]).concat(_,t.slice(arguments[2],t.length));t.splice(0,t.length);var L,q=m(w);try{for(q.s();!(L=q.n()).done;){var Z=L.value;t.push(Z)}}catch(Q){q.e(Q)}finally{q.f()}}}},{key:"asList",value:function(o){var t,i=new ve,a=m(o);try{for(a.s();!(t=a.n()).done;){var c=t.value;i.add(c)}}catch(g){a.e(g)}finally{a.f()}return i}},{key:"copyOf",value:function(o,t){return o.slice(0,t)}}])}(),Ms=h(function o(){u(this,o)}),Gr=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),a=-1,c=this._shell.getCoordinates(),g=0;g<c.length;g++)i[++a]=c[g];for(var p=0;p<this._holes.length;p++)for(var _=this._holes[p].getCoordinates(),w=0;w<_.length;w++)i[++a]=_[w];return i}},{key:"getArea",value:function(){var i=0;i+=Ft.ofRing(this._shell.getCoordinateSequence());for(var a=0;a<this._holes.length;a++)i-=Ft.ofRing(this._holes[a].getCoordinateSequence());return i}},{key:"copyInternal",value:function(){for(var i=this._shell.copy(),a=new Array(this._holes.length).fill(null),c=0;c<this._holes.length;c++)a[c]=this._holes[c].copy();return new t(i,a,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),c=0;c<5;c++){var g=i.getX(c);if(g!==a.getMinX()&&g!==a.getMaxX())return!1;var p=i.getY(c);if(p!==a.getMinY()&&p!==a.getMaxY())return!1}for(var _=i.getX(0),w=i.getY(0),L=1;L<=4;L++){var q=i.getX(L),Z=i.getY(L);if(q!==_==(Z!==w))return!1;_=q,w=Z}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i,g=this._shell,p=c._shell;if(!g.equalsExact(p,a)||this._holes.length!==c._holes.length)return!1;for(var _=0;_<this._holes.length;_++)if(!this._holes[_].equalsExact(c._holes[_],a))return!1;return!0}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var i=0;i<this._holes.length;i++)this._holes[i]=this.normalized(this._holes[i],!1);jt.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];if(a.isEmpty())return null;var g=a.getCoordinateSequence(),p=Lt.minCoordinateIndex(g,0,g.size()-2);Lt.scroll(g,p,!0),Ee.isCCW(g)===c&&Lt.reverse(g)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var i=this.getExteriorRing().reverse(),a=new Array(this.getNumInteriorRing()).fill(null),c=0;c<a.length;c++)a[c]=this.getInteriorRingN(c).reverse();return this.getFactory().createPolygon(i,a)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var i=0;i+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)i+=this._holes[a].getLength();return i}},{key:"getNumPoints",value:function(){for(var i=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)i+=this._holes[a].getNumPoints();return i}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(i,a){var c=i.copy();return this.normalize(c,a),c}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0],a=this._shell,c=i._shell;return a.compareToSameClass(c)}if(arguments.length===2){var g=arguments[1],p=arguments[0],_=this._shell,w=p._shell,L=_.compareToSameClass(w,g);if(L!==0)return L;for(var q=this.getNumInteriorRing(),Z=p.getNumInteriorRing(),Q=0;Q<q&&Q<Z;){var ce=this.getInteriorRingN(Q),ge=p.getInteriorRingN(Q),ye=ce.compareToSameClass(ge,g);if(ye!==0)return ye;Q++}return Q<q?1:Q<Z?-1:0}}},{key:"apply",value:function(){if(xe(arguments[0],wi)){var i=arguments[0];this._shell.apply(i);for(var a=0;a<this._holes.length;a++)this._holes[a].apply(i)}else if(xe(arguments[0],vr)){var c=arguments[0];if(this._shell.apply(c),!c.isDone())for(var g=0;g<this._holes.length&&(this._holes[g].apply(c),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else if(xe(arguments[0],Fr))arguments[0].filter(this);else if(xe(arguments[0],W)){var p=arguments[0];p.filter(this),this._shell.apply(p);for(var _=0;_<this._holes.length;_++)this._holes[_].apply(p)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var a=0;a<this._holes.length;a++)i[a+1]=this._holes[a];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(i){return this._holes[i]}},{key:"interfaces_",get:function(){return[Ms]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var i=arguments[0],a=arguments[1],c=arguments[2];if(fe.constructor_.call(this,c),i===null&&(i=this.getFactory().createLinearRing()),a===null&&(a=[]),fe.hasNullElements(a))throw new X("holes must not contain null elements");if(i.isEmpty()&&fe.hasNonEmptyElements(a))throw new X("shell is empty but holes are not");this._shell=i,this._holes=a}}])}(fe),Is=function(o){function t(){return u(this,t),s(this,t,arguments)}return y(t,o),h(t)}(vi),Ls=function(o){function t(i){var a;return u(this,t),(a=s(this,t)).array=[],i instanceof De&&a.addAll(i),a}return y(t,o),h(t,[{key:"contains",value:function(i){var a,c=m(this.array);try{for(c.s();!(a=c.n()).done;)if(a.value.compareTo(i)===0)return!0}catch(g){c.e(g)}finally{c.f()}return!1}},{key:"add",value:function(i){if(this.contains(i))return!1;for(var a=0,c=this.array.length;a<c;a++)if(this.array[a].compareTo(i)===1)return!!this.array.splice(a,0,i);return this.array.push(i),!0}},{key:"addAll",value:function(i){var a,c=m(i);try{for(c.s();!(a=c.n()).done;){var g=a.value;this.add(g)}}catch(p){c.e(p)}finally{c.f()}return!0}},{key:"remove",value:function(){throw new Ie}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new pn(this.array)}}])}(Is),pn=function(){return h(function o(t){u(this,o),this.array=t,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Oe;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Ie}}])}(),gt=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"computeEnvelopeInternal",value:function(){for(var i=new be,a=0;a<this._geometries.length;a++)i.expandToInclude(this._geometries[a].getEnvelopeInternal());return i}},{key:"getGeometryN",value:function(i){return this._geometries[i]}},{key:"getCoordinates",value:function(){for(var i=new Array(this.getNumPoints()).fill(null),a=-1,c=0;c<this._geometries.length;c++)for(var g=this._geometries[c].getCoordinates(),p=0;p<g.length;p++)i[++a]=g[p];return i}},{key:"getArea",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getArea();return i}},{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new t(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var c=i;if(this._geometries.length!==c._geometries.length)return!1;for(var g=0;g<this._geometries.length;g++)if(!this._geometries[g].equalsExact(c._geometries[g],a))return!1;return!0}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var i=0;i<this._geometries.length;i++)this._geometries[i].normalize();jt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var i=ae.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,this._geometries[a].getBoundaryDimension());return i}},{key:"reverseInternal",value:function(){for(var i=this._geometries.length,a=new ve(i),c=0;c<i;c++)a.add(this._geometries[c].reverse());return this.getFactory().buildGeometry(a)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var i=ae.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,this._geometries[a].getDimension());return i}},{key:"getLength",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getLength();return i}},{key:"getNumPoints",value:function(){for(var i=0,a=0;a<this._geometries.length;a++)i+=this._geometries[a].getNumPoints();return i}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var i=arguments[0],a=new Ls(jt.asList(this._geometries)),c=new Ls(jt.asList(i._geometries));return this.compare(a,c)}if(arguments.length===2){for(var g=arguments[1],p=arguments[0],_=this.getNumGeometries(),w=p.getNumGeometries(),L=0;L<_&&L<w;){var q=this.getGeometryN(L),Z=p.getGeometryN(L),Q=q.compareToSameClass(Z,g);if(Q!==0)return Q;L++}return L<_?1:L<w?-1:0}}},{key:"apply",value:function(){if(xe(arguments[0],wi))for(var i=arguments[0],a=0;a<this._geometries.length;a++)this._geometries[a].apply(i);else if(xe(arguments[0],vr)){var c=arguments[0];if(this._geometries.length===0)return null;for(var g=0;g<this._geometries.length&&(this._geometries[g].apply(c),!c.isDone());g++);c.isGeometryChanged()&&this.geometryChanged()}else if(xe(arguments[0],Fr)){var p=arguments[0];p.filter(this);for(var _=0;_<this._geometries.length;_++)this._geometries[_].apply(p)}else if(xe(arguments[0],W)){var w=arguments[0];w.filter(this);for(var L=0;L<this._geometries.length;L++)this._geometries[L].apply(w)}}},{key:"getBoundary",value:function(){return fe.checkNotGeometryCollection(this),oe.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return fe.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var i=arguments[0],a=arguments[1];if(fe.constructor_.call(this,a),i===null&&(i=[]),fe.hasNullElements(i))throw new X("geometries must not contain null elements");this._geometries=i}}}}])}(fe),ki=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new t(i,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(t,"equalsExact",this,1).call(this,i,a)}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var i=arguments[0];return this._geometries[i].getCoordinate()}return M(t,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[ks]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];gt.constructor_.call(this,i,a)}}])}(gt),_r=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"copyInternal",value:function(){return new t(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||M(t,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var i=this._points.copy();return Lt.reverse(i),this.getFactory().createLinearRing(i)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!M(t,"isClosed",this,1).call(this))throw new X("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new X("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];yr.constructor_.call(this,i,a),this.validateConstruction()}}])}(yr);_r.MINIMUM_VALID_SIZE=4;var Nn=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"setOrdinate",value:function(i,a){switch(i){case t.X:this.x=a;break;case t.Y:this.y=a;break;default:throw new X("Invalid ordinate index: "+i)}}},{key:"getZ",value:function(){return V.NULL_ORDINATE}},{key:"getOrdinate",value:function(i){switch(i){case t.X:return this.x;case t.Y:return this.y}throw new X("Invalid ordinate index: "+i)}},{key:"setZ",value:function(i){throw new X("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new t(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)V.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof t){var i=arguments[0];V.constructor_.call(this,i.x,i.y)}else if(arguments[0]instanceof V){var a=arguments[0];V.constructor_.call(this,a.x,a.y)}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];V.constructor_.call(this,c,g,V.NULL_ORDINATE)}}}])}(V);Nn.X=0,Nn.Y=1,Nn.Z=-1,Nn.M=-1;var jn=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(i,a){switch(i){case t.X:this.x=a;break;case t.Y:this.y=a;break;case t.M:this._m=a;break;default:throw new X("Invalid ordinate index: "+i)}}},{key:"setM",value:function(i){this._m=i}},{key:"getZ",value:function(){return V.NULL_ORDINATE}},{key:"getOrdinate",value:function(i){switch(i){case t.X:return this.x;case t.Y:return this.y;case t.M:return this._m}throw new X("Invalid ordinate index: "+i)}},{key:"setZ",value:function(i){throw new X("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new t(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ(),this._m=i.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)V.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof t){var i=arguments[0];V.constructor_.call(this,i.x,i.y),this._m=i._m}else if(arguments[0]instanceof V){var a=arguments[0];V.constructor_.call(this,a.x,a.y),this._m=this.getM()}}else if(arguments.length===3){var c=arguments[0],g=arguments[1],p=arguments[2];V.constructor_.call(this,c,g,V.NULL_ORDINATE),this._m=p}}}])}(V);jn.X=0,jn.Y=1,jn.Z=-1,jn.M=2;var de=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(i,a){switch(i){case V.X:this.x=a;break;case V.Y:this.y=a;break;case V.Z:this.z=a;break;case V.M:this._m=a;break;default:throw new X("Invalid ordinate index: "+i)}}},{key:"setM",value:function(i){this._m=i}},{key:"getOrdinate",value:function(i){switch(i){case V.X:return this.x;case V.Y:return this.y;case V.Z:return this.getZ();case V.M:return this.getM()}throw new X("Invalid ordinate index: "+i)}},{key:"copy",value:function(){return new t(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ(),this._m=i.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)V.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof t){var i=arguments[0];V.constructor_.call(this,i),this._m=i._m}else if(arguments[0]instanceof V){var a=arguments[0];V.constructor_.call(this,a),this._m=this.getM()}}else if(arguments.length===4){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3];V.constructor_.call(this,c,g,p),this._m=_}}}])}(V),B=function(){function o(){u(this,o)}return h(o,null,[{key:"measures",value:function(t){return t instanceof Nn?0:t instanceof jn||t instanceof de?1:0}},{key:"dimension",value:function(t){return t instanceof Nn?2:t instanceof jn?3:t instanceof de?4:3}},{key:"create",value:function(){if(arguments.length===1){var t=arguments[0];return o.create(t,0)}if(arguments.length===2){var i=arguments[0],a=arguments[1];return i===2?new Nn:i===3&&a===0?new V:i===3&&a===1?new jn:i===4&&a===1?new de:new V}}}])}(),te=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getCoordinate",value:function(i){return this.get(i)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&xe(arguments[0],De)){for(var i=arguments[1],a=!1,c=arguments[0].iterator();c.hasNext();)this.add(c.next(),i),a=!0;return a}return M(t,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var i=M(t,"clone",this,1).call(this),a=0;a<this.size();a++)i.add(a,this.get(a).clone());return i}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(t.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(t.coordArrayType);for(var i=this.size(),a=new Array(i).fill(null),c=0;c<i;c++)a[c]=this.get(i-c-1);return a}}},{key:"add",value:function(){if(arguments.length===1){var i=arguments[0];return M(t,"add",this,1).call(this,i)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],c=arguments[1];return this.add(a,c,!0),!0}if(arguments[0]instanceof V&&typeof arguments[1]=="boolean"){var g=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(g))return null;M(t,"add",this,1).call(this,g)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var p=arguments[0],_=arguments[1];return this.add(p,_),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var w=arguments[0],L=arguments[1];if(arguments[2])for(var q=0;q<w.length;q++)this.add(w[q],L);else for(var Z=w.length-1;Z>=0;Z--)this.add(w[Z],L);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof V){var Q=arguments[0],ce=arguments[1];if(!arguments[2]){var ge=this.size();if(ge>0&&(Q>0&&this.get(Q-1).equals2D(ce)||Q<ge&&this.get(Q).equals2D(ce)))return null}M(t,"add",this,1).call(this,Q,ce)}}else if(arguments.length===4){var ye=arguments[0],Ae=arguments[1],Le=arguments[2],Be=arguments[3],ct=1;Le>Be&&(ct=-1);for(var dt=Le;dt!==Be;dt+=ct)this.add(ye[dt],Ae);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var i=this.get(0).copy();this.add(i,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.ensureCapacity(a.length),this.add(a,c)}}}}])}(ve);te.coordArrayType=new Array(0).fill(null);var ue=function(){function o(){u(this,o)}return h(o,null,[{key:"isRing",value:function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])}},{key:"ptNotInList",value:function(t,i){for(var a=0;a<t.length;a++){var c=t[a];if(o.indexOf(c,i)<0)return c}return null}},{key:"scroll",value:function(t,i){var a=o.indexOf(i,t);if(a<0)return null;var c=new Array(t.length).fill(null);lt.arraycopy(t,a,c,0,t.length-a),lt.arraycopy(t,0,c,t.length-a,a),lt.arraycopy(c,0,t,0,t.length)}},{key:"equals",value:function(){if(arguments.length===2){var t=arguments[0],i=arguments[1];if(t===i)return!0;if(t===null||i===null||t.length!==i.length)return!1;for(var a=0;a<t.length;a++)if(!t[a].equals(i[a]))return!1;return!0}if(arguments.length===3){var c=arguments[0],g=arguments[1],p=arguments[2];if(c===g)return!0;if(c===null||g===null||c.length!==g.length)return!1;for(var _=0;_<c.length;_++)if(p.compare(c[_],g[_])!==0)return!1;return!0}}},{key:"intersection",value:function(t,i){for(var a=new te,c=0;c<t.length;c++)i.intersects(t[c])&&a.add(t[c],!0);return a.toCoordinateArray()}},{key:"measures",value:function(t){if(t===null||t.length===0)return 0;var i,a=0,c=m(t);try{for(c.s();!(i=c.n()).done;){var g=i.value;a=Math.max(a,B.measures(g))}}catch(p){c.e(p)}finally{c.f()}return a}},{key:"hasRepeatedPoints",value:function(t){for(var i=1;i<t.length;i++)if(t[i-1].equals(t[i]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(t){return o.hasRepeatedPoints(t)?new te(t,!1).toCoordinateArray():t}},{key:"reverse",value:function(t){for(var i=t.length-1,a=Math.trunc(i/2),c=0;c<=a;c++){var g=t[c];t[c]=t[i-c],t[i-c]=g}}},{key:"removeNull",value:function(t){for(var i=0,a=0;a<t.length;a++)t[a]!==null&&i++;var c=new Array(i).fill(null);if(i===0)return c;for(var g=0,p=0;p<t.length;p++)t[p]!==null&&(c[g++]=t[p]);return c}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var t=arguments[0],i=new Array(t.length).fill(null),a=0;a<t.length;a++)i[a]=t[a].copy();return i}if(arguments.length===5)for(var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3],w=arguments[4],L=0;L<w;L++)p[_+L]=c[g+L].copy()}},{key:"isEqualReversed",value:function(t,i){for(var a=0;a<t.length;a++){var c=t[a],g=i[t.length-a-1];if(c.compareTo(g)!==0)return!1}return!0}},{key:"envelope",value:function(t){for(var i=new be,a=0;a<t.length;a++)i.expandToInclude(t[a]);return i}},{key:"toCoordinateArray",value:function(t){return t.toArray(o.coordArrayType)}},{key:"dimension",value:function(t){if(t===null||t.length===0)return 3;var i,a=0,c=m(t);try{for(c.s();!(i=c.n()).done;){var g=i.value;a=Math.max(a,B.dimension(g))}}catch(p){c.e(p)}finally{c.f()}return a}},{key:"atLeastNCoordinatesOrNothing",value:function(t,i){return i.length>=t?i:[]}},{key:"indexOf",value:function(t,i){for(var a=0;a<i.length;a++)if(t.equals(i[a]))return a;return-1}},{key:"increasingDirection",value:function(t){for(var i=0;i<Math.trunc(t.length/2);i++){var a=t.length-1-i,c=t[i].compareTo(t[a]);if(c!==0)return c}return 1}},{key:"compare",value:function(t,i){for(var a=0;a<t.length&&a<i.length;){var c=t[a].compareTo(i[a]);if(c!==0)return c;a++}return a<i.length?-1:a<t.length?1:0}},{key:"minCoordinate",value:function(t){for(var i=null,a=0;a<t.length;a++)(i===null||i.compareTo(t[a])>0)&&(i=t[a]);return i}},{key:"extract",value:function(t,i,a){i=Tn.clamp(i,0,t.length);var c=(a=Tn.clamp(a,-1,t.length))-i+1;a<0&&(c=0),i>=t.length&&(c=0),a<i&&(c=0);var g=new Array(c).fill(null);if(c===0)return g;for(var p=0,_=i;_<=a;_++)g[p++]=t[_];return g}}])}(),ze=function(){return h(function o(){u(this,o)},[{key:"compare",value:function(o,t){var i=o,a=t;return ue.compare(i,a)}},{key:"interfaces_",get:function(){return[re]}}])}(),st=function(){return h(function o(){u(this,o)},[{key:"compare",value:function(o,t){var i=o,a=t;if(i.length<a.length)return-1;if(i.length>a.length)return 1;if(i.length===0)return 0;var c=ue.compare(i,a);return ue.isEqualReversed(i,a)?0:c}},{key:"OLDcompare",value:function(o,t){var i=o,a=t;if(i.length<a.length)return-1;if(i.length>a.length)return 1;if(i.length===0)return 0;for(var c=ue.increasingDirection(i),g=ue.increasingDirection(a),p=c>0?0:i.length-1,_=g>0?0:i.length-1,w=0;w<i.length;w++){var L=i[p].compareTo(a[_]);if(L!==0)return L;p+=c,_+=g}return 0}},{key:"interfaces_",get:function(){return[re]}}])}();ue.ForwardComparator=ze,ue.BidirectionalComparator=st,ue.coordArrayType=new Array(0).fill(null);var Ze=function(){return h(function o(t){u(this,o),this.str=t},[{key:"append",value:function(o){this.str+=o}},{key:"setCharAt",value:function(o,t){this.str=this.str.substr(0,o)+t+this.str.substr(o+1)}},{key:"toString",value:function(){return this.str}}])}(),Qe=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getM",value:function(t){return this.hasM()?this._coordinates[t].getM():K.NaN}},{key:"setOrdinate",value:function(t,i,a){switch(i){case Se.X:this._coordinates[t].x=a;break;case Se.Y:this._coordinates[t].y=a;break;default:this._coordinates[t].setOrdinate(i,a)}}},{key:"getZ",value:function(t){return this.hasZ()?this._coordinates[t].getZ():K.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(t,i){switch(i){case Se.X:return this._coordinates[t].x;case Se.Y:return this._coordinates[t].y;default:return this._coordinates[t].getOrdinate(i)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}if(arguments.length===2){var i=arguments[0];arguments[1].setCoordinate(this._coordinates[i])}}},{key:"getCoordinateCopy",value:function(t){var i=this.createCoordinate();return i.setCoordinate(this._coordinates[t]),i}},{key:"createCoordinate",value:function(){return B.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(t){return this._coordinates[t].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(t){for(var i=0;i<this._coordinates.length;i++)t.expandToInclude(this._coordinates[i]);return t}},{key:"copy",value:function(){for(var t=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++){var a=this.createCoordinate();a.setCoordinate(this._coordinates[i]),t[i]=a}return new o(t,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var t=new Ze(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var i=1;i<this._coordinates.length;i++)t.append(", "),t.append(this._coordinates[i]);return t.append(")"),t.toString()}return"()"}},{key:"getY",value:function(t){return this._coordinates[t].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Se,k]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];o.constructor_.call(this,t,ue.dimension(t),ue.measures(t))}else if(Number.isInteger(arguments[0])){var i=arguments[0];this._coordinates=new Array(i).fill(null);for(var a=0;a<i;a++)this._coordinates[a]=new V}else if(xe(arguments[0],Se)){var c=arguments[0];if(c===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=c.getDimension(),this._measures=c.getMeasures(),this._coordinates=new Array(c.size()).fill(null);for(var g=0;g<this._coordinates.length;g++)this._coordinates[g]=c.getCoordinateCopy(g)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var p=arguments[0],_=arguments[1];o.constructor_.call(this,p,_,ue.measures(p))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],L=arguments[1];this._coordinates=new Array(w).fill(null),this._dimension=L;for(var q=0;q<w;q++)this._coordinates[q]=B.create(L)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Z=arguments[0],Q=arguments[1],ce=arguments[2];this._dimension=Q,this._measures=ce,this._coordinates=Z===null?new Array(0).fill(null):Z}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var ge=arguments[0],ye=arguments[1],Ae=arguments[2];this._coordinates=new Array(ge).fill(null),this._dimension=ye,this._measures=Ae;for(var Le=0;Le<ge;Le++)this._coordinates[Le]=this.createCoordinate()}}}}])}(),bt=function(){function o(){u(this,o)}return h(o,[{key:"readResolve",value:function(){return o.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Qe(arguments[0]);if(xe(arguments[0],Se))return new Qe(arguments[0])}else{if(arguments.length===2){var t=arguments[1];return t>3&&(t=3),t<2&&(t=2),new Qe(arguments[0],t)}if(arguments.length===3){var i=arguments[2],a=arguments[1]-i;return i>1&&(i=1),a>3&&(a=3),a<2&&(a=2),new Qe(arguments[0],a+i,i)}}}},{key:"interfaces_",get:function(){return[mr,k]}}],[{key:"instance",value:function(){return o.instanceObject}}])}();bt.instanceObject=new bt;var $n=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new t(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(t,"equalsExact",this,1).call(this,i,a)}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new ve,a=0;a<this._geometries.length;a++)for(var c=this._geometries[a].getBoundary(),g=0;g<c.getNumGeometries();g++)i.add(c.getGeometryN(g));var p=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(p))}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Ms]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];gt.constructor_.call(this,i,a)}}])}(gt),at=function(){return h(function o(){u(this,o)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),po=function(o){function t(){var i;return u(this,t),(i=s(this,t)).map=new Map,i}return y(t,o),h(t,[{key:"get",value:function(i){return this.map.get(i)||null}},{key:"put",value:function(i,a){return this.map.set(i,a),a}},{key:"values",value:function(){for(var i=new ve,a=this.map.values(),c=a.next();!c.done;)i.add(c.value),c=a.next();return i}},{key:"entrySet",value:function(){var i=new Cn;return this.map.entries().forEach(function(a){return i.add(a)}),i}},{key:"size",value:function(){return this.map.size()}}])}(at),At=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"equals",value:function(t){if(!(t instanceof o))return!1;var i=t;return this._modelType===i._modelType&&this._scale===i._scale}},{key:"compareTo",value:function(t){var i=t,a=this.getMaximumSignificantDigits(),c=i.getMaximumSignificantDigits();return gn.compare(a,c)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===o.FLOATING||this._modelType===o.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var t="UNKNOWN";return this._modelType===o.FLOATING?t="Floating":this._modelType===o.FLOATING_SINGLE?t="Floating-Single":this._modelType===o.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var t=arguments[0];return K.isNaN(t)||this._modelType===o.FLOATING_SINGLE?t:this._modelType===o.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof V){var i=arguments[0];if(this._modelType===o.FLOATING)return null;i.x=this.makePrecise(i.x),i.y=this.makePrecise(i.y)}}},{key:"getMaximumSignificantDigits",value:function(){var t=16;return this._modelType===o.FLOATING?t=16:this._modelType===o.FLOATING_SINGLE?t=6:this._modelType===o.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}},{key:"setScale",value:function(t){this._scale=Math.abs(t)}},{key:"interfaces_",get:function(){return[k,$]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=o.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Si){var t=arguments[0];this._modelType=t,t===o.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var i=arguments[0];this._modelType=o.FIXED,this.setScale(i)}else if(arguments[0]instanceof o){var a=arguments[0];this._modelType=a._modelType,this._scale=a._scale}}}},{key:"mostPrecise",value:function(t,i){return t.compareTo(i)>=0?t:i}}])}(),Si=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"readResolve",value:function(){return o.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[k]}}],[{key:"constructor_",value:function(){this._name=null;var t=arguments[0];this._name=t,o.nameToTypeMap.put(t,this)}}])}();Si.nameToTypeMap=new po,At.Type=Si,At.FIXED=new Si("FIXED"),At.FLOATING=new Si("FLOATING"),At.FLOATING_SINGLE=new Si("FLOATING SINGLE"),At.maximumPreciseValue=9007199254740992;var pl=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"copyInternal",value:function(){for(var i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=this._geometries[a].copy();return new t(i,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var i=arguments[0],a=arguments[1];return!!this.isEquivalentClass(i)&&M(t,"equalsExact",this,1).call(this,i,a)}return M(t,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ae.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Ie}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[je]}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];gt.constructor_.call(this,i,a)}}])}(gt),Mi=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"createEmpty",value:function(t){switch(t){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new X("Invalid dimension: "+t)}}},{key:"toGeometry",value:function(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new V(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new V(t.getMinX(),t.getMinY()),new V(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new V(t.getMinX(),t.getMinY()),new V(t.getMinX(),t.getMaxY()),new V(t.getMaxX(),t.getMaxY()),new V(t.getMaxX(),t.getMinY()),new V(t.getMinX(),t.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLineString(t!==null?this.getCoordinateSequenceFactory().create(t):null)}if(xe(arguments[0],Se))return new yr(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new pl(null,this):arguments.length===1?new pl(arguments[0],this):void 0}},{key:"buildGeometry",value:function(t){for(var i=null,a=!1,c=!1,g=t.iterator();g.hasNext();){var p=g.next(),_=p.getTypeCode();i===null&&(i=_),_!==i&&(a=!0),p instanceof gt&&(c=!0)}if(i===null)return this.createGeometryCollection();if(a||c)return this.createGeometryCollection(o.toGeometryArray(t));var w=t.iterator().next();if(t.size()>1){if(w instanceof Gr)return this.createMultiPolygon(o.toPolygonArray(t));if(w instanceof yr)return this.createMultiLineString(o.toLineStringArray(t));if(w instanceof Ss)return this.createMultiPoint(o.toPointArray(t));oe.shouldNeverReachHere("Unhandled geometry type: "+w.getGeometryType())}return w}},{key:"createMultiPointFromCoords",value:function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof V){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}if(xe(arguments[0],Se))return new Ss(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(xe(arguments[0],Se)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof _r){var a=arguments[0];return this.createPolygon(a,null)}}else if(arguments.length===2)return new Gr(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new gt(null,this):arguments.length===1?new gt(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}if(xe(arguments[0],Se))return new _r(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new $n(null,this):arguments.length===1?new $n(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new ki(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new ki(arguments[0],this);if(xe(arguments[0],Se)){var t=arguments[0];if(t===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(t.size()).fill(null),a=0;a<t.size();a++){var c=this.getCoordinateSequenceFactory().create(1,t.getDimension(),t.getMeasures());Lt.copy(t,a,c,0,1),i[a]=this.createPoint(c)}return this.createMultiPoint(i)}}}},{key:"interfaces_",get:function(){return[k]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)o.constructor_.call(this,new At,0);else if(arguments.length===1){if(xe(arguments[0],mr)){var t=arguments[0];o.constructor_.call(this,new At,0,t)}else if(arguments[0]instanceof At){var i=arguments[0];o.constructor_.call(this,i,0,o.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];o.constructor_.call(this,a,c,o.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var g=arguments[0],p=arguments[1],_=arguments[2];this._precisionModel=g,this._coordinateSequenceFactory=_,this._SRID=p}}},{key:"toMultiPolygonArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toGeometryArray",value:function(t){if(t===null)return null;var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return bt.instance()}},{key:"toMultiLineStringArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toLineStringArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toMultiPointArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toLinearRingArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toPointArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"toPolygonArray",value:function(t){var i=new Array(t.size()).fill(null);return t.toArray(i)}},{key:"createPointFromInternalCoord",value:function(t,i){return i.getPrecisionModel().makePrecise(t),i.getFactory().createPoint(t)}}])}(),ml="XY",B2="XYZ",U2="XYM",z2="XYZM",Md={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Id="EMPTY",mo=1,Kn=2,Er=3,Ld=4,Ii=5,q2=6;for(var Y2 in Md)Md[Y2].toUpperCase();var H2=function(){return h(function o(t){u(this,o),this.wkt=t,this.index_=-1},[{key:"isAlpha_",value:function(o){return o>="a"&&o<="z"||o>="A"&&o<="Z"}},{key:"isNumeric_",value:function(o,t){return o>="0"&&o<="9"||o=="."&&!(t!==void 0&&t)}},{key:"isWhiteSpace_",value:function(o){return o==" "||o=="	"||o=="\r"||o==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var o,t=this.nextChar_(),i=this.index_,a=t;if(t=="(")o=Kn;else if(t==",")o=Ii;else if(t==")")o=Er;else if(this.isNumeric_(t)||t=="-")o=Ld,a=this.readNumber_();else if(this.isAlpha_(t))o=mo,a=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(t!=="")throw new Error("Unexpected character: "+t);o=q2}return{position:i,value:a,type:o}}},{key:"readNumber_",value:function(){var o,t=this.index_,i=!1,a=!1;do o=="."?i=!0:o!="e"&&o!="E"||(a=!0),o=this.nextChar_();while(this.isNumeric_(o,i)||!a&&(o=="e"||o=="E")||a&&(o=="-"||o=="+"));return parseFloat(this.wkt.substring(t,this.index_--))}},{key:"readText_",value:function(){var o,t=this.index_;do o=this.nextChar_();while(this.isAlpha_(o));return this.wkt.substring(t,this.index_--).toUpperCase()}}])}(),J2=function(){return h(function o(t,i){u(this,o),this.lexer_=t,this.token_,this.layout_=ml,this.factory=i},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(o){return this.token_.type==o}},{key:"match",value:function(o){var t=this.isTokenType(o);return t&&this.consume_(),t}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var o=ml,t=this.token_;if(this.isTokenType(mo)){var i=t.value;i==="Z"?o=B2:i==="M"?o=U2:i==="ZM"&&(o=z2),o!==ml&&this.consume_()}return o}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Kn)){var o=[];do o.push(this.parseGeometry_());while(this.match(Ii));if(this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Kn)){var o=this.parsePoint_();if(this.match(Er))return o}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Kn)){var o=this.parsePointList_();if(this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Kn)){var o=this.parseLineStringTextList_();if(this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var o;if(this.match(Kn)){if(o=this.token_.type==Kn?this.parsePointTextList_():this.parsePointList_(),this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Kn)){var o=this.parseLineStringTextList_();if(this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Kn)){var o=this.parsePolygonTextList_();if(this.match(Er))return o}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var o=[],t=this.layout_.length,i=0;i<t;++i){var a=this.token_;if(!this.match(Ld))break;o.push(a.value)}if(o.length==t)return o;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var o=[this.parsePoint_()];this.match(Ii);)o.push(this.parsePoint_());return o}},{key:"parsePointTextList_",value:function(){for(var o=[this.parsePointText_()];this.match(Ii);)o.push(this.parsePointText_());return o}},{key:"parseLineStringTextList_",value:function(){for(var o=[this.parseLineStringText_()];this.match(Ii);)o.push(this.parseLineStringText_());return o}},{key:"parsePolygonTextList_",value:function(){for(var o=[this.parsePolygonText_()];this.match(Ii);)o.push(this.parsePolygonText_());return o}},{key:"isEmptyGeometry_",value:function(){var o=this.isTokenType(mo)&&this.token_.value==Id;return o&&this.consume_(),o}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var o=this.factory,t=function(ye){return l(V,D(ye))},i=function(ye){var Ae=ye.map(function(Le){return o.createLinearRing(Le.map(t))});return Ae.length>1?o.createPolygon(Ae[0],Ae.slice(1)):o.createPolygon(Ae[0])},a=this.token_;if(this.match(mo)){var c=a.value;if(this.layout_=this.parseGeometryLayout_(),c=="GEOMETRYCOLLECTION"){var g=this.parseGeometryCollectionText_();return o.createGeometryCollection(g)}switch(c){case"POINT":var p=this.parsePointText_();return p?o.createPoint(l(V,D(p))):o.createPoint();case"LINESTRING":var _=this.parseLineStringText_().map(t);return o.createLineString(_);case"LINEARRING":var w=this.parseLineStringText_().map(t);return o.createLinearRing(w);case"POLYGON":var L=this.parsePolygonText_();return L&&L.length!==0?i(L):o.createPolygon();case"MULTIPOINT":var q=this.parseMultiPointText_();if(!q||q.length===0)return o.createMultiPoint();var Z=q.map(t).map(function(ye){return o.createPoint(ye)});return o.createMultiPoint(Z);case"MULTILINESTRING":var Q=this.parseMultiLineStringText_().map(function(ye){return o.createLineString(ye.map(t))});return o.createMultiLineString(Q);case"MULTIPOLYGON":var ce=this.parseMultiPolygonText_();if(!ce||ce.length===0)return o.createMultiPolygon();var ge=ce.map(i);return o.createMultiPolygon(ge);default:throw new Error("Invalid geometry type: "+c)}}throw new Error(this.formatErrorMessage_())}}])}();function bd(o){if(o.isEmpty())return"";var t=o.getCoordinate(),i=[t.x,t.y];return t.z===void 0||Number.isNaN(t.z)||i.push(t.z),t.m===void 0||Number.isNaN(t.m)||i.push(t.m),i.join(" ")}function bs(o){for(var t=o.getCoordinates().map(function(g){var p=[g.x,g.y];return g.z===void 0||Number.isNaN(g.z)||p.push(g.z),g.m===void 0||Number.isNaN(g.m)||p.push(g.m),p}),i=[],a=0,c=t.length;a<c;++a)i.push(t[a].join(" "));return i.join(", ")}function Ad(o){var t=[];t.push("("+bs(o.getExteriorRing())+")");for(var i=0,a=o.getNumInteriorRing();i<a;++i)t.push("("+bs(o.getInteriorRingN(i))+")");return t.join(", ")}var V2={Point:bd,LineString:bs,LinearRing:bs,Polygon:Ad,MultiPoint:function(o){for(var t=[],i=0,a=o.getNumGeometries();i<a;++i)t.push("("+bd(o.getGeometryN(i))+")");return t.join(", ")},MultiLineString:function(o){for(var t=[],i=0,a=o.getNumGeometries();i<a;++i)t.push("("+bs(o.getGeometryN(i))+")");return t.join(", ")},MultiPolygon:function(o){for(var t=[],i=0,a=o.getNumGeometries();i<a;++i)t.push("("+Ad(o.getGeometryN(i))+")");return t.join(", ")},GeometryCollection:function(o){for(var t=[],i=0,a=o.getNumGeometries();i<a;++i)t.push(Cd(o.getGeometryN(i)));return t.join(", ")}};function Cd(o){var t=o.getGeometryType(),i=V2[t];t=t.toUpperCase();var a=function(c){var g="";if(c.isEmpty())return g;var p=c.getCoordinate();return p.z===void 0||Number.isNaN(p.z)||(g+="Z"),p.m===void 0||Number.isNaN(p.m)||(g+="M"),g}(o);return a.length>0&&(t+=" "+a),o.isEmpty()?t+" "+Id:t+" ("+i(o)+")"}var X2=function(){return h(function o(t){u(this,o),this.geometryFactory=t||new Mi,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(o){var t=new H2(o);return new J2(t,this.geometryFactory).parse()}},{key:"write",value:function(o){return Cd(o)}}])}(),vl=function(){return h(function o(t){u(this,o),this.parser=new X2(t)},[{key:"write",value:function(o){return this.parser.write(o)}}],[{key:"toLineString",value:function(o,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+o.x+" "+o.y+", "+t.x+" "+t.y+" )"}}])}(),He=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getIndexAlongSegment",value:function(t,i){return this.computeIntLineIndex(),this._intLineIndex[t][i]}},{key:"getTopologySummary",value:function(){var t=new Ze;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()}},{key:"computeIntersection",value:function(t,i,a,c){this._inputLines[0][0]=t,this._inputLines[0][1]=i,this._inputLines[1][0]=a,this._inputLines[1][1]=c,this._result=this.computeIntersect(t,i,a,c)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(t){this._precisionModel=t}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var t=arguments[0],i=0;i<this._result;i++)if(!this._intPt[i].equals2D(this._inputLines[t][0])&&!this._intPt[i].equals2D(this._inputLines[t][1]))return!0;return!1}}},{key:"getIntersection",value:function(t){return this._intPt[t]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==o.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(t,i){return o.computeEdgeDistance(this._intPt[i],this._inputLines[t][0],this._inputLines[t][1])}},{key:"isCollinear",value:function(){return this._result===o.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return vl.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+vl.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(t,i){return this._inputLines[t][i]}},{key:"isIntersection",value:function(t){for(var i=0;i<this._result;i++)if(this._intPt[i].equals2D(t))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(t,i){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][i]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new V,this._intPt[1]=new V,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(t,i,a){var c=Math.abs(a.x-i.x),g=Math.abs(a.y-i.y),p=-1;if(t.equals(i))p=0;else if(t.equals(a))p=c>g?c:g;else{var _=Math.abs(t.x-i.x),w=Math.abs(t.y-i.y);(p=c>g?_:w)!==0||t.equals(i)||(p=Math.max(_,w))}return oe.isTrue(!(p===0&&!t.equals(i)),"Bad distance calculation"),p}},{key:"nonRobustComputeEdgeDistance",value:function(t,i,a){var c=t.x-i.x,g=t.y-i.y,p=Math.sqrt(c*c+g*g);return oe.isTrue(!(p===0&&!t.equals(i)),"Invalid distance calculation"),p}}])}();He.DONT_INTERSECT=0,He.DO_INTERSECT=1,He.COLLINEAR=2,He.NO_INTERSECTION=0,He.POINT_INTERSECTION=1,He.COLLINEAR_INTERSECTION=2;var Br=function(o){function t(){return u(this,t),s(this,t)}return y(t,o),h(t,[{key:"isInSegmentEnvelopes",value:function(i){var a=new be(this._inputLines[0][0],this._inputLines[0][1]),c=new be(this._inputLines[1][0],this._inputLines[1][1]);return a.contains(i)&&c.contains(i)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return M(t,"computeIntersection",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1],c=arguments[2];if(this._isProper=!1,be.intersects(a,c,i)&&Ee.index(a,c,i)===0&&Ee.index(c,a,i)===0)return this._isProper=!0,(i.equals(a)||i.equals(c))&&(this._isProper=!1),this._result=He.POINT_INTERSECTION,null;this._result=He.NO_INTERSECTION}},{key:"intersection",value:function(i,a,c,g){var p=this.intersectionSafe(i,a,c,g);return this.isInSegmentEnvelopes(p)||(p=new V(t.nearestEndpoint(i,a,c,g))),this._precisionModel!==null&&this._precisionModel.makePrecise(p),p}},{key:"checkDD",value:function(i,a,c,g,p){var _=Ei.intersection(i,a,c,g),w=this.isInSegmentEnvelopes(_);lt.out.println("DD in env = "+w+"  --------------------- "+_),p.distance(_)>1e-4&&lt.out.println("Distance = "+p.distance(_))}},{key:"intersectionSafe",value:function(i,a,c,g){var p=ws.intersection(i,a,c,g);return p===null&&(p=t.nearestEndpoint(i,a,c,g)),p}},{key:"computeCollinearIntersection",value:function(i,a,c,g){var p=be.intersects(i,a,c),_=be.intersects(i,a,g),w=be.intersects(c,g,i),L=be.intersects(c,g,a);return p&&_?(this._intPt[0]=c,this._intPt[1]=g,He.COLLINEAR_INTERSECTION):w&&L?(this._intPt[0]=i,this._intPt[1]=a,He.COLLINEAR_INTERSECTION):p&&w?(this._intPt[0]=c,this._intPt[1]=i,!c.equals(i)||_||L?He.COLLINEAR_INTERSECTION:He.POINT_INTERSECTION):p&&L?(this._intPt[0]=c,this._intPt[1]=a,!c.equals(a)||_||w?He.COLLINEAR_INTERSECTION:He.POINT_INTERSECTION):_&&w?(this._intPt[0]=g,this._intPt[1]=i,!g.equals(i)||p||L?He.COLLINEAR_INTERSECTION:He.POINT_INTERSECTION):_&&L?(this._intPt[0]=g,this._intPt[1]=a,!g.equals(a)||p||w?He.COLLINEAR_INTERSECTION:He.POINT_INTERSECTION):He.NO_INTERSECTION}},{key:"computeIntersect",value:function(i,a,c,g){if(this._isProper=!1,!be.intersects(i,a,c,g))return He.NO_INTERSECTION;var p=Ee.index(i,a,c),_=Ee.index(i,a,g);if(p>0&&_>0||p<0&&_<0)return He.NO_INTERSECTION;var w=Ee.index(c,g,i),L=Ee.index(c,g,a);return w>0&&L>0||w<0&&L<0?He.NO_INTERSECTION:p===0&&_===0&&w===0&&L===0?this.computeCollinearIntersection(i,a,c,g):(p===0||_===0||w===0||L===0?(this._isProper=!1,i.equals2D(c)||i.equals2D(g)?this._intPt[0]=i:a.equals2D(c)||a.equals2D(g)?this._intPt[0]=a:p===0?this._intPt[0]=new V(c):_===0?this._intPt[0]=new V(g):w===0?this._intPt[0]=new V(i):L===0&&(this._intPt[0]=new V(a))):(this._isProper=!0,this._intPt[0]=this.intersection(i,a,c,g)),He.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(i,a,c,g){var p=i,_=Zt.pointToSegment(i,c,g),w=Zt.pointToSegment(a,c,g);return w<_&&(_=w,p=a),(w=Zt.pointToSegment(c,i,a))<_&&(_=w,p=c),(w=Zt.pointToSegment(g,i,a))<_&&(_=w,p=g),p}}])}(He),W2=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"countSegment",value:function(t,i){if(t.x<this._p.x&&i.x<this._p.x)return null;if(this._p.x===i.x&&this._p.y===i.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&i.y===this._p.y){var a=t.x,c=i.x;return a>c&&(a=i.x,c=t.x),this._p.x>=a&&this._p.x<=c&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&i.y<=this._p.y||i.y>this._p.y&&t.y<=this._p.y){var g=Ee.index(t,i,this._p);if(g===Ee.COLLINEAR)return this._isPointOnSegment=!0,null;i.y<t.y&&(g=-g),g===Ee.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==C.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?C.BOUNDARY:this._crossingCount%2==1?C.INTERIOR:C.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof V&&xe(arguments[1],Se)){for(var t=arguments[1],i=new o(arguments[0]),a=new V,c=new V,g=1;g<t.size();g++)if(t.getCoordinate(g,a),t.getCoordinate(g-1,c),i.countSegment(a,c),i.isOnSegment())return i.getLocation();return i.getLocation()}if(arguments[0]instanceof V&&arguments[1]instanceof Array){for(var p=arguments[1],_=new o(arguments[0]),w=1;w<p.length;w++){var L=p[w],q=p[w-1];if(_.countSegment(L,q),_.isOnSegment())return _.getLocation()}return _.getLocation()}}}])}(),yl=function(){function o(){u(this,o)}return h(o,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof V&&xe(arguments[1],Se)){for(var t=arguments[0],i=arguments[1],a=new Br,c=new V,g=new V,p=i.size(),_=1;_<p;_++)if(i.getCoordinate(_-1,c),i.getCoordinate(_,g),a.computeIntersection(t,c,g),a.hasIntersection())return!0;return!1}if(arguments[0]instanceof V&&arguments[1]instanceof Array){for(var w=arguments[0],L=arguments[1],q=new Br,Z=1;Z<L.length;Z++){var Q=L[Z-1],ce=L[Z];if(q.computeIntersection(w,Q,ce),q.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(t,i){return W2.locatePointInRing(t,i)}},{key:"isInRing",value:function(t,i){return o.locateInRing(t,i)!==C.EXTERIOR}}])}(),$t=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"setAllLocations",value:function(t){for(var i=0;i<this.location.length;i++)this.location[i]=t}},{key:"isNull",value:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==C.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(t){for(var i=0;i<this.location.length;i++)this.location[i]===C.NONE&&(this.location[i]=t)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(t){if(t.location.length>this.location.length){var i=new Array(3).fill(null);i[ne.ON]=this.location[ne.ON],i[ne.LEFT]=C.NONE,i[ne.RIGHT]=C.NONE,this.location=i}for(var a=0;a<this.location.length;a++)this.location[a]===C.NONE&&a<t.location.length&&(this.location[a]=t.location[a])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var t=this.location[ne.LEFT];this.location[ne.LEFT]=this.location[ne.RIGHT],this.location[ne.RIGHT]=t}},{key:"toString",value:function(){var t=new Wt;return this.location.length>1&&t.append(C.toLocationSymbol(this.location[ne.LEFT])),t.append(C.toLocationSymbol(this.location[ne.ON])),this.location.length>1&&t.append(C.toLocationSymbol(this.location[ne.RIGHT])),t.toString()}},{key:"setLocations",value:function(t,i,a){this.location[ne.ON]=t,this.location[ne.LEFT]=i,this.location[ne.RIGHT]=a}},{key:"get",value:function(t){return t<this.location.length?this.location[t]:C.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===C.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var t=arguments[0];this.setLocation(ne.ON,t)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.location[i]=a}}},{key:"init",value:function(t){this.location=new Array(t).fill(null),this.setAllLocations(C.NONE)}},{key:"isEqualOnSide",value:function(t,i){return this.location[i]===t.location[i]}},{key:"allPositionsEqual",value:function(t){for(var i=0;i<this.location.length;i++)if(this.location[i]!==t)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[ne.ON]=i}else if(arguments[0]instanceof o){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var c=0;c<this.location.length;c++)this.location[c]=a.location[c]}}else if(arguments.length===3){var g=arguments[0],p=arguments[1],_=arguments[2];this.init(3),this.location[ne.ON]=g,this.location[ne.LEFT]=p,this.location[ne.RIGHT]=_}}}])}(),Kt=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getGeometryCount",value:function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t}},{key:"setAllLocations",value:function(t,i){this.elt[t].setAllLocations(i)}},{key:"isNull",value:function(t){return this.elt[t].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.elt[i].setAllLocationsIfNull(a)}}},{key:"isLine",value:function(t){return this.elt[t].isLine()}},{key:"merge",value:function(t){for(var i=0;i<2;i++)this.elt[i]===null&&t.elt[i]!==null?this.elt[i]=new $t(t.elt[i]):this.elt[i].merge(t.elt[i])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(ne.ON)}if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.elt[i].get(a)}}},{key:"toString",value:function(){var t=new Wt;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}}},{key:"isAnyNull",value:function(t){return this.elt[t].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var t=arguments[0],i=arguments[1];this.elt[t].setLocation(ne.ON,i)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];this.elt[a].setLocation(c,g)}}},{key:"isEqualOnSide",value:function(t,i){return this.elt[0].isEqualOnSide(t.elt[0],i)&&this.elt[1].isEqualOnSide(t.elt[1],i)}},{key:"allPositionsEqual",value:function(t,i){return this.elt[t].allPositionsEqual(i)}},{key:"toLine",value:function(t){this.elt[t].isArea()&&(this.elt[t]=new $t(this.elt[t].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new $t(t),this.elt[1]=new $t(t)}else if(arguments[0]instanceof o){var i=arguments[0];this.elt[0]=new $t(i.elt[0]),this.elt[1]=new $t(i.elt[1])}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.elt[0]=new $t(C.NONE),this.elt[1]=new $t(C.NONE),this.elt[a].setLocation(c)}else if(arguments.length===3){var g=arguments[0],p=arguments[1],_=arguments[2];this.elt[0]=new $t(g,p,_),this.elt[1]=new $t(g,p,_)}else if(arguments.length===4){var w=arguments[0],L=arguments[1],q=arguments[2],Z=arguments[3];this.elt[0]=new $t(C.NONE,C.NONE,C.NONE),this.elt[1]=new $t(C.NONE,C.NONE,C.NONE),this.elt[w].setLocations(L,q,Z)}}},{key:"toLineLabel",value:function(t){for(var i=new o(C.NONE),a=0;a<2;a++)i.setLocation(a,t.getLocation(a));return i}}])}(),vo=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var o=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)o[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(o),this._isHole=Ee.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(o){this._startDe=o;var t=o,i=!0;do{if(t===null)throw new It("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new It("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var a=t.getLabel();oe.isTrue(a.isArea()),this.mergeLabel(a),this.addPoints(t.getEdge(),t.isForward(),i),i=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(o){return this._pts.get(o)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var o=this._startDe;do{var t=o.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),o=this.getNext(o)}while(o!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(o,t,i){var a=o.getCoordinates();if(t){var c=1;i&&(c=0);for(var g=c;g<a.length;g++)this._pts.add(a[g])}else{var p=a.length-2;i&&(p=a.length-1);for(var _=p;_>=0;_--)this._pts.add(a[_])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var o=this._startDe;do o.getEdge().setInResult(!0),o=o.getNext();while(o!==this._startDe)}},{key:"containsPoint",value:function(o){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(o)||!yl.isInRing(o,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(o))return!1;return!0}},{key:"addHole",value:function(o){this._holes.add(o)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var o=arguments[0];this.mergeLabel(o,0),this.mergeLabel(o,1)}else if(arguments.length===2){var t=arguments[1],i=arguments[0].getLocation(t,ne.RIGHT);if(i===C.NONE)return null;if(this._label.getLocation(t)===C.NONE)return this._label.setLocation(t,i),null}}},{key:"setShell",value:function(o){this._shell=o,o!==null&&o.addHole(this)}},{key:"toPolygon",value:function(o){for(var t=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)t[i]=this._holes.get(i).getLinearRing();return o.createPolygon(this.getLinearRing(),t)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new ve,this._pts=new ve,this._label=new Kt(C.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ve,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var o=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(o),this.computeRing()}}}}])}(),Z2=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"setEdgeRing",value:function(i,a){i.setMinEdgeRing(a)}},{key:"getNext",value:function(i){return i.getNextMin()}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];vo.constructor_.call(this,i,a)}}])}(vo),j2=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"buildMinimalRings",value:function(){var i=new ve,a=this._startDe;do{if(a.getMinEdgeRing()===null){var c=new Z2(a,this._geometryFactory);i.add(c)}a=a.getNext()}while(a!==this._startDe);return i}},{key:"setEdgeRing",value:function(i,a){i.setEdgeRing(a)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var i=this._startDe;do i.getNode().getEdges().linkMinimalDirectedEdges(this),i=i.getNext();while(i!==this._startDe)}},{key:"getNext",value:function(i){return i.getNext()}}],[{key:"constructor_",value:function(){var i=arguments[0],a=arguments[1];vo.constructor_.call(this,i,a)}}])}(vo),Td=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(o){this._isVisited=o}},{key:"setInResult",value:function(o){this._isInResult=o}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(o){this._label=o}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(o){this._isCovered=o,this._isCoveredSet=!0}},{key:"updateIM",value:function(o){oe.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(o)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this._label=o}}}}])}(),yo=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"isIncidentEdgeInResult",value:function(){for(var i=this.getEdges().getEdges().iterator();i.hasNext();)if(i.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(i){i.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(i){}},{key:"computeMergedLocation",value:function(i,a){var c=C.NONE;if(c=this._label.getLocation(a),!i.isNull(a)){var g=i.getLocation(a);c!==C.BOUNDARY&&(c=g)}return c}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return M(t,"setLabel",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1];this._label===null?this._label=new Kt(i,a):this._label.setLocation(i,a)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof Kt)for(var a=arguments[0],c=0;c<2;c++){var g=this.computeMergedLocation(a,c);this._label.getLocation(c)===C.NONE&&this._label.setLocation(c,g)}}},{key:"add",value:function(i){this._edges.insert(i),i.setNode(this)}},{key:"setLabelBoundary",value:function(i){if(this._label===null)return null;var a=C.NONE;this._label!==null&&(a=this._label.getLocation(i));var c=null;switch(a){case C.BOUNDARY:c=C.INTERIOR;break;case C.INTERIOR:default:c=C.BOUNDARY}this._label.setLocation(i,c)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var i=arguments[0],a=arguments[1];this._coord=i,this._edges=a,this._label=new Kt(0,C.NONE)}}])}(Td),$2=function(o){function t(){return u(this,t),s(this,t,arguments)}return y(t,o),h(t)}(at);function Nd(o){return o==null?0:o.color}function Pe(o){return o==null?null:o.parent}function Pn(o,t){o!==null&&(o.color=t)}function _l(o){return o==null?null:o.left}function Pd(o){return o==null?null:o.right}var As=function(o){function t(){var i;return u(this,t),(i=s(this,t)).root_=null,i.size_=0,i}return y(t,o),h(t,[{key:"get",value:function(i){for(var a=this.root_;a!==null;){var c=i.compareTo(a.key);if(c<0)a=a.left;else{if(!(c>0))return a.value;a=a.right}}return null}},{key:"put",value:function(i,a){if(this.root_===null)return this.root_={key:i,value:a,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var c,g,p=this.root_;do if(c=p,(g=i.compareTo(p.key))<0)p=p.left;else{if(!(g>0)){var _=p.value;return p.value=a,_}p=p.right}while(p!==null);var w={key:i,left:null,right:null,value:a,parent:c,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return g<0?c.left=w:c.right=w,this.fixAfterInsertion(w),this.size_++,null}},{key:"fixAfterInsertion",value:function(i){var a;for(i.color=1;i!=null&&i!==this.root_&&i.parent.color===1;)Pe(i)===_l(Pe(Pe(i)))?Nd(a=Pd(Pe(Pe(i))))===1?(Pn(Pe(i),0),Pn(a,0),Pn(Pe(Pe(i)),1),i=Pe(Pe(i))):(i===Pd(Pe(i))&&(i=Pe(i),this.rotateLeft(i)),Pn(Pe(i),0),Pn(Pe(Pe(i)),1),this.rotateRight(Pe(Pe(i)))):Nd(a=_l(Pe(Pe(i))))===1?(Pn(Pe(i),0),Pn(a,0),Pn(Pe(Pe(i)),1),i=Pe(Pe(i))):(i===_l(Pe(i))&&(i=Pe(i),this.rotateRight(i)),Pn(Pe(i),0),Pn(Pe(Pe(i)),1),this.rotateLeft(Pe(Pe(i))));this.root_.color=0}},{key:"values",value:function(){var i=new ve,a=this.getFirstEntry();if(a!==null)for(i.add(a.value);(a=t.successor(a))!==null;)i.add(a.value);return i}},{key:"entrySet",value:function(){var i=new Cn,a=this.getFirstEntry();if(a!==null)for(i.add(a);(a=t.successor(a))!==null;)i.add(a);return i}},{key:"rotateLeft",value:function(i){if(i!=null){var a=i.right;i.right=a.left,a.left!=null&&(a.left.parent=i),a.parent=i.parent,i.parent==null?this.root_=a:i.parent.left===i?i.parent.left=a:i.parent.right=a,a.left=i,i.parent=a}}},{key:"rotateRight",value:function(i){if(i!=null){var a=i.left;i.left=a.right,a.right!=null&&(a.right.parent=i),a.parent=i.parent,i.parent==null?this.root_=a:i.parent.right===i?i.parent.right=a:i.parent.left=a,a.right=i,i.parent=a}}},{key:"getFirstEntry",value:function(){var i=this.root_;if(i!=null)for(;i.left!=null;)i=i.left;return i}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(i){for(var a=this.root_;a!==null;){var c=i.compareTo(a.key);if(c<0)a=a.left;else{if(!(c>0))return!0;a=a.right}}return!1}}],[{key:"successor",value:function(i){var a;if(i===null)return null;if(i.right!==null){for(a=i.right;a.left!==null;)a=a.left;return a}a=i.parent;for(var c=i;a!==null&&c===a.right;)c=a,a=a.parent;return a}}])}($2),Od=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"find",value:function(o){return this.nodeMap.get(o)}},{key:"addNode",value:function(){if(arguments[0]instanceof V){var o=arguments[0],t=this.nodeMap.get(o);return t===null&&(t=this.nodeFact.createNode(o),this.nodeMap.put(o,t)),t}if(arguments[0]instanceof yo){var i=arguments[0],a=this.nodeMap.get(i.getCoordinate());return a===null?(this.nodeMap.put(i.getCoordinate(),i),i):(a.mergeLabel(i),a)}}},{key:"print",value:function(o){for(var t=this.iterator();t.hasNext();)t.next().print(o)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(o){for(var t=new ve,i=this.iterator();i.hasNext();){var a=i.next();a.getLabel().getLocation(o)===C.BOUNDARY&&t.add(a)}return t}},{key:"add",value:function(o){var t=o.getCoordinate();this.addNode(t).add(o)}}],[{key:"constructor_",value:function(){this.nodeMap=new As,this.nodeFact=null;var o=arguments[0];this.nodeFact=o}}])}(),kt=function(){function o(){u(this,o)}return h(o,null,[{key:"isNorthern",value:function(t){return t===o.NE||t===o.NW}},{key:"isOpposite",value:function(t,i){return t!==i&&(t-i+4)%4===2}},{key:"commonHalfPlane",value:function(t,i){if(t===i)return t;if((t-i+4)%4===2)return-1;var a=t<i?t:i;return a===0&&(t>i?t:i)===3?3:a}},{key:"isInHalfPlane",value:function(t,i){return i===o.SE?t===o.SE||t===o.SW:t===i||t===i+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],i=arguments[1];if(t===0&&i===0)throw new X("Cannot compute the quadrant for point ( "+t+", "+i+" )");return t>=0?i>=0?o.NE:o.SE:i>=0?o.NW:o.SW}if(arguments[0]instanceof V&&arguments[1]instanceof V){var a=arguments[0],c=arguments[1];if(c.x===a.x&&c.y===a.y)throw new X("Cannot compute the quadrant for two identical points "+a);return c.x>=a.x?c.y>=a.y?o.NE:o.SE:c.y>=a.y?o.NW:o.SW}}}])}();kt.NE=0,kt.NW=1,kt.SW=2,kt.SE=3;var Rd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compareDirection",value:function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Ee.index(t._p0,t._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(t){this._node=t}},{key:"print",value:function(t){var i=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),c=a.lastIndexOf("."),g=a.substring(c+1);t.print("  "+g+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label)}},{key:"compareTo",value:function(t){var i=t;return this.compareDirection(i)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var t=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),a=i.lastIndexOf(".");return"  "+i.substring(a+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label}},{key:"computeLabel",value:function(t){}},{key:"init",value:function(t,i){this._p0=t,this._p1=i,this._dx=i.x-t.x,this._dy=i.y-t.y,this._quadrant=kt.quadrant(this._dx,this._dy),oe.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var i=arguments[0],a=arguments[1],c=arguments[2];o.constructor_.call(this,i,a,c,null)}else if(arguments.length===4){var g=arguments[0],p=arguments[1],_=arguments[2],w=arguments[3];o.constructor_.call(this,g),this.init(p,_),this._label=w}}}])}(),El=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(i){return this._depth[i]}},{key:"setVisited",value:function(i){this._isVisited=i}},{key:"computeDirectedLabel",value:function(){this._label=new Kt(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(i,a){if(this._depth[i]!==-999&&this._depth[i]!==a)throw new It("assigned depths do not match",this.getCoordinate());this._depth[i]=a}},{key:"isInteriorAreaEdge",value:function(){for(var i=!0,a=0;a<2;a++)this._label.isArea(a)&&this._label.getLocation(a,ne.LEFT)===C.INTERIOR&&this._label.getLocation(a,ne.RIGHT)===C.INTERIOR||(i=!1);return i}},{key:"setNextMin",value:function(i){this._nextMin=i}},{key:"print",value:function(i){M(t,"print",this,1).call(this,i),i.print(" "+this._depth[ne.LEFT]+"/"+this._depth[ne.RIGHT]),i.print(" ("+this.getDepthDelta()+")"),this._isInResult&&i.print(" inResult")}},{key:"setMinEdgeRing",value:function(i){this._minEdgeRing=i}},{key:"isLineEdge",value:function(){var i=this._label.isLine(0)||this._label.isLine(1),a=!this._label.isArea(0)||this._label.allPositionsEqual(0,C.EXTERIOR),c=!this._label.isArea(1)||this._label.allPositionsEqual(1,C.EXTERIOR);return i&&a&&c}},{key:"setEdgeRing",value:function(i){this._edgeRing=i}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var i=this._edge.getDepthDelta();return this._isForward||(i=-i),i}},{key:"setInResult",value:function(i){this._isInResult=i}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(i){this.print(i),i.print(" "),this._isForward?this._edge.print(i):this._edge.printReverse(i)}},{key:"setSym",value:function(i){this._sym=i}},{key:"setVisitedEdge",value:function(i){this.setVisited(i),this._sym.setVisited(i)}},{key:"setEdgeDepths",value:function(i,a){var c=this.getEdge().getDepthDelta();this._isForward||(c=-c);var g=1;i===ne.LEFT&&(g=-1);var p=ne.opposite(i),_=a+c*g;this.setDepth(i,a),this.setDepth(p,_)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(i){this._next=i}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var i=arguments[0],a=arguments[1];if(Rd.constructor_.call(this,i),this._isForward=a,a)this.init(i.getCoordinate(0),i.getCoordinate(1));else{var c=i.getNumPoints()-1;this.init(i.getCoordinate(c),i.getCoordinate(c-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(i,a){return i===C.EXTERIOR&&a===C.INTERIOR?1:i===C.INTERIOR&&a===C.EXTERIOR?-1:0}}])}(Rd),Dd=function(){return h(function o(){u(this,o)},[{key:"createNode",value:function(o){return new yo(o,null)}}])}(),Fd=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(o){o.println("Edges:");for(var t=0;t<this._edges.size();t++){o.println("edge "+t+":");var i=this._edges.get(t);i.print(o),i.eiList.print(o)}}},{key:"find",value:function(o){return this._nodes.find(o)}},{key:"addNode",value:function(){if(arguments[0]instanceof yo){var o=arguments[0];return this._nodes.addNode(o)}if(arguments[0]instanceof V){var t=arguments[0];return this._nodes.addNode(t)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var o=this._nodes.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(o){lt.out.println(o)}},{key:"isBoundaryNode",value:function(o,t){var i=this._nodes.find(t);if(i===null)return!1;var a=i.getLabel();return a!==null&&a.getLocation(o)===C.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var o=this._nodes.iterator();o.hasNext();)o.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(o,t,i,a){return!!o.equals(i)&&Ee.index(o,t,a)===Ee.COLLINEAR&&kt.quadrant(o,t)===kt.quadrant(i,a)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(o){lt.out.print(o)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(o,t){for(var i=0;i<this._edges.size();i++){var a=this._edges.get(i),c=a.getCoordinates();if(this.matchInSameDirection(o,t,c[0],c[1])||this.matchInSameDirection(o,t,c[c.length-1],c[c.length-2]))return a}return null}},{key:"insertEdge",value:function(o){this._edges.add(o)}},{key:"findEdgeEnd",value:function(o){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var i=t.next();if(i.getEdge()===o)return i}return null}},{key:"addEdges",value:function(o){for(var t=o.iterator();t.hasNext();){var i=t.next();this._edges.add(i);var a=new El(i,!0),c=new El(i,!1);a.setSym(c),c.setSym(a),this.add(a),this.add(c)}}},{key:"add",value:function(o){this._nodes.add(o),this._edgeEndList.add(o)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(o,t){for(var i=0;i<this._edges.size();i++){var a=this._edges.get(i),c=a.getCoordinates();if(o.equals(c[0])&&t.equals(c[1]))return a}return null}}],[{key:"constructor_",value:function(){if(this._edges=new ve,this._nodes=null,this._edgeEndList=new ve,arguments.length===0)this._nodes=new Od(new Dd);else if(arguments.length===1){var o=arguments[0];this._nodes=new Od(o)}}},{key:"linkResultDirectedEdges",value:function(o){for(var t=o.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}}])}(),K2=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"sortShellsAndHoles",value:function(t,i,a){for(var c=t.iterator();c.hasNext();){var g=c.next();g.isHole()?a.add(g):i.add(g)}}},{key:"computePolygons",value:function(t){for(var i=new ve,a=t.iterator();a.hasNext();){var c=a.next().toPolygon(this._geometryFactory);i.add(c)}return i}},{key:"placeFreeHoles",value:function(t,i){for(var a=i.iterator();a.hasNext();){var c=a.next();if(c.getShell()===null){var g=o.findEdgeRingContaining(c,t);if(g===null)throw new It("unable to assign hole to a shell",c.getCoordinate(0));c.setShell(g)}}}},{key:"buildMinimalEdgeRings",value:function(t,i,a){for(var c=new ve,g=t.iterator();g.hasNext();){var p=g.next();if(p.getMaxNodeDegree()>2){p.linkDirectedEdgesForMinimalEdgeRings();var _=p.buildMinimalRings(),w=this.findShell(_);w!==null?(this.placePolygonHoles(w,_),i.add(w)):a.addAll(_)}else c.add(p)}return c}},{key:"buildMaximalEdgeRings",value:function(t){for(var i=new ve,a=t.iterator();a.hasNext();){var c=a.next();if(c.isInResult()&&c.getLabel().isArea()&&c.getEdgeRing()===null){var g=new j2(c,this._geometryFactory);i.add(g),g.setInResult()}}return i}},{key:"placePolygonHoles",value:function(t,i){for(var a=i.iterator();a.hasNext();){var c=a.next();c.isHole()&&c.setShell(t)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(t){for(var i=0,a=null,c=t.iterator();c.hasNext();){var g=c.next();g.isHole()||(a=g,i++)}return oe.isTrue(i<=1,"found two shells in MinimalEdgeRing list"),a}},{key:"add",value:function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var i=arguments[0],a=arguments[1];Fd.linkResultDirectedEdges(a);var c=this.buildMaximalEdgeRings(i),g=new ve,p=this.buildMinimalEdgeRings(c,this._shellList,g);this.sortShellsAndHoles(p,this._shellList,g),this.placeFreeHoles(this._shellList,g)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new ve;var t=arguments[0];this._geometryFactory=t}},{key:"findEdgeRingContaining",value:function(t,i){for(var a=t.getLinearRing(),c=a.getEnvelopeInternal(),g=a.getCoordinateN(0),p=null,_=null,w=i.iterator();w.hasNext();){var L=w.next(),q=L.getLinearRing(),Z=q.getEnvelopeInternal();if(!Z.equals(c)&&Z.contains(c)){g=ue.ptNotInList(a.getCoordinates(),q.getCoordinates());var Q=!1;yl.isInRing(g,q.getCoordinates())&&(Q=!0),Q&&(p===null||_.contains(Z))&&(_=(p=L).getLinearRing().getEnvelopeInternal())}}return p}}])}(),Gd=function(){return h(function o(){u(this,o)},[{key:"getBounds",value:function(){}}])}(),Qn=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Gd,k]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var o=arguments[0],t=arguments[1];this._bounds=o,this._item=t}}])}(),_o=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var o=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),o}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(o){for(var t=null,i=this._items.get(o);2*o<=this._size&&((t=2*o)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(i)<0);o=t)this._items.set(o,this._items.get(t));this._items.set(o,i)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(o){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,o);o.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,o)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new ve,this._items.add(null)}}])}(),Q2=function(){return h(function o(){u(this,o)},[{key:"insert",value:function(o,t){}},{key:"remove",value:function(o,t){}},{key:"query",value:function(){}}])}(),Qt=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(o){oe.isTrue(this._bounds===null),this._childBoundables.add(o)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Gd,k]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new ve,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this._level=o}}}}])}(),Li={reverseOrder:function(){return{compare:function(o,t){return t.compareTo(o)}}},min:function(o){return Li.sort(o),o.get(0)},sort:function(o,t){var i=o.toArray();t?jt.sort(i,t):jt.sort(i);for(var a=o.iterator(),c=0,g=i.length;c<g;c++)a.next(),a.set(i[c])},singletonList:function(o){var t=new ve;return t.add(o),t}},eS=function(){function o(){u(this,o)}return h(o,null,[{key:"maxDistance",value:function(t,i,a,c,g,p,_,w){var L=o.distance(t,i,g,p);return L=Math.max(L,o.distance(t,i,_,w)),L=Math.max(L,o.distance(a,c,g,p)),L=Math.max(L,o.distance(a,c,_,w))}},{key:"distance",value:function(t,i,a,c){var g=a-t,p=c-i;return Math.sqrt(g*g+p*p)}},{key:"maximumDistance",value:function(t,i){var a=Math.min(t.getMinX(),i.getMinX()),c=Math.min(t.getMinY(),i.getMinY()),g=Math.max(t.getMaxX(),i.getMaxX()),p=Math.max(t.getMaxY(),i.getMaxY());return o.distance(a,c,g,p)}},{key:"minMaxDistance",value:function(t,i){var a=t.getMinX(),c=t.getMinY(),g=t.getMaxX(),p=t.getMaxY(),_=i.getMinX(),w=i.getMinY(),L=i.getMaxX(),q=i.getMaxY(),Z=o.maxDistance(a,c,a,p,_,w,_,q);return Z=Math.min(Z,o.maxDistance(a,c,a,p,_,w,L,w)),Z=Math.min(Z,o.maxDistance(a,c,a,p,L,q,_,q)),Z=Math.min(Z,o.maxDistance(a,c,a,p,L,q,L,w)),Z=Math.min(Z,o.maxDistance(a,c,g,c,_,w,_,q)),Z=Math.min(Z,o.maxDistance(a,c,g,c,_,w,L,w)),Z=Math.min(Z,o.maxDistance(a,c,g,c,L,q,_,q)),Z=Math.min(Z,o.maxDistance(a,c,g,c,L,q,L,w)),Z=Math.min(Z,o.maxDistance(g,p,a,p,_,w,_,q)),Z=Math.min(Z,o.maxDistance(g,p,a,p,_,w,L,w)),Z=Math.min(Z,o.maxDistance(g,p,a,p,L,q,_,q)),Z=Math.min(Z,o.maxDistance(g,p,a,p,L,q,L,w)),Z=Math.min(Z,o.maxDistance(g,p,g,c,_,w,_,q)),Z=Math.min(Z,o.maxDistance(g,p,g,c,_,w,L,w)),Z=Math.min(Z,o.maxDistance(g,p,g,c,L,q,_,q)),Z=Math.min(Z,o.maxDistance(g,p,g,c,L,q,L,w))}}])}(),bi=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"maximumDistance",value:function(){return eS.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(t,i){var a=o.isComposite(this._boundable1),c=o.isComposite(this._boundable2);if(a&&c)return o.area(this._boundable1)>o.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,i),null):(this.expand(this._boundable2,this._boundable1,!0,t,i),null);if(a)return this.expand(this._boundable1,this._boundable2,!1,t,i),null;if(c)return this.expand(this._boundable2,this._boundable1,!0,t,i),null;throw new X("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(o.isComposite(this._boundable1)||o.isComposite(this._boundable2))}},{key:"compareTo",value:function(t){var i=t;return this._distance<i._distance?-1:this._distance>i._distance?1:0}},{key:"expand",value:function(t,i,a,c,g){for(var p=t.getChildBoundables().iterator();p.hasNext();){var _=p.next(),w=null;(w=a?new o(i,_,this._itemDistance):new o(_,i,this._itemDistance)).getDistance()<g&&c.add(w)}}},{key:"getBoundable",value:function(t){return t===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],i=arguments[1],a=arguments[2];this._boundable1=t,this._boundable2=i,this._itemDistance=a,this._distance=this.distance()}},{key:"area",value:function(t){return t.getBounds().getArea()}},{key:"isComposite",value:function(t){return t instanceof Qt}}])}(),Bd=function(){return h(function o(){u(this,o)},[{key:"visitItem",value:function(o){}}])}(),Ai=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"queryInternal",value:function(){if(xe(arguments[2],Bd)&&arguments[0]instanceof Object&&arguments[1]instanceof Qt)for(var t=arguments[0],i=arguments[2],a=arguments[1].getChildBoundables(),c=0;c<a.size();c++){var g=a.get(c);this.getIntersectsOp().intersects(g.getBounds(),t)&&(g instanceof Qt?this.queryInternal(t,g,i):g instanceof Qn?i.visitItem(g.getItem()):oe.shouldNeverReachHere())}else if(xe(arguments[2],Zn)&&arguments[0]instanceof Object&&arguments[1]instanceof Qt)for(var p=arguments[0],_=arguments[2],w=arguments[1].getChildBoundables(),L=0;L<w.size();L++){var q=w.get(L);this.getIntersectsOp().intersects(q.getBounds(),p)&&(q instanceof Qt?this.queryInternal(p,q,_):q instanceof Qn?_.add(q.getItem()):oe.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(t){return t.get(t.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=0,i=arguments[0].getChildBoundables().iterator();i.hasNext();){var a=i.next();a instanceof Qt?t+=this.size(a):a instanceof Qn&&(t+=1)}return t}}},{key:"removeItem",value:function(t,i){for(var a=null,c=t.getChildBoundables().iterator();c.hasNext();){var g=c.next();g instanceof Qn&&g.getItem()===i&&(a=g)}return a!==null&&(t.getChildBoundables().remove(a),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new ve:t}if(arguments.length===1){for(var i=arguments[0],a=new ve,c=i.getChildBoundables().iterator();c.hasNext();){var g=c.next();if(g instanceof Qt){var p=this.itemsTree(g);p!==null&&a.add(p)}else g instanceof Qn?a.add(g.getItem()):oe.shouldNeverReachHere()}return a.size()<=0?null:a}}},{key:"insert",value:function(t,i){oe.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Qn(t,i))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var t=arguments[0],i=new ve;return this.boundablesAtLevel(t,this._root,i),i}if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];if(oe.isTrue(a>-2),c.getLevel()===a)return g.add(c),null;for(var p=c.getChildBoundables().iterator();p.hasNext();){var _=p.next();_ instanceof Qt?this.boundablesAtLevel(a,_,g):(oe.isTrue(_ instanceof Qn),a===-1&&g.add(_))}return null}}},{key:"query",value:function(){if(arguments.length===1){var t=arguments[0];this.build();var i=new ve;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,i),i}if(arguments.length===2){var a=arguments[0],c=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.queryInternal(a,this._root,c)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var t=arguments[0],i=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,i)}if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2],p=this.removeItem(c,g);if(p)return!0;for(var _=null,w=c.getChildBoundables().iterator();w.hasNext();){var L=w.next();if(this.getIntersectsOp().intersects(L.getBounds(),a)&&L instanceof Qt&&(p=this.remove(a,L,g))){_=L;break}}return _!==null&&_.getChildBoundables().isEmpty()&&c.getChildBoundables().remove(_),p}}},{key:"createHigherLevels",value:function(t,i){oe.isTrue(!t.isEmpty());var a=this.createParentBoundables(t,i+1);return a.size()===1?a.get(0):this.createHigherLevels(a,i+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=0,i=arguments[0].getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof Qt){var c=this.depth(a);c>t&&(t=c)}}return t+1}}},{key:"createParentBoundables",value:function(t,i){oe.isTrue(!t.isEmpty());var a=new ve;a.add(this.createNode(i));var c=new ve(t);Li.sort(c,this.getComparator());for(var g=c.iterator();g.hasNext();){var p=g.next();this.lastNode(a).getChildBoundables().size()===this.getNodeCapacity()&&a.add(this.createNode(i)),this.lastNode(a).addChildBoundable(p)}return a}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[k]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new ve,this._nodeCapacity=null,arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var t=arguments[0];oe.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}},{key:"compareDoubles",value:function(t,i){return t>i?1:t<i?-1:0}}])}();Ai.IntersectsOp=function(){},Ai.DEFAULT_NODE_CAPACITY=10;var tS=function(){return h(function o(){u(this,o)},[{key:"distance",value:function(o,t){}}])}(),On=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"createParentBoundablesFromVerticalSlices",value:function(i,a){oe.isTrue(i.length>0);for(var c=new ve,g=0;g<i.length;g++)c.addAll(this.createParentBoundablesFromVerticalSlice(i[g],a));return c}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var i=arguments[0],a=arguments[1];return this.nearestNeighbourK(i,K.POSITIVE_INFINITY,a)}if(arguments.length===3){var c=arguments[0],g=arguments[2],p=arguments[1],_=new _o;_.add(c);for(var w=new _o;!_.isEmpty()&&p>=0;){var L=_.poll(),q=L.getDistance();if(q>=p)break;L.isLeaves()?w.size()<g?w.add(L):(w.peek().getDistance()>q&&(w.poll(),w.add(L)),p=w.peek().getDistance()):L.expandToQueue(_,p)}return t.getItems(w)}}},{key:"createNode",value:function(i){return new Ud(i)}},{key:"size",value:function(){return arguments.length===0?M(t,"size",this,1).call(this):M(t,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof be))return M(t,"insert",this,1).apply(this,arguments);var i=arguments[0],a=arguments[1];if(i.isNull())return null;M(t,"insert",this,1).call(this,i,a)}},{key:"getIntersectsOp",value:function(){return t.intersectsOp}},{key:"verticalSlices",value:function(i,a){for(var c=Math.trunc(Math.ceil(i.size()/a)),g=new Array(a).fill(null),p=i.iterator(),_=0;_<a;_++){g[_]=new ve;for(var w=0;p.hasNext()&&w<c;){var L=p.next();g[_].add(L),w++}}return g}},{key:"query",value:function(){if(arguments.length===1){var i=arguments[0];return M(t,"query",this,1).call(this,i)}if(arguments.length===2){var a=arguments[0],c=arguments[1];M(t,"query",this,1).call(this,a,c)}}},{key:"getComparator",value:function(){return t.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(i,a){return M(t,"createParentBoundables",this,1).call(this,i,a)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof be){var i=arguments[0],a=arguments[1];return M(t,"remove",this,1).call(this,i,a)}return M(t,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?M(t,"depth",this,1).call(this):M(t,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(i,a){oe.isTrue(!i.isEmpty());var c=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),g=new ve(i);Li.sort(g,t.xComparator);var p=this.verticalSlices(g,Math.trunc(Math.ceil(Math.sqrt(c))));return this.createParentBoundablesFromVerticalSlices(p,a)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(xe(arguments[0],tS)){var i=arguments[0];if(this.isEmpty())return null;var a=new bi(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(a)}if(arguments[0]instanceof bi){var c=arguments[0],g=K.POSITIVE_INFINITY,p=null,_=new _o;for(_.add(c);!_.isEmpty()&&g>0;){var w=_.poll(),L=w.getDistance();if(L>=g)break;w.isLeaves()?(g=L,p=w):w.expandToQueue(_,g)}return p===null?null:[p.getBoundable(0).getItem(),p.getBoundable(1).getItem()]}}else{if(arguments.length===2){var q=arguments[0],Z=arguments[1];if(this.isEmpty()||q.isEmpty())return null;var Q=new bi(this.getRoot(),q.getRoot(),Z);return this.nearestNeighbour(Q)}if(arguments.length===3){var ce=arguments[2],ge=new Qn(arguments[0],arguments[1]),ye=new bi(this.getRoot(),ge,ce);return this.nearestNeighbour(ye)[0]}if(arguments.length===4){var Ae=arguments[2],Le=arguments[3],Be=new Qn(arguments[0],arguments[1]),ct=new bi(this.getRoot(),Be,Ae);return this.nearestNeighbourK(ct,Le)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var i=arguments[0],a=arguments[1],c=K.POSITIVE_INFINITY,g=new _o;for(g.add(i);!g.isEmpty();){var p=g.poll(),_=p.getDistance();if(_>a)return!1;if(p.maximumDistance()<=a)return!0;if(p.isLeaves()){if((c=_)<=a)return!0}else p.expandToQueue(g,c)}return!1}if(arguments.length===3){var w=arguments[0],L=arguments[1],q=arguments[2],Z=new bi(this.getRoot(),w.getRoot(),L);return this.isWithinDistance(Z,q)}}},{key:"interfaces_",get:function(){return[Q2,k]}}],[{key:"constructor_",value:function(){if(arguments.length===0)t.constructor_.call(this,t.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var i=arguments[0];Ai.constructor_.call(this,i)}}},{key:"centreX",value:function(i){return t.avg(i.getMinX(),i.getMaxX())}},{key:"avg",value:function(i,a){return(i+a)/2}},{key:"getItems",value:function(i){for(var a=new Array(i.size()).fill(null),c=0;!i.isEmpty();){var g=i.poll();a[c]=g.getBoundable(0).getItem(),c++}return a}},{key:"centreY",value:function(i){return t.avg(i.getMinY(),i.getMaxY())}}])}(Ai),Ud=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"computeBounds",value:function(){for(var i=null,a=this.getChildBoundables().iterator();a.hasNext();){var c=a.next();i===null?i=new be(c.getBounds()):i.expandToInclude(c.getBounds())}return i}}],[{key:"constructor_",value:function(){var i=arguments[0];Qt.constructor_.call(this,i)}}])}(Qt);On.STRtreeNode=Ud,On.xComparator=new(function(){return h(function o(){u(this,o)},[{key:"interfaces_",get:function(){return[re]}},{key:"compare",value:function(o,t){return Ai.compareDoubles(On.centreX(o.getBounds()),On.centreX(t.getBounds()))}}])}()),On.yComparator=new(function(){return h(function o(){u(this,o)},[{key:"interfaces_",get:function(){return[re]}},{key:"compare",value:function(o,t){return Ai.compareDoubles(On.centreY(o.getBounds()),On.centreY(t.getBounds()))}}])}()),On.intersectsOp=new(function(){return h(function o(){u(this,o)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(o,t){return o.intersects(t)}}])}()),On.DEFAULT_NODE_CAPACITY=10;var nS=function(){function o(){u(this,o)}return h(o,null,[{key:"relativeSign",value:function(t,i){return t<i?-1:t>i?1:0}},{key:"compare",value:function(t,i,a){if(i.equals2D(a))return 0;var c=o.relativeSign(i.x,a.x),g=o.relativeSign(i.y,a.y);switch(t){case 0:return o.compareValue(c,g);case 1:return o.compareValue(g,c);case 2:return o.compareValue(g,-c);case 3:return o.compareValue(-c,g);case 4:return o.compareValue(-c,-g);case 5:return o.compareValue(-g,-c);case 6:return o.compareValue(-g,c);case 7:return o.compareValue(c,-g)}return oe.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(t,i){return t<0?-1:t>0?1:i<0?-1:i>0?1:0}}])}(),rS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(o){o.print(this.coord),o.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(o){var t=o;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:this._isInterior?t._isInterior?nS.compare(this._segmentOctant,this.coord,t.coord):1:-1}},{key:"isEndPoint",value:function(o){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===o}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var o=arguments[0],t=arguments[1],i=arguments[2],a=arguments[3];this._segString=o,this.coord=new V(t),this.segmentIndex=i,this._segmentOctant=a,this._isInterior=!t.equals2D(o.getCoordinate(i))}}])}(),iS=function(){return h(function o(){u(this,o)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),sS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var o=new te;this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var a=t.next();this.addEdgeCoordinates(i,a,o),i=a}return o.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var o=new ve;this.findCollapsesFromInsertedNodes(o),this.findCollapsesFromExistingVertices(o);for(var t=o.iterator();t.hasNext();){var i=t.next().intValue();this.add(this._edge.getCoordinate(i),i)}}},{key:"createSplitEdgePts",value:function(o,t){var i=t.segmentIndex-o.segmentIndex+2;if(i===2)return[new V(o.coord),new V(t.coord)];var a=this._edge.getCoordinate(t.segmentIndex),c=t.isInterior()||!t.coord.equals2D(a);c||i--;var g=new Array(i).fill(null),p=0;g[p++]=new V(o.coord);for(var _=o.segmentIndex+1;_<=t.segmentIndex;_++)g[p++]=this._edge.getCoordinate(_);return c&&(g[p]=new V(t.coord)),g}},{key:"print",value:function(o){o.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(o)}},{key:"findCollapsesFromExistingVertices",value:function(o){for(var t=0;t<this._edge.size()-2;t++){var i=this._edge.getCoordinate(t);this._edge.getCoordinate(t+1);var a=this._edge.getCoordinate(t+2);i.equals2D(a)&&o.add(gn.valueOf(t+1))}}},{key:"addEdgeCoordinates",value:function(o,t,i){var a=this.createSplitEdgePts(o,t);i.add(a,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(o){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),i=t.next();t.hasNext();){var a=t.next(),c=this.createSplitEdge(i,a);o.add(c),i=a}}},{key:"findCollapseIndex",value:function(o,t,i){if(!o.coord.equals2D(t.coord))return!1;var a=t.segmentIndex-o.segmentIndex;return t.isInterior()||a--,a===1&&(i[0]=o.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(o){for(var t=new Array(1).fill(null),i=this.iterator(),a=i.next();i.hasNext();){var c=i.next();this.findCollapseIndex(a,c,t)&&o.add(gn.valueOf(t[0])),a=c}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var o=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(o),o)}},{key:"createSplitEdge",value:function(o,t){var i=this.createSplitEdgePts(o,t);return new Ur(i,this._edge.getData())}},{key:"add",value:function(o,t){var i=new rS(this._edge,o,t,this._edge.getSegmentOctant(t)),a=this._nodeMap.get(i);return a!==null?(oe.isTrue(a.coord.equals2D(o),"Found equal nodes with different coordinates"),a):(this._nodeMap.put(i,i),i)}},{key:"checkSplitEdgesCorrectness",value:function(o){var t=this._edge.getCoordinates(),i=o.get(0).getCoordinate(0);if(!i.equals2D(t[0]))throw new me("bad split edge start point at "+i);var a=o.get(o.size()-1).getCoordinates(),c=a[a.length-1];if(!c.equals2D(t[t.length-1]))throw new me("bad split edge end point at "+c)}}],[{key:"constructor_",value:function(){this._nodeMap=new As,this._edge=null;var o=arguments[0];this._edge=o}}])}(),aS=function(){function o(){u(this,o)}return h(o,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],i=arguments[1];if(t===0&&i===0)throw new X("Cannot compute the octant for point ( "+t+", "+i+" )");var a=Math.abs(t),c=Math.abs(i);return t>=0?i>=0?a>=c?0:1:a>=c?7:6:i>=0?a>=c?3:2:a>=c?4:5}if(arguments[0]instanceof V&&arguments[1]instanceof V){var g=arguments[0],p=arguments[1],_=p.x-g.x,w=p.y-g.y;if(_===0&&w===0)throw new X("Cannot compute the octant for two identical points "+g);return o.octant(_,w)}}}])}(),oS=function(){return h(function o(){u(this,o)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(o){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(o){}},{key:"getData",value:function(){}}])}(),uS=function(){return h(function o(){u(this,o)},[{key:"addIntersection",value:function(o,t){}},{key:"interfaces_",get:function(){return[oS]}}])}(),Ur=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(t){return this._pts[t]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))}},{key:"setData",value:function(t){this._data=t}},{key:"safeOctant",value:function(t,i){return t.equals2D(i)?0:aS.octant(t,i)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var t=arguments[0],i=arguments[1];this.addIntersectionNode(t,i)}else if(arguments.length===4){var a=arguments[1],c=arguments[3],g=new V(arguments[0].getIntersection(c));this.addIntersection(g,a)}}},{key:"toString",value:function(){return vl.toLineString(new Qe(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(t,i){var a=i,c=a+1;if(c<this._pts.length){var g=this._pts[c];t.equals2D(g)&&(a=c)}return this._nodeList.add(t,a)}},{key:"addIntersections",value:function(t,i,a){for(var c=0;c<t.getIntersectionNum();c++)this.addIntersection(t,i,a,c)}},{key:"interfaces_",get:function(){return[uS]}}],[{key:"constructor_",value:function(){this._nodeList=new sS(this),this._pts=null,this._data=null;var t=arguments[0],i=arguments[1];this._pts=t,this._data=i}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var t=arguments[0],i=new ve;return o.getNodedSubstrings(t,i),i}if(arguments.length===2)for(var a=arguments[1],c=arguments[0].iterator();c.hasNext();)c.next().getNodeList().addSplitEdges(a)}}])}(),Gt=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof o){var t=arguments[0],i=Ee.index(this.p0,this.p1,t.p0),a=Ee.index(this.p0,this.p1,t.p1);return i>=0&&a>=0||i<=0&&a<=0?Math.max(i,a):0}if(arguments[0]instanceof V){var c=arguments[0];return Ee.index(this.p0,this.p1,c)}}},{key:"toGeometry",value:function(t){return t.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(t){if(!(t instanceof o))return!1;var i=t;return this.p0.equals(i.p0)&&this.p1.equals(i.p1)}},{key:"intersection",value:function(t){var i=new Br;return i.computeIntersection(this.p0,this.p1,t.p0,t.p1),i.hasIntersection()?i.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof V){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new V(t);var i=this.projectionFactor(t),a=new V;return a.x=this.p0.x+i*(this.p1.x-this.p0.x),a.y=this.p0.y+i*(this.p1.y-this.p0.y),a}if(arguments[0]instanceof o){var c=arguments[0],g=this.projectionFactor(c.p0),p=this.projectionFactor(c.p1);if(g>=1&&p>=1||g<=0&&p<=0)return null;var _=this.project(c.p0);g<0&&(_=this.p0),g>1&&(_=this.p1);var w=this.project(c.p1);return p<0&&(w=this.p0),p>1&&(w=this.p1),new o(_,w)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(t){return t===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(t){return Zt.pointToLinePerpendicular(t,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return o.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,c=i*i+a*a;return c<=0?K.NaN:((t.x-this.p0.x)*i+(t.y-this.p0.y)*a)/c}},{key:"closestPoints",value:function(t){var i=this.intersection(t);if(i!==null)return[i,i];var a=new Array(2).fill(null),c=K.MAX_VALUE,g=null,p=this.closestPoint(t.p0);c=p.distance(t.p0),a[0]=p,a[1]=t.p0;var _=this.closestPoint(t.p1);(g=_.distance(t.p1))<c&&(c=g,a[0]=_,a[1]=t.p1);var w=t.closestPoint(this.p0);(g=w.distance(this.p0))<c&&(c=g,a[0]=this.p0,a[1]=w);var L=t.closestPoint(this.p1);return(g=L.distance(this.p1))<c&&(c=g,a[0]=this.p1,a[1]=L),a}},{key:"closestPoint",value:function(t){var i=this.projectionFactor(t);return i>0&&i<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(t){var i=t,a=this.p0.compareTo(i.p0);return a!==0?a:this.p1.compareTo(i.p1)}},{key:"reverse",value:function(){var t=this.p0;this.p0=this.p1,this.p1=t}},{key:"equalsTopo",value:function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)}},{key:"lineIntersection",value:function(t){return ws.intersection(this.p0,this.p1,t.p0,t.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(t,i){var a=this.p0.x+t*(this.p1.x-this.p0.x),c=this.p0.y+t*(this.p1.y-this.p0.y),g=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,_=Math.sqrt(g*g+p*p),w=0,L=0;if(i!==0){if(_<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");w=i*g/_,L=i*p/_}return new V(a-L,c+w)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.p0.x=i.x,this.p0.y=i.y,this.p1.x=a.x,this.p1.y=a.y}}},{key:"segmentFraction",value:function(t){var i=this.projectionFactor(t);return i<0?i=0:(i>1||K.isNaN(i))&&(i=1),i}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(t){var i=this.p1.getY()-this.p0.getY(),a=this.p0.getX()-this.p1.getX(),c=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),g=i*i+a*a,p=i*i-a*a,_=t.getX(),w=t.getY();return new V((-p*_-2*i*a*w-2*i*c)/g,(p*w-2*i*a*_-2*a*c)/g)}},{key:"distance",value:function(){if(arguments[0]instanceof o){var t=arguments[0];return Zt.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof V){var i=arguments[0];return Zt.pointToSegment(i,this.p0,this.p1)}}},{key:"pointAlong",value:function(t){var i=new V;return i.x=this.p0.x+t*(this.p1.x-this.p0.x),i.y=this.p0.y+t*(this.p1.y-this.p0.y),i}},{key:"hashCode",value:function(){var t=K.doubleToLongBits(this.p0.x);t^=31*K.doubleToLongBits(this.p0.y);var i=Math.trunc(t)^Math.trunc(t>>32),a=K.doubleToLongBits(this.p1.x);return a^=31*K.doubleToLongBits(this.p1.y),i^(Math.trunc(a)^Math.trunc(a>>32))}},{key:"interfaces_",get:function(){return[$,k]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)o.constructor_.call(this,new V,new V);else if(arguments.length===1){var t=arguments[0];o.constructor_.call(this,t.p0,t.p1)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.p0=i,this.p1=a}else if(arguments.length===4){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3];o.constructor_.call(this,new V(c,g),new V(p,_))}}},{key:"midPoint",value:function(t,i){return new V((t.x+i.x)/2,(t.y+i.y)/2)}}])}(),lS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var o=arguments[1],t=arguments[2],i=arguments[3];arguments[0].getLineSegment(o,this._overlapSeg1),t.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Gt,this._overlapSeg2=new Gt}}])}(),zd=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(o,t){t.p0=this._pts[o],t.p1=this._pts[o+1]}},{key:"computeSelect",value:function(o,t,i,a){var c=this._pts[t],g=this._pts[i];if(i-t==1)return a.select(this,t),null;if(!o.intersects(c,g))return null;var p=Math.trunc((t+i)/2);t<p&&this.computeSelect(o,t,p,a),p<i&&this.computeSelect(o,p,i,a)}},{key:"getCoordinates",value:function(){for(var o=new Array(this._end-this._start+1).fill(null),t=0,i=this._start;i<=this._end;i++)o[t++]=this._pts[i];return o}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var o=arguments[0],t=arguments[1];this.computeOverlaps(this._start,this._end,o,o._start,o._end,t)}else if(arguments.length===6){var i=arguments[0],a=arguments[1],c=arguments[2],g=arguments[3],p=arguments[4],_=arguments[5];if(a-i==1&&p-g==1)return _.overlap(this,i,c,g),null;if(!this.overlaps(i,a,c,g,p))return null;var w=Math.trunc((i+a)/2),L=Math.trunc((g+p)/2);i<w&&(g<L&&this.computeOverlaps(i,w,c,g,L,_),L<p&&this.computeOverlaps(i,w,c,L,p,_)),w<a&&(g<L&&this.computeOverlaps(w,a,c,g,L,_),L<p&&this.computeOverlaps(w,a,c,L,p,_))}}},{key:"setId",value:function(o){this._id=o}},{key:"select",value:function(o,t){this.computeSelect(o,this._start,this._end,t)}},{key:"getEnvelope",value:function(){if(this._env===null){var o=this._pts[this._start],t=this._pts[this._end];this._env=new be(o,t)}return this._env}},{key:"overlaps",value:function(o,t,i,a,c){return be.intersects(this._pts[o],this._pts[t],i._pts[a],i._pts[c])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var o=arguments[0],t=arguments[1],i=arguments[2],a=arguments[3];this._pts=o,this._start=t,this._end=i,this._context=a}}])}(),cS=function(){function o(){u(this,o)}return h(o,null,[{key:"findChainEnd",value:function(t,i){for(var a=i;a<t.length-1&&t[a].equals2D(t[a+1]);)a++;if(a>=t.length-1)return t.length-1;for(var c=kt.quadrant(t[a],t[a+1]),g=i+1;g<t.length&&!(!t[g-1].equals2D(t[g])&&kt.quadrant(t[g-1],t[g])!==c);)g++;return g-1}},{key:"getChains",value:function(){if(arguments.length===1){var t=arguments[0];return o.getChains(t,null)}if(arguments.length===2){var i=arguments[0],a=arguments[1],c=new ve,g=0;do{var p=o.findChainEnd(i,g),_=new zd(i,g,p,a);c.add(_),g=p}while(g<i.length-1);return c}}}])}(),xl=function(){return h(function o(){u(this,o)},[{key:"computeNodes",value:function(o){}},{key:"getNodedSubstrings",value:function(){}}])}(),qd=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(o){this._segInt=o}},{key:"interfaces_",get:function(){return[xl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setSegmentIntersector(o)}}}}])}(),wl=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Ur.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(i){for(var a=cS.getChains(i.getCoordinates(),i).iterator();a.hasNext();){var c=a.next();c.setId(this._idCounter++),this._index.insert(c.getEnvelope(),c),this._monoChains.add(c)}}},{key:"computeNodes",value:function(i){this._nodedSegStrings=i;for(var a=i.iterator();a.hasNext();)this.add(a.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var i=new Yd(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var c=a.next(),g=this._index.query(c.getEnvelope()).iterator();g.hasNext();){var p=g.next();if(p.getId()>c.getId()&&(c.computeOverlaps(p,i),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new ve,this._index=new On,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var i=arguments[0];qd.constructor_.call(this,i)}}}}])}(qd),Yd=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"overlap",value:function(){if(arguments.length!==4)return M(t,"overlap",this,1).apply(this,arguments);var i=arguments[1],a=arguments[2],c=arguments[3],g=arguments[0].getContext(),p=a.getContext();this._si.processIntersections(g,i,p,c)}}],[{key:"constructor_",value:function(){this._si=null;var i=arguments[0];this._si=i}}])}(lS);wl.SegmentOverlapAction=Yd;var mn=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isDeletable",value:function(t,i,a,c){var g=this._inputLine[t],p=this._inputLine[i],_=this._inputLine[a];return!!this.isConcave(g,p,_)&&!!this.isShallow(g,p,_,c)&&this.isShallowSampled(g,p,t,a,c)}},{key:"deleteShallowConcavities",value:function(){for(var t=1,i=this.findNextNonDeletedIndex(t),a=this.findNextNonDeletedIndex(i),c=!1;a<this._inputLine.length;){var g=!1;this.isDeletable(t,i,a,this._distanceTol)&&(this._isDeleted[i]=o.DELETE,g=!0,c=!0),t=g?a:i,i=this.findNextNonDeletedIndex(t),a=this.findNextNonDeletedIndex(i)}return c}},{key:"isShallowConcavity",value:function(t,i,a,c){return Ee.index(t,i,a)===this._angleOrientation&&Zt.pointToSegment(i,t,a)<c}},{key:"isShallowSampled",value:function(t,i,a,c,g){var p=Math.trunc((c-a)/o.NUM_PTS_TO_CHECK);p<=0&&(p=1);for(var _=a;_<c;_+=p)if(!this.isShallow(t,i,this._inputLine[_],g))return!1;return!0}},{key:"isConcave",value:function(t,i,a){var c=Ee.index(t,i,a)===this._angleOrientation;return c}},{key:"simplify",value:function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Ee.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var i=!1;do i=this.deleteShallowConcavities();while(i);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(t){for(var i=t+1;i<this._inputLine.length&&this._isDeleted[i]===o.DELETE;)i++;return i}},{key:"isShallow",value:function(t,i,a,c){return Zt.pointToSegment(i,t,a)<c}},{key:"collapseLine",value:function(){for(var t=new te,i=0;i<this._inputLine.length;i++)this._isDeleted[i]!==o.DELETE&&t.add(this._inputLine[i]);return t.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ee.COUNTERCLOCKWISE;var t=arguments[0];this._inputLine=t}},{key:"simplify",value:function(t,i){return new o(t).simplify(i)}}])}();mn.INIT=0,mn.DELETE=1,mn.KEEP=1,mn.NUM_PTS_TO_CHECK=10;var Hd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getCoordinates",value:function(){return this._ptList.toArray(o.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(t){this._precisionModel=t}},{key:"addPt",value:function(t){var i=new V(t);if(this._precisionModel.makePrecise(i),this.isRedundant(i))return null;this._ptList.add(i)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(t,i){if(i)for(var a=0;a<t.length;a++)this.addPt(t[a]);else for(var c=t.length-1;c>=0;c--)this.addPt(t[c])}},{key:"isRedundant",value:function(t){if(this._ptList.size()<1)return!1;var i=this._ptList.get(this._ptList.size()-1);return t.distance(i)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Mi().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var t=new V(this._ptList.get(0)),i=this._ptList.get(this._ptList.size()-1);if(t.equals(i))return null;this._ptList.add(t)}},{key:"setMinimumVertexDistance",value:function(t){this._minimimVertexDistance=t}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ve}}])}();Hd.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Bt=function(){function o(){u(this,o)}return h(o,null,[{key:"toDegrees",value:function(t){return 180*t/Math.PI}},{key:"normalize",value:function(t){for(;t>Math.PI;)t-=o.PI_TIMES_2;for(;t<=-Math.PI;)t+=o.PI_TIMES_2;return t}},{key:"angle",value:function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}if(arguments.length===2){var i=arguments[0],a=arguments[1],c=a.x-i.x,g=a.y-i.y;return Math.atan2(g,c)}}},{key:"isAcute",value:function(t,i,a){var c=t.x-i.x,g=t.y-i.y;return c*(a.x-i.x)+g*(a.y-i.y)>0}},{key:"isObtuse",value:function(t,i,a){var c=t.x-i.x,g=t.y-i.y;return c*(a.x-i.x)+g*(a.y-i.y)<0}},{key:"interiorAngle",value:function(t,i,a){var c=o.angle(i,t),g=o.angle(i,a);return Math.abs(g-c)}},{key:"normalizePositive",value:function(t){if(t<0){for(;t<0;)t+=o.PI_TIMES_2;t>=o.PI_TIMES_2&&(t=0)}else{for(;t>=o.PI_TIMES_2;)t-=o.PI_TIMES_2;t<0&&(t=0)}return t}},{key:"angleBetween",value:function(t,i,a){var c=o.angle(i,t),g=o.angle(i,a);return o.diff(c,g)}},{key:"diff",value:function(t,i){var a=null;return(a=t<i?i-t:t-i)>Math.PI&&(a=2*Math.PI-a),a}},{key:"toRadians",value:function(t){return t*Math.PI/180}},{key:"getTurn",value:function(t,i){var a=Math.sin(i-t);return a>0?o.COUNTERCLOCKWISE:a<0?o.CLOCKWISE:o.NONE}},{key:"angleBetweenOriented",value:function(t,i,a){var c=o.angle(i,t),g=o.angle(i,a)-c;return g<=-Math.PI?g+o.PI_TIMES_2:g>Math.PI?g-o.PI_TIMES_2:g}}])}();Bt.PI_TIMES_2=2*Math.PI,Bt.PI_OVER_2=Math.PI/2,Bt.PI_OVER_4=Math.PI/4,Bt.COUNTERCLOCKWISE=Ee.COUNTERCLOCKWISE,Bt.CLOCKWISE=Ee.CLOCKWISE,Bt.NONE=Ee.COLLINEAR;var Cs=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"addNextSegment",value:function(t,i){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var a=Ee.index(this._s0,this._s1,this._s2),c=a===Ee.CLOCKWISE&&this._side===ne.LEFT||a===Ee.COUNTERCLOCKWISE&&this._side===ne.RIGHT;a===0?this.addCollinear(i):c?this.addOutsideTurn(a,i):this.addInsideTurn(a,i)}},{key:"addLineEndCap",value:function(t,i){var a=new Gt(t,i),c=new Gt;this.computeOffsetSegment(a,ne.LEFT,this._distance,c);var g=new Gt;this.computeOffsetSegment(a,ne.RIGHT,this._distance,g);var p=i.x-t.x,_=i.y-t.y,w=Math.atan2(_,p);switch(this._bufParams.getEndCapStyle()){case H.CAP_ROUND:this._segList.addPt(c.p1),this.addDirectedFillet(i,w+Math.PI/2,w-Math.PI/2,Ee.CLOCKWISE,this._distance),this._segList.addPt(g.p1);break;case H.CAP_FLAT:this._segList.addPt(c.p1),this._segList.addPt(g.p1);break;case H.CAP_SQUARE:var L=new V;L.x=Math.abs(this._distance)*Math.cos(w),L.y=Math.abs(this._distance)*Math.sin(w);var q=new V(c.p1.x+L.x,c.p1.y+L.y),Z=new V(g.p1.x+L.x,g.p1.y+L.y);this._segList.addPt(q),this._segList.addPt(Z)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(t,i,a,c){var g=ws.intersection(i.p0,i.p1,a.p0,a.p1);if(g!==null&&(c<=0?1:g.distance(t)/Math.abs(c))<=this._bufParams.getMitreLimit())return this._segList.addPt(g),null;this.addLimitedMitreJoin(i,a,c,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(t,i){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*o.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===H.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===H.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(i&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(t){this._segList.addPt(new V(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new V(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new V(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new V(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(t,i){this._segList.addPts(t,i)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(t,i,a,c,g){var p=i.x-t.x,_=i.y-t.y,w=Math.atan2(_,p),L=a.x-t.x,q=a.y-t.y,Z=Math.atan2(q,L);c===Ee.CLOCKWISE?w<=Z&&(w+=2*Math.PI):w>=Z&&(w-=2*Math.PI),this._segList.addPt(i),this.addDirectedFillet(t,w,Z,c,g),this._segList.addPt(a)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(t,i,a){this._s1=t,this._s2=i,this._side=a,this._seg1.setCoordinates(t,i),this.computeOffsetSegment(this._seg1,a,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(t,i,a,c){var g=this._seg0.p1,p=Bt.angle(g,this._seg0.p0),_=Bt.angleBetweenOriented(this._seg0.p0,g,this._seg1.p1)/2,w=Bt.normalize(p+_),L=Bt.normalize(w+Math.PI),q=c*a,Z=a-q*Math.abs(Math.sin(_)),Q=g.x+q*Math.cos(L),ce=g.y+q*Math.sin(L),ge=new V(Q,ce),ye=new Gt(g,ge),Ae=ye.pointAlongOffset(1,Z),Le=ye.pointAlongOffset(1,-Z);this._side===ne.LEFT?(this._segList.addPt(Ae),this._segList.addPt(Le)):(this._segList.addPt(Le),this._segList.addPt(Ae))}},{key:"addDirectedFillet",value:function(t,i,a,c,g){var p=c===Ee.CLOCKWISE?-1:1,_=Math.abs(i-a),w=Math.trunc(_/this._filletAngleQuantum+.5);if(w<1)return null;for(var L=_/w,q=new V,Z=0;Z<w;Z++){var Q=i+p*Z*L;q.x=t.x+g*Math.cos(Q),q.y=t.y+g*Math.sin(Q),this._segList.addPt(q)}}},{key:"computeOffsetSegment",value:function(t,i,a,c){var g=i===ne.LEFT?1:-1,p=t.p1.x-t.p0.x,_=t.p1.y-t.p0.y,w=Math.sqrt(p*p+_*_),L=g*a*p/w,q=g*a*_/w;c.p0.x=t.p0.x-q,c.p0.y=t.p0.y+L,c.p1.x=t.p1.x-q,c.p1.y=t.p1.y+L}},{key:"addInsideTurn",value:function(t,i){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*o.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var a=new V((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(a);var c=new V((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(c)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(t){var i=new V(t.x+this._distance,t.y);this._segList.addPt(i),this.addDirectedFillet(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(t,i){this._segList.addPt(t.p1),this._segList.addPt(i.p0)}},{key:"init",value:function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Hd,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*o.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===H.JOIN_BEVEL||this._bufParams.getJoinStyle()===H.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Ee.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Gt,this._seg1=new Gt,this._offset0=new Gt,this._offset1=new Gt,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],i=arguments[1],a=arguments[2];this._precisionModel=t,this._bufParams=i,this._li=new Br,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===H.JOIN_ROUND&&(this._closingSegLengthFactor=o.MAX_CLOSING_SEG_LEN_FACTOR),this.init(a)}}])}();Cs.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Cs.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Cs.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Cs.MAX_CLOSING_SEG_LEN_FACTOR=80;var hS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getOffsetCurve",value:function(t,i){if(this._distance=i,i===0)return null;var a=i<0,c=Math.abs(i),g=this.getSegGen(c);t.length<=1?this.computePointCurve(t[0],g):this.computeOffsetCurve(t,a,g);var p=g.getCoordinates();return a&&ue.reverse(p),p}},{key:"computeSingleSidedBufferCurve",value:function(t,i,a){var c=this.simplifyTolerance(this._distance);if(i){a.addSegments(t,!0);var g=mn.simplify(t,-c),p=g.length-1;a.initSideSegments(g[p],g[p-1],ne.LEFT),a.addFirstSegment();for(var _=p-2;_>=0;_--)a.addNextSegment(g[_],!0)}else{a.addSegments(t,!1);var w=mn.simplify(t,c),L=w.length-1;a.initSideSegments(w[0],w[1],ne.LEFT),a.addFirstSegment();for(var q=2;q<=L;q++)a.addNextSegment(w[q],!0)}a.addLastSegment(),a.closeRing()}},{key:"computeRingBufferCurve",value:function(t,i,a){var c=this.simplifyTolerance(this._distance);i===ne.RIGHT&&(c=-c);var g=mn.simplify(t,c),p=g.length-1;a.initSideSegments(g[p-1],g[0],i);for(var _=1;_<=p;_++){var w=_!==1;a.addNextSegment(g[_],w)}a.closeRing()}},{key:"computeLineBufferCurve",value:function(t,i){var a=this.simplifyTolerance(this._distance),c=mn.simplify(t,a),g=c.length-1;i.initSideSegments(c[0],c[1],ne.LEFT);for(var p=2;p<=g;p++)i.addNextSegment(c[p],!0);i.addLastSegment(),i.addLineEndCap(c[g-1],c[g]);var _=mn.simplify(t,-a),w=_.length-1;i.initSideSegments(_[w],_[w-1],ne.LEFT);for(var L=w-2;L>=0;L--)i.addNextSegment(_[L],!0);i.addLastSegment(),i.addLineEndCap(_[1],_[0]),i.closeRing()}},{key:"computePointCurve",value:function(t,i){switch(this._bufParams.getEndCapStyle()){case H.CAP_ROUND:i.createCircle(t);break;case H.CAP_SQUARE:i.createSquare(t)}}},{key:"getLineCurve",value:function(t,i){if(this._distance=i,this.isLineOffsetEmpty(i))return null;var a=Math.abs(i),c=this.getSegGen(a);if(t.length<=1)this.computePointCurve(t[0],c);else if(this._bufParams.isSingleSided()){var g=i<0;this.computeSingleSidedBufferCurve(t,g,c)}else this.computeLineBufferCurve(t,c);return c.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(t){return t*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(t,i,a){if(this._distance=a,t.length<=2)return this.getLineCurve(t,a);if(a===0)return o.copyCoordinates(t);var c=this.getSegGen(a);return this.computeRingBufferCurve(t,i,c),c.getCoordinates()}},{key:"computeOffsetCurve",value:function(t,i,a){var c=this.simplifyTolerance(this._distance);if(i){var g=mn.simplify(t,-c),p=g.length-1;a.initSideSegments(g[p],g[p-1],ne.LEFT),a.addFirstSegment();for(var _=p-2;_>=0;_--)a.addNextSegment(g[_],!0)}else{var w=mn.simplify(t,c),L=w.length-1;a.initSideSegments(w[0],w[1],ne.LEFT),a.addFirstSegment();for(var q=2;q<=L;q++)a.addNextSegment(w[q],!0)}a.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(t){return t===0||t<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(t){return new Cs(this._precisionModel,this._bufParams,t)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],i=arguments[1];this._precisionModel=t,this._bufParams=i}},{key:"copyCoordinates",value:function(t){for(var i=new Array(t.length).fill(null),a=0;a<i.length;a++)i[a]=new V(t[a]);return i}}])}(),Jd=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var o=arguments[0],t=new ve,i=this._subgraphs.iterator();i.hasNext();){var a=i.next(),c=a.getEnvelope();o.y<c.getMinY()||o.y>c.getMaxY()||this.findStabbedSegments(o,a.getDirectedEdges(),t)}return t}if(arguments.length===3){if(xe(arguments[2],Zn)&&arguments[0]instanceof V&&arguments[1]instanceof El){for(var g=arguments[0],p=arguments[1],_=arguments[2],w=p.getEdge().getCoordinates(),L=0;L<w.length-1;L++)if(this._seg.p0=w[L],this._seg.p1=w[L+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<g.x||this._seg.isHorizontal()||g.y<this._seg.p0.y||g.y>this._seg.p1.y||Ee.index(this._seg.p0,this._seg.p1,g)===Ee.RIGHT)){var q=p.getDepth(ne.LEFT);this._seg.p0.equals(w[L])||(q=p.getDepth(ne.RIGHT));var Z=new Vd(this._seg,q);_.add(Z)}}else if(xe(arguments[2],Zn)&&arguments[0]instanceof V&&xe(arguments[1],Zn))for(var Q=arguments[0],ce=arguments[2],ge=arguments[1].iterator();ge.hasNext();){var ye=ge.next();ye.isForward()&&this.findStabbedSegments(Q,ye,ce)}}}},{key:"getDepth",value:function(o){var t=this.findStabbedSegments(o);return t.size()===0?0:Li.min(t)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Gt;var o=arguments[0];this._subgraphs=o}}])}(),Vd=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(o){var t=o;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(t._upwardSeg);return i!==0||(i=-1*t._upwardSeg.orientationIndex(this._upwardSeg))!==0?i:this._upwardSeg.compareTo(t._upwardSeg)}},{key:"compareX",value:function(o,t){var i=o.p0.compareTo(t.p0);return i!==0?i:o.p1.compareTo(t.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var o=arguments[0],t=arguments[1];this._upwardSeg=new Gt(o),this._leftDepth=t}}])}();Jd.DepthSegment=Vd;var Xd=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,null,[{key:"constructor_",value:function(){J.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(J),kl=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getY",value:function(){var t=this.y/this.w;if(K.isNaN(t)||K.isInfinite(t))throw new Xd;return t}},{key:"getX",value:function(){var t=this.x/this.w;if(K.isNaN(t)||K.isInfinite(t))throw new Xd;return t}},{key:"getCoordinate",value:function(){var t=new V;return t.x=this.getX(),t.y=this.getY(),t}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],a=arguments[1];this.x=i,this.y=a,this.w=1}else if(arguments[0]instanceof o&&arguments[1]instanceof o){var c=arguments[0],g=arguments[1];this.x=c.y*g.w-g.y*c.w,this.y=g.x*c.w-c.x*g.w,this.w=c.x*g.y-g.x*c.y}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var p=arguments[0],_=arguments[1];this.x=p.y-_.y,this.y=_.x-p.x,this.w=p.x*_.y-_.x*p.y}}else if(arguments.length===3){var w=arguments[0],L=arguments[1],q=arguments[2];this.x=w,this.y=L,this.w=q}else if(arguments.length===4){var Z=arguments[0],Q=arguments[1],ce=arguments[2],ge=arguments[3],ye=Z.y-Q.y,Ae=Q.x-Z.x,Le=Z.x*Q.y-Q.x*Z.y,Be=ce.y-ge.y,ct=ge.x-ce.x,dt=ce.x*ge.y-ge.x*ce.y;this.x=Ae*dt-ct*Le,this.y=Be*Le-ye*dt,this.w=ye*ct-Be*Ae}}}])}(),fS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"area",value:function(){return o.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return o.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(t){if(t===null)throw new X("Supplied point is null.");return o.interpolateZ(t,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return o.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return o.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return o.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return o.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return o.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return o.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var t=arguments[0],i=arguments[1],a=arguments[2];this.p0=t,this.p1=i,this.p2=a}},{key:"area",value:function(t,i,a){return Math.abs(((a.x-t.x)*(i.y-t.y)-(i.x-t.x)*(a.y-t.y))/2)}},{key:"signedArea",value:function(t,i,a){return((a.x-t.x)*(i.y-t.y)-(i.x-t.x)*(a.y-t.y))/2}},{key:"det",value:function(t,i,a,c){return t*c-i*a}},{key:"interpolateZ",value:function(t,i,a,c){var g=i.x,p=i.y,_=a.x-g,w=c.x-g,L=a.y-p,q=c.y-p,Z=_*q-w*L,Q=t.x-g,ce=t.y-p,ge=(q*Q-w*ce)/Z,ye=(-L*Q+_*ce)/Z;return i.getZ()+ge*(a.getZ()-i.getZ())+ye*(c.getZ()-i.getZ())}},{key:"longestSideLength",value:function(t,i,a){var c=t.distance(i),g=i.distance(a),p=a.distance(t),_=c;return g>_&&(_=g),p>_&&(_=p),_}},{key:"circumcentreDD",value:function(t,i,a){var c=_e.valueOf(t.x).subtract(a.x),g=_e.valueOf(t.y).subtract(a.y),p=_e.valueOf(i.x).subtract(a.x),_=_e.valueOf(i.y).subtract(a.y),w=_e.determinant(c,g,p,_).multiply(2),L=c.sqr().add(g.sqr()),q=p.sqr().add(_.sqr()),Z=_e.determinant(g,L,_,q),Q=_e.determinant(c,L,p,q),ce=_e.valueOf(a.x).subtract(Z.divide(w)).doubleValue(),ge=_e.valueOf(a.y).add(Q.divide(w)).doubleValue();return new V(ce,ge)}},{key:"isAcute",value:function(t,i,a){return!!Bt.isAcute(t,i,a)&&!!Bt.isAcute(i,a,t)&&!!Bt.isAcute(a,t,i)}},{key:"circumcentre",value:function(t,i,a){var c=a.x,g=a.y,p=t.x-c,_=t.y-g,w=i.x-c,L=i.y-g,q=2*o.det(p,_,w,L),Z=o.det(_,p*p+_*_,L,w*w+L*L),Q=o.det(p,p*p+_*_,w,w*w+L*L);return new V(c-Z/q,g+Q/q)}},{key:"perpendicularBisector",value:function(t,i){var a=i.x-t.x,c=i.y-t.y,g=new kl(t.x+a/2,t.y+c/2,1),p=new kl(t.x-c+a/2,t.y+a+c/2,1);return new kl(g,p)}},{key:"angleBisector",value:function(t,i,a){var c=i.distance(t),g=c/(c+i.distance(a)),p=a.x-t.x,_=a.y-t.y;return new V(t.x+g*p,t.y+g*_)}},{key:"area3D",value:function(t,i,a){var c=i.x-t.x,g=i.y-t.y,p=i.getZ()-t.getZ(),_=a.x-t.x,w=a.y-t.y,L=a.getZ()-t.getZ(),q=g*L-p*w,Z=p*_-c*L,Q=c*w-g*_,ce=q*q+Z*Z+Q*Q,ge=Math.sqrt(ce)/2;return ge}},{key:"centroid",value:function(t,i,a){var c=(t.x+i.x+a.x)/3,g=(t.y+i.y+a.y)/3;return new V(c,g)}},{key:"inCentre",value:function(t,i,a){var c=i.distance(a),g=t.distance(a),p=t.distance(i),_=c+g+p,w=(c*t.x+g*i.x+p*a.x)/_,L=(c*t.y+g*i.y+p*a.y)/_;return new V(w,L)}}])}(),gS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(o,t,i,a,c){if(t===0&&o.length<_r.MINIMUM_VALID_SIZE)return null;var g=a,p=c;o.length>=_r.MINIMUM_VALID_SIZE&&Ee.isCCW(o)&&(g=c,p=a,i=ne.opposite(i));var _=this._curveBuilder.getRingCurve(o,i,t);this.addCurve(_,g,p)}},{key:"addRingBothSides",value:function(o,t){this.addRingSide(o,t,ne.LEFT,C.EXTERIOR,C.INTERIOR),this.addRingSide(o,t,ne.RIGHT,C.INTERIOR,C.EXTERIOR)}},{key:"addPoint",value:function(o){if(this._distance<=0)return null;var t=o.getCoordinates(),i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,C.EXTERIOR,C.INTERIOR)}},{key:"addPolygon",value:function(o){var t=this._distance,i=ne.LEFT;this._distance<0&&(t=-this._distance,i=ne.RIGHT);var a=o.getExteriorRing(),c=ue.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&c.length<3)return null;this.addRingSide(c,t,i,C.EXTERIOR,C.INTERIOR);for(var g=0;g<o.getNumInteriorRing();g++){var p=o.getInteriorRingN(g),_=ue.removeRepeatedPoints(p.getCoordinates());this._distance>0&&this.isErodedCompletely(p,-this._distance)||this.addRingSide(_,t,ne.opposite(i),C.INTERIOR,C.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(o,t){var i=new fS(o[0],o[1],o[2]),a=i.inCentre();return Zt.pointToSegment(a,i.p0,i.p1)<Math.abs(t)}},{key:"addLineString",value:function(o){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var t=ue.removeRepeatedPoints(o.getCoordinates());if(ue.isRing(t)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(t,this._distance);else{var i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,C.EXTERIOR,C.INTERIOR)}}},{key:"addCurve",value:function(o,t,i){if(o===null||o.length<2)return null;var a=new Ur(o,new Kt(0,C.BOUNDARY,t,i));this._curveList.add(a)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(o){if(o.isEmpty())return null;if(o instanceof Gr)this.addPolygon(o);else if(o instanceof yr)this.addLineString(o);else if(o instanceof Ss)this.addPoint(o);else if(o instanceof ki)this.addCollection(o);else if(o instanceof pl)this.addCollection(o);else if(o instanceof $n)this.addCollection(o);else{if(!(o instanceof gt))throw new Ie(o.getGeometryType());this.addCollection(o)}}},{key:"isErodedCompletely",value:function(o,t){var i=o.getCoordinates();if(i.length<4)return t<0;if(i.length===4)return this.isTriangleErodedCompletely(i,t);var a=o.getEnvelopeInternal(),c=Math.min(a.getHeight(),a.getWidth());return t<0&&2*Math.abs(t)>c}},{key:"addCollection",value:function(o){for(var t=0;t<o.getNumGeometries();t++){var i=o.getGeometryN(t);this.add(i)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ve;var o=arguments[0],t=arguments[1],i=arguments[2];this._inputGeom=o,this._distance=t,this._curveBuilder=i}}])}(),dS=function(){return h(function o(){u(this,o)},[{key:"locate",value:function(o){}}])}(),pS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,o.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Oe;var t=this._parent.getGeometryN(this._index++);return t instanceof gt?(this._subcollectionIterator=new o(t),this._subcollectionIterator.next()):t}},{key:"remove",value:function(){throw new Ie(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[iS]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}},{key:"isAtomic",value:function(t){return!(t instanceof gt)}}])}(),mS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"locate",value:function(t){return o.locate(t,this._geom)}},{key:"interfaces_",get:function(){return[dS]}}],[{key:"constructor_",value:function(){this._geom=null;var t=arguments[0];this._geom=t}},{key:"locatePointInPolygon",value:function(t,i){if(i.isEmpty())return C.EXTERIOR;var a=i.getExteriorRing(),c=o.locatePointInRing(t,a);if(c!==C.INTERIOR)return c;for(var g=0;g<i.getNumInteriorRing();g++){var p=i.getInteriorRingN(g),_=o.locatePointInRing(t,p);if(_===C.BOUNDARY)return C.BOUNDARY;if(_===C.INTERIOR)return C.EXTERIOR}return C.INTERIOR}},{key:"locatePointInRing",value:function(t,i){return i.getEnvelopeInternal().intersects(t)?yl.locateInRing(t,i.getCoordinates()):C.EXTERIOR}},{key:"containsPointInPolygon",value:function(t,i){return C.EXTERIOR!==o.locatePointInPolygon(t,i)}},{key:"locateInGeometry",value:function(t,i){if(i instanceof Gr)return o.locatePointInPolygon(t,i);if(i instanceof gt)for(var a=new pS(i);a.hasNext();){var c=a.next();if(c!==i){var g=o.locateInGeometry(t,c);if(g!==C.EXTERIOR)return g}}return C.EXTERIOR}},{key:"isContained",value:function(t,i){return C.EXTERIOR!==o.locate(t,i)}},{key:"locate",value:function(t,i){return i.isEmpty()?C.EXTERIOR:i.getEnvelopeInternal().intersects(t)?o.locateInGeometry(t,i):C.EXTERIOR}}])}(),vS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(o){this.getEdges();var t=this._edgeList.indexOf(o),i=t-1;return t===0&&(i=this._edgeList.size()-1),this._edgeList.get(i)}},{key:"propagateSideLabels",value:function(o){for(var t=C.NONE,i=this.iterator();i.hasNext();){var a=i.next().getLabel();a.isArea(o)&&a.getLocation(o,ne.LEFT)!==C.NONE&&(t=a.getLocation(o,ne.LEFT))}if(t===C.NONE)return null;for(var c=t,g=this.iterator();g.hasNext();){var p=g.next(),_=p.getLabel();if(_.getLocation(o,ne.ON)===C.NONE&&_.setLocation(o,ne.ON,c),_.isArea(o)){var w=_.getLocation(o,ne.LEFT),L=_.getLocation(o,ne.RIGHT);if(L!==C.NONE){if(L!==c)throw new It("side location conflict",p.getCoordinate());w===C.NONE&&oe.shouldNeverReachHere("found single null side (at "+p.getCoordinate()+")"),c=w}else oe.isTrue(_.getLocation(o,ne.LEFT)===C.NONE,"found single null side"),_.setLocation(o,ne.RIGHT,c),_.setLocation(o,ne.LEFT,c)}}}},{key:"getCoordinate",value:function(){var o=this.iterator();return o.hasNext()?o.next().getCoordinate():null}},{key:"print",value:function(o){lt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(o)}},{key:"isAreaLabelsConsistent",value:function(o){return this.computeEdgeEndLabels(o.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(o){var t=this.getEdges();if(t.size()<=0)return!0;var i=t.size()-1,a=t.get(i).getLabel().getLocation(o,ne.LEFT);oe.isTrue(a!==C.NONE,"Found unlabelled area edge");for(var c=a,g=this.iterator();g.hasNext();){var p=g.next().getLabel();oe.isTrue(p.isArea(o),"Found non-area edge");var _=p.getLocation(o,ne.LEFT),w=p.getLocation(o,ne.RIGHT);if(_===w||w!==c)return!1;c=_}return!0}},{key:"findIndex",value:function(o){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===o)return t;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new ve(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(o,t,i){return this._ptInAreaLocation[o]===C.NONE&&(this._ptInAreaLocation[o]=mS.locate(t,i[o].getGeometry())),this._ptInAreaLocation[o]}},{key:"toString",value:function(){var o=new Wt;o.append("EdgeEndStar:   "+this.getCoordinate()),o.append(`
`);for(var t=this.iterator();t.hasNext();){var i=t.next();o.append(i),o.append(`
`)}return o.toString()}},{key:"computeEdgeEndLabels",value:function(o){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(o)}},{key:"computeLabelling",value:function(o){this.computeEdgeEndLabels(o[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],i=this.iterator();i.hasNext();)for(var a=i.next().getLabel(),c=0;c<2;c++)a.isLine(c)&&a.getLocation(c)===C.BOUNDARY&&(t[c]=!0);for(var g=this.iterator();g.hasNext();)for(var p=g.next(),_=p.getLabel(),w=0;w<2;w++)if(_.isAnyNull(w)){var L=C.NONE;if(t[w])L=C.EXTERIOR;else{var q=p.getCoordinate();L=this.getLocation(w,q,o)}_.setAllLocationsIfNull(w,L)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(o,t){this._edgeMap.put(o,t),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new As,this._edgeList=null,this._ptInAreaLocation=[C.NONE,C.NONE]}}])}(),yS=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var i=null,a=null,c=this._SCANNING_FOR_INCOMING,g=0;g<this._resultAreaEdgeList.size();g++){var p=this._resultAreaEdgeList.get(g),_=p.getSym();if(p.getLabel().isArea())switch(i===null&&p.isInResult()&&(i=p),c){case this._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;a=_,c=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!p.isInResult())continue;a.setNext(p),c=this._SCANNING_FOR_INCOMING}}if(c===this._LINKING_TO_OUTGOING){if(i===null)throw new It("no outgoing dirEdge found",this.getCoordinate());oe.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),a.setNext(i)}}},{key:"insert",value:function(i){var a=i;this.insertEdgeEnd(a,a)}},{key:"getRightmostEdge",value:function(){var i=this.getEdges(),a=i.size();if(a<1)return null;var c=i.get(0);if(a===1)return c;var g=i.get(a-1),p=c.getQuadrant(),_=g.getQuadrant();return kt.isNorthern(p)&&kt.isNorthern(_)?c:kt.isNorthern(p)||kt.isNorthern(_)?c.getDy()!==0?c:g.getDy()!==0?g:(oe.shouldNeverReachHere("found two horizontal edges incident on node"),null):g}},{key:"print",value:function(i){lt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var a=this.iterator();a.hasNext();){var c=a.next();i.print("out "),c.print(i),i.println(),i.print("in "),c.getSym().print(i),i.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ve;for(var i=this.iterator();i.hasNext();){var a=i.next();(a.isInResult()||a.getSym().isInResult())&&this._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(i){for(var a=this.iterator();a.hasNext();){var c=a.next().getLabel();c.setAllLocationsIfNull(0,i.getLocation(0)),c.setAllLocationsIfNull(1,i.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var i=null,a=null,c=this._edgeList.size()-1;c>=0;c--){var g=this._edgeList.get(c),p=g.getSym();a===null&&(a=p),i!==null&&p.setNext(i),i=g}a.setNext(i)}},{key:"computeDepths",value:function(){if(arguments.length===1){var i=arguments[0],a=this.findIndex(i),c=i.getDepth(ne.LEFT),g=i.getDepth(ne.RIGHT),p=this.computeDepths(a+1,this._edgeList.size(),c);if(this.computeDepths(0,a,p)!==g)throw new It("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var _=arguments[1],w=arguments[2],L=arguments[0];L<_;L++){var q=this._edgeList.get(L);q.setEdgeDepths(ne.RIGHT,w),w=q.getDepth(ne.LEFT)}return w}}},{key:"mergeSymLabels",value:function(){for(var i=this.iterator();i.hasNext();){var a=i.next();a.getLabel().merge(a.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(i){for(var a=null,c=null,g=this._SCANNING_FOR_INCOMING,p=this._resultAreaEdgeList.size()-1;p>=0;p--){var _=this._resultAreaEdgeList.get(p),w=_.getSym();switch(a===null&&_.getEdgeRing()===i&&(a=_),g){case this._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==i)continue;c=w,g=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==i)continue;c.setNextMin(_),g=this._SCANNING_FOR_INCOMING}}g===this._LINKING_TO_OUTGOING&&(oe.isTrue(a!==null,"found null for first outgoing dirEdge"),oe.isTrue(a.getEdgeRing()===i,"unable to link last incoming dirEdge"),c.setNextMin(a))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var i=0,a=this.iterator();a.hasNext();)a.next().isInResult()&&i++;return i}if(arguments.length===1){for(var c=arguments[0],g=0,p=this.iterator();p.hasNext();)p.next().getEdgeRing()===c&&g++;return g}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var i=C.NONE,a=this.iterator();a.hasNext();){var c=a.next(),g=c.getSym();if(!c.isLineEdge()){if(c.isInResult()){i=C.INTERIOR;break}if(g.isInResult()){i=C.EXTERIOR;break}}}if(i===C.NONE)return null;for(var p=i,_=this.iterator();_.hasNext();){var w=_.next(),L=w.getSym();w.isLineEdge()?w.getEdge().setCovered(p===C.INTERIOR):(w.isInResult()&&(p=C.EXTERIOR),L.isInResult()&&(p=C.INTERIOR))}}},{key:"computeLabelling",value:function(i){M(t,"computeLabelling",this,1).call(this,i),this._label=new Kt(C.NONE);for(var a=this.iterator();a.hasNext();)for(var c=a.next().getEdge().getLabel(),g=0;g<2;g++){var p=c.getLocation(g);p!==C.INTERIOR&&p!==C.BOUNDARY||this._label.setLocation(g,C.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(vS),_S=function(o){function t(){return u(this,t),s(this,t)}return y(t,o),h(t,[{key:"createNode",value:function(i){return new yo(i,new yS)}}])}(Dd),Wd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"compareTo",value:function(t){var i=t;return o.compareOriented(this._pts,this._orientation,i._pts,i._orientation)}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=o.orientation(t)}},{key:"orientation",value:function(t){return ue.increasingDirection(t)===1}},{key:"compareOriented",value:function(t,i,a,c){for(var g=i?1:-1,p=c?1:-1,_=i?t.length:-1,w=c?a.length:-1,L=i?0:t.length-1,q=c?0:a.length-1;;){var Z=t[L].compareTo(a[q]);if(Z!==0)return Z;var Q=(L+=g)===_,ce=(q+=p)===w;if(Q&&!ce)return-1;if(!Q&&ce)return 1;if(Q&&ce)return 0}}}])}(),ES=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"print",value:function(o){o.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var i=this._edges.get(t);t>0&&o.print(","),o.print("(");for(var a=i.getCoordinates(),c=0;c<a.length;c++)c>0&&o.print(","),o.print(a[c].x+" "+a[c].y);o.println(")")}o.print(")  ")}},{key:"addAll",value:function(o){for(var t=o.iterator();t.hasNext();)this.add(t.next())}},{key:"findEdgeIndex",value:function(o){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(o))return t;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(o){return this._edges.get(o)}},{key:"findEqualEdge",value:function(o){var t=new Wd(o.getCoordinates());return this._ocaMap.get(t)}},{key:"add",value:function(o){this._edges.add(o);var t=new Wd(o.getCoordinates());this._ocaMap.put(t,o)}}],[{key:"constructor_",value:function(){this._edges=new ve,this._ocaMap=new As}}])}(),Zd=function(){return h(function o(){u(this,o)},[{key:"processIntersections",value:function(o,t,i,a){}},{key:"isDone",value:function(){}}])}(),xS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isTrivialIntersection",value:function(t,i,a,c){if(t===a&&this._li.getIntersectionNum()===1){if(o.isAdjacentSegments(i,c))return!0;if(t.isClosed()){var g=t.size()-1;if(i===0&&c===g||c===0&&i===g)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(t,i,a,c){if(t===a&&i===c)return null;this.numTests++;var g=t.getCoordinates()[i],p=t.getCoordinates()[i+1],_=a.getCoordinates()[c],w=a.getCoordinates()[c+1];this._li.computeIntersection(g,p,_,w),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,i,a,c)||(this._hasIntersection=!0,t.addIntersections(this._li,i,0),a.addIntersections(this._li,c,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zd]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t}},{key:"isAdjacentSegments",value:function(t,i){return Math.abs(t-i)===1}}])}(),wS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(o){o.print(this.coord),o.print(" seg # = "+this.segmentIndex),o.println(" dist = "+this.dist)}},{key:"compareTo",value:function(o){var t=o;return this.compare(t.segmentIndex,t.dist)}},{key:"isEndPoint",value:function(o){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===o}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(o,t){return this.segmentIndex<o?-1:this.segmentIndex>o?1:this.dist<t?-1:this.dist>t?1:0}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var o=arguments[0],t=arguments[1],i=arguments[2];this.coord=new V(o),this.segmentIndex=t,this.dist=i}}])}(),kS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"print",value:function(o){o.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(o)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(o){this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var a=t.next(),c=this.createSplitEdge(i,a);o.add(c),i=a}}},{key:"addEndpoints",value:function(){var o=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[o],o,0)}},{key:"createSplitEdge",value:function(o,t){var i=t.segmentIndex-o.segmentIndex+2,a=this.edge.pts[t.segmentIndex],c=t.dist>0||!t.coord.equals2D(a);c||i--;var g=new Array(i).fill(null),p=0;g[p++]=new V(o.coord);for(var _=o.segmentIndex+1;_<=t.segmentIndex;_++)g[p++]=this.edge.pts[_];return c&&(g[p]=t.coord),new $d(g,new Kt(this.edge._label))}},{key:"add",value:function(o,t,i){var a=new wS(o,t,i),c=this._nodeMap.get(a);return c!==null?c:(this._nodeMap.put(a,a),a)}},{key:"isIntersection",value:function(o){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(o))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new As,this.edge=null;var o=arguments[0];this.edge=o}}])}(),SS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])||o.isTrue(this._matrix[C.INTERIOR][C.BOUNDARY])||o.isTrue(this._matrix[C.BOUNDARY][C.INTERIOR])||o.isTrue(this._matrix[C.BOUNDARY][C.BOUNDARY]))&&this._matrix[C.EXTERIOR][C.INTERIOR]===ae.FALSE&&this._matrix[C.EXTERIOR][C.BOUNDARY]===ae.FALSE}},{key:"isCoveredBy",value:function(){return(o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])||o.isTrue(this._matrix[C.INTERIOR][C.BOUNDARY])||o.isTrue(this._matrix[C.BOUNDARY][C.INTERIOR])||o.isTrue(this._matrix[C.BOUNDARY][C.BOUNDARY]))&&this._matrix[C.INTERIOR][C.EXTERIOR]===ae.FALSE&&this._matrix[C.BOUNDARY][C.EXTERIOR]===ae.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var t=arguments[0],i=0;i<t.length;i++){var a=Math.trunc(i/3),c=i%3;this._matrix[a][c]=ae.toDimensionValue(t.charAt(i))}else if(arguments.length===3){var g=arguments[0],p=arguments[1],_=arguments[2];this._matrix[g][p]=_}}},{key:"isContains",value:function(){return o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&this._matrix[C.EXTERIOR][C.INTERIOR]===ae.FALSE&&this._matrix[C.EXTERIOR][C.BOUNDARY]===ae.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var t=arguments[0],i=0;i<t.length;i++){var a=Math.trunc(i/3),c=i%3;this.setAtLeast(a,c,ae.toDimensionValue(t.charAt(i)))}else if(arguments.length===3){var g=arguments[0],p=arguments[1],_=arguments[2];this._matrix[g][p]<_&&(this._matrix[g][p]=_)}}},{key:"setAtLeastIfValid",value:function(t,i,a){t>=0&&i>=0&&this.setAtLeast(t,i,a)}},{key:"isWithin",value:function(){return o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&this._matrix[C.INTERIOR][C.EXTERIOR]===ae.FALSE&&this._matrix[C.BOUNDARY][C.EXTERIOR]===ae.FALSE}},{key:"isTouches",value:function(t,i){return t>i?this.isTouches(i,t):(t===ae.A&&i===ae.A||t===ae.L&&i===ae.L||t===ae.L&&i===ae.A||t===ae.P&&i===ae.A||t===ae.P&&i===ae.L)&&this._matrix[C.INTERIOR][C.INTERIOR]===ae.FALSE&&(o.isTrue(this._matrix[C.INTERIOR][C.BOUNDARY])||o.isTrue(this._matrix[C.BOUNDARY][C.INTERIOR])||o.isTrue(this._matrix[C.BOUNDARY][C.BOUNDARY]))}},{key:"isOverlaps",value:function(t,i){return t===ae.P&&i===ae.P||t===ae.A&&i===ae.A?o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&o.isTrue(this._matrix[C.INTERIOR][C.EXTERIOR])&&o.isTrue(this._matrix[C.EXTERIOR][C.INTERIOR]):t===ae.L&&i===ae.L&&this._matrix[C.INTERIOR][C.INTERIOR]===1&&o.isTrue(this._matrix[C.INTERIOR][C.EXTERIOR])&&o.isTrue(this._matrix[C.EXTERIOR][C.INTERIOR])}},{key:"isEquals",value:function(t,i){return t===i&&o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&this._matrix[C.INTERIOR][C.EXTERIOR]===ae.FALSE&&this._matrix[C.BOUNDARY][C.EXTERIOR]===ae.FALSE&&this._matrix[C.EXTERIOR][C.INTERIOR]===ae.FALSE&&this._matrix[C.EXTERIOR][C.BOUNDARY]===ae.FALSE}},{key:"toString",value:function(){for(var t=new Ze("123456789"),i=0;i<3;i++)for(var a=0;a<3;a++)t.setCharAt(3*i+a,ae.toDimensionSymbol(this._matrix[i][a]));return t.toString()}},{key:"setAll",value:function(t){for(var i=0;i<3;i++)for(var a=0;a<3;a++)this._matrix[i][a]=t}},{key:"get",value:function(t,i){return this._matrix[t][i]}},{key:"transpose",value:function(){var t=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=t,t=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=t,t=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=t,this}},{key:"matches",value:function(t){if(t.length!==9)throw new X("Should be length 9: "+t);for(var i=0;i<3;i++)for(var a=0;a<3;a++)if(!o.matches(this._matrix[i][a],t.charAt(3*i+a)))return!1;return!0}},{key:"add",value:function(t){for(var i=0;i<3;i++)for(var a=0;a<3;a++)this.setAtLeast(i,a,t.get(i,a))}},{key:"isDisjoint",value:function(){return this._matrix[C.INTERIOR][C.INTERIOR]===ae.FALSE&&this._matrix[C.INTERIOR][C.BOUNDARY]===ae.FALSE&&this._matrix[C.BOUNDARY][C.INTERIOR]===ae.FALSE&&this._matrix[C.BOUNDARY][C.BOUNDARY]===ae.FALSE}},{key:"isCrosses",value:function(t,i){return t===ae.P&&i===ae.L||t===ae.P&&i===ae.A||t===ae.L&&i===ae.A?o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&o.isTrue(this._matrix[C.INTERIOR][C.EXTERIOR]):t===ae.L&&i===ae.P||t===ae.A&&i===ae.P||t===ae.A&&i===ae.L?o.isTrue(this._matrix[C.INTERIOR][C.INTERIOR])&&o.isTrue(this._matrix[C.EXTERIOR][C.INTERIOR]):t===ae.L&&i===ae.L&&this._matrix[C.INTERIOR][C.INTERIOR]===0}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(ae.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var t=arguments[0];o.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof o){var i=arguments[0];o.constructor_.call(this),this._matrix[C.INTERIOR][C.INTERIOR]=i._matrix[C.INTERIOR][C.INTERIOR],this._matrix[C.INTERIOR][C.BOUNDARY]=i._matrix[C.INTERIOR][C.BOUNDARY],this._matrix[C.INTERIOR][C.EXTERIOR]=i._matrix[C.INTERIOR][C.EXTERIOR],this._matrix[C.BOUNDARY][C.INTERIOR]=i._matrix[C.BOUNDARY][C.INTERIOR],this._matrix[C.BOUNDARY][C.BOUNDARY]=i._matrix[C.BOUNDARY][C.BOUNDARY],this._matrix[C.BOUNDARY][C.EXTERIOR]=i._matrix[C.BOUNDARY][C.EXTERIOR],this._matrix[C.EXTERIOR][C.INTERIOR]=i._matrix[C.EXTERIOR][C.INTERIOR],this._matrix[C.EXTERIOR][C.BOUNDARY]=i._matrix[C.EXTERIOR][C.BOUNDARY],this._matrix[C.EXTERIOR][C.EXTERIOR]=i._matrix[C.EXTERIOR][C.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var t=arguments[0],i=arguments[1];return i===ae.SYM_DONTCARE||i===ae.SYM_TRUE&&(t>=0||t===ae.TRUE)||i===ae.SYM_FALSE&&t===ae.FALSE||i===ae.SYM_P&&t===ae.P||i===ae.SYM_L&&t===ae.L||i===ae.SYM_A&&t===ae.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var a=arguments[1];return new o(arguments[0]).matches(a)}}},{key:"isTrue",value:function(t){return t>=0||t===ae.TRUE}}])}(),MS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(t){return t===null||t.length===0?null:(this.ensureCapacity(this._size+t.length),lt.arraycopy(t,0,this._data,this._size,t.length),void(this._size+=t.length))}},{key:"ensureCapacity",value:function(t){if(t<=this._data.length)return null;var i=Math.max(t,2*this._data.length);this._data=jt.copyOf(this._data,i)}},{key:"toArray",value:function(){var t=new Array(this._size).fill(null);return lt.arraycopy(this._data,0,t,0,this._size),t}},{key:"add",value:function(t){this.ensureCapacity(this._size+1),this._data[this._size]=t,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)o.constructor_.call(this,10);else if(arguments.length===1){var t=arguments[0];this._data=new Array(t).fill(null)}}}])}(),IS=function(){function o(){u(this,o)}return h(o,[{key:"getChainStartIndices",value:function(t){var i=0,a=new MS(Math.trunc(t.length/2));a.add(i);do{var c=this.findChainEnd(t,i);a.add(c),i=c}while(i<t.length-1);return a.toArray()}},{key:"findChainEnd",value:function(t,i){for(var a=kt.quadrant(t[i],t[i+1]),c=i+1;c<t.length&&kt.quadrant(t[c-1],t[c])===a;)c++;return c-1}},{key:"OLDgetChainStartIndices",value:function(t){var i=0,a=new ve;a.add(i);do{var c=this.findChainEnd(t,i);a.add(c),i=c}while(i<t.length-1);return o.toIntArray(a)}}],[{key:"toIntArray",value:function(t){for(var i=new Array(t.size()).fill(null),a=0;a<i.length;a++)i[a]=t.get(a).intValue();return i}}])}(),LS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(o){var t=this.pts[this.startIndex[o]].x,i=this.pts[this.startIndex[o+1]].x;return t>i?t:i}},{key:"getMinX",value:function(o){var t=this.pts[this.startIndex[o]].x,i=this.pts[this.startIndex[o+1]].x;return t<i?t:i}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var o=arguments[0],t=arguments[1],i=arguments[2],a=arguments[3];this.computeIntersectsForChain(this.startIndex[o],this.startIndex[o+1],t,t.startIndex[i],t.startIndex[i+1],a)}else if(arguments.length===6){var c=arguments[0],g=arguments[1],p=arguments[2],_=arguments[3],w=arguments[4],L=arguments[5];if(g-c==1&&w-_==1)return L.addIntersections(this.e,c,p.e,_),null;if(!this.overlaps(c,g,p,_,w))return null;var q=Math.trunc((c+g)/2),Z=Math.trunc((_+w)/2);c<q&&(_<Z&&this.computeIntersectsForChain(c,q,p,_,Z,L),Z<w&&this.computeIntersectsForChain(c,q,p,Z,w,L)),q<g&&(_<Z&&this.computeIntersectsForChain(q,g,p,_,Z,L),Z<w&&this.computeIntersectsForChain(q,g,p,Z,w,L))}}},{key:"overlaps",value:function(o,t,i,a,c){return be.intersects(this.pts[o],this.pts[t],i.pts[a],i.pts[c])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(o,t){for(var i=0;i<this.startIndex.length-1;i++)for(var a=0;a<o.startIndex.length-1;a++)this.computeIntersectsForChain(i,o,a,t)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var o=arguments[0];this.e=o,this.pts=o.getCoordinates();var t=new IS;this.startIndex=t.getChainStartIndices(this.pts)}}])}(),jd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"getDepth",value:function(t,i){return this._depth[t][i]}},{key:"setDepth",value:function(t,i,a){this._depth[t][i]=a}},{key:"isNull",value:function(){if(arguments.length===0){for(var t=0;t<2;t++)for(var i=0;i<3;i++)if(this._depth[t][i]!==o.NULL_VALUE)return!1;return!0}if(arguments.length===1){var a=arguments[0];return this._depth[a][1]===o.NULL_VALUE}if(arguments.length===2){var c=arguments[0],g=arguments[1];return this._depth[c][g]===o.NULL_VALUE}}},{key:"normalize",value:function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var i=this._depth[t][1];this._depth[t][2]<i&&(i=this._depth[t][2]),i<0&&(i=0);for(var a=1;a<3;a++){var c=0;this._depth[t][a]>i&&(c=1),this._depth[t][a]=c}}}},{key:"getDelta",value:function(t){return this._depth[t][ne.RIGHT]-this._depth[t][ne.LEFT]}},{key:"getLocation",value:function(t,i){return this._depth[t][i]<=0?C.EXTERIOR:C.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var t=arguments[0],i=0;i<2;i++)for(var a=1;a<3;a++){var c=t.getLocation(i,a);c!==C.EXTERIOR&&c!==C.INTERIOR||(this.isNull(i,a)?this._depth[i][a]=o.depthAtLocation(c):this._depth[i][a]+=o.depthAtLocation(c))}else if(arguments.length===3){var g=arguments[0],p=arguments[1];arguments[2]===C.INTERIOR&&this._depth[g][p]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var i=0;i<3;i++)this._depth[t][i]=o.NULL_VALUE}},{key:"depthAtLocation",value:function(t){return t===C.EXTERIOR?0:t===C.INTERIOR?1:o.NULL_VALUE}}])}();jd.NULL_VALUE=-1;var $d=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var i=new Array(2).fill(null);return i[0]=this.pts[0],i[1]=this.pts[1],new t(i,Kt.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(i){this._isIsolated=i}},{key:"setName",value:function(i){this._name=i}},{key:"equals",value:function(i){if(!(i instanceof t))return!1;var a=i;if(this.pts.length!==a.pts.length)return!1;for(var c=!0,g=!0,p=this.pts.length,_=0;_<this.pts.length;_++)if(this.pts[_].equals2D(a.pts[_])||(c=!1),this.pts[_].equals2D(a.pts[--p])||(g=!1),!c&&!g)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var i=arguments[0];return this.pts[i]}}},{key:"print",value:function(i){i.print("edge "+this._name+": "),i.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&i.print(","),i.print(this.pts[a].x+" "+this.pts[a].y);i.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(i){t.updateIM(this._label,i)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(i){i.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)i.print(this.pts[a]+" ");i.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new LS(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new be;for(var i=0;i<this.pts.length;i++)this._env.expandToInclude(this.pts[i])}return this._env}},{key:"addIntersection",value:function(i,a,c,g){var p=new V(i.getIntersection(g)),_=a,w=i.getEdgeDistance(c,g),L=_+1;if(L<this.pts.length){var q=this.pts[L];p.equals2D(q)&&(_=L,w=0)}this.eiList.add(p,_,w)}},{key:"toString",value:function(){var i=new Ze;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&i.append(","),i.append(this.pts[a].x+" "+this.pts[a].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()}},{key:"isPointwiseEqual",value:function(i){if(this.pts.length!==i.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!this.pts[a].equals2D(i.pts[a]))return!1;return!0}},{key:"setDepthDelta",value:function(i){this._depthDelta=i}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(i,a,c){for(var g=0;g<i.getIntersectionNum();g++)this.addIntersection(i,a,c,g)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new kS(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new jd,this._depthDelta=0,arguments.length===1){var i=arguments[0];t.constructor_.call(this,i,null)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.pts=a,this._label=c}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof SS&&arguments[0]instanceof Kt))return M(t,"updateIM",this).apply(this,arguments);var i=arguments[0],a=arguments[1];a.setAtLeastIfValid(i.getLocation(0,ne.ON),i.getLocation(1,ne.ON),1),i.isArea()&&(a.setAtLeastIfValid(i.getLocation(0,ne.LEFT),i.getLocation(1,ne.LEFT),2),a.setAtLeastIfValid(i.getLocation(0,ne.RIGHT),i.getLocation(1,ne.RIGHT),2))}}])}(Td),Kd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"setWorkingPrecisionModel",value:function(t){this._workingPrecisionModel=t}},{key:"insertUniqueEdge",value:function(t){var i=this._edgeList.findEqualEdge(t);if(i!==null){var a=i.getLabel(),c=t.getLabel();i.isPointwiseEqual(t)||(c=new Kt(t.getLabel())).flip(),a.merge(c);var g=o.depthDelta(c),p=i.getDepthDelta()+g;i.setDepthDelta(p)}else this._edgeList.add(t),t.setDepthDelta(o.depthDelta(t.getLabel()))}},{key:"buildSubgraphs",value:function(t,i){for(var a=new ve,c=t.iterator();c.hasNext();){var g=c.next(),p=g.getRightmostCoordinate(),_=new Jd(a).getDepth(p);g.computeDepth(_),g.findResultEdges(),a.add(g),i.add(g.getDirectedEdges(),g.getNodes())}}},{key:"createSubgraphs",value:function(t){for(var i=new ve,a=t.getNodes().iterator();a.hasNext();){var c=a.next();if(!c.isVisited()){var g=new xs;g.create(c),i.add(g)}}return Li.sort(i,Li.reverseOrder()),i}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(t){if(this._workingNoder!==null)return this._workingNoder;var i=new wl,a=new Br;return a.setPrecisionModel(t),i.setSegmentIntersector(new xS(a)),i}},{key:"buffer",value:function(t,i){var a=this._workingPrecisionModel;a===null&&(a=t.getPrecisionModel()),this._geomFact=t.getFactory();var c=new hS(a,this._bufParams),g=new gS(t,i,c).getCurves();if(g.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(g,a),this._graph=new Fd(new _S),this._graph.addEdges(this._edgeList.getEdges());var p=this.createSubgraphs(this._graph),_=new K2(this._geomFact);this.buildSubgraphs(p,_);var w=_.getPolygons();return w.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(w)}},{key:"computeNodedEdges",value:function(t,i){var a=this.getNoder(i);a.computeNodes(t);for(var c=a.getNodedSubstrings().iterator();c.hasNext();){var g=c.next(),p=g.getCoordinates();if(p.length!==2||!p[0].equals2D(p[1])){var _=g.getData(),w=new $d(g.getCoordinates(),new Kt(_));this.insertUniqueEdge(w)}}}},{key:"setNoder",value:function(t){this._workingNoder=t}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ES;var t=arguments[0];this._bufParams=t}},{key:"depthDelta",value:function(t){var i=t.getLocation(0,ne.LEFT),a=t.getLocation(0,ne.RIGHT);return i===C.INTERIOR&&a===C.EXTERIOR?1:i===C.EXTERIOR&&a===C.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(t){for(var i=new Mi,a=new ve;t.hasNext();){var c=t.next(),g=i.createLineString(c.getCoordinates());a.add(g)}return i.buildGeometry(a)}}])}(),bS=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"rescale",value:function(){if(xe(arguments[0],De))for(var t=arguments[0].iterator();t.hasNext();){var i=t.next();this.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],c=0;c<a.length;c++)a[c].x=a[c].x/this._scaleFactor+this._offsetX,a[c].y=a[c].y/this._scaleFactor+this._offsetY;a.length===2&&a[0].equals2D(a[1])&&lt.out.println(a)}}},{key:"scale",value:function(){if(xe(arguments[0],De)){for(var t=arguments[0],i=new ve(t.size()),a=t.iterator();a.hasNext();){var c=a.next();i.add(new Ur(this.scale(c.getCoordinates()),c.getData()))}return i}if(arguments[0]instanceof Array){for(var g=arguments[0],p=new Array(g.length).fill(null),_=0;_<g.length;_++)p[_]=new V(Math.round((g[_].x-this._offsetX)*this._scaleFactor),Math.round((g[_].y-this._offsetY)*this._scaleFactor),g[_].getZ());return ue.removeRepeatedPoints(p)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t}},{key:"computeNodes",value:function(t){var i=t;this._isScaled&&(i=this.scale(t)),this._noder.computeNodes(i)}},{key:"interfaces_",get:function(){return[xl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],i=arguments[1];o.constructor_.call(this,t,i,0,0)}else if(arguments.length===4){var a=arguments[0],c=arguments[1];this._noder=a,this._scaleFactor=c,this._isScaled=!this.isIntegerPrecision()}}}])}(),Qd=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var i=t.next().getCoordinates();this.checkEndPtVertexIntersections(i[0],this._segStrings),this.checkEndPtVertexIntersections(i[i.length-1],this._segStrings)}else if(arguments.length===2){for(var a=arguments[0],c=arguments[1].iterator();c.hasNext();)for(var g=c.next().getCoordinates(),p=1;p<g.length-1;p++)if(g[p].equals(a))throw new me("found endpt/interior pt intersection at index "+p+" :pt "+a)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var i=t.next(),a=this._segStrings.iterator();a.hasNext();){var c=a.next();this.checkInteriorIntersections(i,c)}else if(arguments.length===2)for(var g=arguments[0],p=arguments[1],_=g.getCoordinates(),w=p.getCoordinates(),L=0;L<_.length-1;L++)for(var q=0;q<w.length-1;q++)this.checkInteriorIntersections(g,L,p,q);else if(arguments.length===4){var Z=arguments[0],Q=arguments[1],ce=arguments[2],ge=arguments[3];if(Z===ce&&Q===ge)return null;var ye=Z.getCoordinates()[Q],Ae=Z.getCoordinates()[Q+1],Le=ce.getCoordinates()[ge],Be=ce.getCoordinates()[ge+1];if(this._li.computeIntersection(ye,Ae,Le,Be),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ye,Ae)||this.hasInteriorIntersection(this._li,Le,Be)))throw new me("found non-noded intersection at "+ye+"-"+Ae+" and "+Le+"-"+Be)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var i=t.next();this.checkCollapses(i)}else if(arguments.length===1)for(var a=arguments[0].getCoordinates(),c=0;c<a.length-2;c++)this.checkCollapse(a[c],a[c+1],a[c+2])}},{key:"hasInteriorIntersection",value:function(t,i,a){for(var c=0;c<t.getIntersectionNum();c++){var g=t.getIntersection(c);if(!g.equals(i)&&!g.equals(a))return!0}return!1}},{key:"checkCollapse",value:function(t,i,a){if(t.equals(a))throw new me("found non-noded collapse at "+o.fact.createLineString([t,i,a]))}}],[{key:"constructor_",value:function(){this._li=new Br,this._segStrings=null;var t=arguments[0];this._segStrings=t}}])}();Qd.fact=new Mi;var Sl=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"intersectsScaled",value:function(t,i){var a=Math.min(t.x,i.x),c=Math.max(t.x,i.x),g=Math.min(t.y,i.y),p=Math.max(t.y,i.y),_=this._maxx<a||this._minx>c||this._maxy<g||this._miny>p;if(_)return!1;var w=this.intersectsToleranceSquare(t,i);return oe.isTrue(!(_&&w),"Found bad envelope test"),w}},{key:"initCorners",value:function(t){var i=.5;this._minx=t.x-i,this._maxx=t.x+i,this._miny=t.y-i,this._maxy=t.y+i,this._corner[0]=new V(this._maxx,this._maxy),this._corner[1]=new V(this._minx,this._maxy),this._corner[2]=new V(this._minx,this._miny),this._corner[3]=new V(this._maxx,this._miny)}},{key:"intersects",value:function(t,i){return this._scaleFactor===1?this.intersectsScaled(t,i):(this.copyScaled(t,this._p0Scaled),this.copyScaled(i,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(t){return Math.round(t*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(t,i){i.x=this.scale(t.x),i.y=this.scale(t.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var t=o.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new be(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(t,i){return this._li.computeIntersection(t,i,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,i,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,i,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,i,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(t,i){var a=!1,c=!1;return this._li.computeIntersection(t,i,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,i,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(a=!0),this._li.computeIntersection(t,i,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(c=!0),this._li.computeIntersection(t,i,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!a||!c)||!!t.equals(this._pt)||!!i.equals(this._pt))))}},{key:"addSnappedNode",value:function(t,i){var a=t.getCoordinate(i),c=t.getCoordinate(i+1);return!!this.intersects(a,c)&&(t.addIntersection(this.getCoordinate(),i),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],i=arguments[1],a=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=i,this._li=a,i<=0)throw new X("Scale factor must be non-zero");i!==1&&(this._pt=new V(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new V,this._p1Scaled=new V),this.initCorners(this._pt)}}])}();Sl.SAFE_ENV_EXPANSION_FACTOR=.75;var AS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var o=arguments[1];arguments[0].getLineSegment(o,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Gt}}])}(),ep=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var o=arguments[0];return this.snap(o,null,-1)}if(arguments.length===3){var t=arguments[0],i=arguments[1],a=arguments[2],c=t.getSafeEnvelope(),g=new tp(t,i,a);return this._index.query(c,new(function(){return h(function p(){u(this,p)},[{key:"interfaces_",get:function(){return[Bd]}},{key:"visitItem",value:function(p){p.select(c,g)}}])}())),g.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var o=arguments[0];this._index=o}}])}(),tp=function(o){function t(){var i;return u(this,t),i=s(this,t),t.constructor_.apply(i,arguments),i}return y(t,o),h(t,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof zd))return M(t,"select",this,1).apply(this,arguments);var i=arguments[1],a=arguments[0].getContext();if(this._parentEdge===a&&(i===this._hotPixelVertexIndex||i+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(a,i)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var i=arguments[0],a=arguments[1],c=arguments[2];this._hotPixel=i,this._parentEdge=a,this._hotPixelVertexIndex=c}}])}(AS);ep.HotPixelSnapAction=tp;var CS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(o,t,i,a){if(o===i&&t===a)return null;var c=o.getCoordinates()[t],g=o.getCoordinates()[t+1],p=i.getCoordinates()[a],_=i.getCoordinates()[a+1];if(this._li.computeIntersection(c,g,p,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)this._interiorIntersections.add(this._li.getIntersection(w));o.addIntersections(this._li,t,0),i.addIntersections(this._li,a,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zd]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var o=arguments[0];this._li=o,this._interiorIntersections=new ve}}])}(),TS=function(){return h(function o(){u(this,o),o.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(o){var t=Ur.getNodedSubstrings(o),i=new Qd(t);try{i.checkValid()}catch(a){if(!(a instanceof J))throw a;a.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Ur.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(o,t){var i=this.findInteriorIntersections(o,t);this.computeIntersectionSnaps(i),this.computeVertexSnaps(o)}},{key:"findInteriorIntersections",value:function(o,t){var i=new CS(t);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(o),i.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(xe(arguments[0],De))for(var o=arguments[0].iterator();o.hasNext();){var t=o.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof Ur)for(var i=arguments[0],a=i.getCoordinates(),c=0;c<a.length;c++){var g=new Sl(a[c],this._scaleFactor,this._li);this._pointSnapper.snap(g,i,c)&&i.addIntersection(a[c],c)}}},{key:"computeNodes",value:function(o){this._nodedSegStrings=o,this._noder=new wl,this._pointSnapper=new ep(this._noder.getIndex()),this.snapRound(o,this._li)}},{key:"computeIntersectionSnaps",value:function(o){for(var t=o.iterator();t.hasNext();){var i=t.next(),a=new Sl(i,this._scaleFactor,this._li);this._pointSnapper.snap(a)}}},{key:"interfaces_",get:function(){return[xl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var o=arguments[0];this._pm=o,this._li=new Br,this._li.setPrecisionModel(o),this._scaleFactor=o.getScale()}}])}(),Ci=function(){function o(){u(this,o),o.constructor_.apply(this,arguments)}return h(o,[{key:"bufferFixedPrecision",value:function(t){var i=new bS(new TS(new At(1)),t.getScale()),a=new Kd(this._bufParams);a.setWorkingPrecisionModel(t),a.setNoder(i),this._resultGeometry=a.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var t=o.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(g){if(!(g instanceof It))throw g;this._saveException=g}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var i=arguments[0],a=o.precisionScaleFactor(this._argGeom,this._distance,i),c=new At(a);this.bufferFixedPrecision(c)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===At.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(t){this._bufParams.setQuadrantSegments(t)}},{key:"bufferOriginalPrecision",value:function(){try{var t=new Kd(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(i){if(!(i instanceof me))throw i;this._saveException=i}}},{key:"getResultGeometry",value:function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(t){this._bufParams.setEndCapStyle(t)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new H,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this._argGeom=i,this._bufParams=a}}},{key:"bufferOp",value:function(){if(arguments.length===2){var t=arguments[1];return new o(arguments[0]).getResultGeometry(t)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var i=arguments[1],a=arguments[2],c=new o(arguments[0]);return c.setQuadrantSegments(a),c.getResultGeometry(i)}if(arguments[2]instanceof H&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var g=arguments[1];return new o(arguments[0],arguments[2]).getResultGeometry(g)}}else if(arguments.length===4){var p=arguments[1],_=arguments[2],w=arguments[3],L=new o(arguments[0]);return L.setQuadrantSegments(_),L.setEndCapStyle(w),L.getResultGeometry(p)}}},{key:"precisionScaleFactor",value:function(t,i,a){var c=t.getEnvelopeInternal(),g=Tn.max(Math.abs(c.getMaxX()),Math.abs(c.getMaxY()),Math.abs(c.getMinX()),Math.abs(c.getMinY()))+2*(i>0?i:0),p=a-Math.trunc(Math.log(g)/Math.log(10)+1);return Math.pow(10,p)}}])}();Ci.CAP_ROUND=H.CAP_ROUND,Ci.CAP_BUTT=H.CAP_FLAT,Ci.CAP_FLAT=H.CAP_FLAT,Ci.CAP_SQUARE=H.CAP_SQUARE,Ci.MAX_PRECISION_DIGITS=12;var NS=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],np=function(){return h(function o(t){u(this,o),this.geometryFactory=t||new Mi},[{key:"read",value:function(o){var t,i=(t=typeof o=="string"?JSON.parse(o):o).type;if(!en[i])throw new Error("Unknown GeoJSON type: "+t.type);return NS.indexOf(i)!==-1?en[i].call(this,t.coordinates):i==="GeometryCollection"?en[i].call(this,t.geometries):en[i].call(this,t)}},{key:"write",value:function(o){var t=o.getGeometryType();if(!Rn[t])throw new Error("Geometry is not supported");return Rn[t].call(this,o)}}])}(),en={Feature:function(o){var t={};for(var i in o)t[i]=o[i];if(o.geometry){var a=o.geometry.type;if(!en[a])throw new Error("Unknown GeoJSON type: "+o.type);t.geometry=this.read(o.geometry)}return o.bbox&&(t.bbox=en.bbox.call(this,o.bbox)),t},FeatureCollection:function(o){var t={};if(o.features){t.features=[];for(var i=0;i<o.features.length;++i)t.features.push(this.read(o.features[i]))}return o.bbox&&(t.bbox=this.parse.bbox.call(this,o.bbox)),t},coordinates:function(o){for(var t=[],i=0;i<o.length;++i){var a=o[i];t.push(l(V,D(a)))}return t},bbox:function(o){return this.geometryFactory.createLinearRing([new V(o[0],o[1]),new V(o[2],o[1]),new V(o[2],o[3]),new V(o[0],o[3]),new V(o[0],o[1])])},Point:function(o){var t=l(V,D(o));return this.geometryFactory.createPoint(t)},MultiPoint:function(o){for(var t=[],i=0;i<o.length;++i)t.push(en.Point.call(this,o[i]));return this.geometryFactory.createMultiPoint(t)},LineString:function(o){var t=en.coordinates.call(this,o);return this.geometryFactory.createLineString(t)},MultiLineString:function(o){for(var t=[],i=0;i<o.length;++i)t.push(en.LineString.call(this,o[i]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(o){for(var t=en.coordinates.call(this,o[0]),i=this.geometryFactory.createLinearRing(t),a=[],c=1;c<o.length;++c){var g=o[c],p=en.coordinates.call(this,g),_=this.geometryFactory.createLinearRing(p);a.push(_)}return this.geometryFactory.createPolygon(i,a)},MultiPolygon:function(o){for(var t=[],i=0;i<o.length;++i){var a=o[i];t.push(en.Polygon.call(this,a))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(o){for(var t=[],i=0;i<o.length;++i){var a=o[i];t.push(this.read(a))}return this.geometryFactory.createGeometryCollection(t)}},Rn={coordinate:function(o){var t=[o.x,o.y];return o.z&&t.push(o.z),o.m&&t.push(o.m),t},Point:function(o){return{type:"Point",coordinates:Rn.coordinate.call(this,o.getCoordinate())}},MultiPoint:function(o){for(var t=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Rn.Point.call(this,a);t.push(c.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(o){for(var t=[],i=o.getCoordinates(),a=0;a<i.length;++a){var c=i[a];t.push(Rn.coordinate.call(this,c))}return{type:"LineString",coordinates:t}},MultiLineString:function(o){for(var t=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Rn.LineString.call(this,a);t.push(c.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(o){var t=[],i=Rn.LineString.call(this,o._shell);t.push(i.coordinates);for(var a=0;a<o._holes.length;++a){var c=o._holes[a],g=Rn.LineString.call(this,c);t.push(g.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(o){for(var t=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=Rn.Polygon.call(this,a);t.push(c.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(o){for(var t=[],i=0;i<o._geometries.length;++i){var a=o._geometries[i],c=a.getGeometryType();t.push(Rn[c].call(this,a))}return{type:"GeometryCollection",geometries:t}}};return{BufferOp:Ci,GeoJSONReader:function(){return h(function o(t){u(this,o),this.parser=new np(t||new Mi)},[{key:"read",value:function(o){return this.parser.read(o)}}])}(),GeoJSONWriter:function(){return h(function o(){u(this,o),this.parser=new np(this.geometryFactory)},[{key:"write",value:function(o){return this.parser.write(o)}}])}()}})}(ha)),ha.exports}var N_=T_();const P_=Cl(N_);function ir(){return new fa}function fa(){this.reset()}fa.prototype={constructor:fa,reset:function(){this.s=this.t=0},add:function(n){Mh(ga,n,this.t),Mh(this,ga.s,this.s),this.s?this.t+=ga.t:this.s=ga.t},valueOf:function(){return this.s}};var ga=new fa;function Mh(n,r,e){var s=n.s=r+e,u=s-r,l=s-u;n.t=r-l+(e-u)}var Ye=1e-6,Ce=Math.PI,xn=Ce/2,Ih=Ce/4,wn=Ce*2,sr=180/Ce,zt=Ce/180,rt=Math.abs,O_=Math.atan,Qr=Math.atan2,Je=Math.cos,Ve=Math.sin,ei=Math.sqrt;function Lh(n){return n>1?0:n<-1?Ce:Math.acos(n)}function br(n){return n>1?xn:n<-1?-xn:Math.asin(n)}function Hi(){}function da(n,r){n&&Ah.hasOwnProperty(n.type)&&Ah[n.type](n,r)}var bh={Feature:function(n,r){da(n.geometry,r)},FeatureCollection:function(n,r){for(var e=n.features,s=-1,u=e.length;++s<u;)da(e[s].geometry,r)}},Ah={Sphere:function(n,r){r.sphere()},Point:function(n,r){n=n.coordinates,r.point(n[0],n[1],n[2])},MultiPoint:function(n,r){for(var e=n.coordinates,s=-1,u=e.length;++s<u;)n=e[s],r.point(n[0],n[1],n[2])},LineString:function(n,r){au(n.coordinates,r,0)},MultiLineString:function(n,r){for(var e=n.coordinates,s=-1,u=e.length;++s<u;)au(e[s],r,0)},Polygon:function(n,r){Ch(n.coordinates,r)},MultiPolygon:function(n,r){for(var e=n.coordinates,s=-1,u=e.length;++s<u;)Ch(e[s],r)},GeometryCollection:function(n,r){for(var e=n.geometries,s=-1,u=e.length;++s<u;)da(e[s],r)}};function au(n,r,e){var s=-1,u=n.length-e,l;for(r.lineStart();++s<u;)l=n[s],r.point(l[0],l[1],l[2]);r.lineEnd()}function Ch(n,r){var e=-1,s=n.length;for(r.polygonStart();++e<s;)au(n[e],r,1);r.polygonEnd()}function R_(n,r){n&&bh.hasOwnProperty(n.type)?bh[n.type](n,r):da(n,r)}ir(),ir();function ou(n){return[Qr(n[1],n[0]),br(n[2])]}function ti(n){var r=n[0],e=n[1],s=Je(e);return[s*Je(r),s*Ve(r),Ve(e)]}function pa(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]}function ma(n,r){return[n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0]]}function uu(n,r){n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}function va(n,r){return[n[0]*r,n[1]*r,n[2]*r]}function lu(n){var r=ei(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=r,n[1]/=r,n[2]/=r}ir();function Th(n,r){function e(s,u){return s=n(s,u),r(s[0],s[1])}return n.invert&&r.invert&&(e.invert=function(s,u){return s=r.invert(s,u),s&&n.invert(s[0],s[1])}),e}function cu(n,r){return[n>Ce?n-wn:n<-Ce?n+wn:n,r]}cu.invert=cu;function D_(n,r,e){return(n%=wn)?r||e?Th(Ph(n),Oh(r,e)):Ph(n):r||e?Oh(r,e):cu}function Nh(n){return function(r,e){return r+=n,[r>Ce?r-wn:r<-Ce?r+wn:r,e]}}function Ph(n){var r=Nh(n);return r.invert=Nh(-n),r}function Oh(n,r){var e=Je(n),s=Ve(n),u=Je(r),l=Ve(r);function f(h,m){var d=Je(m),v=Je(h)*d,y=Ve(h)*d,E=Ve(m),S=E*e+v*s;return[Qr(y*u-S*l,v*e-E*s),br(S*u+y*l)]}return f.invert=function(h,m){var d=Je(m),v=Je(h)*d,y=Ve(h)*d,E=Ve(m),S=E*u-y*l;return[Qr(y*u+E*l,v*e+S*s),br(S*e-v*s)]},f}function F_(n,r,e,s,u,l){if(e){var f=Je(r),h=Ve(r),m=s*e;u==null?(u=r+s*wn,l=r-m/2):(u=Rh(f,u),l=Rh(f,l),(s>0?u<l:u>l)&&(u+=s*wn));for(var d,v=u;s>0?v>l:v<l;v-=m)d=ou([f,-h*Je(v),-h*Ve(v)]),n.point(d[0],d[1])}}function Rh(n,r){r=ti(r),r[0]-=n,lu(r);var e=Lh(-r[1]);return((-r[2]<0?-e:e)+wn-Ye)%wn}function Dh(){var n=[],r;return{point:function(e,s){r.push([e,s])},lineStart:function(){n.push(r=[])},lineEnd:Hi,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],r=null,e}}}function G_(n,r,e,s,u,l){var f=n[0],h=n[1],m=r[0],d=r[1],v=0,y=1,E=m-f,S=d-h,M;if(M=e-f,!(!E&&M>0)){if(M/=E,E<0){if(M<v)return;M<y&&(y=M)}else if(E>0){if(M>y)return;M>v&&(v=M)}if(M=u-f,!(!E&&M<0)){if(M/=E,E<0){if(M>y)return;M>v&&(v=M)}else if(E>0){if(M<v)return;M<y&&(y=M)}if(M=s-h,!(!S&&M>0)){if(M/=S,S<0){if(M<v)return;M<y&&(y=M)}else if(S>0){if(M>y)return;M>v&&(v=M)}if(M=l-h,!(!S&&M<0)){if(M/=S,S<0){if(M>y)return;M>v&&(v=M)}else if(S>0){if(M<v)return;M<y&&(y=M)}return v>0&&(n[0]=f+v*E,n[1]=h+v*S),y<1&&(r[0]=f+y*E,r[1]=h+y*S),!0}}}}}function ya(n,r){return rt(n[0]-r[0])<Ye&&rt(n[1]-r[1])<Ye}function _a(n,r,e,s){this.x=n,this.z=r,this.o=e,this.e=s,this.v=!1,this.n=this.p=null}function Fh(n,r,e,s,u){var l=[],f=[],h,m;if(n.forEach(function(M){if(!((D=M.length-1)<=0)){var D,U=M[0],G=M[D],I;if(ya(U,G)){for(u.lineStart(),h=0;h<D;++h)u.point((U=M[h])[0],U[1]);u.lineEnd();return}l.push(I=new _a(U,M,null,!0)),f.push(I.o=new _a(U,null,I,!1)),l.push(I=new _a(G,M,null,!1)),f.push(I.o=new _a(G,null,I,!0))}}),!!l.length){for(f.sort(r),Gh(l),Gh(f),h=0,m=f.length;h<m;++h)f[h].e=e=!e;for(var d=l[0],v,y;;){for(var E=d,S=!0;E.v;)if((E=E.n)===d)return;v=E.z,u.lineStart();do{if(E.v=E.o.v=!0,E.e){if(S)for(h=0,m=v.length;h<m;++h)u.point((y=v[h])[0],y[1]);else s(E.x,E.n.x,1,u);E=E.n}else{if(S)for(v=E.p.z,h=v.length-1;h>=0;--h)u.point((y=v[h])[0],y[1]);else s(E.x,E.p.x,-1,u);E=E.p}E=E.o,v=E.z,S=!S}while(!E.v);u.lineEnd()}}}function Gh(n){if(r=n.length){for(var r,e=0,s=n[0],u;++e<r;)s.n=u=n[e],u.p=s,s=u;s.n=u=n[0],u.p=s}}function Bh(n,r){return n<r?-1:n>r?1:n>=r?0:NaN}function B_(n){return n.length===1&&(n=U_(n)),{left:function(r,e,s,u){for(s==null&&(s=0),u==null&&(u=r.length);s<u;){var l=s+u>>>1;n(r[l],e)<0?s=l+1:u=l}return s},right:function(r,e,s,u){for(s==null&&(s=0),u==null&&(u=r.length);s<u;){var l=s+u>>>1;n(r[l],e)>0?u=l:s=l+1}return s}}}function U_(n){return function(r,e){return Bh(n(r),e)}}B_(Bh);function Uh(n){for(var r=n.length,e,s=-1,u=0,l,f;++s<r;)u+=n[s].length;for(l=new Array(u);--r>=0;)for(f=n[r],e=f.length;--e>=0;)l[--u]=f[e];return l}var Ea=1e9,xa=-1e9;function z_(n,r,e,s){function u(d,v){return n<=d&&d<=e&&r<=v&&v<=s}function l(d,v,y,E){var S=0,M=0;if(d==null||(S=f(d,y))!==(M=f(v,y))||m(d,v)<0^y>0)do E.point(S===0||S===3?n:e,S>1?s:r);while((S=(S+y+4)%4)!==M);else E.point(v[0],v[1])}function f(d,v){return rt(d[0]-n)<Ye?v>0?0:3:rt(d[0]-e)<Ye?v>0?2:1:rt(d[1]-r)<Ye?v>0?1:0:v>0?3:2}function h(d,v){return m(d.x,v.x)}function m(d,v){var y=f(d,1),E=f(v,1);return y!==E?y-E:y===0?v[1]-d[1]:y===1?d[0]-v[0]:y===2?d[1]-v[1]:v[0]-d[0]}return function(d){var v=d,y=Dh(),E,S,M,D,U,G,I,H,J,X,W,$={point:x,lineStart:T,lineEnd:F,polygonStart:b,polygonEnd:A};function x(N,R){u(N,R)&&v.point(N,R)}function k(){for(var N=0,R=0,Y=S.length;R<Y;++R)for(var z=S[R],j=1,K=z.length,re=z[0],me,he,oe=re[0],le=re[1];j<K;++j)me=oe,he=le,re=z[j],oe=re[0],le=re[1],he<=s?le>s&&(oe-me)*(s-he)>(le-he)*(n-me)&&++N:le<=s&&(oe-me)*(s-he)<(le-he)*(n-me)&&--N;return N}function b(){v=y,E=[],S=[],W=!0}function A(){var N=k(),R=W&&N,Y=(E=Uh(E)).length;(R||Y)&&(d.polygonStart(),R&&(d.lineStart(),l(null,null,1,d),d.lineEnd()),Y&&Fh(E,h,N,l,d),d.polygonEnd()),v=d,E=S=M=null}function T(){$.point=P,S&&S.push(M=[]),X=!0,J=!1,I=H=NaN}function F(){E&&(P(D,U),G&&J&&y.rejoin(),E.push(y.result())),$.point=x,J&&v.lineEnd()}function P(N,R){var Y=u(N,R);if(S&&M.push([N,R]),X)D=N,U=R,G=Y,X=!1,Y&&(v.lineStart(),v.point(N,R));else if(Y&&J)v.point(N,R);else{var z=[I=Math.max(xa,Math.min(Ea,I)),H=Math.max(xa,Math.min(Ea,H))],j=[N=Math.max(xa,Math.min(Ea,N)),R=Math.max(xa,Math.min(Ea,R))];G_(z,j,n,r,e,s)?(J||(v.lineStart(),v.point(z[0],z[1])),v.point(j[0],j[1]),Y||v.lineEnd(),W=!1):Y&&(v.lineStart(),v.point(N,R),W=!1)}I=N,H=R,J=Y}return $}}var hu=ir();function q_(n,r){var e=r[0],s=r[1],u=[Ve(e),-Je(e),0],l=0,f=0;hu.reset();for(var h=0,m=n.length;h<m;++h)if(v=(d=n[h]).length)for(var d,v,y=d[v-1],E=y[0],S=y[1]/2+Ih,M=Ve(S),D=Je(S),U=0;U<v;++U,E=I,M=J,D=X,y=G){var G=d[U],I=G[0],H=G[1]/2+Ih,J=Ve(H),X=Je(H),W=I-E,$=W>=0?1:-1,x=$*W,k=x>Ce,b=M*J;if(hu.add(Qr(b*$*Ve(x),D*X+b*Je(x))),l+=k?W+$*wn:W,k^E>=e^I>=e){var A=ma(ti(y),ti(G));lu(A);var T=ma(u,A);lu(T);var F=(k^W>=0?-1:1)*br(T[2]);(s>F||s===F&&(A[0]||A[1]))&&(f+=k^W>=0?1:-1)}}return(l<-1e-6||l<Ye&&hu<-1e-6)^f&1}ir();function zh(n){return n}ir(),ir();var ni=1/0,wa=ni,Ji=-ni,ka=Ji,qh={point:Y_,lineStart:Hi,lineEnd:Hi,polygonStart:Hi,polygonEnd:Hi,result:function(){var n=[[ni,wa],[Ji,ka]];return Ji=ka=-(wa=ni=1/0),n}};function Y_(n,r){n<ni&&(ni=n),n>Ji&&(Ji=n),r<wa&&(wa=r),r>ka&&(ka=r)}ir();function Yh(n,r,e,s){return function(u,l){var f=r(l),h=u.invert(s[0],s[1]),m=Dh(),d=r(m),v=!1,y,E,S,M={point:D,lineStart:G,lineEnd:I,polygonStart:function(){M.point=H,M.lineStart=J,M.lineEnd=X,E=[],y=[]},polygonEnd:function(){M.point=D,M.lineStart=G,M.lineEnd=I,E=Uh(E);var W=q_(y,h);E.length?(v||(l.polygonStart(),v=!0),Fh(E,J_,W,e,l)):W&&(v||(l.polygonStart(),v=!0),l.lineStart(),e(null,null,1,l),l.lineEnd()),v&&(l.polygonEnd(),v=!1),E=y=null},sphere:function(){l.polygonStart(),l.lineStart(),e(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function D(W,$){var x=u(W,$);n(W=x[0],$=x[1])&&l.point(W,$)}function U(W,$){var x=u(W,$);f.point(x[0],x[1])}function G(){M.point=U,f.lineStart()}function I(){M.point=D,f.lineEnd()}function H(W,$){S.push([W,$]);var x=u(W,$);d.point(x[0],x[1])}function J(){d.lineStart(),S=[]}function X(){H(S[0][0],S[0][1]),d.lineEnd();var W=d.clean(),$=m.result(),x,k=$.length,b,A,T;if(S.pop(),y.push(S),S=null,!!k){if(W&1){if(A=$[0],(b=A.length-1)>0){for(v||(l.polygonStart(),v=!0),l.lineStart(),x=0;x<b;++x)l.point((T=A[x])[0],T[1]);l.lineEnd()}return}k>1&&W&2&&$.push($.pop().concat($.shift())),E.push($.filter(H_))}}return M}}function H_(n){return n.length>1}function J_(n,r){return((n=n.x)[0]<0?n[1]-xn-Ye:xn-n[1])-((r=r.x)[0]<0?r[1]-xn-Ye:xn-r[1])}const Hh=Yh(function(){return!0},V_,W_,[-Ce,-xn]);function V_(n){var r=NaN,e=NaN,s=NaN,u;return{lineStart:function(){n.lineStart(),u=1},point:function(l,f){var h=l>0?Ce:-Ce,m=rt(l-r);rt(m-Ce)<Ye?(n.point(r,e=(e+f)/2>0?xn:-xn),n.point(s,e),n.lineEnd(),n.lineStart(),n.point(h,e),n.point(l,e),u=0):s!==h&&m>=Ce&&(rt(r-s)<Ye&&(r-=s*Ye),rt(l-h)<Ye&&(l-=h*Ye),e=X_(r,e,l,f),n.point(s,e),n.lineEnd(),n.lineStart(),n.point(h,e),u=0),n.point(r=l,e=f),s=h},lineEnd:function(){n.lineEnd(),r=e=NaN},clean:function(){return 2-u}}}function X_(n,r,e,s){var u,l,f=Ve(n-e);return rt(f)>Ye?O_((Ve(r)*(l=Je(s))*Ve(e)-Ve(s)*(u=Je(r))*Ve(n))/(u*l*f)):(r+s)/2}function W_(n,r,e,s){var u;if(n==null)u=e*xn,s.point(-Ce,u),s.point(0,u),s.point(Ce,u),s.point(Ce,0),s.point(Ce,-u),s.point(0,-u),s.point(-Ce,-u),s.point(-Ce,0),s.point(-Ce,u);else if(rt(n[0]-r[0])>Ye){var l=n[0]<r[0]?Ce:-Ce;u=e*l/2,s.point(-l,u),s.point(0,u),s.point(l,u)}else s.point(r[0],r[1])}function Z_(n,r){var e=Je(n),s=e>0,u=rt(e)>Ye;function l(v,y,E,S){F_(S,n,r,E,v,y)}function f(v,y){return Je(v)*Je(y)>e}function h(v){var y,E,S,M,D;return{lineStart:function(){M=S=!1,D=1},point:function(U,G){var I=[U,G],H,J=f(U,G),X=s?J?0:d(U,G):J?d(U+(U<0?Ce:-Ce),G):0;if(!y&&(M=S=J)&&v.lineStart(),J!==S&&(H=m(y,I),(!H||ya(y,H)||ya(I,H))&&(I[0]+=Ye,I[1]+=Ye,J=f(I[0],I[1]))),J!==S)D=0,J?(v.lineStart(),H=m(I,y),v.point(H[0],H[1])):(H=m(y,I),v.point(H[0],H[1]),v.lineEnd()),y=H;else if(u&&y&&s^J){var W;!(X&E)&&(W=m(I,y,!0))&&(D=0,s?(v.lineStart(),v.point(W[0][0],W[0][1]),v.point(W[1][0],W[1][1]),v.lineEnd()):(v.point(W[1][0],W[1][1]),v.lineEnd(),v.lineStart(),v.point(W[0][0],W[0][1])))}J&&(!y||!ya(y,I))&&v.point(I[0],I[1]),y=I,S=J,E=X},lineEnd:function(){S&&v.lineEnd(),y=null},clean:function(){return D|(M&&S)<<1}}}function m(v,y,E){var S=ti(v),M=ti(y),D=[1,0,0],U=ma(S,M),G=pa(U,U),I=U[0],H=G-I*I;if(!H)return!E&&v;var J=e*G/H,X=-e*I/H,W=ma(D,U),$=va(D,J),x=va(U,X);uu($,x);var k=W,b=pa($,k),A=pa(k,k),T=b*b-A*(pa($,$)-1);if(!(T<0)){var F=ei(T),P=va(k,(-b-F)/A);if(uu(P,$),P=ou(P),!E)return P;var N=v[0],R=y[0],Y=v[1],z=y[1],j;R<N&&(j=N,N=R,R=j);var K=R-N,re=rt(K-Ce)<Ye,me=re||K<Ye;if(!re&&z<Y&&(j=Y,Y=z,z=j),me?re?Y+z>0^P[1]<(rt(P[0]-N)<Ye?Y:z):Y<=P[1]&&P[1]<=z:K>Ce^(N<=P[0]&&P[0]<=R)){var he=va(k,(-b+F)/A);return uu(he,$),[P,ou(he)]}}}function d(v,y){var E=s?n:Ce-n,S=0;return v<-E?S|=1:v>E&&(S|=2),y<-E?S|=4:y>E&&(S|=8),S}return Yh(f,h,l,s?[0,-n]:[-Ce,n-Ce])}function Jh(n){return function(r){var e=new fu;for(var s in n)e[s]=n[s];return e.stream=r,e}}function fu(){}fu.prototype={constructor:fu,point:function(n,r){this.stream.point(n,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Vh(n,r,e){var s=r[1][0]-r[0][0],u=r[1][1]-r[0][1],l=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),l!=null&&n.clipExtent(null),R_(e,n.stream(qh));var f=qh.result(),h=Math.min(s/(f[1][0]-f[0][0]),u/(f[1][1]-f[0][1])),m=+r[0][0]+(s-h*(f[1][0]+f[0][0]))/2,d=+r[0][1]+(u-h*(f[1][1]+f[0][1]))/2;return l!=null&&n.clipExtent(l),n.scale(h*150).translate([m,d])}function j_(n,r,e){return Vh(n,[[0,0],r],e)}var Xh=16,$_=Je(30*zt);function Wh(n,r){return+r?Q_(n,r):K_(n)}function K_(n){return Jh({point:function(r,e){r=n(r,e),this.stream.point(r[0],r[1])}})}function Q_(n,r){function e(s,u,l,f,h,m,d,v,y,E,S,M,D,U){var G=d-s,I=v-u,H=G*G+I*I;if(H>4*r&&D--){var J=f+E,X=h+S,W=m+M,$=ei(J*J+X*X+W*W),x=br(W/=$),k=rt(rt(W)-1)<Ye||rt(l-y)<Ye?(l+y)/2:Qr(X,J),b=n(k,x),A=b[0],T=b[1],F=A-s,P=T-u,N=I*F-G*P;(N*N/H>r||rt((G*F+I*P)/H-.5)>.3||f*E+h*S+m*M<$_)&&(e(s,u,l,f,h,m,A,T,k,J/=$,X/=$,W,D,U),U.point(A,T),e(A,T,k,J,X,W,d,v,y,E,S,M,D,U))}}return function(s){var u,l,f,h,m,d,v,y,E,S,M,D,U={point:G,lineStart:I,lineEnd:J,polygonStart:function(){s.polygonStart(),U.lineStart=X},polygonEnd:function(){s.polygonEnd(),U.lineStart=I}};function G(x,k){x=n(x,k),s.point(x[0],x[1])}function I(){y=NaN,U.point=H,s.lineStart()}function H(x,k){var b=ti([x,k]),A=n(x,k);e(y,E,v,S,M,D,y=A[0],E=A[1],v=x,S=b[0],M=b[1],D=b[2],Xh,s),s.point(y,E)}function J(){U.point=G,s.lineEnd()}function X(){I(),U.point=W,U.lineEnd=$}function W(x,k){H(u=x,k),l=y,f=E,h=S,m=M,d=D,U.point=H}function $(){e(y,E,v,S,M,D,l,f,u,h,m,d,Xh,s),U.lineEnd=J,J()}return U}}var eE=Jh({point:function(n,r){this.stream.point(n*zt,r*zt)}});function tE(n){return nE(function(){return n})()}function nE(n){var r,e=150,s=480,u=250,l,f,h=0,m=0,d=0,v=0,y=0,E,S,M=null,D=Hh,U=null,G,I,H,J=zh,X=.5,W=Wh(A,X),$,x;function k(P){return P=S(P[0]*zt,P[1]*zt),[P[0]*e+l,f-P[1]*e]}function b(P){return P=S.invert((P[0]-l)/e,(f-P[1])/e),P&&[P[0]*sr,P[1]*sr]}function A(P,N){return P=r(P,N),[P[0]*e+l,f-P[1]*e]}k.stream=function(P){return $&&x===P?$:$=eE(D(E,W(J(x=P))))},k.clipAngle=function(P){return arguments.length?(D=+P?Z_(M=P*zt,6*zt):(M=null,Hh),F()):M*sr},k.clipExtent=function(P){return arguments.length?(J=P==null?(U=G=I=H=null,zh):z_(U=+P[0][0],G=+P[0][1],I=+P[1][0],H=+P[1][1]),F()):U==null?null:[[U,G],[I,H]]},k.scale=function(P){return arguments.length?(e=+P,T()):e},k.translate=function(P){return arguments.length?(s=+P[0],u=+P[1],T()):[s,u]},k.center=function(P){return arguments.length?(h=P[0]%360*zt,m=P[1]%360*zt,T()):[h*sr,m*sr]},k.rotate=function(P){return arguments.length?(d=P[0]%360*zt,v=P[1]%360*zt,y=P.length>2?P[2]%360*zt:0,T()):[d*sr,v*sr,y*sr]},k.precision=function(P){return arguments.length?(W=Wh(A,X=P*P),F()):ei(X)},k.fitExtent=function(P,N){return Vh(k,P,N)},k.fitSize=function(P,N){return j_(k,P,N)};function T(){S=Th(E=D_(d,v,y),r);var P=r(h,m);return l=s-P[0]*e,f=u+P[1]*e,F()}function F(){return $=x=null,k}return function(){return r=n.apply(this,arguments),k.invert=r.invert&&b,T()}}function Zh(n){return function(r,e){var s=Je(r),u=Je(e),l=n(s*u);return[l*u*Ve(r),l*Ve(e)]}}function jh(n){return function(r,e){var s=ei(r*r+e*e),u=n(s),l=Ve(u),f=Je(u);return[Qr(r*l,s*f),br(s&&e*l/s)]}}var rE=Zh(function(n){return ei(2/(1+n))});rE.invert=jh(function(n){return 2*br(n/2)});var $h=Zh(function(n){return(n=Lh(n))&&n/Ve(n)});$h.invert=jh(function(n){return n});function iE(){return tE($h).scale(79.4188).clipAngle(180-.001)}function Kh(n,r){return[n,r]}Kh.invert=Kh;var{BufferOp:sE,GeoJSONReader:aE,GeoJSONWriter:oE}=P_;function uE(n,r,e){e=e||{};var s=e.units||"kilometers",u=e.steps||8;if(!n)throw new Error("geojson is required");if(typeof e!="object")throw new Error("options must be an object");if(typeof u!="number")throw new Error("steps must be an number");if(r===void 0)throw new Error("radius is required");if(u<=0)throw new Error("steps must be greater than 0");var l=[];switch(n.type){case"GeometryCollection":return nr(n,function(f){var h=Sa(f,r,s,u);h&&l.push(h)}),$e(l);case"FeatureCollection":return yn(n,function(f){var h=Sa(f,r,s,u);h&&yn(h,function(m){m&&l.push(m)})}),$e(l)}return Sa(n,r,s,u)}function Sa(n,r,e,s){var u=n.properties||{},l=n.type==="Feature"?n.geometry:n;if(l.type==="GeometryCollection"){var f=[];return nr(n,function(D){var U=Sa(D,r,e,s);U&&f.push(U)}),$e(f)}var h=lE(l),m={type:l.type,coordinates:ef(l.coordinates,h)},d=new aE,v=d.read(m),y=wo(ko(r,e),"meters"),E=sE.bufferOp(v,y,s),S=new oE;if(E=S.write(E),!Qh(E.coordinates)){var M={type:E.type,coordinates:tf(E.coordinates,h)};return tn(M,u)}}function Qh(n){return Array.isArray(n[0])?Qh(n[0]):isNaN(n[0])}function ef(n,r){return typeof n[0]!="object"?r(n):n.map(function(e){return ef(e,r)})}function tf(n,r){return typeof n[0]!="object"?r.invert(n):n.map(function(e){return tf(e,r)})}function lE(n){var r=A_(n).geometry.coordinates,e=[-r[0],-r[1]];return iE().rotate(e).scale(tt)}var cE=uE;const nf=(n,r)=>(jr(n,e=>{const s=e.coordinate;s[0]+=r.lng,s[1]+=r.lat}),n),hE=(n,r)=>{const s=n.getBounds(),u=Xl(s[0],s[1],{units:"meters"});return cE(r,u*1e-4,{units:"meters"})||null},rf=(n,r)=>{const e=an(n.getGeoJson());return nf(e,r),e},fE=(n,r)=>{const e=rf(n,r);n.shapeProperties.center&&(n.shapeProperties.center[0]+=r.lng,n.shapeProperties.center[1]+=r.lat),n.updateGeoJsonGeometry(e.geometry)},sf=n=>Object.fromEntries(Object.entries(n.getShapeProperties()).filter(([,r])=>r!==null).map(([r,e])=>[`_gm_shape_${r}`,e])),gE=(n,r)=>{try{jr(n,e=>{if(!Lr(e.coordinate,r))throw new Error("stop")})}catch{return!1}return!0},gu=(n,r)=>{const e=gE(n,r);return kh(n)?e:e&&su(n)?!S_(n,r,{ignoreSelfIntersections:!0}).features.length:!1},du=n=>{const r=n.getGeoJson();return typeof r!="object"?null:tu(r)},dE=n=>{if(su(n)){const r=I_(n,{mutate:!1});if(r.type==="Feature"&&su(r))return{...r,properties:n.properties||{}}}return kh(n)?n:null},pE=["circle","ellipse","rectangle"];class Vi{constructor(r){O(this,"gm");O(this,"id","no-id");O(this,"parent",null);O(this,"shape");O(this,"markers");O(this,"shapeProperties",{center:null});O(this,"source");O(this,"orders",this.getEmptyOrders());this.gm=r.gm,this.id=r.id,this.source=r.source,this.parent=r.parent,this.markers=new Map,this.shape=r.geoJsonShapeFeature.properties.shape,this.order=this.getFreeOrder(),this.addGeoJson(r.geoJsonShapeFeature)}get order(){const r=this.source.id;if(this.orders[r]!==null)return this.orders[r];throw new Error(`Null order for feature id: ${this.id}`)}set order(r){const e=this.source.id;this.orders[e]=r}getEmptyOrders(){return Object.fromEntries(Ti(se).map(r=>[r,null]))}get temporary(){return this.source.id===se.temporary}get sourceName(){return this.source.id}getFreeOrder(){return this.getSourceGeoJson().features.length}getGeoJson(r=!1){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson().features[this.order]||null;if(this.id!==(e==null?void 0:e.id))throw ie.error(`Feature not found: ${this.id} !== ${e==null?void 0:e.id}`,e,this.getSourceGeoJson()),new Error("Feature not found");return r?{...e,properties:{...e.properties,...sf(this)}}:e}getShapeProperty(r){return this.shapeProperties[r]}getShapeProperties(){return this.shapeProperties}setShapeProperty(r,e){this.shapeProperties[r]=e}getSourceGeoJson(){return this.source.getGeoJson()}addGeoJson(r){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);const e=this.getSourceGeoJson();e.features[this.order]&&ie.error("FeatureData.addGeoJson, not an empty feature",this.id,e);const s={...r,id:this.id,properties:{...r.properties,[ar]:this.id}};e.features[this.order]=s,this.updateGeoJsonCenter(s),this.gm.features.updateSourceData({diff:{add:[s]},sourceName:this.sourceName})}removeGeoJson(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const r=this.getSourceGeoJson();delete r.features[this.order],this.gm.features.updateSourceData({diff:{remove:[this.id]},sourceName:this.sourceName}),this.order=null}removeMarkers(){this.markers.forEach(r=>{r.instance instanceof Os?r.instance.remove():this.gm.features.delete(r.instance)}),this.markers=new Map}updateGeoJsonGeometry(r){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson();e.features[this.order].geometry=r;const s={update:[e.features[this.order]]};this.gm.features.updateSourceData({diff:s,sourceName:this.sourceName})}updateGeoJsonProperties(r){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson();e.features[this.order].properties={...e.features[this.order].properties,...r};const s={update:[e.features[this.order]]};this.gm.features.updateSourceData({diff:s,sourceName:this.sourceName})}updateGeoJsonCenter(r){if(this.shape==="circle"){const e=Ko(Gl(r));this.setShapeProperty("center",e)}else this.shape==="ellipse"&&r.properties._gm_shape_center&&(this.setShapeProperty("center",r.properties._gm_shape_center),this.setShapeProperty("xSemiAxis",r.properties._gm_shape_xSemiAxis),this.setShapeProperty("ySemiAxis",r.properties._gm_shape_ySemiAxis),this.setShapeProperty("angle",r.properties._gm_shape_angle),delete r.properties._gm_shape_center,delete r.properties._gm_shape_xSemiAxis,delete r.properties._gm_shape_ySemiAxis,delete r.properties._gm_shape_angle)}convertToPolygon(){return this.isConvertableToPolygon()?(this.shape="polygon",this.shapeProperties.center=null,delete this.shapeProperties.angle,delete this.shapeProperties.xSemiAxis,delete this.shapeProperties.ySemiAxis,!0):!1}isConvertableToPolygon(){return pE.includes(this.shape)}fixOrder(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`)}isFeatureAvailable(){return this.order!==null}changeSource({sourceName:r,atomic:e}){e?this.gm.features.withAtomicSourcesUpdate(()=>this.actualChangeSource({sourceName:r,atomic:e})):this.actualChangeSource({sourceName:r,atomic:e})}actualChangeSource({sourceName:r,atomic:e}){if(this.source.id===r){ie.error(`FeatureData.changeSource: feature "${this.id}" already has the source "${r}"`);return}const s=this.gm.features.sources[r];if(!s){ie.error(`FeatureData.changeSource: missing source "${r}"`);return}const u=this.getGeoJson();this.removeGeoJson(),this.source=s,this.order=this.getFreeOrder(),this.addGeoJson(u),this.markers.forEach(l=>{l.instance instanceof Vi&&l.instance.changeSource({sourceName:r,atomic:e})})}delete(){this.removeGeoJson(),this.removeMarkers(),this.id="no-id",this.orders=this.getEmptyOrders()}}const mE=n=>Pt(n)&&n.action==="before_create",vE=n=>Pt(n)&&n.action==="before_update",yE=["on","off"],pu=n=>Pt(n)&&n.type==="control"&&yE.includes(n.action),Pt=n=>!!(n&&typeof n=="object"&&"level"in n&&"type"in n&&"action"in n),Ma=n=>Pt(n)&&er(n.action,hp),pe="gm";class Ia{constructor(r){O(this,"gm");this.gm=r}trackExclusiveModes(r){if(r.action!=="mode_start")return;const{sectionName:e,modeName:s}=this.getControlIds(r)||{},u=this.getControl(r);u!=null&&u.settings.exclusive&&this.gm.control.eachControlWithOptions(l=>{const f=l.control.type,h=l.control.targetMode;f===e&&h===s||l.controlOptions.active&&l.control.settings.exclusive&&this.gm.options.disableMode(f,h)})}trackRelatedModes(r){Ma(r)&&this.gm.control.eachControlWithOptions(e=>{var u;const s=e.control;(u=s.settings.enabledBy)!=null&&u.includes(r.mode)&&(r.action==="mode_start"?this.gm.options.enableMode(s.type,s.targetMode):r.action==="mode_end"?this.gm.options.disableMode(s.type,s.targetMode):ie.error("Unknown mode action",r.action))})}getControl(r){const{modeName:e,sectionName:s}=this.getControlIds(r)||{};return e&&s?this.gm.control.getControl({actionType:s,modeName:e}):null}getControlOptions(r){const{modeName:e,sectionName:s}=this.getControlIds(r)||{};return e&&s?this.gm.options.getControlOptions({actionType:s,modeName:e}):null}getControlIds(r){let e=null,s=null;return r.action==="mode_start"?(e=r.type,s=r.mode):pu(r)&&(e=r.section,s=r.target),e&&s?{sectionName:e,modeName:s}:null}}class af{isInstanceAvailable(){return this.sourceInstance?!0:(ie.error("Source instance is not available"),!1)}}const _E=["intersection_violation","containment_violation"],Xi=n=>Pt(n)&&n.type==="helper",EE=n=>Xi(n)&&n.mode==="geofencing"&&er(n.action,_E),xE=["draw","edit","helper"];class La{constructor(r){O(this,"gm");O(this,"options",[]);O(this,"actions",[]);O(this,"flags",{featureCreateAllowed:!0,featureUpdateAllowed:!0});O(this,"internalMapEventHandlers",{[`${pe}:helper`]:this.handleHelperEvent.bind(this)});this.gm=r}startAction(){this.gm.events.bus.attachEvents(this.internalMapEventHandlers),this.gm.events.bus.attachEvents(this.mapEventHandlers),this.onStartAction()}endAction(){this.onEndAction(),this.gm.events.bus.detachEvents(this.mapEventHandlers),this.gm.events.bus.detachEvents(this.internalMapEventHandlers)}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}getOptionValue(r){const e=this.options.find(s=>s.name===r);if(!e)throw new Error(`Option ${r} not found`);if(e.type==="toggle")return e.value;if(e.type==="select")return e.value.value;throw new Error(`Unknown option type: ${JSON.stringify(e)}`)}applyOptionValue(r,e){const s=this.options.find(u=>u.name===r);if(!s){ie.error("Option not found",r,e);return}if(s.type==="toggle"&&typeof e=="boolean")s.value=e;else if(s.type==="select"){const u=s.choices.find(l=>l.value===e);u&&(s.value=u)}else ie.error("Can't apply option value",r,e,s)}handleHelperEvent(r){return EE(r)?this.handleGeofencingViolationEvent(r):{next:!0}}handleGeofencingViolationEvent(r){return r.actionType==="draw"?this.flags.featureCreateAllowed=!1:r.actionType==="edit"&&(this.flags.featureUpdateAllowed=!1),{next:!0}}fireBeforeFeatureCreate({geoJsonFeatures:r,forceMode:e=void 0}){this.flags.featureCreateAllowed=!0;const s={level:"system",type:this.actionType,mode:e||this.mode,action:"before_create",geoJsonFeatures:r};this.gm.events.fire(`${pe}:${this.actionType}`,s)}fireBeforeFeatureUpdate({features:r,geoJsonFeatures:e,forceMode:s=void 0}){this.flags.featureUpdateAllowed=!0;const u={level:"system",type:this.actionType,mode:s||this.mode,action:"before_update",features:r,geoJsonFeatures:e};this.gm.events.fire(`${pe}:${this.actionType}`,u)}}const ba=n=>Pt(n)&&n.type==="draw",wE=n=>Pt(n)&&n.type==="draw"&&"variant"in n&&n.variant===null,mu=n=>Pt(n)&&n.type==="draw"&&"variant"in n&&n.variant==="line_drawer",kE=n=>Pt(n)&&n.type==="draw"&&"variant"in n&&n.variant==="freehand_drawer",ri=["marker","ellipse","circle","circle_marker","text_marker","line","rectangle","polygon"],of=["freehand","custom_shape"],vu=[...ri,...of];class kn extends La{constructor(){super(...arguments);O(this,"actionType","draw");O(this,"shape",null);O(this,"featureData",null)}saveFeature(){if(this.featureData){const e=this.featureData.getGeoJson();this.removeTmpFeature(),this.gm.features.createFeature({sourceName:se.main,shapeGeoJson:e})}else ie.error("BaseDraw.saveFeature: no featureData to save")}removeTmpFeature(){this.featureData&&(this.featureData.temporary||ie.error("Not a temporary feature to remove",this.featureData),this.gm.features.delete(this.featureData),this.featureData=null)}fireMarkerPointerStartEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,s={level:"system",variant:null,type:"draw",mode:this.shape,action:"start",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${pe}:draw`,s)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,s={level:"system",variant:null,type:"draw",mode:this.shape,action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${pe}:draw`,s)}fireMarkerPointerFinishEvent(){if(!this.shape)return;const e={level:"system",variant:null,type:"draw",mode:this.shape,action:"finish"};this.gm.events.fire(`${pe}:draw`,e)}forwardLineDrawerEvent(e){if(!mu(e)||!this.shape)return{next:!0};if(e.action==="start"||e.action==="update"){const s={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${pe}:draw`,s)}else if(e.action==="finish"||e.action==="cancel"){const s={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action};this.gm.events.fire(`${pe}:draw`,s)}return{next:!0}}}const uf=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove","touchcancel"],SE=["load"];function ME(n){return uf.includes(n)}function IE(n){return SE.includes(n)}const lf=n=>!!(n&&typeof n=="object"&&"once"in n&&typeof n.once=="function"),Ke=(n,r={warning:!1})=>{if(!n)return r.warning&&ie.warn("Empty event",n),!1;const e=typeof n=="object"&&"lngLat"in n&&"point"in n&&"type"in n&&"originalEvent"in n&&typeof n.type=="string"&&uf.includes(n.type);return!e&&r.warning&&ie.warn("Not a pointer event",n),e},se={main:`${pe}_main`,temporary:`${pe}_temporary`},ar="_gmid";class LE{constructor(r){O(this,"gm");O(this,"featureCounter",0);O(this,"featureStore",new Map);O(this,"featureStoreAllowedSources",[se.main,se.temporary]);O(this,"autoUpdatesEnabled",!0);O(this,"diffUpdatesEnabled",!0);O(this,"sources");O(this,"defaultSourceName",se.main);O(this,"updateStorage");O(this,"delayedSourceUpdateMethods");O(this,"layers");this.gm=r,this.sources=Object.fromEntries(Ti(se).map(e=>[e,null])),this.updateStorage=Object.fromEntries(Ti(se).map(e=>[e,{add:[],remove:[],update:[]}])),this.delayedSourceUpdateMethods=Object.fromEntries(Ti(se).map(e=>[e,{throttled:this.getDelayedSourceUpdateMethod({sourceName:e,type:"throttled"}),debounced:this.getDelayedSourceUpdateMethod({sourceName:e,type:"debounced"})}])),this.layers=[]}init(){if(Object.values(this.sources).some(r=>r!==null)){ie.warn("features.init(): features are already initialized");return}ot(this.sources).forEach(r=>{this.sources[r]=this.createSource(r)}),this.layers=this.createLayers()}get forEach(){return this.filteredForEach(r=>!r.temporary)}get tmpForEach(){return this.filteredForEach(r=>r.temporary)}getNewFeatureId(){return this.featureCounter+=1,`feature-${this.featureCounter}`}filteredForEach(r){return e=>{this.featureStore.forEach((s,u,l)=>{r(s)&&e(s,u,l)})}}has(r,e){const s=this.featureStore.get(e);return!!s&&(s==null?void 0:s.source)===this.sources[r]}get(r,e){const s=this.featureStore.get(e)||null;return(s==null?void 0:s.source)===this.sources[r]?s:null}add(r){if(this.featureStore.has(r.id)){ie.error(`features.add: feature with the id "${r.id}" already exists`);return}this.featureStoreAllowedSources.includes(r.source.id)&&this.featureStore.set(r.id,r)}setDefaultSourceName(r){this.defaultSourceName=r}getDelayedSourceUpdateMethod({sourceName:r,type:e}){if(e==="throttled")return ih(()=>this.updateSourceByStorage(r),2*this.gm.options.settings.throttlingDelay,{leading:!1,trailing:!0});if(e==="debounced")return Vo(()=>this.updateSourceByStorage(r),2*this.gm.options.settings.throttlingDelay,{leading:!0,trailing:!1});throw new Error("Features: getDelayedSourceUpdateMethod: invalid type")}updateSourceByStorage(r){const e=this.sources[r],s=this.updateStorage[r],u=Object.values(s).some(l=>l.length);e&&u&&(e.updateData(s),this.resetDiffStorage(r))}resetDiffStorage(r){const e=this.updateStorage[r];e.add=[],e.remove=[],e.update=[]}withAtomicSourcesUpdate(r){try{return this.autoUpdatesEnabled=!1,r()}finally{Ti(se).forEach(e=>{this.updateSourceByStorage(e)}),this.autoUpdatesEnabled=!0}}updateSourceData({diff:r,sourceName:e}){this.gm.features.diffUpdatesEnabled?this.updateSourceDataWithDiff({diff:r,sourceName:e}):this.setSourceData({diff:r,sourceName:e})}updateSourceDataWithDiff({diff:r,sourceName:e}){const s=this.updateStorage[e];r.add&&(s.add=s.add.concat(r.add)),r.update&&(s.update=s.update.concat(r.update)),r.remove&&(s.remove=s.remove.concat(r.remove)),this.gm.features.autoUpdatesEnabled&&(this.delayedSourceUpdateMethods[e].throttled(),this.delayedSourceUpdateMethods[e].debounced())}setSourceData({sourceName:r}){ie.warn("Review this Features.setSourceData() method");const e=this.getSourceGeoJson(r);e.features=e.features.filter(s=>!!s),this.setSourceGeoJson({geoJson:e,sourceName:r})}createSource(r){const e=this.gm.mapAdapter.addSource(r,{type:"FeatureCollection",features:[]});if(e)return e;throw new Error(`Features: failed to create the source: "${r}"`)}delete(r){let e;r instanceof Vi?e=r:e=this.featureStore.get(r)||null,e?(e.removeMarkers(),e.removeGeoJson(),this.featureStore.delete(e.id)):ie.error(`features.delete: feature "${r}" not found`)}getFeatureByMouseEvent({event:r,sourceNames:e}){if(!Ke(r,{warning:!0}))return null;const s=[r.point.x,r.point.y],u=this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:s,sourceNames:e});return u.length?u[0]:null}getFeaturesByGeoJsonBounds({geoJson:r,sourceNames:e}){const s=Qo(r),u=this.gm.mapAdapter.coordBoundsToScreenBounds(s);return this.getFeaturesByScreenBounds({bounds:u,sourceNames:e})}getFeaturesByScreenBounds({bounds:r,sourceNames:e}){return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:r,sourceNames:e})}createFeature({featureId:r,shapeGeoJson:e,parent:s,sourceName:u,imported:l}){const f=this.sources[u];if(!f)return ie.error("Features.createFeature Missing source for feature creation"),null;const h=r||e.properties[ar]||this.getNewFeatureId();if(this.featureStore.get(h))return ie.error(`Features.createFeature: feature with the id "${h}" already exists`,this.featureStore.get(h)),null;const m=new Vi({gm:this.gm,id:h,parent:s||null,source:f,geoJsonShapeFeature:an(e)});return this.add(m),!m.temporary&&!l&&this.fireFeatureCreatedEvent(m),this.featureCounter+=1,m}importGeoJson(r){const e="features"in r?r.features:[r],s={stats:{total:0,success:0,failed:0},addedFeatures:[]};return e.forEach(u=>{let l=null;s.stats.total+=1;const f=dE(u);f&&(l=this.importGeoJsonFeature(f)),l?(s.addedFeatures.push(l),s.stats.success+=1):s.stats.failed+=1}),s}importGeoJsonFeature(r){const e=this.defaultSourceName,s=this.getFeatureShapeByGeoJson(r);if(!s)return ie.error("features.addGeoJsonFeature: unknown shape",s),null;const u=r.id||`${e}-feature-${this.featureCounter}`;return this.createFeature({featureId:r.id,shapeGeoJson:{...r,properties:{...r.properties,[ar]:u,shape:s}},sourceName:e,imported:!0})}getAll(){return this.exportGeoJson()}exportGeoJson({allowedShapes:r}={allowedShapes:void 0}){return this.asGeoJsonFeatureCollection({sourceNames:[se.main],shapeTypes:r||[...ri]})}getSourceGeoJson(r){const e=this.sources[r];if(!e)throw new Error(`getSourceGeoJson: missing source "${r}"`);return e.getGeoJson()}setSourceGeoJson({geoJson:r,sourceName:e}){const s=this.sources[e];if(!s)throw new Error(`setSourceGeoJson: missing source "${e}"`);s.setGeoJson(r)}asGeoJsonFeatureCollection({shapeTypes:r,sourceNames:e}){const s={type:"FeatureCollection",features:[]};return e.forEach(u=>{const l=this.sources[u];l&&l.getGeoJson().features.filter(h=>!!h).forEach(h=>{if(r===void 0||r.includes(h.properties.shape)){const m=this.featureStore.has(h.properties._gmid??"")?sf(this.featureStore.get(h.properties._gmid)):{};s.features.push({...h,properties:{...h.properties,...m}})}})}),s}convertSourceToGm(r){const e=[],s=r.getGeoJson(),u="features"in s?s.features:[s];return this.gm.mapAdapter.getSource(r.id).remove({removeLayers:!1}),u.forEach(f=>{const h=this.addGeoJsonFeature({shapeGeoJson:f,defaultSource:!0});h&&e.push(h)}),e}addGeoJsonFeature({shapeGeoJson:r,sourceName:e,defaultSource:s}){let u;if(s?(u=this.defaultSourceName,e&&ie.warn("features.addGeoJsonFeature: default source is set, sourceName is ignored")):u=e||null,!u)return ie.error("features.addGeoJsonFeature: missing sourceName"),null;const l=this.getFeatureShapeByGeoJson(r);return l?this.createFeature({featureId:r.id,shapeGeoJson:{...r,properties:{...r.properties,shape:l}},sourceName:u}):(ie.error("features.addGeoJsonFeature: unknown shape",l),null)}createLayers(){const r=[];return ot(this.sources).forEach(e=>{ot(this.gm.options.layerStyles).forEach(s=>{this.gm.options.layerStyles[s][e].forEach(l=>{const f=this.createGenericLayer({layerId:`${e}-${s}__${l.type}-layer`,partialStyle:l,shape:s,sourceName:e});f&&r.push(f)})})}),r}createGenericLayer({layerId:r,sourceName:e,partialStyle:s,shape:u}){const l={...s,id:r,source:e,filter:["in",["get","shape"],["literal",[u]]]};return this.gm.mapAdapter.addLayer(l)}getFeatureShapeByGeoJson(r){const e={Point:"marker",LineString:"line",Polygon:"polygon",MultiPolygon:"polygon"},s=r.properties;return s!=null&&s.shape&&ri.includes(s==null?void 0:s.shape)?s==null?void 0:s.shape:e[r.geometry.type]||null}createMarkerFeature({parentFeature:r,coordinate:e,type:s,sourceName:u}){return this.createFeature({sourceName:u,parent:r,shapeGeoJson:{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{shape:`${s}_marker`}}})}updateMarkerFeaturePosition(r,e){r.updateGeoJsonGeometry({type:"Point",coordinates:e})}fireFeatureCreatedEvent(r){if(er(r.shape,ri)){const e={level:"system",type:"draw",mode:r.shape,action:"feature_created",featureData:r};this.gm.events.fire(`${pe}:draw`,e)}}}const cf=n=>[{type:"circle",paint:{"circle-radius":n.circleMarkerRadius,"circle-color":n.fillColor,"circle-opacity":n.fillOpacity,"circle-stroke-color":n.lineColor,"circle-stroke-width":n.lineWidth,"circle-stroke-opacity":n.lineOpacity}}],Aa=n=>[{type:"circle",paint:{"circle-radius":7,"circle-color":"#ffffff","circle-opacity":1,"circle-stroke-color":n.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],hf=n=>[{type:"line",paint:{"line-color":n.lineColor,"line-opacity":n.lineOpacity,"line-width":n.lineWidth}}],ff=()=>[{type:"symbol",layout:{"icon-image":"default-marker","icon-size":.18,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}],or=n=>[{type:"fill",paint:{"fill-color":n.fillColor,"fill-opacity":n.fillOpacity}},{type:"line",paint:{"line-color":n.lineColor,"line-opacity":n.lineOpacity,"line-width":n.lineWidth}}],gf=n=>[{type:"circle",paint:{"circle-radius":6,"circle-color":"#ffffff","circle-opacity":.6,"circle-stroke-color":n.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],df=()=>[{type:"line",paint:{"line-color":"#00979f","line-width":1.8,"line-dasharray":[2,1]}}],pf=()=>[{type:"symbol",layout:{"text-field":["get","text"],"text-justify":"center"},paint:{"text-color":"black","text-halo-color":"#fff","text-halo-width":2}}],it={[se.main]:{lineColor:"#278cda",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[se.temporary]:{lineColor:"#ff5600",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10}},mf={polygon:{[se.main]:or(it[se.main]),[se.temporary]:or(it[se.temporary])},ellipse:{[se.main]:or(it[se.main]),[se.temporary]:or(it[se.temporary])},rectangle:{[se.main]:or(it[se.main]),[se.temporary]:or(it[se.temporary])},circle:{[se.main]:or(it[se.main]),[se.temporary]:or(it[se.temporary])},circle_marker:{[se.main]:cf(it[se.main]),[se.temporary]:cf(it[se.temporary])},line:{[se.main]:hf(it[se.main]),[se.temporary]:hf(it[se.temporary])},marker:{[se.temporary]:ff(),[se.main]:ff()},text_marker:{[se.main]:pf(),[se.temporary]:pf()},dom_marker:{[se.main]:[],[se.temporary]:[]},center_marker:{[se.main]:Aa(it[se.main]),[se.temporary]:Aa(it[se.temporary])},vertex_marker:{[se.main]:Aa(it[se.main]),[se.temporary]:Aa(it[se.temporary])},edge_marker:{[se.main]:gf(it[se.main]),[se.temporary]:gf(it[se.temporary])},snap_guide:{[se.main]:df(),[se.temporary]:df()}},bE={settings:{throttlingDelay:10,controlsPosition:"top-left"},layerStyles:mf,controls:{draw:{marker:{title:"Marker",icon:ht.marker,uiEnabled:!0,active:!1},circle_marker:{title:"Circle Marker",icon:ht.circle_marker,uiEnabled:!0,active:!1},text_marker:{title:"Text Marker",icon:ht.text_marker,uiEnabled:!0,active:!1},circle:{title:"Circle",icon:ht.circle,uiEnabled:!0,active:!1},ellipse:{title:"Ellipse",icon:ht.ellipse,uiEnabled:!0,active:!1},line:{title:"Line",icon:ht.line,uiEnabled:!0,active:!1},rectangle:{title:"Rectangle",icon:ht.rectangle,uiEnabled:!0,active:!1},polygon:{title:"Polygon",icon:ht.polygon,uiEnabled:!0,active:!1}},edit:{drag:{title:"Drag",icon:ht.drag,uiEnabled:!0,active:!1},change:{title:"Change",icon:ht.change,uiEnabled:!0,active:!1},rotate:{title:"Rotate",icon:ht.rotate,uiEnabled:!0,active:!1},cut:{title:"Cut",icon:ht.cut,uiEnabled:!0,active:!1},delete:{title:"Delete",icon:ht.delete,uiEnabled:!0,active:!1}},helper:{shape_markers:{title:"Shape markers",icon:null,uiEnabled:!0,active:!1},snapping:{title:"Snapping",icon:ht.snapping,uiEnabled:!0,active:!1},zoom_to_features:{title:"Zoom to features",icon:ht.zoom_to_features,uiEnabled:!0,active:!1}}}},vf=()=>an(bE),yf=!1;var yu=Array.isArray,AE=Array.prototype.indexOf,_u=Array.from,_f=Object.defineProperty,Wi=Object.getOwnPropertyDescriptor,Ef=Object.getOwnPropertyDescriptors,CE=Object.prototype,TE=Array.prototype,Eu=Object.getPrototypeOf;const ii=()=>{};function NE(n){return n()}function xu(n){for(var r=0;r<n.length;r++)n[r]()}const on=2,xf=4,Ca=8,wu=16,Un=32,Zi=64,Ta=128,qt=256,Na=512,yt=1024,zn=2048,si=4096,qn=8192,Pa=16384,PE=32768,ku=65536,OE=1<<19,wf=1<<20,Ar=Symbol("$state"),RE=Symbol("");let Oa=[];function DE(){var n=Oa;Oa=[],xu(n)}function FE(n){Oa.length===0&&queueMicrotask(DE),Oa.push(n)}function kf(n){return n===this.v}function Sf(n,r){return n!=n?r==r:n!==r||n!==null&&typeof n=="object"||typeof n=="function"}function Mf(n){return!Sf(n,this.v)}function GE(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function BE(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function UE(n){throw new Error("https://svelte.dev/e/effect_orphan")}function zE(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function qE(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function YE(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function HE(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function JE(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ji=!1,VE=!1;function XE(){ji=!0}const Su=1,Mu=2,If=4,WE=8,ZE=16,jE=1,$E=2,St=Symbol();function Iu(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let Re=null;function Lf(n){Re=n}function Lu(n){return KE().get(n)}function ai(n,r=!1,e){Re={p:Re,c:null,e:null,m:!1,s:n,x:null,l:null},ji&&!r&&(Re.l={s:null,u:null,r1:[],r2:Ot(!1)})}function oi(n){const r=Re;if(r!==null){const f=r.e;if(f!==null){var e=Ge,s=Fe;r.e=null;try{for(var u=0;u<f.length;u++){var l=f[u];hr(l.effect),cr(l.reaction),Xa(l.fn)}}finally{hr(e),cr(s)}}Re=r.p,r.m=!0}return{}}function Ra(){return!ji||Re!==null&&Re.l===null}function KE(n){return Re===null&&Iu(),Re.c??(Re.c=new Map(QE(Re)||void 0))}function QE(n){let r=n.p;for(;r!==null;){const e=r.c;if(e!==null)return e;r=r.p}return null}function Ot(n,r){var e={f:0,v:n,reactions:null,equals:kf,rv:0,wv:0};return e}function bf(n){return Af(Ot(n))}function bu(n,r=!1){var s;const e=Ot(n);return r||(e.equals=Mf),ji&&Re!==null&&Re.l!==null&&((s=Re.l).s??(s.s=[])).push(e),e}function ex(n,r=!1){return Af(bu(n,r))}function Af(n){return Fe!==null&&!un&&(Fe.f&on)!==0&&(Mn===null?ox([n]):Mn.push(n)),n}function ut(n,r){return Fe!==null&&!un&&Ra()&&(Fe.f&(on|wu))!==0&&(Mn===null||!Mn.includes(n))&&JE(),Au(n,r)}function Au(n,r){return n.equals(r)||(n.v,n.v=r,n.wv=qf(),Cf(n,zn),Ra()&&Ge!==null&&(Ge.f&yt)!==0&&(Ge.f&(Un|Zi))===0&&(Yn===null?ux([n]):Yn.push(n))),r}function Cf(n,r){var e=n.reactions;if(e!==null)for(var s=Ra(),u=e.length,l=0;l<u;l++){var f=e[l],h=f.f;(h&zn)===0&&(!s&&f===Ge||(In(f,r),(h&(yt|qt))!==0&&((h&on)!==0?Cf(f,si):Va(f))))}}function Cu(n){var r=on|zn,e=Fe!==null&&(Fe.f&on)!==0?Fe:null;return Ge===null||e!==null&&(e.f&qt)!==0?r|=qt:Ge.f|=wf,{ctx:Re,deps:null,effects:null,equals:kf,f:r,fn:n,reactions:null,rv:0,v:null,wv:0,parent:e??Ge}}function Tf(n){const r=Cu(n);return r.equals=Mf,r}function Nf(n){var r=n.effects;if(r!==null){n.effects=null;for(var e=0;e<r.length;e+=1)Jn(r[e])}}function tx(n){for(var r=n.parent;r!==null;){if((r.f&on)===0)return r;r=r.parent}return null}function nx(n){var r,e=Ge;hr(tx(n));try{Nf(n),r=Hf(n)}finally{hr(e)}return r}function Pf(n){var r=nx(n),e=(fr||(n.f&qt)!==0)&&n.deps!==null?si:yt;In(n,e),n.equals(r)||(n.v=r,n.wv=qf())}let rx=!1;function Sn(n,r=null,e){if(typeof n!="object"||n===null||Ar in n)return n;const s=Eu(n);if(s!==CE&&s!==TE)return n;var u=new Map,l=yu(n),f=Ot(0);l&&u.set("length",Ot(n.length));var h;return new Proxy(n,{defineProperty(m,d,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&qE();var y=u.get(d);return y===void 0?(y=Ot(v.value),u.set(d,y)):ut(y,Sn(v.value,h)),!0},deleteProperty(m,d){var v=u.get(d);if(v===void 0)d in m&&u.set(d,Ot(St));else{if(l&&typeof d=="string"){var y=u.get("length"),E=Number(d);Number.isInteger(E)&&E<y.v&&ut(y,E)}ut(v,St),Of(f)}return!0},get(m,d,v){var M;if(d===Ar)return n;var y=u.get(d),E=d in m;if(y===void 0&&(!E||(M=Wi(m,d))!=null&&M.writable)&&(y=Ot(Sn(E?m[d]:St,h)),u.set(d,y)),y!==void 0){var S=Te(y);return S===St?void 0:S}return Reflect.get(m,d,v)},getOwnPropertyDescriptor(m,d){var v=Reflect.getOwnPropertyDescriptor(m,d);if(v&&"value"in v){var y=u.get(d);y&&(v.value=Te(y))}else if(v===void 0){var E=u.get(d),S=E==null?void 0:E.v;if(E!==void 0&&S!==St)return{enumerable:!0,configurable:!0,value:S,writable:!0}}return v},has(m,d){var S;if(d===Ar)return!0;var v=u.get(d),y=v!==void 0&&v.v!==St||Reflect.has(m,d);if(v!==void 0||Ge!==null&&(!y||(S=Wi(m,d))!=null&&S.writable)){v===void 0&&(v=Ot(y?Sn(m[d],h):St),u.set(d,v));var E=Te(v);if(E===St)return!1}return y},set(m,d,v,y){var H;var E=u.get(d),S=d in m;if(l&&d==="length")for(var M=v;M<E.v;M+=1){var D=u.get(M+"");D!==void 0?ut(D,St):M in m&&(D=Ot(St),u.set(M+"",D))}E===void 0?(!S||(H=Wi(m,d))!=null&&H.writable)&&(E=Ot(void 0),ut(E,Sn(v,h)),u.set(d,E)):(S=E.v!==St,ut(E,Sn(v,h)));var U=Reflect.getOwnPropertyDescriptor(m,d);if(U!=null&&U.set&&U.set.call(y,v),!S){if(l&&typeof d=="string"){var G=u.get("length"),I=Number(d);Number.isInteger(I)&&I>=G.v&&ut(G,I+1)}Of(f)}return!0},ownKeys(m){Te(f);var d=Reflect.ownKeys(m).filter(E=>{var S=u.get(E);return S===void 0||S.v!==St});for(var[v,y]of u)y.v!==St&&!(v in m)&&d.push(v);return d},setPrototypeOf(){YE()}})}function Of(n,r=1){ut(n,n.v+r)}function Rf(n){return n!==null&&typeof n=="object"&&Ar in n?n[Ar]:n}function ix(n,r){return Object.is(Rf(n),Rf(r))}var Df,Ff,Gf,Bf;function sx(){if(Df===void 0){Df=window,Ff=/Firefox/.test(navigator.userAgent);var n=Element.prototype,r=Node.prototype;Gf=Wi(r,"firstChild").get,Bf=Wi(r,"nextSibling").get,n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__styles=null,n.__e=void 0,Text.prototype.__t=void 0}}function Da(n=""){return document.createTextNode(n)}function $i(n){return Gf.call(n)}function Fa(n){return Bf.call(n)}function ur(n,r){return $i(n)}function lr(n,r){{var e=$i(n);return e instanceof Comment&&e.data===""?Fa(e):e}}function Ga(n,r=1,e=!1){let s=n;for(;r--;)s=Fa(s);return s}function ax(n){n.textContent=""}let Ba=!1,Tu=!1,Ua=null,za=!1,Nu=!1;function Uf(n){Nu=n}let qa=[],lM=[],Fe=null,un=!1;function cr(n){Fe=n}let Ge=null;function hr(n){Ge=n}let Mn=null;function ox(n){Mn=n}let _t=null,Rt=0,Yn=null;function ux(n){Yn=n}let zf=1,Ya=0,fr=!1;function qf(){return++zf}function Ki(n){var y;var r=n.f;if((r&zn)!==0)return!0;if((r&si)!==0){var e=n.deps,s=(r&qt)!==0;if(e!==null){var u,l,f=(r&Na)!==0,h=s&&Ge!==null&&!fr,m=e.length;if(f||h){var d=n,v=d.parent;for(u=0;u<m;u++)l=e[u],(f||!((y=l==null?void 0:l.reactions)!=null&&y.includes(d)))&&(l.reactions??(l.reactions=[])).push(d);f&&(d.f^=Na),h&&v!==null&&(v.f&qt)===0&&(d.f^=qt)}for(u=0;u<m;u++)if(l=e[u],Ki(l)&&Pf(l),l.wv>n.wv)return!0}(!s||Ge!==null&&!fr)&&In(n,yt)}return!1}function lx(n,r){for(var e=r;e!==null;){if((e.f&Ta)!==0)try{e.fn(n);return}catch{e.f^=Ta}e=e.parent}throw Ba=!1,n}function cx(n){return(n.f&Pa)===0&&(n.parent===null||(n.parent.f&Ta)===0)}function Ha(n,r,e,s){if(Ba){if(e===null&&(Ba=!1),cx(r))throw n;return}e!==null&&(Ba=!0);{lx(n,r);return}}function Yf(n,r,e=!0){var s=n.reactions;if(s!==null)for(var u=0;u<s.length;u++){var l=s[u];(l.f&on)!==0?Yf(l,r,!1):r===l&&(e?In(l,zn):(l.f&yt)!==0&&In(l,si),Va(l))}}function Hf(n){var S;var r=_t,e=Rt,s=Yn,u=Fe,l=fr,f=Mn,h=Re,m=un,d=n.f;_t=null,Rt=0,Yn=null,fr=(d&qt)!==0&&(un||!za||Fe===null),Fe=(d&(Un|Zi))===0?n:null,Mn=null,Lf(n.ctx),un=!1,Ya++;try{var v=(0,n.fn)(),y=n.deps;if(_t!==null){var E;if(Ja(n,Rt),y!==null&&Rt>0)for(y.length=Rt+_t.length,E=0;E<_t.length;E++)y[Rt+E]=_t[E];else n.deps=y=_t;if(!fr)for(E=Rt;E<y.length;E++)((S=y[E]).reactions??(S.reactions=[])).push(n)}else y!==null&&Rt<y.length&&(Ja(n,Rt),y.length=Rt);if(Ra()&&Yn!==null&&!un&&y!==null&&(n.f&(on|si|zn))===0)for(E=0;E<Yn.length;E++)Yf(Yn[E],n);return u!==null&&Ya++,v}finally{_t=r,Rt=e,Yn=s,Fe=u,fr=l,Mn=f,Lf(h),un=m}}function hx(n,r){let e=r.reactions;if(e!==null){var s=AE.call(e,n);if(s!==-1){var u=e.length-1;u===0?e=r.reactions=null:(e[s]=e[u],e.pop())}}e===null&&(r.f&on)!==0&&(_t===null||!_t.includes(r))&&(In(r,si),(r.f&(qt|Na))===0&&(r.f^=Na),Nf(r),Ja(r,0))}function Ja(n,r){var e=n.deps;if(e!==null)for(var s=r;s<e.length;s++)hx(n,e[s])}function Pu(n){var r=n.f;if((r&Pa)===0){In(n,yt);var e=Ge,s=Re,u=za;Ge=n,za=!0;try{(r&wu)!==0?wx(n):Wf(n),Xf(n);var l=Hf(n);n.teardown=typeof l=="function"?l:null,n.wv=zf;var f=n.deps,h;yf&&VE&&n.f&zn}catch(m){Ha(m,n,e,s||n.ctx)}finally{za=u,Ge=e}}}function fx(){try{zE()}catch(n){if(Ua!==null)Ha(n,Ua,null);else throw n}}function gx(){try{for(var n=0;qa.length>0;){n++>1e3&&fx();var r=qa,e=r.length;qa=[];for(var s=0;s<e;s++){var u=r[s];(u.f&yt)===0&&(u.f^=yt);var l=px(u);dx(l)}}}finally{Tu=!1,Ua=null}}function dx(n){var r=n.length;if(r!==0)for(var e=0;e<r;e++){var s=n[e];if((s.f&(Pa|qn))===0)try{Ki(s)&&(Pu(s),s.deps===null&&s.first===null&&s.nodes_start===null&&(s.teardown===null?Zf(s):s.fn=null))}catch(u){Ha(u,s,null,s.ctx)}}}function Va(n){Tu||(Tu=!0,queueMicrotask(gx));for(var r=Ua=n;r.parent!==null;){r=r.parent;var e=r.f;if((e&(Zi|Un))!==0){if((e&yt)===0)return;r.f^=yt}}qa.push(r)}function px(n){for(var r=[],e=n.first;e!==null;){var s=e.f,u=(s&Un)!==0,l=u&&(s&yt)!==0;if(!l&&(s&qn)===0){if((s&xf)!==0)r.push(e);else if(u)e.f^=yt;else{var f=Fe;try{Fe=e,Ki(e)&&Pu(e)}catch(d){Ha(d,e,null,e.ctx)}finally{Fe=f}}var h=e.first;if(h!==null){e=h;continue}}var m=e.parent;for(e=e.next;e===null&&m!==null;)e=m.next,m=m.parent}return r}function Te(n){var r=n.f,e=(r&on)!==0;if(Fe!==null&&!un){Mn!==null&&Mn.includes(n)&&HE();var s=Fe.deps;n.rv<Ya&&(n.rv=Ya,_t===null&&s!==null&&s[Rt]===n?Rt++:_t===null?_t=[n]:(!fr||!_t.includes(n))&&_t.push(n))}else if(e&&n.deps===null&&n.effects===null){var u=n,l=u.parent;l!==null&&(l.f&qt)===0&&(u.f^=qt)}return e&&(u=n,Ki(u)&&Pf(u)),n.v}function Qi(n){var r=un;try{return un=!0,n()}finally{un=r}}const mx=-7169;function In(n,r){n.f=n.f&mx|r}function vx(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Ar in n)Ou(n);else if(!Array.isArray(n))for(let r in n){const e=n[r];typeof e=="object"&&e&&Ar in e&&Ou(e)}}}function Ou(n,r=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!r.has(n)){r.add(n),n instanceof Date&&n.getTime();for(let s in n)try{Ou(n[s],r)}catch{}const e=Eu(n);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const s=Ef(e);for(let u in s){const l=s[u].get;if(l)try{l.call(n)}catch{}}}}}function Jf(n){Ge===null&&Fe===null&&UE(),Fe!==null&&(Fe.f&qt)!==0&&Ge===null&&BE(),Nu&&GE()}function yx(n,r){var e=r.last;e===null?r.last=r.first=n:(e.next=n,n.prev=e,r.last=n)}function ui(n,r,e,s=!0){var u=(n&Zi)!==0,l=Ge,f={ctx:Re,deps:null,nodes_start:null,nodes_end:null,f:n|zn,first:null,fn:r,last:null,next:null,parent:u?null:l,prev:null,teardown:null,transitions:null,wv:0};if(e)try{Pu(f),f.f|=PE}catch(d){throw Jn(f),d}else r!==null&&Va(f);var h=e&&f.deps===null&&f.first===null&&f.nodes_start===null&&f.teardown===null&&(f.f&(wf|Ta))===0;if(!h&&!u&&s&&(l!==null&&yx(f,l),Fe!==null&&(Fe.f&on)!==0)){var m=Fe;(m.effects??(m.effects=[])).push(f)}return f}function _x(n){const r=ui(Ca,null,!1);return In(r,yt),r.teardown=n,r}function Ru(n){Jf();var r=Ge!==null&&(Ge.f&Un)!==0&&Re!==null&&!Re.m;if(r){var e=Re;(e.e??(e.e=[])).push({fn:n,effect:Ge,reaction:Fe})}else{var s=Xa(n);return s}}function Ex(n){return Jf(),Vf(n)}function xx(n){const r=ui(Zi,n,!0);return(e={})=>new Promise(s=>{e.outro?Za(r,()=>{Jn(r),s(void 0)}):(Jn(r),s(void 0))})}function Xa(n){return ui(xf,n,!1)}function Vf(n){return ui(Ca,n,!0)}function Hn(n,r=[],e=Cu){const s=r.map(e);return Wa(()=>n(...s.map(Te)))}function Wa(n,r=0){return ui(Ca|wu|r,n,!0)}function li(n,r=!0){return ui(Ca|Un,n,!0,r)}function Xf(n){var r=n.teardown;if(r!==null){const e=Nu,s=Fe;Uf(!0),cr(null);try{r.call(null)}finally{Uf(e),cr(s)}}}function Wf(n,r=!1){var e=n.first;for(n.first=n.last=null;e!==null;){var s=e.next;Jn(e,r),e=s}}function wx(n){for(var r=n.first;r!==null;){var e=r.next;(r.f&Un)===0&&Jn(r),r=e}}function Jn(n,r=!0){var e=!1;if((r||(n.f&OE)!==0)&&n.nodes_start!==null){for(var s=n.nodes_start,u=n.nodes_end;s!==null;){var l=s===u?null:Fa(s);s.remove(),s=l}e=!0}Wf(n,r&&!e),Ja(n,0),In(n,Pa);var f=n.transitions;if(f!==null)for(const m of f)m.stop();Xf(n);var h=n.parent;h!==null&&h.first!==null&&Zf(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=null}function Zf(n){var r=n.parent,e=n.prev,s=n.next;e!==null&&(e.next=s),s!==null&&(s.prev=e),r!==null&&(r.first===n&&(r.first=s),r.last===n&&(r.last=e))}function Za(n,r){var e=[];Du(n,e,!0),jf(e,()=>{Jn(n),r&&r()})}function jf(n,r){var e=n.length;if(e>0){var s=()=>--e||r();for(var u of n)u.out(s)}else r()}function Du(n,r,e){if((n.f&qn)===0){if(n.f^=qn,n.transitions!==null)for(const f of n.transitions)(f.is_global||e)&&r.push(f);for(var s=n.first;s!==null;){var u=s.next,l=(s.f&ku)!==0||(s.f&Un)!==0;Du(s,r,l?e:!1),s=u}}}function ja(n){$f(n,!0)}function $f(n,r){if((n.f&qn)!==0){n.f^=qn,(n.f&yt)===0&&(n.f^=yt),Ki(n)&&(In(n,zn),Va(n));for(var e=n.first;e!==null;){var s=e.next,u=(e.f&ku)!==0||(e.f&Un)!==0;$f(e,u?r:!1),e=s}if(n.transitions!==null)for(const l of n.transitions)(l.is_global||r)&&l.in()}}const kx=["touchstart","touchmove"];function Sx(n){return kx.includes(n)}let Kf=!1;function Mx(){Kf||(Kf=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{var r;if(!n.defaultPrevented)for(const e of n.target.elements)(r=e.__on_r)==null||r.call(e)})},{capture:!0}))}function Ix(n){var r=Fe,e=Ge;cr(null),hr(null);try{return n()}finally{cr(r),hr(e)}}function Qf(n,r,e,s=e){n.addEventListener(r,()=>Ix(e));const u=n.__on_r;u?n.__on_r=()=>{u(),s(!0)}:n.__on_r=()=>s(!0),Mx()}const eg=new Set,Fu=new Set;function Gu(n){for(var r=0;r<n.length;r++)eg.add(n[r]);for(var e of Fu)e(n)}function $a(n){var I;var r=this,e=r.ownerDocument,s=n.type,u=((I=n.composedPath)==null?void 0:I.call(n))||[],l=u[0]||n.target,f=0,h=n.__root;if(h){var m=u.indexOf(h);if(m!==-1&&(r===document||r===window)){n.__root=r;return}var d=u.indexOf(r);if(d===-1)return;m<=d&&(f=m)}if(l=u[f]||n.target,l!==r){_f(n,"currentTarget",{configurable:!0,get(){return l||e}});var v=Fe,y=Ge;cr(null),hr(null);try{for(var E,S=[];l!==null;){var M=l.assignedSlot||l.parentNode||l.host||null;try{var D=l["__"+s];if(D!==void 0&&(!l.disabled||n.target===l))if(yu(D)){var[U,...G]=D;U.apply(l,[n,...G])}else D.call(l,n)}catch(H){E?S.push(H):E=H}if(n.cancelBubble||M===r||M===null)break;l=M}if(E){for(let H of S)queueMicrotask(()=>{throw H});throw E}}finally{n.__root=r,delete n.currentTarget,cr(v),hr(y)}}}function tg(n){var r=document.createElement("template");return r.innerHTML=n,r.content}function es(n,r){var e=Ge;e.nodes_start===null&&(e.nodes_start=n,e.nodes_end=r)}function ln(n,r){var e=(r&jE)!==0,s=(r&$E)!==0,u,l=!n.startsWith("<!>");return()=>{u===void 0&&(u=tg(l?n:"<!>"+n),e||(u=$i(u)));var f=s||Ff?document.importNode(u,!0):u.cloneNode(!0);if(e){var h=$i(f),m=f.lastChild;es(h,m)}else es(f,f);return f}}function ng(n=""){{var r=Da(n+"");return es(r,r),r}}function ci(){var n=document.createDocumentFragment(),r=document.createComment(""),e=Da();return n.append(r,e),es(r,e),n}function et(n,r){n!==null&&n.before(r)}function hi(n,r){var e=r==null?"":typeof r=="object"?r+"":r;e!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=e,n.nodeValue=e+"")}function Lx(n,r){return bx(n,r)}const fi=new Map;function bx(n,{target:r,anchor:e,props:s={},events:u,context:l,intro:f=!0}){sx();var h=new Set,m=y=>{for(var E=0;E<y.length;E++){var S=y[E];if(!h.has(S)){h.add(S);var M=Sx(S);r.addEventListener(S,$a,{passive:M});var D=fi.get(S);D===void 0?(document.addEventListener(S,$a,{passive:M}),fi.set(S,1)):fi.set(S,D+1)}}};m(_u(eg)),Fu.add(m);var d=void 0,v=xx(()=>{var y=e??r.appendChild(Da());return li(()=>{if(l){ai({});var E=Re;E.c=l}u&&(s.$$events=u),d=n(y,s)||{},l&&oi()}),()=>{var M;for(var E of h){r.removeEventListener(E,$a);var S=fi.get(E);--S===0?(document.removeEventListener(E,$a),fi.delete(E)):fi.set(E,S)}Fu.delete(m),y!==e&&((M=y.parentNode)==null||M.removeChild(y))}});return Bu.set(d,v),d}let Bu=new WeakMap;function Ax(n,r){const e=Bu.get(n);return e?(Bu.delete(n),e(r)):Promise.resolve()}function Ln(n,r,[e,s]=[0,0]){var u=n,l=null,f=null,h=St,m=e>0?ku:0,d=!1;const v=(E,S=!0)=>{d=!0,y(S,E)},y=(E,S)=>{h!==(h=E)&&(h?(l?ja(l):S&&(l=li(()=>S(u))),f&&Za(f,()=>{f=null})):(f?ja(f):S&&(f=li(()=>S(u,[e+1,s]))),l&&Za(l,()=>{l=null})))};Wa(()=>{d=!1,r(v),d||y(null,null)},m)}function ts(n,r){return r}function Cx(n,r,e,s){for(var u=[],l=r.length,f=0;f<l;f++)Du(r[f].e,u,!0);var h=l>0&&u.length===0&&e!==null;if(h){var m=e.parentNode;ax(m),m.append(e),s.clear(),gr(n,r[0].prev,r[l-1].next)}jf(u,()=>{for(var d=0;d<l;d++){var v=r[d];h||(s.delete(v.k),gr(n,v.prev,v.next)),Jn(v.e,!h)}})}function ns(n,r,e,s,u,l=null){var f=n,h={flags:r,items:new Map,first:null},m=(r&If)!==0;if(m){var d=n;f=d.appendChild(Da())}var v=null,y=!1,E=Tf(()=>{var S=e();return yu(S)?S:S==null?[]:_u(S)});Wa(()=>{var S=Te(E),M=S.length;y&&M===0||(y=M===0,Tx(S,h,f,u,r,s,e),l!==null&&(M===0?v?ja(v):v=li(()=>l(f)):v!==null&&Za(v,()=>{v=null})),Te(E))})}function Tx(n,r,e,s,u,l,f){var P,N,R,Y;var h=(u&WE)!==0,m=(u&(Su|Mu))!==0,d=n.length,v=r.items,y=r.first,E=y,S,M=null,D,U=[],G=[],I,H,J,X;if(h)for(X=0;X<d;X+=1)I=n[X],H=l(I,X),J=v.get(H),J!==void 0&&((P=J.a)==null||P.measure(),(D??(D=new Set)).add(J));for(X=0;X<d;X+=1){if(I=n[X],H=l(I,X),J=v.get(H),J===void 0){var W=E?E.e.nodes_start:e;M=Px(W,r,M,M===null?r.first:M.next,I,H,X,s,u,f),v.set(H,M),U=[],G=[],E=M.next;continue}if(m&&Nx(J,I,X,u),(J.e.f&qn)!==0&&(ja(J.e),h&&((N=J.a)==null||N.unfix(),(D??(D=new Set)).delete(J))),J!==E){if(S!==void 0&&S.has(J)){if(U.length<G.length){var $=G[0],x;M=$.prev;var k=U[0],b=U[U.length-1];for(x=0;x<U.length;x+=1)rg(U[x],$,e);for(x=0;x<G.length;x+=1)S.delete(G[x]);gr(r,k.prev,b.next),gr(r,M,k),gr(r,b,$),E=$,M=b,X-=1,U=[],G=[]}else S.delete(J),rg(J,E,e),gr(r,J.prev,J.next),gr(r,J,M===null?r.first:M.next),gr(r,M,J),M=J;continue}for(U=[],G=[];E!==null&&E.k!==H;)(E.e.f&qn)===0&&(S??(S=new Set)).add(E),G.push(E),E=E.next;if(E===null)continue;J=E}U.push(J),M=J,E=J.next}if(E!==null||S!==void 0){for(var A=S===void 0?[]:_u(S);E!==null;)(E.e.f&qn)===0&&A.push(E),E=E.next;var T=A.length;if(T>0){var F=(u&If)!==0&&d===0?e:null;if(h){for(X=0;X<T;X+=1)(R=A[X].a)==null||R.measure();for(X=0;X<T;X+=1)(Y=A[X].a)==null||Y.fix()}Cx(r,A,F,v)}}h&&FE(()=>{var z;if(D!==void 0)for(J of D)(z=J.a)==null||z.apply()}),Ge.first=r.first&&r.first.e,Ge.last=M&&M.e}function Nx(n,r,e,s){(s&Su)!==0&&Au(n.v,r),(s&Mu)!==0?Au(n.i,e):n.i=e}function Px(n,r,e,s,u,l,f,h,m,d){var v=(m&Su)!==0,y=(m&ZE)===0,E=v?y?bu(u):Ot(u):u,S=(m&Mu)===0?f:Ot(f),M={i:S,v:E,k:l,a:null,e:null,prev:e,next:s};try{return M.e=li(()=>h(n,E,S,d),rx),M.e.prev=e&&e.e,M.e.next=s&&s.e,e===null?r.first=M:(e.next=M,e.e.next=M.e),s!==null&&(s.prev=M,s.e.prev=M.e),M}finally{}}function rg(n,r,e){for(var s=n.next?n.next.e.nodes_start:e,u=r?r.e.nodes_start:e,l=n.e.nodes_start;l!==s;){var f=Fa(l);u.before(l),l=f}}function gr(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function Ox(n,r,e,s,u){var l=n,f="",h;Wa(()=>{f!==(f=r()??"")&&(h!==void 0&&(Jn(h),h=void 0),f!==""&&(h=li(()=>{var m=f+"",d=tg(m);es($i(d),d.lastChild),l.before(d)})))})}const ig=[...` 	
\r\f\v\uFEFF`];function Rx(n,r,e){var s=n==null?"":""+n;if(r&&(s=s?s+" "+r:r),e){for(var u in e)if(e[u])s=s?s+" "+u:u;else if(s.length)for(var l=u.length,f=0;(f=s.indexOf(u,f))>=0;){var h=f+l;(f===0||ig.includes(s[f-1]))&&(h===s.length||ig.includes(s[h]))?s=(f===0?"":s.substring(0,f))+s.substring(h+1):f=h}}return s===""?null:s}function Uu(n,r,e,s,u,l){var f=n.__className;if(f!==e){var h=Rx(e,s,l);h==null?n.removeAttribute("class"):n.className=h,n.__className=e}else if(l)for(var m in l){var d=!!l[m];(u==null||d!==!!u[m])&&n.classList.toggle(m,d)}return l}function Cr(n,r,e,s){var u=n.__attributes??(n.__attributes={});u[r]!==(u[r]=e)&&(r==="style"&&"__styles"in n&&(n.__styles={}),r==="loading"&&(n[RE]=e),e==null?n.removeAttribute(r):typeof e!="string"&&Dx(n).includes(r)?n[r]=e:n.setAttribute(r,e))}var sg=new Map;function Dx(n){var r=sg.get(n.nodeName);if(r)return r;sg.set(n.nodeName,r=[]);for(var e,s=n,u=Element.prototype;u!==s;){e=Ef(s);for(var l in e)e[l].set&&r.push(l);s=Eu(s)}return r}function Fx(n,r,e=r){Qf(n,"change",s=>{var u=s?n.defaultChecked:n.checked;e(u)}),Qi(r)==null&&e(n.checked),Vf(()=>{var s=r();n.checked=!!s})}function ag(n,r,e){if(n.multiple)return Ux(n,r);for(var s of n.options){var u=rs(s);if(ix(u,r)){s.selected=!0;return}}(!e||r!==void 0)&&(n.selectedIndex=-1)}function Gx(n,r){Xa(()=>{var e=new MutationObserver(()=>{var s=n.__value;ag(n,s)});return e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function Bx(n,r,e=r){var s=!0;Qf(n,"change",u=>{var l=u?"[selected]":":checked",f;if(n.multiple)f=[].map.call(n.querySelectorAll(l),rs);else{var h=n.querySelector(l)??n.querySelector("option:not([disabled])");f=h&&rs(h)}e(f)}),Xa(()=>{var u=r();if(ag(n,u,s),s&&u===void 0){var l=n.querySelector(":checked");l!==null&&(u=rs(l),e(u))}n.__value=u,s=!1}),Gx(n)}function Ux(n,r){for(var e of n.options)e.selected=~r.indexOf(rs(e))}function rs(n){return"__value"in n?n.__value:n.value}function zx(n=!1){const r=Re,e=r.l.u;if(!e)return;let s=()=>vx(r.s);if(n){let u=0,l={};const f=Cu(()=>{let h=!1;const m=r.s;for(const d in m)m[d]!==l[d]&&(l[d]=m[d],h=!0);return h&&u++,u});s=()=>Te(f)}e.b.length&&Ex(()=>{og(r,s),xu(e.b)}),Ru(()=>{const u=Qi(()=>e.m.map(NE));return()=>{for(const l of u)typeof l=="function"&&l()}}),e.a.length&&Ru(()=>{og(r,s),xu(e.a)})}function og(n,r){if(n.l.s)for(const e of n.l.s)Te(e);r()}let zu=Symbol();function qx(n,r,e){const s=e[r]??(e[r]={store:null,source:bu(void 0),unsubscribe:ii});if(s.store!==n&&!(zu in e))if(s.unsubscribe(),s.store=n??null,n==null)s.source.v=void 0,s.unsubscribe=ii;else{var u=!0;s.unsubscribe=lg(n,l=>{u?s.source.v=l:ut(s.source,l)}),u=!1}return n&&zu in e?Xx(n):Te(s.source)}function Yx(){const n={};function r(){_x(()=>{for(var e in n)n[e].unsubscribe();_f(n,zu,{enumerable:!1,value:!0})})}return[n,r]}function ug(n){Re===null&&Iu(),ji&&Re.l!==null?Jx(Re).m.push(n):Ru(()=>{const r=Qi(n);if(typeof r=="function")return r})}function Hx(n){Re===null&&Iu(),ug(()=>()=>Qi(n))}function Jx(n){var r=n.l;return r.u??(r.u={a:[],b:[],m:[]})}function lg(n,r,e){if(n==null)return r(void 0),ii;const s=Qi(()=>n.subscribe(r,e));return s.unsubscribe?()=>s.unsubscribe():s}const gi=[];function Vx(n,r=ii){let e=null;const s=new Set;function u(h){if(Sf(n,h)&&(n=h,e)){const m=!gi.length;for(const d of s)d[1](),gi.push(d,n);if(m){for(let d=0;d<gi.length;d+=2)gi[d][0](gi[d+1]);gi.length=0}}}function l(h){u(h(n))}function f(h,m=ii){const d=[h,m];return s.add(d),s.size===1&&(e=r(u,l)||ii),h(n),()=>{s.delete(d),s.size===0&&e&&(e(),e=null)}}return{set:u,update:l,subscribe:f}}function Xx(n){let r;return lg(n,e=>r=e)(),r}const Wx={controls:an(bl),options:vf().controls},qu=Vx(Wx),Zx="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Zx),XE();const cg=(n,r,e)=>{var s,u;if(!r.actionInstance||!r.actionOption){ie.error("Can't apply option value",r.actionInstance,r.actionOption);return}if(((s=r.actionOption)==null?void 0:s.type)==="toggle"){const l=n.target;ut(e,Sn(l.checked))}else if(((u=r.actionOption)==null?void 0:u.type)==="select"){const l=n.target;ut(e,Sn(l.value))}r.actionInstance.applyOptionValue(r.actionOption.name,Te(e))};var jx=ln("<option> </option>"),$x=ln('<label class="svelte-1892xbw"> </label> <select class="svelte-1892xbw"></select>',1),Kx=ln('<label class="svelte-1892xbw"><input type="checkbox" class="svelte-1892xbw"> </label>'),Qx=ln("<span>Unknown type</span>"),ew=ln('<div class="action-option svelte-1892xbw"><!></div>');function tw(n,r){ai(r,!0);let e=bf("");ug(()=>{r.actionOption&&(r.actionOption.type==="select"?ut(e,Sn(r.actionOption.value.value)):r.actionOption.type==="toggle"&&ut(e,Sn(r.actionOption.value)))});var s=ci(),u=lr(s);{var l=f=>{var h=ew(),m=ur(h);{var d=y=>{var E=$x(),S=lr(E),M=ur(S),D=Ga(S,2);D.__change=[cg,r,e],ns(D,21,()=>r.actionOption.choices,ts,(U,G)=>{var I=jx(),H={},J=ur(I);Hn(()=>{H!==(H=Te(G).value)&&(I.value=(I.__value=Te(G).value)==null?"":Te(G).value),hi(J,Te(G).title)}),et(U,I)}),Hn(()=>{Cr(S,"for",r.actionOption.name),hi(M,r.actionOption.label),Cr(D,"id",r.actionOption.name)}),Bx(D,()=>Te(e),U=>ut(e,U)),et(y,E)},v=(y,E)=>{{var S=D=>{var U=Kx(),G=ur(U);G.__change=[cg,r,e];var I=Ga(G);Hn(H=>{Cr(U,"for",r.actionOption.name),Cr(G,"id",H),hi(I,` ${r.actionOption.label??""}`)},[()=>String(r.actionOption.name)]),Fx(G,()=>Te(e),H=>ut(e,H)),et(D,U)},M=D=>{var U=Qx();et(D,U)};Ln(y,D=>{r.actionOption.type==="toggle"&&typeof Te(e)=="boolean"?D(S):D(M,!1)},E)}};Ln(m,y=>{r.actionOption.type==="select"?y(d):y(v,!1)})}et(f,h)};Ln(u,f=>{r.actionOption&&f(l)})}et(n,s),oi()}Gu(["change"]);const nw=(n,r)=>{if(n.preventDefault(),!r.actionInstance||!r.subAction){ie.error("Can't run a SubAction",r.actionInstance,r.subAction);return}r.subAction.method()};var rw=ln('<button type="submit" class="sub-action svelte-1x28ief"> </button>');function iw(n,r){ai(r,!0);var e=ci(),s=lr(e);{var u=l=>{var f=rw();f.__click=[nw,r];var h=ur(f);Hn(()=>{Cr(f,"title",r.subAction.label),hi(h,r.subAction.label)}),et(l,f)};Ln(s,l=>{r.subAction&&l(u)})}et(n,e),oi()}Gu(["click"]);var sw=ln("<!> <!>",1);function aw(n,r){ai(r,!0);const e=Lu("gm"),s=r.control.type,u=r.control.targetMode;let l=bf(null);s&&u&&ut(l,Sn(e.actionInstances[`${s}__${u}`]||null));var f=ci(),h=lr(f);{var m=d=>{var v=sw(),y=lr(v);ns(y,17,()=>Te(l).options,ts,(S,M)=>{tw(S,{get actionInstance(){return Te(l)},get actionOption(){return Te(M)}})});var E=Ga(y,2);ns(E,17,()=>Te(l).actions,ts,(S,M)=>{iw(S,{get actionInstance(){return Te(l)},get subAction(){return Te(M)}})}),et(d,v)};Ln(h,d=>{Te(l)&&d(m)})}et(n,f),oi()}/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:hg,setPrototypeOf:fg,isFrozen:ow,getPrototypeOf:uw,getOwnPropertyDescriptor:lw}=Object;let{freeze:Et,seal:Yt,create:gg}=Object,{apply:Yu,construct:Hu}=typeof Reflect<"u"&&Reflect;Et||(Et=function(r){return r}),Yt||(Yt=function(r){return r}),Yu||(Yu=function(r,e,s){return r.apply(e,s)}),Hu||(Hu=function(r,e){return new r(...e)});const Ka=wt(Array.prototype.forEach),cw=wt(Array.prototype.lastIndexOf),dg=wt(Array.prototype.pop),is=wt(Array.prototype.push),hw=wt(Array.prototype.splice),Qa=wt(String.prototype.toLowerCase),Ju=wt(String.prototype.toString),pg=wt(String.prototype.match),ss=wt(String.prototype.replace),fw=wt(String.prototype.indexOf),gw=wt(String.prototype.trim),cn=wt(Object.prototype.hasOwnProperty),xt=wt(RegExp.prototype.test),as=dw(TypeError);function wt(n){return function(r){for(var e=arguments.length,s=new Array(e>1?e-1:0),u=1;u<e;u++)s[u-1]=arguments[u];return Yu(n,r,s)}}function dw(n){return function(){for(var r=arguments.length,e=new Array(r),s=0;s<r;s++)e[s]=arguments[s];return Hu(n,e)}}function Me(n,r){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Qa;fg&&fg(n,null);let s=r.length;for(;s--;){let u=r[s];if(typeof u=="string"){const l=e(u);l!==u&&(ow(r)||(r[s]=l),u=l)}n[u]=!0}return n}function pw(n){for(let r=0;r<n.length;r++)cn(n,r)||(n[r]=null);return n}function Tr(n){const r=gg(null);for(const[e,s]of hg(n))cn(n,e)&&(Array.isArray(s)?r[e]=pw(s):s&&typeof s=="object"&&s.constructor===Object?r[e]=Tr(s):r[e]=s);return r}function os(n,r){for(;n!==null;){const s=lw(n,r);if(s){if(s.get)return wt(s.get);if(typeof s.value=="function")return wt(s.value)}n=uw(n)}function e(){return null}return e}const mg=Et(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Vu=Et(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Xu=Et(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),mw=Et(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Wu=Et(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),vw=Et(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),vg=Et(["#text"]),yg=Et(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Zu=Et(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),_g=Et(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),eo=Et(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),yw=Yt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),_w=Yt(/<%[\w\W]*|[\w\W]*%>/gm),Ew=Yt(/\$\{[\w\W]*/gm),xw=Yt(/^data-[\-\w.\u00B7-\uFFFF]+$/),ww=Yt(/^aria-[\-\w]+$/),Eg=Yt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),kw=Yt(/^(?:\w+script|data):/i),Sw=Yt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),xg=Yt(/^html$/i),Mw=Yt(/^[a-z][.\w]*(-[.\w]+)+$/i);var wg=Object.freeze({__proto__:null,ARIA_ATTR:ww,ATTR_WHITESPACE:Sw,CUSTOM_ELEMENT:Mw,DATA_ATTR:xw,DOCTYPE_NAME:xg,ERB_EXPR:_w,IS_ALLOWED_URI:Eg,IS_SCRIPT_OR_DATA:kw,MUSTACHE_EXPR:yw,TMPLIT_EXPR:Ew});const us={element:1,text:3,progressingInstruction:7,comment:8,document:9},Iw=function(){return typeof window>"u"?null:window},Lw=function(r,e){if(typeof r!="object"||typeof r.createPolicy!="function")return null;let s=null;const u="data-tt-policy-suffix";e&&e.hasAttribute(u)&&(s=e.getAttribute(u));const l="dompurify"+(s?"#"+s:"");try{return r.createPolicy(l,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return console.warn("TrustedTypes policy "+l+" could not be created."),null}},kg=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Sg(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Iw();const r=de=>Sg(de);if(r.version="3.2.4",r.removed=[],!n||!n.document||n.document.nodeType!==us.document||!n.Element)return r.isSupported=!1,r;let{document:e}=n;const s=e,u=s.currentScript,{DocumentFragment:l,HTMLTemplateElement:f,Node:h,Element:m,NodeFilter:d,NamedNodeMap:v=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:y,DOMParser:E,trustedTypes:S}=n,M=m.prototype,D=os(M,"cloneNode"),U=os(M,"remove"),G=os(M,"nextSibling"),I=os(M,"childNodes"),H=os(M,"parentNode");if(typeof f=="function"){const de=e.createElement("template");de.content&&de.content.ownerDocument&&(e=de.content.ownerDocument)}let J,X="";const{implementation:W,createNodeIterator:$,createDocumentFragment:x,getElementsByTagName:k}=e,{importNode:b}=s;let A=kg();r.isSupported=typeof hg=="function"&&typeof H=="function"&&W&&W.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:T,ERB_EXPR:F,TMPLIT_EXPR:P,DATA_ATTR:N,ARIA_ATTR:R,IS_SCRIPT_OR_DATA:Y,ATTR_WHITESPACE:z,CUSTOM_ELEMENT:j}=wg;let{IS_ALLOWED_URI:K}=wg,re=null;const me=Me({},[...mg,...Vu,...Xu,...Wu,...vg]);let he=null;const oe=Me({},[...yg,...Zu,..._g,...eo]);let le=Object.seal(gg(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),we=null,Ne=null,V=!0,fn=!0,be=!1,fe=!0,C=!1,De=!0,Oe=!1,Ie=!1,vi=!1,Cn=!1,yi=!1,ne=!1,vs=!0,ys=!1;const Zn="user-content-";let _s=!0,xe=!1,Wt={},gn=null;const _i=Me({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let _e=null;const Ei=Me({},["audio","video","img","source","image","track"]);let Se=null;const Ee=Me({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),xi="http://www.w3.org/1998/Math/MathML",It="http://www.w3.org/2000/svg",dn="http://www.w3.org/1999/xhtml";let ve=dn,Es=!1,xs=null;const ws=Me({},[xi,It,dn],Ju);let lt=Me({},["mi","mo","mn","ms","mtext"]),Tn=Me({},["annotation-xml"]);const Zt=Me({},["title","style","font","a","script"]);let mr=null;const wi=["application/xhtml+xml","text/html"],dl="text/html";let je=null,Lt=null;const ae=e.createElement("form"),Fr=function(B){return B instanceof RegExp||B instanceof Function},vr=function(){let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Lt&&Lt===B)){if((!B||typeof B!="object")&&(B={}),B=Tr(B),mr=wi.indexOf(B.PARSER_MEDIA_TYPE)===-1?dl:B.PARSER_MEDIA_TYPE,je=mr==="application/xhtml+xml"?Ju:Qa,re=cn(B,"ALLOWED_TAGS")?Me({},B.ALLOWED_TAGS,je):me,he=cn(B,"ALLOWED_ATTR")?Me({},B.ALLOWED_ATTR,je):oe,xs=cn(B,"ALLOWED_NAMESPACES")?Me({},B.ALLOWED_NAMESPACES,Ju):ws,Se=cn(B,"ADD_URI_SAFE_ATTR")?Me(Tr(Ee),B.ADD_URI_SAFE_ATTR,je):Ee,_e=cn(B,"ADD_DATA_URI_TAGS")?Me(Tr(Ei),B.ADD_DATA_URI_TAGS,je):Ei,gn=cn(B,"FORBID_CONTENTS")?Me({},B.FORBID_CONTENTS,je):_i,we=cn(B,"FORBID_TAGS")?Me({},B.FORBID_TAGS,je):{},Ne=cn(B,"FORBID_ATTR")?Me({},B.FORBID_ATTR,je):{},Wt=cn(B,"USE_PROFILES")?B.USE_PROFILES:!1,V=B.ALLOW_ARIA_ATTR!==!1,fn=B.ALLOW_DATA_ATTR!==!1,be=B.ALLOW_UNKNOWN_PROTOCOLS||!1,fe=B.ALLOW_SELF_CLOSE_IN_ATTR!==!1,C=B.SAFE_FOR_TEMPLATES||!1,De=B.SAFE_FOR_XML!==!1,Oe=B.WHOLE_DOCUMENT||!1,Cn=B.RETURN_DOM||!1,yi=B.RETURN_DOM_FRAGMENT||!1,ne=B.RETURN_TRUSTED_TYPE||!1,vi=B.FORCE_BODY||!1,vs=B.SANITIZE_DOM!==!1,ys=B.SANITIZE_NAMED_PROPS||!1,_s=B.KEEP_CONTENT!==!1,xe=B.IN_PLACE||!1,K=B.ALLOWED_URI_REGEXP||Eg,ve=B.NAMESPACE||dn,lt=B.MATHML_TEXT_INTEGRATION_POINTS||lt,Tn=B.HTML_INTEGRATION_POINTS||Tn,le=B.CUSTOM_ELEMENT_HANDLING||{},B.CUSTOM_ELEMENT_HANDLING&&Fr(B.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=B.CUSTOM_ELEMENT_HANDLING.tagNameCheck),B.CUSTOM_ELEMENT_HANDLING&&Fr(B.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=B.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),B.CUSTOM_ELEMENT_HANDLING&&typeof B.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=B.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),C&&(fn=!1),yi&&(Cn=!0),Wt&&(re=Me({},vg),he=[],Wt.html===!0&&(Me(re,mg),Me(he,yg)),Wt.svg===!0&&(Me(re,Vu),Me(he,Zu),Me(he,eo)),Wt.svgFilters===!0&&(Me(re,Xu),Me(he,Zu),Me(he,eo)),Wt.mathMl===!0&&(Me(re,Wu),Me(he,_g),Me(he,eo))),B.ADD_TAGS&&(re===me&&(re=Tr(re)),Me(re,B.ADD_TAGS,je)),B.ADD_ATTR&&(he===oe&&(he=Tr(he)),Me(he,B.ADD_ATTR,je)),B.ADD_URI_SAFE_ATTR&&Me(Se,B.ADD_URI_SAFE_ATTR,je),B.FORBID_CONTENTS&&(gn===_i&&(gn=Tr(gn)),Me(gn,B.FORBID_CONTENTS,je)),_s&&(re["#text"]=!0),Oe&&Me(re,["html","head","body"]),re.table&&(Me(re,["tbody"]),delete we.tbody),B.TRUSTED_TYPES_POLICY){if(typeof B.TRUSTED_TYPES_POLICY.createHTML!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof B.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');J=B.TRUSTED_TYPES_POLICY,X=J.createHTML("")}else J===void 0&&(J=Lw(S,u)),J!==null&&typeof X=="string"&&(X=J.createHTML(""));Et&&Et(B),Lt=B}},yr=Me({},[...Vu,...Xu,...mw]),ks=Me({},[...Wu,...vw]),Ss=function(B){let te=H(B);(!te||!te.tagName)&&(te={namespaceURI:ve,tagName:"template"});const ue=Qa(B.tagName),ze=Qa(te.tagName);return xs[B.namespaceURI]?B.namespaceURI===It?te.namespaceURI===dn?ue==="svg":te.namespaceURI===xi?ue==="svg"&&(ze==="annotation-xml"||lt[ze]):!!yr[ue]:B.namespaceURI===xi?te.namespaceURI===dn?ue==="math":te.namespaceURI===It?ue==="math"&&Tn[ze]:!!ks[ue]:B.namespaceURI===dn?te.namespaceURI===It&&!Tn[ze]||te.namespaceURI===xi&&!lt[ze]?!1:!ks[ue]&&(Zt[ue]||!yr[ue]):!!(mr==="application/xhtml+xml"&&xs[B.namespaceURI]):!1},Ft=function(B){is(r.removed,{element:B});try{H(B).removeChild(B)}catch{U(B)}},jt=function(B,te){try{is(r.removed,{attribute:te.getAttributeNode(B),from:te})}catch{is(r.removed,{attribute:null,from:te})}if(te.removeAttribute(B),B==="is")if(Cn||yi)try{Ft(te)}catch{}else try{te.setAttribute(B,"")}catch{}},Ms=function(B){let te=null,ue=null;if(vi)B="<remove></remove>"+B;else{const Ze=pg(B,/^[\r\n\t ]+/);ue=Ze&&Ze[0]}mr==="application/xhtml+xml"&&ve===dn&&(B='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+B+"</body></html>");const ze=J?J.createHTML(B):B;if(ve===dn)try{te=new E().parseFromString(ze,mr)}catch{}if(!te||!te.documentElement){te=W.createDocument(ve,"template",null);try{te.documentElement.innerHTML=Es?X:ze}catch{}}const st=te.body||te.documentElement;return B&&ue&&st.insertBefore(e.createTextNode(ue),st.childNodes[0]||null),ve===dn?k.call(te,Oe?"html":"body")[0]:Oe?te.documentElement:st},Gr=function(B){return $.call(B.ownerDocument||B,B,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Is=function(B){return B instanceof y&&(typeof B.nodeName!="string"||typeof B.textContent!="string"||typeof B.removeChild!="function"||!(B.attributes instanceof v)||typeof B.removeAttribute!="function"||typeof B.setAttribute!="function"||typeof B.namespaceURI!="string"||typeof B.insertBefore!="function"||typeof B.hasChildNodes!="function")},Ls=function(B){return typeof h=="function"&&B instanceof h};function pn(de,B,te){Ka(de,ue=>{ue.call(r,B,te,Lt)})}const gt=function(B){let te=null;if(pn(A.beforeSanitizeElements,B,null),Is(B))return Ft(B),!0;const ue=je(B.nodeName);if(pn(A.uponSanitizeElement,B,{tagName:ue,allowedTags:re}),B.hasChildNodes()&&!Ls(B.firstElementChild)&&xt(/<[/\w]/g,B.innerHTML)&&xt(/<[/\w]/g,B.textContent)||B.nodeType===us.progressingInstruction||De&&B.nodeType===us.comment&&xt(/<[/\w]/g,B.data))return Ft(B),!0;if(!re[ue]||we[ue]){if(!we[ue]&&_r(ue)&&(le.tagNameCheck instanceof RegExp&&xt(le.tagNameCheck,ue)||le.tagNameCheck instanceof Function&&le.tagNameCheck(ue)))return!1;if(_s&&!gn[ue]){const ze=H(B)||B.parentNode,st=I(B)||B.childNodes;if(st&&ze){const Ze=st.length;for(let Qe=Ze-1;Qe>=0;--Qe){const bt=D(st[Qe],!0);bt.__removalCount=(B.__removalCount||0)+1,ze.insertBefore(bt,G(B))}}}return Ft(B),!0}return B instanceof m&&!Ss(B)||(ue==="noscript"||ue==="noembed"||ue==="noframes")&&xt(/<\/no(script|embed|frames)/i,B.innerHTML)?(Ft(B),!0):(C&&B.nodeType===us.text&&(te=B.textContent,Ka([T,F,P],ze=>{te=ss(te,ze," ")}),B.textContent!==te&&(is(r.removed,{element:B.cloneNode()}),B.textContent=te)),pn(A.afterSanitizeElements,B,null),!1)},ki=function(B,te,ue){if(vs&&(te==="id"||te==="name")&&(ue in e||ue in ae))return!1;if(!(fn&&!Ne[te]&&xt(N,te))){if(!(V&&xt(R,te))){if(!he[te]||Ne[te]){if(!(_r(B)&&(le.tagNameCheck instanceof RegExp&&xt(le.tagNameCheck,B)||le.tagNameCheck instanceof Function&&le.tagNameCheck(B))&&(le.attributeNameCheck instanceof RegExp&&xt(le.attributeNameCheck,te)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(te))||te==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&xt(le.tagNameCheck,ue)||le.tagNameCheck instanceof Function&&le.tagNameCheck(ue))))return!1}else if(!Se[te]){if(!xt(K,ss(ue,z,""))){if(!((te==="src"||te==="xlink:href"||te==="href")&&B!=="script"&&fw(ue,"data:")===0&&_e[B])){if(!(be&&!xt(Y,ss(ue,z,"")))){if(ue)return!1}}}}}}return!0},_r=function(B){return B!=="annotation-xml"&&pg(B,j)},Nn=function(B){pn(A.beforeSanitizeAttributes,B,null);const{attributes:te}=B;if(!te||Is(B))return;const ue={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:he,forceKeepAttr:void 0};let ze=te.length;for(;ze--;){const st=te[ze],{name:Ze,namespaceURI:Qe,value:bt}=st,$n=je(Ze);let at=Ze==="value"?bt:gw(bt);if(ue.attrName=$n,ue.attrValue=at,ue.keepAttr=!0,ue.forceKeepAttr=void 0,pn(A.uponSanitizeAttribute,B,ue),at=ue.attrValue,ys&&($n==="id"||$n==="name")&&(jt(Ze,B),at=Zn+at),De&&xt(/((--!?|])>)|<\/(style|title)/i,at)){jt(Ze,B);continue}if(ue.forceKeepAttr||(jt(Ze,B),!ue.keepAttr))continue;if(!fe&&xt(/\/>/i,at)){jt(Ze,B);continue}C&&Ka([T,F,P],At=>{at=ss(at,At," ")});const po=je(B.nodeName);if(ki(po,$n,at)){if(J&&typeof S=="object"&&typeof S.getAttributeType=="function"&&!Qe)switch(S.getAttributeType(po,$n)){case"TrustedHTML":{at=J.createHTML(at);break}case"TrustedScriptURL":{at=J.createScriptURL(at);break}}try{Qe?B.setAttributeNS(Qe,Ze,at):B.setAttribute(Ze,at),Is(B)?Ft(B):dg(r.removed)}catch{}}}pn(A.afterSanitizeAttributes,B,null)},jn=function de(B){let te=null;const ue=Gr(B);for(pn(A.beforeSanitizeShadowDOM,B,null);te=ue.nextNode();)pn(A.uponSanitizeShadowNode,te,null),gt(te),Nn(te),te.content instanceof l&&de(te.content);pn(A.afterSanitizeShadowDOM,B,null)};return r.sanitize=function(de){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},te=null,ue=null,ze=null,st=null;if(Es=!de,Es&&(de="<!-->"),typeof de!="string"&&!Ls(de))if(typeof de.toString=="function"){if(de=de.toString(),typeof de!="string")throw as("dirty is not a string, aborting")}else throw as("toString is not a function");if(!r.isSupported)return de;if(Ie||vr(B),r.removed=[],typeof de=="string"&&(xe=!1),xe){if(de.nodeName){const bt=je(de.nodeName);if(!re[bt]||we[bt])throw as("root node is forbidden and cannot be sanitized in-place")}}else if(de instanceof h)te=Ms("<!---->"),ue=te.ownerDocument.importNode(de,!0),ue.nodeType===us.element&&ue.nodeName==="BODY"||ue.nodeName==="HTML"?te=ue:te.appendChild(ue);else{if(!Cn&&!C&&!Oe&&de.indexOf("<")===-1)return J&&ne?J.createHTML(de):de;if(te=Ms(de),!te)return Cn?null:ne?X:""}te&&vi&&Ft(te.firstChild);const Ze=Gr(xe?de:te);for(;ze=Ze.nextNode();)gt(ze),Nn(ze),ze.content instanceof l&&jn(ze.content);if(xe)return de;if(Cn){if(yi)for(st=x.call(te.ownerDocument);te.firstChild;)st.appendChild(te.firstChild);else st=te;return(he.shadowroot||he.shadowrootmode)&&(st=b.call(s,st,!0)),st}let Qe=Oe?te.outerHTML:te.innerHTML;return Oe&&re["!doctype"]&&te.ownerDocument&&te.ownerDocument.doctype&&te.ownerDocument.doctype.name&&xt(xg,te.ownerDocument.doctype.name)&&(Qe="<!DOCTYPE "+te.ownerDocument.doctype.name+`>
`+Qe),C&&Ka([T,F,P],bt=>{Qe=ss(Qe,bt," ")}),J&&ne?J.createHTML(Qe):Qe},r.setConfig=function(){let de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};vr(de),Ie=!0},r.clearConfig=function(){Lt=null,Ie=!1},r.isValidAttribute=function(de,B,te){Lt||vr({});const ue=je(de),ze=je(B);return ki(ue,ze,te)},r.addHook=function(de,B){typeof B=="function"&&is(A[de],B)},r.removeHook=function(de,B){if(B!==void 0){const te=cw(A[de],B);return te===-1?void 0:hw(A[de],te,1)[0]}return dg(A[de])},r.removeHooks=function(de){A[de]=[]},r.removeAllHooks=function(){A=kg()},r}var bw=Sg();const Aw=(n,r,e)=>{r.control&&r.controlOptions?e.options.toggleMode(r.control.type,r.control.targetMode):ie.error("Control or controlOptions not defined",r.control,r.controlOptions)};var Cw=ln("<div><!></div>"),Tw=ln('<div class="control-container svelte-1rd72r"><button type="button"><!></button> <!></div>');function Nw(n,r){var m;ai(r,!0);const e=(m=r.controlOptions)!=null&&m.icon?bw.sanitize(r.controlOptions.icon.trim()):null,s=Lu("gm"),u=s.control.getDefaultPosition();var l=ci(),f=lr(l);{var h=d=>{var v=Tw(),y=ur(v);let E;y.__click=[Aw,r,s];var S=ur(y);{var M=I=>{var H=ci(),J=lr(H);Ox(J,()=>e),et(I,H)},D=(I,H)=>{{var J=W=>{var $=ng();Hn(x=>hi($,x),[()=>r.controlOptions.title.slice(0,2)]),et(W,$)},X=W=>{var $=ng();Hn(()=>hi($,r.control.targetMode)),et(W,$)};Ln(I,W=>{r.controlOptions.title?W(J):W(X,!1)},H)}};Ln(S,I=>{r.controlOptions.icon?I(M):I(D,!1)})}var U=Ga(y,2);{var G=I=>{var H=Cw();let J;var X=ur(H);aw(X,{get control(){return r.control}}),Hn((W,$)=>J=Uu(H,1,"control-menu svelte-1rd72r",null,J,{"menu-right":W,"menu-left":$}),[()=>u.endsWith("left"),()=>u.endsWith("right")]),et(I,H)};Ln(U,I=>{r.controlOptions.active&&I(G)})}Hn(()=>{Cr(y,"id",`id_${r.control.type}_${r.control.targetMode}`),E=Uu(y,1,`gm-control-button ${r.control.type}-${r.control.targetMode}`,"svelte-1rd72r",E,{active:r.controlOptions.active}),Cr(y,"title",r.controlOptions.title)}),et(d,v)};Ln(f,d=>{r.control&&r.controlOptions&&r.controlOptions.uiEnabled&&d(h)})}et(n,l),oi()}Gu(["click"]);var Pw=ln("<div></div>"),Ow=ln('<div class="gm-reactive-controls svelte-blwgmu"></div>');function Rw(n,r){ai(r,!1);const[e,s]=Yx(),u=()=>qx(qu,"$controlsStore",e),f=`${Lu("gm").mapAdapter.mapType}gl`;let h=u(),m=h.controls,d=ex(h.options);const v=qu.subscribe(S=>{m=S.controls,ut(d,S.options)});Hx(v);const y=(S,M)=>{const D=m==null?void 0:m[S];return(D==null?void 0:D[M])||null};zx();var E=Ow();ns(E,5,()=>Object.entries(Te(d)),ts,(S,M)=>{let D=()=>Te(M)[0],U=()=>Te(M)[1];var G=Pw();ns(G,5,()=>Object.entries(U()),ts,(I,H)=>{let J=()=>Te(H)[0],X=()=>Te(H)[1];var W=ci();const $=Tf(()=>y(D(),J()));var x=lr(W);{var k=b=>{Nw(b,{get control(){return Te($)},get controlOptions(){return X()}})};Ln(x,b=>{Te($)&&b(k)})}et(I,W)}),Hn(()=>Uu(G,1,`${f}-ctrl ${f}-ctrl-group group-${D()}`,"svelte-blwgmu")),et(S,G)}),et(n,E),oi(),s()}class Dw{constructor(r){O(this,"gm");this.gm=r}}class Fw extends Dw{constructor(){super(...arguments);O(this,"controls",an(bl));O(this,"reactiveControls",null);O(this,"container");O(this,"mapEventHandlers",{[`${pe}:draw`]:this.handleModeEvent.bind(this),[`${pe}:edit`]:this.handleModeEvent.bind(this),[`${pe}:helper`]:this.handleModeEvent.bind(this)})}onAdd(){if(this.createControls(),this.gm.events.bus.attachEvents(this.mapEventHandlers),!this.container)throw new Error("Controls container is not initialized");return this.container}createControls(e=void 0){if(this.controlsAdded()){ie.warn("Can't add controls: controls already added");return}this.container=e||this.createHtmlContainer(),this.createReactivePanel()}onRemove(){this.gm.events.bus.detachEvents(this.mapEventHandlers),this.reactiveControls&&(Ax(this.reactiveControls),this.reactiveControls=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=void 0}handleModeEvent(e){return Ma(e)?(["mode_started","mode_ended"].includes(e.action)&&this.updateReactivePanel(),{next:!0}):{next:!0}}controlsAdded(){return!!this.reactiveControls}createReactivePanel(){if(!this.container){ie.error("Can't create reactive panel: container is not initialized");return}this.syncModeStates();const e=new Map;e.set("gm",this.gm),this.reactiveControls=Lx(Rw,{target:this.container,context:e}),this.updateReactivePanel()}updateReactivePanel(){qu.update(()=>({controls:this.controls,options:this.gm.options.controls}))}createHtmlContainer(){const e=document.createElement("div");return e.classList.add("geoman-controls"),e}syncModeStates(){this.eachControlWithOptions(({control:e})=>{this.gm.options.syncModeState(e.type,e.targetMode)})}eachControlWithOptions(e){return ot(this.controls).forEach(s=>{const u=this.controls[s];return Object.keys(u).forEach(l=>{const f=l,h=this.getControl({actionType:s,modeName:f}),m=this.gm.options.getControlOptions({actionType:s,modeName:f});h&&m&&e({control:h,controlOptions:m})})})}getControl({actionType:e,modeName:s}){return e&&s&&this.controls[e][s]||null}getDefaultPosition(){return this.gm.options.settings.controlsPosition}}const Gw=`_${pe}`;class Bw{constructor(r){O(this,"gm");O(this,"globalEventsListener",null);this.gm=r}get map(){return this.gm.mapAdapter.getMapInstance()}processEvent(r,e){this.fireToMap("system",r.split(":")[1],{...e,level:"user"}),e.action==="mode_start"||e.action==="mode_end"?this.forwardModeToggledEvent(e):e.action==="feature_created"?this.forwardFeatureCreated(e):e.action==="feature_removed"?this.forwardFeatureRemoved(e):e.action==="feature_updated"?this.forwardFeatureUpdated(e):e.action==="feature_edit_start"?this.forwardFeatureEditStart(e):e.action==="feature_edit_end"?this.forwardFeatureEditEnd(e):(e.action==="loaded"||e.action==="unloaded")&&this.forwardGeomanLoaded(e)}forwardModeToggledEvent(r){const e=r.action==="mode_start";let s;if(r.type==="draw"){const u="globaldrawmodetoggled";s={enabled:e,shape:r.mode,map:this.map},this.fireToMap("converted",u,s),s={shape:r.mode,map:this.map},this.fireToMap("converted",e?"drawstart":"drawend",s)}else if(r.type==="edit"){const u=this.getConvertedEditModeName(r.mode);s={enabled:e,map:this.map},this.fireToMap("converted",`global${u}modetoggled`,s)}else r.type==="helper"&&(s={enabled:e,map:this.map},this.fireToMap("converted",`global${r.mode}modetoggled`,s))}forwardFeatureCreated(r){const e={shape:r.mode,feature:r.featureData,map:this.map};this.fireToMap("converted","create",e)}forwardFeatureRemoved(r){const e={shape:r.mode,feature:r.featureData,map:this.map};this.fireToMap("converted","remove",e)}forwardFeatureUpdated(r){const e=["lasso"],s={map:this.map};r.sourceFeatures.length===1&&!e.includes(r.mode)?s.originalFeature=r.sourceFeatures[0]:s.originalFeatures=r.sourceFeatures,r.targetFeatures.length===1&&!e.includes(r.mode)?(s.feature=r.targetFeatures[0],s.shape=s.feature.shape):s.features=r.targetFeatures;const u=this.getConvertedEditModeName(r.mode);this.fireToMap("converted",`${u}`,s)}forwardFeatureEditStart(r){const e=this.getConvertedEditModeName(r.mode),s={shape:r.feature.shape,feature:r.feature,map:this.map};this.fireToMap("converted",`${e}start`,s)}forwardFeatureEditEnd(r){const e=this.getConvertedEditModeName(r.mode),s={shape:r.feature.shape,feature:r.feature,map:this.map};this.fireToMap("converted",`${e}end`,s)}forwardGeomanLoaded(r){this.fireToMap("converted",`${r.action}`,{map:this.map,[pe]:this.gm})}fireToMap(r,e,s){const l=`${r==="system"?Gw:pe}:${e}`;this.globalEventsListener&&this.globalEventsListener({type:r,name:l,payload:s}),this.gm.mapAdapter.fire(l,s)}getConvertedEditModeName(r){return r==="change"?"edit":r}}class Uw{constructor(r){O(this,"gm");O(this,"forwarder");O(this,"mapEventHandlers",{});O(this,"gmEventHandlers",{});this.gm=r,this.forwarder=new Bw(r)}fireEvent(r,e){const s=this.gmEventHandlers[r];if(!s)return;const{controlHandler:u}=s;u(e),this.forwarder.processEvent(r,e)}attachEvents(r){ot(r).forEach(e=>{const s=r[e];s&&this.on(e,s)})}detachEvents(r){ot(r).forEach(e=>{const s=r[e];s&&this.off(e,s)})}detachAllEvents(){ot(this.gmEventHandlers).forEach(r=>{var s;Array.from(((s=this.gmEventHandlers[r])==null?void 0:s.handlers)||[]).forEach(u=>{this.off(r,u)})}),ot(this.mapEventHandlers).forEach(r=>{var s;Array.from(((s=this.mapEventHandlers[r])==null?void 0:s.handlers)||[]).forEach(u=>{this.off(r,u)})})}on(r,e){r.startsWith(pe)?this.onGmEvent(r,e):this.onMapEvent(r,e)}onGmEvent(r,e){var s;this.gmEventHandlers[r]||(this.gmEventHandlers[r]=this.createEventSection(r)),(s=this.gmEventHandlers[r])==null||s.handlers.unshift(e)}onMapEvent(r,e){var s;if(!this.mapEventHandlers[r]){const u=this.createEventSection(r);this.gm.mapAdapter.on(r,u.controlHandler),this.mapEventHandlers[r]=u}(s=this.mapEventHandlers[r])==null||s.handlers.unshift(e)}off(r,e){r.startsWith(`${pe}`)?this.offGmEvent(r,e):this.offMapEvent(r,e)}offGmEvent(r,e){var l;const s=((l=this.gmEventHandlers[r])==null?void 0:l.handlers)||[],u=s.findIndex(f=>e===f);u===-1?ie.warn("MapEvents: handler not found",r,e):(s.splice(u,1),s.length===0&&delete this.gmEventHandlers[r])}offMapEvent(r,e){var l,f;const s=((l=this.mapEventHandlers[r])==null?void 0:l.handlers)||[],u=s.findIndex(h=>e===h);if(u===-1)ie.warn("MapEvents: handler not found",r,e);else if(s.splice(u,1),s.length===0){const h=(f=this.mapEventHandlers[r])==null?void 0:f.controlHandler;h&&this.gm.mapAdapter.off(r,h),delete this.mapEventHandlers[r]}}createEventSection(r){return{handlers:[],controlHandler:e=>{let s;if(Pt(e)&&r.startsWith(`${pe}`)?s=this.gmEventHandlers[r]:s=this.mapEventHandlers[r],!s){ie.debug(`No handlers for eventName: "${r}"`);return}s.handlers.some(u=>{let l;return Pt(e),l=u(e),l&&typeof l=="object"&&"next"in l?!l.next:(ie.error('EventsBus: handler should return an object with a "next" property'),!1)})}}}}class zw extends Ia{constructor(e,s){super(e);O(this,"mapEventHandlers",{[`${pe}:control`]:this.handleControlEvent.bind(this)});s.attachEvents(this.mapEventHandlers)}handleControlEvent(e){return pu(e)?(this.getControl(e)||ie.error("Control not found, event payload",e),{next:!0}):{next:!0}}}const ju=["drag","change","rotate","scale","copy","cut","split","union","difference","line_simplification","lasso","delete"];class Nr extends La{constructor(){super(...arguments);O(this,"actionType","edit");O(this,"featureData",null);O(this,"cursorExcludedLayerIds",["rectangle-line","polygon-line","circle-line"]);O(this,"layerEventHandlersData",[])}startAction(){this.setEventsForLayers("mouseenter",this.setCursorToPointer.bind(this)),this.setEventsForLayers("mouseleave",this.setCursorToEmpty.bind(this)),super.startAction()}endAction(){this.clearEventsForLayers(),super.endAction()}setCursorToPointer(){this.gm.mapAdapter.setCursor("pointer")}setCursorToEmpty(){this.gm.mapAdapter.setCursor("")}setEventsForLayers(e,s){this.gm.features.layers.map(l=>l.id).filter(l=>!this.cursorExcludedLayerIds.some(f=>l.includes(f))).forEach(l=>{this.gm.mapAdapter.on(e,l,s),this.layerEventHandlersData.push({eventName:e,layerId:l,callback:s})})}clearEventsForLayers(){this.layerEventHandlersData.forEach(({eventName:e,layerId:s,callback:u})=>{this.gm.mapAdapter.off(e,s,u)}),this.layerEventHandlersData=[]}updateFeatureGeoJson({featureData:e,featureGeoJson:s,forceMode:u=void 0}){if(!this.flags.featureUpdateAllowed)return!1;const l=s.properties;return l.shape==="circle"&&l.center&&e.setShapeProperty("center",l.center),l.shape==="ellipse"&&l._gm_shape_center&&(e.setShapeProperty("center",l._gm_shape_center),e.setShapeProperty("xSemiAxis",l._gm_shape_xSemiAxis),e.setShapeProperty("ySemiAxis",l._gm_shape_ySemiAxis),e.setShapeProperty("angle",l._gm_shape_angle)),e.updateGeoJsonGeometry(s.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:[e],forceMode:u}),!0}fireFeatureUpdatedEvent({sourceFeatures:e,targetFeatures:s,markerData:u=void 0,forceMode:l=void 0}){const f={level:"system",type:"edit",action:"feature_updated",mode:l||this.mode,sourceFeatures:e,targetFeatures:s,markerData:u||null};this.gm.events.fire(`${pe}:edit`,f)}fireFeatureEditStartEvent({feature:e,forceMode:s=void 0}){const u={level:"system",type:"edit",action:"feature_edit_start",mode:s||this.mode,feature:e};this.gm.events.fire(`${pe}:edit`,u)}fireFeatureEditEndEvent({feature:e,forceMode:s=void 0}){const u={level:"system",type:"edit",action:"feature_edit_end",mode:s||this.mode,feature:e};this.gm.events.fire(`${pe}:edit`,u)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker)return;const e=this.gm.markerPointer.marker,s={level:"system",variant:null,type:"draw",mode:this.getLineDrawerMode(),action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:null};this.gm.events.fire(`${pe}:draw`,s)}forwardLineDrawerEvent(e){if(!mu(e)||!["cut","split"].includes(this.mode))return{next:!0};if(e.action==="start"||e.action==="update"){const s={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${pe}:draw`,s)}else if(e.action==="finish"||e.action==="cancel"){const s={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action};this.gm.events.fire(`${pe}:draw`,s)}return{next:!0}}fireFeatureRemovedEvent(e){if(er(e.shape,ri)){const s={level:"system",type:"edit",mode:e.shape,action:"feature_removed",featureData:e};this.gm.events.fire(`${pe}:edit`,s)}}getLineDrawerMode(){return this.mode==="cut"?"polygon":(this.mode==="split","line")}}const $u=["shape_markers","pin","snapping","snap_guides","measurements","auto_trace","geofencing","zoom_to_features","click_to_edit"];class Vn extends La{constructor(){super(...arguments);O(this,"actionType","helper")}}const Pr=n=>Pt(n)&&n.type==="edit",Mg=n=>xE.includes(n),Ig=n=>vu.includes(n),Lg=n=>ju.includes(n),bg=n=>$u.includes(n),Ag=n=>Ig(n)||Lg(n)||bg(n);class qw extends Ia{constructor(e,s){super(e);O(this,"mapEventHandlers",{[`${pe}:draw`]:this.handleDrawEvent.bind(this)});s.attachEvents(this.mapEventHandlers)}handleDrawEvent(e){if(!ba(e))return{next:!0};const s=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(s,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(s)),{next:!0}}start(e,s){const u=this.gm.createDrawInstance(s.mode);u&&(e in this.gm.actionInstances&&ie.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=u,u.startAction())}end(e){const s=this.gm.actionInstances[e];s instanceof kn?(s.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for draw event "${e}":`,s)}}class Yw extends Ia{constructor(e,s){super(e);O(this,"mapEventHandlers",{[`${pe}:edit`]:this.handleEditEvent.bind(this)});s.attachEvents(this.mapEventHandlers)}handleEditEvent(e){if(!Pr(e))return{next:!0};const s=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(s,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(s)),{next:!0}}start(e,s){if(s.action!=="mode_start")return;const u=this.gm.createEditInstance(s.mode);u&&(e in this.gm.actionInstances&&ie.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=u,u.startAction())}end(e){const s=this.gm.actionInstances[e];s instanceof Nr?(s.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}": `,s)}}class Hw extends Ia{constructor(e,s){super(e);O(this,"mapEventHandlers",{[`${pe}:helper`]:this.handleHelperEvent.bind(this)});s.attachEvents(this.mapEventHandlers)}handleHelperEvent(e){if(!Xi(e))return{next:!0};const s=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(s,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(s)),{next:!0}}start(e,s){const u=this.gm.createHelperInstance(s.mode);u&&(e in this.gm.actionInstances&&ie.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=u,u.startAction())}end(e){const s=this.gm.actionInstances[e];s instanceof Vn?(s.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}":`,s)}}class Jw{constructor(r){O(this,"gm");O(this,"bus");O(this,"listeners",{});this.gm=r,this.bus=new Uw(this.gm),this.listeners={draw:new qw(this.gm,this.bus),edit:new Yw(this.gm,this.bus),helper:new Hw(this.gm,this.bus),control:new zw(this.gm,this.bus)}}fire(r,e){this.listeners[e.type]||ie.error(`Can't find event listener for "${e.type}" event type`),this.bus.fireEvent(r,e)}}class Cg{getEuclideanNearestLngLat(r,e){const s=this.project(e);let u=[0,0],l=1/0;return ra(r,f=>{const h=this.project(f.start.coordinate),m=this.project(f.end.coordinate),d=ch(h,m,s),v=zi(s,d);v<l&&(l=v,u=[d[0],d[1]])}),this.unproject(u)}getDistance(r,e){return Xl(r,e,{units:"meters"})}}class Tg{isInstanceAvailable(){return this.layerInstance?!0:(ie.error("layerInstance is not available"),!1)}}class Ku extends Tg{constructor({gm:e,layerId:s,options:u}){super();O(this,"gm");O(this,"layerInstance",null);O(this,"mapInstance");this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,u?this.layerInstance=this.createLayer(u):this.layerInstance=this.mapInstance.getLayer(s)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.id}get source(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.source}createLayer(e){return this.mapInstance.addLayer(e),this.mapInstance.getLayer(e.id)||null}remove(){this.isInstanceAvailable()&&this.mapInstance.removeLayer(this.id),this.layerInstance=null}}class Vw extends Os{constructor({mapInstance:e,options:s,lngLat:u}){super();O(this,"markerInstance");this.markerInstance=new pt.Marker(s).setLngLat(u).addTo(e)}getElement(){var e;return this.isMarkerInstanceAvailable()&&((e=this.markerInstance)==null?void 0:e.getElement())||null}setLngLat(e){var s;this.isMarkerInstanceAvailable()&&((s=this.markerInstance)==null||s.setLngLat(e))}getLngLat(){var e;return this.isMarkerInstanceAvailable()?((e=this.markerInstance)==null?void 0:e.getLngLat().toArray())||[0,0]:[0,0]}remove(){var e;(e=this.markerInstance)==null||e.remove()}}class Ng{isInstanceAvailable(){return this.popupInstance?!0:(ie.error("Popup instance is not available"),!1)}}class Xw extends Ng{constructor({mapInstance:e,options:s,lngLat:u}){super();O(this,"popupInstance");this.popupInstance=new pt.Popup(s).addTo(e),u&&this.setLngLat(u)}getLngLat(){return this.isInstanceAvailable()?this.popupInstance.getLngLat().toArray()||[0,0]:[0,0]}setLngLat(e){this.isInstanceAvailable()&&this.popupInstance.setLngLat(e)}setHtml(e){this.isInstanceAvailable()&&this.popupInstance.setHTML(e)}remove(){this.isInstanceAvailable()&&this.popupInstance.remove()}}function Ww(n,r){const e=n??{add:[],update:[],remove:[]},s=r??{add:[],update:[],remove:[]},u=new Set(s.remove),l=e.add.filter(m=>!u.has(m.id)),f=e.update.filter(m=>!u.has(m.id)),h=[];return s.update.forEach(m=>{const d=l.findIndex(y=>y.id===m.id),v=f.findIndex(y=>y.id===m.id);if(d===-1&&v===-1){h.push(m);return}d!==-1&&(l[d]=m),v!==-1&&(f[v]=m)}),{add:[...l,...s.add],update:[...f,...h],remove:[...e.remove,...s.remove]}}class Pg extends af{constructor({gm:e,geoJson:s,sourceId:u}){super();O(this,"gm");O(this,"mapInstance");O(this,"sourceInstance");O(this,"pendingUpdateStorage",null);O(this,"mlSourceDiff",null);O(this,"updateTimeout",null);O(this,"updateData",e=>{if(!this.isInstanceAvailable())return;const s=Ww(this.pendingUpdateStorage,e??null);if(this.updateTimeout&&(window.clearTimeout(this.updateTimeout),this.updateTimeout=null),this.sourceInstance._pendingLoads===0){this.pendingUpdateStorage=null;const u=this.convertGeoJsonDiffToMlDiff(s);this.sourceInstance.updateData(u)}else this.pendingUpdateStorage=s,this.updateTimeout=window.setTimeout(this.updateData,15)});this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,s?this.sourceInstance=this.createSource({geoJson:s,sourceId:u}):this.sourceInstance=this.mapInstance.getSource(u)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.id}createSource({geoJson:e,sourceId:s}){let u=this.mapInstance.getSource(s);return u||(this.mapInstance.addSource(s,{type:"geojson",data:e,promoteId:ar}),u=this.mapInstance.getSource(s)),u??null}getGeoJson(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.serialize().data}setGeoJson(e){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.setData(e)}convertGeoJsonDiffToMlDiff(e){return{add:e.add,update:e.update.map(this.convertFeatureToMlUpdateDiff.bind(this)),remove:e.remove}}convertFeatureToMlUpdateDiff(e){const s=Object.entries(e.properties||{}).map(u=>({key:u[0],value:u[1]}));return{id:e.id,newGeometry:e.geometry,addOrUpdateProperties:s}}remove({removeLayers:e}){this.isInstanceAvailable()&&(e&&this.gm.mapAdapter.eachLayer(s=>{s.source===this.sourceInstance.id&&this.gm.mapAdapter.removeLayer(s.id)}),this.mapInstance.removeSource(this.sourceInstance.id))}}const Zw=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"],Qu=n=>Zw.includes(n);class jw extends Cg{constructor(e,s){super();O(this,"gm");O(this,"mapType","maplibre");O(this,"mapInstance");this.gm=s,this.mapInstance=e}getMapInstance(){return this.mapInstance}isLoaded(){return this.mapInstance.loaded()}getContainer(){return this.mapInstance.getContainer()}getCanvas(){return this.mapInstance.getCanvas()}addControl(e){this.mapInstance.addControl(e)}removeControl(e){this.mapInstance.removeControl(e)}async loadImage({id:e,image:s}){const u=await this.mapInstance.loadImage(s);this.mapInstance.addImage(e,u.data)}getBounds(){return this.mapInstance.getBounds().toArray()}fitBounds(e,s){this.mapInstance.fitBounds(e,s)}setCursor(e){this.mapInstance.getCanvas().style.cursor=e}disableMapInteractions(e){e.forEach(s=>{this.mapInstance[s].disable()})}enableMapInteractions(e){e.forEach(s=>{this.mapInstance[s].enable()})}setDragPan(e){e?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()}queryFeaturesByScreenCoordinates({queryCoordinates:e=void 0,sourceNames:s}){return sh(this.mapInstance.queryRenderedFeatures(e).map(l=>({featureId:l.properties[ar],featureSourceName:l.source})),Ks).map(({featureId:l,featureSourceName:f})=>l===void 0||!s.includes(f)?null:this.gm.features.get(f,l)||null).filter(l=>!!l)}queryGeoJsonFeatures({queryCoordinates:e=void 0,sourceNames:s}){const u=(f,h)=>(f==null?void 0:f.id)===(h==null?void 0:h.id);return sh(this.mapInstance.queryRenderedFeatures(e).map(f=>{const h=this.convertToGeoJsonImportFeature(f);return h?{id:f.properties[ar],sourceName:f.source,geoJson:h}:null}),u).filter(f=>!!f&&f.id!==void 0&&f.geoJson&&s.includes(f.sourceName))}convertToGeoJsonImportFeature(e){const s=e.properties[ar];return s===void 0||e.geometry.type==="GeometryCollection"?null:{id:s,type:"Feature",properties:e.properties,geometry:e.geometry}}addSource(e,s){return new Pg({gm:this.gm,sourceId:e,geoJson:s})}getSource(e){return new Pg({gm:this.gm,sourceId:e})}addLayer(e){const s=e.id;return new Ku({gm:this.gm,layerId:s,options:e})}getLayer(e){return new Ku({gm:this.gm,layerId:e})}removeLayer(e){const s=this.getLayer(e);s&&s.remove()}eachLayer(e){this.mapInstance.getStyle().layers.forEach(s=>{e(new Ku({gm:this.gm,layerId:s.id}))})}createDomMarker(e,s){return new Vw({mapInstance:this.mapInstance,options:e,lngLat:s})}createPopup(e,s){return new Xw({mapInstance:this.mapInstance,options:e,lngLat:s})}project(e){const s=this.mapInstance.project(e);return[s.x,s.y]}unproject(e){const s=this.mapInstance.unproject(e);return[s.lng,s.lat]}coordBoundsToScreenBounds(e){const s=new pt.LngLatBounds(e),u=this.project(s.getSouthWest().toArray()),l=this.project(s.getNorthEast().toArray());return[u,l]}fire(e,s){this.mapInstance.fire(e,s)}on(e,s,u){if(typeof s=="string"&&u&&Qu(e))this.mapInstance.on(e,s,u);else if(typeof s=="function")this.mapInstance.on(e,s);else throw new Error("Invalid arguments passed to 'on' method")}once(e,s,u){if(typeof s=="string"&&u&&Qu(e))this.mapInstance.once(e,s,u);else if(typeof s=="function")this.mapInstance.once(e,s);else throw new Error("Invalid arguments passed to 'once' method.")}off(e,s,u){if(typeof s=="string"&&u&&Qu(e))this.mapInstance.off(e,s,u);else if(typeof s=="function")this.mapInstance.off(e,s);else throw new Error("Invalid arguments passed to 'off' method")}}const $w=async(n,r)=>new jw(r,n),Og=(n,r)=>{if(Array.isArray(n)&&Array.isArray(r)){const e=U1(n,"type");return r.forEach(s=>{e[s.type]?z1(e[s.type],s):e[s.type]=an(s)}),R1(e)}};class Rg{constructor(r,e){O(this,"gm");O(this,"settings");O(this,"controls");O(this,"layerStyles");this.gm=r;const s=this.getMergedOptions(e);this.settings=s.settings,this.controls=s.controls,this.layerStyles=s.layerStyles}getMergedOptions(r={}){return T1(vf(),r,Og)}enableMode(r,e){const s=this.isModeEnabled(r,e),u=this.isModeAvailable(r,e);if(u||ie.warn(`Unable to enable mode, "${r}:${e}" is not available`),s||!u)return;const f=this.controls[r][e];f?(f.active=!0,this.fireModeEvent(r,e,"mode_start"),this.fireControlEvent(r,e,"on"),this.fireModeEvent(r,e,"mode_started")):ie.error("Can't find control section for",r,e)}disableMode(r,e){const s=this.isModeEnabled(r,e),u=this.isModeAvailable(r,e);if(!s||!u)return;const f=this.controls[r][e];f?(f.active=!1,this.fireModeEvent(r,e,"mode_end"),this.fireControlEvent(r,e,"off"),this.fireModeEvent(r,e,"mode_ended")):ie.error("Can't find control section for",r,e)}syncModeState(r,e){const u=this.controls[r][e],l=this.isModeAvailable(r,e);u&&(l?u.active?this.enableMode(r,e):this.disableMode(r,e):(console.log(`Not available mode: ${r}:${e}`),u.active=!1,u.uiEnabled=!1))}toggleMode(r,e){this.isModeEnabled(r,e)?this.disableMode(r,e):this.enableMode(r,e)}isModeEnabled(r,e){return!!Object.entries(this.gm.actionInstances).find(([s,u])=>s===`${r}__${e}`&&u)}isModeAvailable(r,e){return r==="draw"&&er(e,vu)?!!this.gm.drawClassMap[e]:r==="edit"&&er(e,ju)?!!this.gm.editClassMap[e]:r==="helper"&&er(e,$u)?!!this.gm.helperClassMap[e]:!1}getControlOptions({actionType:r,modeName:e}){return r&&e&&this.controls[r][e]||null}fireModeEvent(r,e,s){const u={level:"system",type:r,mode:e,action:s};Ma(u)&&(ba(u)?this.gm.events.fire(`${pe}:${r}`,u):Pr(u)?this.gm.events.fire(`${pe}:${r}`,u):Xi(u)&&this.gm.events.fire(`${pe}:${r}`,u))}fireControlEvent(r,e,s){const u={level:"system",type:"control",section:r,target:e,action:s};this.gm.events.fire(`${pe}:control`,u)}}class el extends kn{constructor(){super(...arguments);O(this,"mode","circle");O(this,"shape","circle");O(this,"circleCenterPoint",null);O(this,"circleCenterLngLat",null);O(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.gm.markerPointer.disable(),this.fireFinishEvent()}createFeature(){const e=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(this.circleCenterLngLat||[0,0]),sourceName:se.temporary});return e&&this.circleCenterLngLat&&e.setShapeProperty("center",this.circleCenterLngLat),e}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}createMarker(){const e=document.createElement("div");e.innerHTML=Al;const s=e.firstChild;return s.style.color="#278cda",s.style.width="28px",s.style.height="28px",s.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"center",element:s},[0,0])}getControlMarkerData(){const e=this.gm.markerPointer.marker;return e?{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}}:null}fireStartEvent(e,s){const u={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:s};this.gm.events.fire(`${pe}:draw`,u)}fireUpdateEvent(e,s){const u={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:s};this.gm.events.fire(`${pe}:draw`,u)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${pe}:draw`,e)}}class Kw extends el{constructor(){super(...arguments);O(this,"mode","circle_marker");O(this,"shape","circle_marker")}onStartAction(){this.gm.markerPointer.enable({customMarker:this.createMarker()})}onEndAction(){this.fireMarkerPointerFinishEvent(),super.onEndAction()}onMouseMove(){return this.fireMarkerPointerUpdateEvent(),{next:!0}}onMouseClick(e){var u;const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();return this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(s)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(),this.circleCenterLngLat=s,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.updateFeaturePosition(this.circleCenterLngLat),this.saveFeature()),{next:!1}}updateFeaturePosition(e){if(!this.featureData)return;const s=this.getFeatureGeoJson(e);this.featureData.updateGeoJsonGeometry(s.geometry)}}const Qw=()=>"ontouchstart"in window||navigator.maxTouchPoints>0||matchMedia("(hover: none)").matches?!0:"msMaxTouchPoints"in navigator&&typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0,dr=(n,r,e=10)=>{const s={...n};return ot(n).forEach(u=>{const l=n[u];typeof l=="function"?s[u]=ih(l.bind(r),e,{leading:!0,trailing:!1}):ie.error("convertToThrottled: item is not a function",n[u])}),s},ek=(n,r,e=10)=>{const s={...n};return ot(n).forEach(u=>{const l=n[u];typeof l=="function"?s[u]=Vo(l.bind(r),e,{leading:!1,trailing:!0}):ie.error("convertToDebounced: item is not a function",n[u])}),s};class tk extends el{constructor(){super(...arguments);O(this,"mode","circle");O(this,"shape","circle");O(this,"throttledMethods",dr({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay))}onMouseClick(e){var u;if(!Ke(e))return{next:!0};const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();if(this.circleCenterPoint&&this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,s)]}),this.flags.featureCreateAllowed&&(this.saveCircleFeature(s),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.fireFinishEvent());else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(s)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=s,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const l=this.getControlMarkerData();this.featureData&&l&&this.fireStartEvent(this.featureData,l)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterPoint||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(this.featureData&&this.circleCenterLngLat){const s=this.getCircleGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(s.geometry);const u=this.getControlMarkerData();u&&this.fireUpdateEvent(this.featureData,u)}}saveCircleFeature(e){var s;if(this.circleCenterLngLat&&this.featureData){const u=((s=this.gm.markerPointer.marker)==null?void 0:s.getLngLat())||e;this.updateFeatureGeoJson(u),this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?eu(this.featureData.getGeoJson()):!1}getCircleGeoJson(e,s){const u=this.gm.mapAdapter.getDistance(e,s);return{...nu({center:e,radius:u}),properties:{shape:this.shape}}}}const nk={dom:`<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21">
    <circle cx="10.5" cy="10.5" r="9.213" fill="#fff" stroke="#278cda" stroke-width="2.303"/>
</svg>
`},Dg=(n,r=void 0)=>{const e=document.createElement("div");e.classList.add("marker-wrapper"),e.style.lineHeight="0",e.innerHTML=nk[n];const s=e.firstChild;return r&&Object.assign(s.style,r),e};function rk(n,r={}){var e,s,u,l=r.properties,f=(e=r.autoComplete)!=null?e:!0,h=(s=r.orderCoords)!=null?s:!0,m=(u=r.mutate)!=null?u:!1;switch(m||(n=Fs(n)),n.type){case"FeatureCollection":var d=[];return n.features.forEach(function(v){d.push(Ct(Fg(v,{},f,h)))}),xo(d,l);default:return Fg(n,l,f,h)}}function Fg(n,r,e,s){r=r||(n.type==="Feature"?n.properties:{});var u=Ni(n),l=u.coordinates,f=u.type;if(!l.length)throw new Error("line must contain coordinates");switch(f){case"LineString":return e&&(l=Gg(l)),Dn([l],r);case"MultiLineString":var h=[],m=0;return l.forEach(function(d){if(e&&(d=Gg(d)),s){var v=ik(_n(qr(d)));v>m?(h.unshift(d),m=v):h.push(d)}else h.push(d)}),Dn(h,r);default:throw new Error("geometry type "+f+" is not supported")}}function Gg(n){var r=n[0],e=r[0],s=r[1],u=n[n.length-1],l=u[0],f=u[1];return(e!==l||s!==f)&&n.push(r),n}function ik(n){var r=n[0],e=n[1],s=n[2],u=n[3];return Math.abs(r-s)*Math.abs(e-u)}var tl=rk;const Bg=n=>!!n&&typeof n=="object"&&n instanceof Vn&&"removeSnapGuides"in n&&"updateSnapGuides"in n&&n.mode==="snap_guides"&&typeof n.removeSnapGuides=="function"&&typeof n.updateSnapGuides=="function",sk=n=>!!n&&typeof n=="object"&&n instanceof Vn&&"getShortestPath"in n&&n.mode==="auto_trace"&&typeof n.getShortestPath=="function",ak=n=>!!n&&typeof n=="object"&&n instanceof Vn&&"getSharedMarkers"in n&&n.mode==="pin"&&typeof n.getSharedMarkers=="function";class to extends kn{constructor(e,s={snappingMarkers:"none",targetShape:"line"}){super(e);O(this,"mode","line");O(this,"snappingKey","line_drawer");O(this,"drawOptions");O(this,"shapeLngLats",[]);O(this,"throttledMethods",dr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay));O(this,"mapEventHandlers",{[`${pe}:helper`]:this.handleGmHelperEvent.bind(this),click:this.onMouseClick.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this)});O(this,"drawerEventHandlers",{firstMarkerClick:null,lastMarkerClick:null,nMarkerClick:null});this.drawOptions=s}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return Bg(e)?e:null}get autoTraceEnabled(){var e;return((e=this.gm.options.controls.helper.auto_trace)==null?void 0:e.active)||!1}get autoTraceHelperInstance(){return this.autoTraceEnabled&&Object.values(this.gm.actionInstances).find(sk)||null}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){var e;this.gm.markerPointer.disable(),this.endShape(),(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmHelperEvent(e){return Xi(e)?(e.mode==="snap_guides"&&e.action==="mode_start"&&this.updateSnapGuides(),{next:!0}):(ie.error("LineDrawer.handleGmHelperEvent: invalid event",e),{next:!0})}updateSnapGuides(){var e;if(this.snapGuidesInstance){const s=(e=this.featureData)==null?void 0:e.getGeoJson();s&&s.geometry.coordinates.pop(),this.snapGuidesInstance.updateSnapGuides(s||null,this.shapeLngLats.at(-1)||null,!0)}}on(e,s){this.drawerEventHandlers[e]=s}onMouseClick(e){var u;if(!Ke(e,{warning:!0}))return{next:!0};const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();if(this.featureData){const l=this.getClickedMarkerInfo(e);this.handleNextVertex(s,l)}else this.isFeatureAllowed(hh(s))&&this.startShape(s);return this.updateSnapGuides(),{next:!0}}handleNextVertex(e,s){var f,h,m,d,v,y;if(!this.featureData){ie.error("LineDrawer.handleNextVertex: no featureData");return}const u=this.featureData.markers.size,l=this.getMarkerClickEventData(s.index);s.index<u-1&&this.addPoint(e,s),s.index!==-1&&(s.index===0?(h=(f=this.drawerEventHandlers).firstMarkerClick)==null||h.call(f,l):s.index>0&&s.index===u-1&&((d=(m=this.drawerEventHandlers).lastMarkerClick)==null||d.call(m,l)),s.index>=0&&((y=(v=this.drawerEventHandlers).nMarkerClick)==null||y.call(v,l)))}getMarkerClickEventData(e){const s=this.getFeatureGeoJson({withControlMarker:!1});return{markerIndex:e,shapeCoordinates:this.getShapeCoordinates({withControlMarker:!1}),geoJson:s,bounds:Qo(s)}}onMouseMove(e){return Ke(e,{warning:!0})?(this.featureData&&this.shapeLngLats.length&&this.updateFeatureSource(),{next:!0}):{next:!0}}startShape(e){this.shapeLngLats=[e],this.featureData=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson({withControlMarker:!0}),sourceName:se.temporary});const s={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",0]}};this.featureData&&(this.featureData.markers.set(s.position.path.join("."),s),this.setSnapping(),this.fireStartEvent(this.featureData,s)),this.gm.mapAdapter.disableMapInteractions(["doubleClickZoom"])}endShape(){const e=this.getFeatureGeoJson({withControlMarker:!1});this.removeSnapping(),this.removeTmpFeature(),this.shapeLngLats=[],this.gm.mapAdapter.enableMapInteractions(["doubleClickZoom"]),this.fireStopEvent(e)}setSnapping(){if(!this.snappingHelper)return;const e=this.drawOptions.snappingMarkers;e==="none"?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[]):e==="all"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,this.shapeLngLats):e==="first"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[0]]):e==="last"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[this.shapeLngLats.length-1]]):ie.error("LineDrawer.setSnapping: invalid data",e,this.shapeLngLats)}removeSnapping(){this.snappingHelper&&this.snappingHelper.clearCustomSnappingCoordinates(this.snappingKey)}getClickedMarkerInfo(e){if(!this.featureData)return{index:-1,path:null};let s=0,u=null;try{this.featureData.markers.forEach((l,f)=>{if(l.instance instanceof Os){const h=l.instance.getElement()||null,m=e.originalEvent.target,d=m instanceof Element?m:null;if(h&&h.contains(d))throw u=f,new Error("stop")}s+=1})}catch{if(u)return{index:s,path:u}}return{index:-1,path:null}}addPoint(e,s){const u=this.featureData;if(!u){ie.error("LineDrawer.addPoint: no featureData");return}const l=this.getAddedLngLats(e,s),f=this.getFeatureGeoJsonWithType({withControlMarker:!0,coordinates:this.shapeLngLats.concat(l)});this.isFeatureAllowed(f)&&(l.forEach(h=>{this.shapeLngLats.push(h);const m=this.addMarker(h,u);this.fireUpdateEvent(u,m)}),this.updateFeatureSource())}isFeatureAllowed(e){return this.gm.getActiveDrawModes().length?(this.fireBeforeFeatureCreate({geoJsonFeatures:[e]}),this.flags.featureCreateAllowed):!0}getAddedLngLats(e,s){if(!this.featureData)return ie.error("LineDrawer.getCurrentLngLats: no featureData"),[];const l=this.getMarkerInfoLngLat(s)||e,f=this.getAutoTracePath(l);return[...(f==null?void 0:f.slice(1,-1))||[],l]}getAutoTracePath(e){const s=this.shapeLngLats.at(-1);return this.autoTraceEnabled&&this.autoTraceHelperInstance&&s&&this.autoTraceHelperInstance.getShortestPath(s,e)||null}getMarkerInfoLngLat(e){if(this.featureData&&e.path){const s=this.featureData.markers.get(e.path);if(s&&s.type==="dom")return s.instance.getLngLat();ie.error("LineDrawer.addPoint: no markerData",e)}return null}addMarker(e,s){const u={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",this.shapeLngLats.length]}};return s.markers.set(u.position.path.join("."),{type:"dom",instance:u.instance,position:{coordinate:e,path:[]}}),u}createMarker(e){return this.gm.mapAdapter.createDomMarker({element:Dg("dom",{pointerEvents:"auto",cursor:"pointer"}),anchor:"center"},e)}updateFeatureSource(){if(this.featureData&&(this.featureData.updateGeoJsonGeometry(this.getFeatureGeoJson({withControlMarker:!0}).geometry),this.gm.markerPointer.marker)){const e={type:"dom",instance:this.gm.markerPointer.marker,position:{coordinate:this.gm.markerPointer.marker.getLngLat(),path:["geometry","coordinates",this.shapeLngLats.length]}};this.fireUpdateEvent(this.featureData,e)}}getFeatureGeoJson({withControlMarker:e,coordinates:s=void 0}){return{type:"Feature",properties:{shape:"line"},geometry:{type:"LineString",coordinates:s||this.getShapeCoordinates({withControlMarker:e})}}}getFeatureGeoJsonWithType({withControlMarker:e,coordinates:s=void 0}){const u=this.getFeatureGeoJson({withControlMarker:e,coordinates:s});return this.drawOptions.targetShape==="polygon"&&u.geometry.coordinates.length>3?tl(u,{properties:u.properties}):u}getShapeCoordinates({withControlMarker:e}){const s=[...this.shapeLngLats];return e&&this.gm.markerPointer.marker&&s.push(this.gm.markerPointer.marker.getLngLat()),s}fireStartEvent(e,s){this.gm.events.fire(`${pe}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"start",featureData:e,markerData:s})}fireUpdateEvent(e,s){this.gm.events.fire(`${pe}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"update",featureData:e,markerData:s})}fireStopEvent(e){this.gm.events.fire(`${pe}:draw`,{level:"system",type:"draw",mode:"line",action:"finish",variant:"line_drawer",geoJsonFeature:e})}}class ok extends kn{constructor(){super(...arguments);O(this,"mode","line");O(this,"shape","line");O(this,"lineDrawer",new to(this.gm,{snappingMarkers:"first",targetShape:"line"}));O(this,"mapEventHandlers",{[`${pe}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("nMarkerClick",this.lineFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return Ke(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}lineFinished(e){this.lineDrawer.endShape();let s=e.shapeCoordinates;return e.markerIndex>0&&(s=s.slice(0,e.markerIndex+1)),s.length<2?null:this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(s),sourceName:se.main})}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"LineString",coordinates:e}}}}class uk extends kn{constructor(){super(...arguments);O(this,"mode","marker");O(this,"shape","marker");O(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){const e=this.createMarker();this.gm.markerPointer.enable({customMarker:e}),this.fireMarkerPointerStartEvent()}onEndAction(){this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseClick(e){return Ke(e)&&(this.featureData=this.createFeature(e),this.featureData&&this.saveFeature()),{next:!1}}onMouseMove(e){return!Ke(e)||!this.gm.markerPointer.marker?{next:!0}:(this.fireMarkerPointerUpdateEvent(),{next:!0})}createMarker(){const e=document.createElement("div");return e.style.backgroundImage=`url("${xr}")`,e.style.width="36px",e.style.height="36px",e.style.backgroundSize="cover",e.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"bottom",element:e},[0,0])}createFeature(e){var l;const s=((l=this.gm.markerPointer.marker)==null?void 0:l.getLngLat())||e.lngLat.toArray(),u=this.getFeatureGeoJson(s);return u&&(this.fireBeforeFeatureCreate({geoJsonFeatures:[u]}),this.flags.featureCreateAllowed)?this.gm.features.createFeature({shapeGeoJson:u,sourceName:se.temporary}):null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}}function lk(n){var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return yn(n,e=>{var s;switch((s=e.geometry)==null?void 0:s.type){case"Point":r.MultiPoint.coordinates.push(e.geometry.coordinates),r.MultiPoint.properties.push(e.properties);break;case"MultiPoint":r.MultiPoint.coordinates.push(...e.geometry.coordinates),r.MultiPoint.properties.push(e.properties);break;case"LineString":r.MultiLineString.coordinates.push(e.geometry.coordinates),r.MultiLineString.properties.push(e.properties);break;case"MultiLineString":r.MultiLineString.coordinates.push(...e.geometry.coordinates),r.MultiLineString.properties.push(e.properties);break;case"Polygon":r.MultiPolygon.coordinates.push(e.geometry.coordinates),r.MultiPolygon.properties.push(e.properties);break;case"MultiPolygon":r.MultiPolygon.coordinates.push(...e.geometry.coordinates),r.MultiPolygon.properties.push(e.properties);break}}),$e(Object.keys(r).filter(function(e){return r[e].coordinates.length}).sort().map(function(e){var s={type:e,coordinates:r[e].coordinates},u={collectedProperties:r[e].properties};return tn(s,u)}))}var ck=lk;function hk(n,r,e,s,u){Ug(n,r,e||0,s||n.length-1,u||fk)}function Ug(n,r,e,s,u){for(;s>e;){if(s-e>600){var l=s-e+1,f=r-e+1,h=Math.log(l),m=.5*Math.exp(2*h/3),d=.5*Math.sqrt(h*m*(l-m)/l)*(f-l/2<0?-1:1),v=Math.max(e,Math.floor(r-f*m/l+d)),y=Math.min(s,Math.floor(r+(l-f)*m/l+d));Ug(n,r,v,y,u)}var E=n[r],S=e,M=s;for(ls(n,e,r),u(n[s],E)>0&&ls(n,e,s);S<M;){for(ls(n,S,M),S++,M--;u(n[S],E)<0;)S++;for(;u(n[M],E)>0;)M--}u(n[e],E)===0?ls(n,e,M):(M++,ls(n,M,s)),M<=r&&(e=M+1),r<=M&&(s=M-1)}}function ls(n,r,e){var s=n[r];n[r]=n[e],n[e]=s}function fk(n,r){return n<r?-1:n>r?1:0}class Ht{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(r){let e=this.data;const s=[];if(!ro(r,e))return s;const u=this.toBBox,l=[];for(;e;){for(let f=0;f<e.children.length;f++){const h=e.children[f],m=e.leaf?u(h):h;ro(r,m)&&(e.leaf?s.push(h):rl(r,m)?this._all(h,s):l.push(h))}e=l.pop()}return s}collides(r){let e=this.data;if(!ro(r,e))return!1;const s=[];for(;e;){for(let u=0;u<e.children.length;u++){const l=e.children[u],f=e.leaf?this.toBBox(l):l;if(ro(r,f)){if(e.leaf||rl(r,f))return!0;s.push(l)}}e=s.pop()}return!1}load(r){if(!(r&&r.length))return this;if(r.length<this._minEntries){for(let s=0;s<r.length;s++)this.insert(r[s]);return this}let e=this._build(r.slice(),0,r.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const s=this.data;this.data=e,e=s}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=pi([]),this}remove(r,e){if(!r)return this;let s=this.data;const u=this.toBBox(r),l=[],f=[];let h,m,d;for(;s||l.length;){if(s||(s=l.pop(),m=l[l.length-1],h=f.pop(),d=!0),s.leaf){const v=gk(r,s.children,e);if(v!==-1)return s.children.splice(v,1),l.push(s),this._condense(l),this}!d&&!s.leaf&&rl(s,u)?(l.push(s),f.push(h),h=0,m=s,s=s.children[0]):m?(h++,s=m.children[h],d=!1):s=null}return this}toBBox(r){return r}compareMinX(r,e){return r.minX-e.minX}compareMinY(r,e){return r.minY-e.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,e){const s=[];for(;r;)r.leaf?e.push(...r.children):s.push(...r.children),r=s.pop();return e}_build(r,e,s,u){const l=s-e+1;let f=this._maxEntries,h;if(l<=f)return h=pi(r.slice(e,s+1)),di(h,this.toBBox),h;u||(u=Math.ceil(Math.log(l)/Math.log(f)),f=Math.ceil(l/Math.pow(f,u-1))),h=pi([]),h.leaf=!1,h.height=u;const m=Math.ceil(l/f),d=m*Math.ceil(Math.sqrt(f));zg(r,e,s,d,this.compareMinX);for(let v=e;v<=s;v+=d){const y=Math.min(v+d-1,s);zg(r,v,y,m,this.compareMinY);for(let E=v;E<=y;E+=m){const S=Math.min(E+m-1,y);h.children.push(this._build(r,E,S,u-1))}}return di(h,this.toBBox),h}_chooseSubtree(r,e,s,u){for(;u.push(e),!(e.leaf||u.length-1===s);){let l=1/0,f=1/0,h;for(let m=0;m<e.children.length;m++){const d=e.children[m],v=nl(d),y=mk(r,d)-v;y<f?(f=y,l=v<l?v:l,h=d):y===f&&v<l&&(l=v,h=d)}e=h||e.children[0]}return e}_insert(r,e,s){const u=s?r:this.toBBox(r),l=[],f=this._chooseSubtree(u,this.data,e,l);for(f.children.push(r),hs(f,u);e>=0&&l[e].children.length>this._maxEntries;)this._split(l,e),e--;this._adjustParentBBoxes(u,l,e)}_split(r,e){const s=r[e],u=s.children.length,l=this._minEntries;this._chooseSplitAxis(s,l,u);const f=this._chooseSplitIndex(s,l,u),h=pi(s.children.splice(f,s.children.length-f));h.height=s.height,h.leaf=s.leaf,di(s,this.toBBox),di(h,this.toBBox),e?r[e-1].children.push(h):this._splitRoot(s,h)}_splitRoot(r,e){this.data=pi([r,e]),this.data.height=r.height+1,this.data.leaf=!1,di(this.data,this.toBBox)}_chooseSplitIndex(r,e,s){let u,l=1/0,f=1/0;for(let h=e;h<=s-e;h++){const m=cs(r,0,h,this.toBBox),d=cs(r,h,s,this.toBBox),v=vk(m,d),y=nl(m)+nl(d);v<l?(l=v,u=h,f=y<f?y:f):v===l&&y<f&&(f=y,u=h)}return u||s-e}_chooseSplitAxis(r,e,s){const u=r.leaf?this.compareMinX:dk,l=r.leaf?this.compareMinY:pk,f=this._allDistMargin(r,e,s,u),h=this._allDistMargin(r,e,s,l);f<h&&r.children.sort(u)}_allDistMargin(r,e,s,u){r.children.sort(u);const l=this.toBBox,f=cs(r,0,e,l),h=cs(r,s-e,s,l);let m=no(f)+no(h);for(let d=e;d<s-e;d++){const v=r.children[d];hs(f,r.leaf?l(v):v),m+=no(f)}for(let d=s-e-1;d>=e;d--){const v=r.children[d];hs(h,r.leaf?l(v):v),m+=no(h)}return m}_adjustParentBBoxes(r,e,s){for(let u=s;u>=0;u--)hs(e[u],r)}_condense(r){for(let e=r.length-1,s;e>=0;e--)r[e].children.length===0?e>0?(s=r[e-1].children,s.splice(s.indexOf(r[e]),1)):this.clear():di(r[e],this.toBBox)}}function gk(n,r,e){if(!e)return r.indexOf(n);for(let s=0;s<r.length;s++)if(e(n,r[s]))return s;return-1}function di(n,r){cs(n,0,n.children.length,r,n)}function cs(n,r,e,s,u){u||(u=pi(null)),u.minX=1/0,u.minY=1/0,u.maxX=-1/0,u.maxY=-1/0;for(let l=r;l<e;l++){const f=n.children[l];hs(u,n.leaf?s(f):f)}return u}function hs(n,r){return n.minX=Math.min(n.minX,r.minX),n.minY=Math.min(n.minY,r.minY),n.maxX=Math.max(n.maxX,r.maxX),n.maxY=Math.max(n.maxY,r.maxY),n}function dk(n,r){return n.minX-r.minX}function pk(n,r){return n.minY-r.minY}function nl(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function no(n){return n.maxX-n.minX+(n.maxY-n.minY)}function mk(n,r){return(Math.max(r.maxX,n.maxX)-Math.min(r.minX,n.minX))*(Math.max(r.maxY,n.maxY)-Math.min(r.minY,n.minY))}function vk(n,r){const e=Math.max(n.minX,r.minX),s=Math.max(n.minY,r.minY),u=Math.min(n.maxX,r.maxX),l=Math.min(n.maxY,r.maxY);return Math.max(0,u-e)*Math.max(0,l-s)}function rl(n,r){return n.minX<=r.minX&&n.minY<=r.minY&&r.maxX<=n.maxX&&r.maxY<=n.maxY}function ro(n,r){return r.minX<=n.maxX&&r.minY<=n.maxY&&r.maxX>=n.minX&&r.maxY>=n.minY}function pi(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function zg(n,r,e,s,u){const l=[r,e];for(;l.length;){if(e=l.pop(),r=l.pop(),e-r<=s)continue;const f=r+Math.ceil((e-r)/s/2)*s;hk(n,f,r,e,u),l.push(r,f,f,e)}}function yk(n){return vp(n,(r,e)=>r+_k(e),0)}function _k(n){let r=0,e;switch(n.type){case"Polygon":return qg(n.coordinates);case"MultiPolygon":for(e=0;e<n.coordinates.length;e++)r+=qg(n.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function qg(n){let r=0;if(n&&n.length>0){r+=Math.abs(Yg(n[0]));for(let e=1;e<n.length;e++)r-=Math.abs(Yg(n[e]))}return r}var Ek=tt*tt/2,il=Math.PI/180;function Yg(n){const r=n.length-1;if(r<=2)return 0;let e=0,s=0;for(;s<r;){const u=n[s],l=n[s+1===r?0:s+1],f=n[s+2>=r?(s+2)%r:s+2],h=u[0]*il,m=l[1]*il,d=f[0]*il;e+=(d-h)*Math.sin(m),s++}return e*Ek}function xk(n,r,e){if(n.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");e===void 0&&(e=1);var s=n.geometry.coordinates,u=[],l={};if(e){for(var f=[],h=0;h<s.length;h++)for(var m=0;m<s[h].length-1;m++)f.push(U(h,m));var d=new Ht;d.load(f)}for(var v=0;v<s.length;v++)for(var y=0;y<s[v].length-1;y++)if(e){var E=d.search(U(v,y));E.forEach(function(G){var I=G.ring,H=G.edge;D(v,y,I,H)})}else for(var S=0;S<s.length;S++)for(var M=0;M<s[S].length-1;M++)D(v,y,S,M);return r||(u={type:"Feature",geometry:{type:"MultiPoint",coordinates:u}}),u;function D(G,I,H,J){var X=s[G][I],W=s[G][I+1],$=s[H][J],x=s[H][J+1],k=wk(X,W,$,x);if(k!==null){var b,A;if(W[0]!==X[0]?b=(k[0]-X[0])/(W[0]-X[0]):b=(k[1]-X[1])/(W[1]-X[1]),x[0]!==$[0]?A=(k[0]-$[0])/(x[0]-$[0]):A=(k[1]-$[1])/(x[1]-$[1]),!(b>=1||b<=0||A>=1||A<=0)){var T=k,F=!l[T];F&&(l[T]=!0),r?u.push(r(k,G,I,X,W,b,H,J,$,x,A,F)):u.push(k)}}}function U(G,I){var H=s[G][I],J=s[G][I+1],X,W,$,x;return H[0]<J[0]?(X=H[0],W=J[0]):(X=J[0],W=H[0]),H[1]<J[1]?($=H[1],x=J[1]):($=J[1],x=H[1]),{minX:X,minY:$,maxX:W,maxY:x,ring:G,edge:I}}}function wk(n,r,e,s){if(fs(n,e)||fs(n,s)||fs(r,e)||fs(s,e))return null;var u=n[0],l=n[1],f=r[0],h=r[1],m=e[0],d=e[1],v=s[0],y=s[1],E=(u-f)*(d-y)-(l-h)*(m-v);if(E===0)return null;var S=((u*h-l*f)*(m-v)-(u-f)*(m*y-d*v))/E,M=((u*h-l*f)*(d-y)-(l-h)*(m*y-d*v))/E;return[S,M]}function fs(n,r){if(!n||!r||n.length!==r.length)return!1;for(var e=0,s=n.length;e<s;e++)if(n[e]instanceof Array&&r[e]instanceof Array){if(!fs(n[e],r[e]))return!1}else if(n[e]!==r[e])return!1;return!0}function kk(n){if(n.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(n.geometry===void 0||n.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(n.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var r=n.geometry.coordinates.length,e=[],I=0;I<r;I++){var s=n.geometry.coordinates[I];gs(s[0],s[s.length-1])||s.push(s[0]);for(var u=0;u<s.length-1;u++)e.push(s[u])}if(!Mk(e))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var l=e.length,f=xk(n,function(oe,le,we,Ne,V,fn,be,fe,C,De,Oe,Ie){return[oe,le,we,Ne,V,fn,be,fe,C,De,Oe,Ie]}),h=f.length;if(h==0){for(var $=[],I=0;I<r;I++)$.push(Dn([n.geometry.coordinates[I]],{parent:-1,winding:Sk(n.geometry.coordinates[I])}));var j=$e($);return K(),re(),j}for(var m=[],d=[],I=0;I<r;I++){m.push([]);for(var u=0;u<n.geometry.coordinates[I].length-1;u++)m[I].push([new Hg(n.geometry.coordinates[I][mi(u+1,n.geometry.coordinates[I].length-1)],1,[I,u],[I,mi(u+1,n.geometry.coordinates[I].length-1)],void 0)]),d.push(new Jg(n.geometry.coordinates[I][u],[I,mi(u-1,n.geometry.coordinates[I].length-1)],[I,u],void 0,void 0,!1,!0))}for(var I=0;I<h;I++)m[f[I][1]][f[I][2]].push(new Hg(f[I][0],f[I][5],[f[I][1],f[I][2]],[f[I][6],f[I][7]],void 0)),f[I][11]&&d.push(new Jg(f[I][0],[f[I][1],f[I][2]],[f[I][6],f[I][7]],void 0,void 0,!0,!0));for(var v=d.length,I=0;I<m.length;I++)for(var u=0;u<m[I].length;u++)m[I][u].sort(function(le,we){return le.param<we.param?-1:1});for(var y=[],I=0;I<v;I++)y.push({minX:d[I].coord[0],minY:d[I].coord[1],maxX:d[I].coord[0],maxY:d[I].coord[1],index:I});var E=new Ht;E.load(y);for(var I=0;I<m.length;I++)for(var u=0;u<m[I].length;u++)for(var S=0;S<m[I][u].length;S++){var M;S==m[I][u].length-1?M=m[I][mi(u+1,n.geometry.coordinates[I].length-1)][0].coord:M=m[I][u][S+1].coord;var D=E.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0];m[I][u][S].nxtIsectAlongEdgeIn=D.index}for(var I=0;I<m.length;I++)for(var u=0;u<m[I].length;u++)for(var S=0;S<m[I][u].length;S++){var M=m[I][u][S].coord,D=E.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0],U=D.index;U<l?d[U].nxtIsectAlongRingAndEdge2=m[I][u][S].nxtIsectAlongEdgeIn:gs(d[U].ringAndEdge1,m[I][u][S].ringAndEdgeIn)?d[U].nxtIsectAlongRingAndEdge1=m[I][u][S].nxtIsectAlongEdgeIn:d[U].nxtIsectAlongRingAndEdge2=m[I][u][S].nxtIsectAlongEdgeIn}for(var G=[],I=0,u=0;u<r;u++){for(var H=I,S=0;S<n.geometry.coordinates[u].length-1;S++)d[I].coord[0]<d[H].coord[0]&&(H=I),I++;for(var J=d[H].nxtIsectAlongRingAndEdge2,S=0;S<d.length;S++)if(d[S].nxtIsectAlongRingAndEdge1==H||d[S].nxtIsectAlongRingAndEdge2==H){var X=S;break}var W=io([d[X].coord,d[H].coord,d[J].coord],!0)?1:-1;G.push({isect:H,parent:-1,winding:W})}G.sort(function(he,oe){return d[he.isect].coord>d[oe.isect].coord?-1:1});for(var $=[];G.length>0;){var x=G.pop(),k=x.isect,b=x.parent,A=x.winding,T=$.length,F=[d[k].coord],P=k;if(d[k].ringAndEdge1Walkable)var N=d[k].ringAndEdge1,R=d[k].nxtIsectAlongRingAndEdge1;else var N=d[k].ringAndEdge2,R=d[k].nxtIsectAlongRingAndEdge2;for(;!gs(d[k].coord,d[R].coord);){F.push(d[R].coord);for(var Y=void 0,I=0;I<G.length;I++)if(G[I].isect==R){Y=I;break}if(Y!=null&&G.splice(Y,1),gs(N,d[R].ringAndEdge1)){if(N=d[R].ringAndEdge2,d[R].ringAndEdge2Walkable=!1,d[R].ringAndEdge1Walkable){var z={isect:R};io([d[P].coord,d[R].coord,d[d[R].nxtIsectAlongRingAndEdge2].coord],A==1)?(z.parent=b,z.winding=-A):(z.parent=T,z.winding=A),G.push(z)}P=R,R=d[R].nxtIsectAlongRingAndEdge2}else{if(N=d[R].ringAndEdge1,d[R].ringAndEdge1Walkable=!1,d[R].ringAndEdge2Walkable){var z={isect:R};io([d[P].coord,d[R].coord,d[d[R].nxtIsectAlongRingAndEdge1].coord],A==1)?(z.parent=b,z.winding=-A):(z.parent=T,z.winding=A),G.push(z)}P=R,R=d[R].nxtIsectAlongRingAndEdge1}}F.push(d[R].coord),$.push(Dn([F],{index:T,parent:b,winding:A,netWinding:void 0}))}var j=$e($);K(),re();function K(){for(var he=[],oe=0;oe<j.features.length;oe++)j.features[oe].properties.parent==-1&&he.push(oe);if(he.length>1)for(var oe=0;oe<he.length;oe++){for(var le=-1,we=1/0,Ne=0;Ne<j.features.length;Ne++)he[oe]!=Ne&&Lr(j.features[he[oe]].geometry.coordinates[0][0],j.features[Ne],{ignoreBoundary:!0})&&yk(j.features[Ne])<we&&(le=Ne);j.features[he[oe]].properties.parent=le}}function re(){for(var he=0;he<j.features.length;he++)if(j.features[he].properties.parent==-1){var oe=j.features[he].properties.winding;j.features[he].properties.netWinding=oe,me(he,oe)}}function me(he,oe){for(var le=0;le<j.features.length;le++)if(j.features[le].properties.parent==he){var we=oe+j.features[le].properties.winding;j.features[le].properties.netWinding=we,me(le,we)}}return j}var Hg=function(n,r,e,s,u){this.coord=n,this.param=r,this.ringAndEdgeIn=e,this.ringAndEdgeOut=s,this.nxtIsectAlongEdgeIn=u},Jg=function(n,r,e,s,u,l,f){this.coord=n,this.ringAndEdge1=r,this.ringAndEdge2=e,this.nxtIsectAlongRingAndEdge1=s,this.nxtIsectAlongRingAndEdge2=u,this.ringAndEdge1Walkable=l,this.ringAndEdge2Walkable=f};function io(n,r){if(typeof r>"u"&&(r=!0),n.length!=3)throw new Error("This function requires an array of three points [x,y]");var e=(n[1][0]-n[0][0])*(n[2][1]-n[0][1])-(n[1][1]-n[0][1])*(n[2][0]-n[0][0]);return e>=0==r}function Sk(n){for(var r=0,e=0;e<n.length-1;e++)n[e][0]<n[r][0]&&(r=e);if(io([n[mi(r-1,n.length-1)],n[r],n[mi(r+1,n.length-1)]],!0))var s=1;else var s=-1;return s}function gs(n,r){if(!n||!r||n.length!=r.length)return!1;for(var e=0,s=n.length;e<s;e++)if(n[e]instanceof Array&&r[e]instanceof Array){if(!gs(n[e],r[e]))return!1}else if(n[e]!=r[e])return!1;return!0}function mi(n,r){return(n%r+r)%r}function Mk(n){for(var r={},e=1,s=0,u=n.length;s<u;++s){if(Object.prototype.hasOwnProperty.call(r,n[s])){e=0;break}r[n[s]]=1}return e}function Ik(n){var r=[];return rr(n,function(e){e.geometry.type==="Polygon"&&yn(kk(e),function(s){r.push(Dn(s.geometry.coordinates,e.properties))})}),$e(r)}var Lk=Ik;class bk extends kn{constructor(){super(...arguments);O(this,"mode","polygon");O(this,"shape","polygon");O(this,"lineDrawer",new to(this.gm,{snappingMarkers:"first",targetShape:"polygon"}));O(this,"mapEventHandlers",{[`${pe}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onEndAction(){this.lineDrawer.endAction()}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.polygonFinished.bind(this))}onMouseMove(e){return Ke(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}polygonFinished(e){if(this.lineDrawer.endShape(),e.shapeCoordinates.length<3)return;const s=this.fixShapeGeoJson(tl(e.geoJson));s&&this.gm.features.createFeature({shapeGeoJson:{...s,properties:{...s.properties,shape:this.shape}},sourceName:se.main})}fixShapeGeoJson(e){try{return Yl(ck(Lk(e))).features[0]}catch{return null}}}class Ak extends kn{constructor(){super(...arguments);O(this,"mode","rectangle");O(this,"shape","rectangle");O(this,"startLngLat",null);O(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)});O(this,"throttledMethods",dr({updateFeaturePosition:this.updateFeaturePosition},this,this.gm.options.settings.throttlingDelay))}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.startLngLat=null,this.gm.markerPointer.disable(),this.fireFinishEvent()}onMouseClick(e){var u;if(!Ke(e,{warning:!0}))return{next:!1};const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();if(this.startLngLat){const l=this.getFeatureGeoJson($r(this.startLngLat,s));this.fireBeforeFeatureCreate({geoJsonFeatures:[l]}),this.flags.featureCreateAllowed&&this.finishShape(s)}else{const l=this.getFeatureGeoJson($r(s,s));if(this.fireBeforeFeatureCreate({geoJsonFeatures:[l]}),this.flags.featureCreateAllowed){const f=this.startShape(s);if(f){const h=this.getControlMarkerData(["geometry","coordinates",4]);this.fireStartEvent(f,h)}}}return{next:!1}}onMouseMove(e){var f;if(!Ke(e,{warning:!0}))return{next:!1};if(!this.startLngLat)return this.fireMarkerPointerUpdateEvent(),{next:!1};const s=((f=this.gm.markerPointer.marker)==null?void 0:f.getLngLat())||e.lngLat.toArray(),u=$r(this.startLngLat,s),l=this.getFeatureGeoJson(u);return this.fireBeforeFeatureCreate({geoJsonFeatures:[l]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeaturePosition(u),{next:!1}}startShape(e){this.startLngLat=e;const s=$r(this.startLngLat,this.startLngLat);return this.featureData=this.createFeature(s),this.featureData}finishShape(e){if(this.startLngLat){const s=$r(this.startLngLat,e);this.throttledMethods.updateFeaturePosition(s)}this.featureData&&(this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()),this.startLngLat=null,this.fireFinishEvent()}createFeature(e){return this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:se.temporary})}isFeatureGeoJsonValid(){return this.featureData?eu(this.featureData.getGeoJson()):!1}getFeatureGeoJson(e){return{...$o([e[0],e[2]],[e[2],e[3]]),properties:{shape:this.shape}}}updateFeaturePosition(e){if(!this.featureData)return;const s=$o([e[0],e[1]],[e[2],e[3]]);this.featureData.updateGeoJsonGeometry(s.geometry);const u=this.getControlMarkerData(["geometry","coordinates",4]);this.fireUpdateEvent(this.featureData,u)}getControlMarkerData(e){const s=this.gm.markerPointer.marker;return s?{type:"dom",instance:s,position:{coordinate:s.getLngLat(),path:e}}:null}fireStartEvent(e,s){const u={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:s};this.gm.events.fire(`${pe}:draw`,u)}fireUpdateEvent(e,s){const u={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:s};this.gm.events.fire(`${pe}:draw`,u)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${pe}:draw`,e)}}class Ck extends kn{constructor(){super(...arguments);O(this,"mode","text_marker");O(this,"shape","text_marker");O(this,"textarea",null);O(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0})}onEndAction(){this.removeTextarea(),this.removeTmpFeature(),this.featureData=null,this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseMove(e){return Ke(e,{warning:!0})?(this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}onMouseClick(e){var s;if(!Ke(e,{warning:!0}))return{next:!0};if(this.textarea)this.endShape(),this.gm.markerPointer.enable({invisibleMarker:!0,lngLat:e.lngLat.toArray()}),this.fireMarkerPointerUpdateEvent();else{const u=((s=this.gm.markerPointer.marker)==null?void 0:s.getLngLat())||e.lngLat.toArray();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(u)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(u),this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent())}return{next:!1}}createFeature(e){const s=this.gm.mapAdapter.project(e);return this.createTextarea(s),this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:se.temporary})}endShape(){var s;const e=((s=this.textarea)==null?void 0:s.value)||"";this.removeTextarea(),e.trim()?(this.updateFeatureSource(e),this.saveFeature()):this.removeTmpFeature()}createTextarea(e){this.textarea=document.createElement("textarea"),this.textarea.style.position="absolute",this.textarea.style.left=`${e[0]}px`,this.textarea.style.top=`${e[1]}px`,this.textarea.style.opacity="0.7",this.gm.mapAdapter.getContainer().appendChild(this.textarea),this.textarea.focus()}removeTextarea(){var e;(e=this.textarea)==null||e.remove(),this.textarea=null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape,text:""},geometry:{type:"Point",coordinates:e}}}updateFeatureSource(e){this.featureData&&this.featureData.updateGeoJsonProperties({shape:this.shape,text:e})}}class Tk extends el{constructor(){super(...arguments);O(this,"mode","ellipse");O(this,"shape","ellipse");O(this,"xSemiAxisPoint",null);O(this,"xSemiAxisLngLat",null);O(this,"throttledMethods",dr({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay))}onMouseClick(e){var u;if(!Ke(e))return{next:!0};const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();if(this.circleCenterLngLat&&this.xSemiAxisLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,s)]}),this.flags.featureCreateAllowed&&(this.saveEllipseFeature(s),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.xSemiAxisPoint=null,this.xSemiAxisLngLat=null,this.fireFinishEvent());else if(this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getEllipseGeoJson(this.circleCenterLngLat,s)]}),this.flags.featureCreateAllowed&&(this.xSemiAxisLngLat=s,this.xSemiAxisPoint=this.gm.mapAdapter.project(this.circleCenterLngLat));else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(s)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=s,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const l=this.getControlMarkerData();this.featureData&&l&&this.fireStartEvent(this.featureData,l)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.xSemiAxisLngLat?this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,e):this.getEllipseGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterLngLat||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(!this.featureData||!this.circleCenterLngLat)return;const s=this.xSemiAxisLngLat?this.getEllipseGeoJson(this.circleCenterLngLat,this.xSemiAxisLngLat,e):this.getEllipseGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(s.geometry),this.featureData.updateGeoJsonProperties({shape:s.properties.shape});const u=this.getControlMarkerData();u&&this.fireUpdateEvent(this.featureData,u)}saveEllipseFeature(e){var s;if(!(!this.circleCenterLngLat||!this.xSemiAxisLngLat)&&this.featureData){const u=((s=this.gm.markerPointer.marker)==null?void 0:s.getLngLat())||e;this.updateFeatureGeoJson(u);const{xSemiAxis:l,ySemiAxis:f,angle:h}=fh({center:this.circleCenterLngLat,xSemiAxisLngLat:this.xSemiAxisLngLat,rimLngLat:u});this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.featureData.setShapeProperty("xSemiAxis",l),this.featureData.setShapeProperty("ySemiAxis",f),this.featureData.setShapeProperty("angle",h),this.isFeatureGeoJsonValid()?(this.featureData.changeSource({sourceName:"gm_main",atomic:!0}),this.gm.features.fireFeatureCreatedEvent(this.featureData),this.featureData=null):this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?eu(this.featureData.getGeoJson()):!1}getEllipseGeoJson(e,s,u){const{xSemiAxis:l,ySemiAxis:f,angle:h}=fh({center:e,xSemiAxisLngLat:s,rimLngLat:u});return aa({center:e,xSemiAxis:l,ySemiAxis:f,angle:h})}}const Vg={marker:uk,ellipse:Tk,circle:tk,circle_marker:Kw,text_marker:Ck,line:ok,rectangle:Ak,polygon:bk,freehand:null,custom_shape:null};class so extends Nr{constructor(){super(...arguments);O(this,"mode","drag");O(this,"isDragging",!1);O(this,"previousLngLat",null);O(this,"pointBasedShapes",["marker","circle_marker","text_marker"]);O(this,"throttledMethods",dr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay));O(this,"mapEventHandlers",{[`${pe}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this),touchmove:this.throttledMethods.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this)});O(this,"getUpdatedGeoJsonHandlers",{marker:this.moveSource.bind(this),ellipse:this.moveEllipse.bind(this),circle:this.moveCircle.bind(this),circle_marker:this.moveSource.bind(this),text_marker:this.moveSource.bind(this),line:this.moveSource.bind(this),rectangle:this.moveSource.bind(this),polygon:this.moveSource.bind(this)})}onMouseDown(e){var s;return this.featureData=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[se.main]}),this.featureData&&this.getUpdatedGeoJsonHandlers[this.featureData.shape]?(this.featureData.changeSource({sourceName:se.temporary,atomic:!0}),this.gm.mapAdapter.setDragPan(!1),this.isDragging=!0,(s=this.snappingHelper)==null||s.addExcludedFeature(this.featureData),this.isPointBasedShape()&&this.alignShapeCenterWithControlMarker(this.featureData,e),this.fireFeatureEditStartEvent({feature:this.featureData,forceMode:"drag"}),{next:!1}):{next:!0}}onMouseUp(){var e;return this.featureData?((e=this.snappingHelper)==null||e.clearExcludedFeatures(),this.featureData.changeSource({sourceName:se.main,atomic:!0}),this.isDragging=!1,this.previousLngLat=null,this.gm.mapAdapter.setDragPan(!0),this.fireFeatureEditEndEvent({feature:this.featureData,forceMode:"drag"}),this.featureData=null,{next:!0}):{next:!0}}onMouseMove(e){var s;if(!this.isDragging||!Ke(e,{warning:!0}))return{next:!0};if(this.featureData){const u=((s=this.gm.markerPointer.marker)==null?void 0:s.getLngLat())||e.lngLat.toArray();this.moveFeature(this.featureData,u)}return{next:!1}}isPointBasedShape(){return!!this.featureData&&this.pointBasedShapes.includes(this.featureData.shape)}alignShapeCenterWithControlMarker(e,s){var l;const u=du(e);u&&((l=this.gm.markerPointer.marker)==null||l.setLngLat(u),this.onMouseMove(s))}moveFeature(e,s){if(!this.isDragging)return;if(!this.previousLngLat){this.previousLngLat=s;return}const u=this.getUpdatedGeoJsonHandlers[e.shape];if(u){const l=u(e,this.previousLngLat,s);if(!l){ie.error("BaseDrag.moveFeature: invalid updatedGeoJson",e);return}this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[l],forceMode:"drag"}),this.updateFeatureGeoJson({featureData:e,featureGeoJson:l,forceMode:"drag"})&&(this.previousLngLat=s)}}moveSource(e,s,u){const l=ta(s,u);return rf(e,l)}moveEllipse(e,s,u){if(e.shape!=="ellipse")return ie.error("BaseDrag.moveCircle: invalid shape type",e),null;const l=e.getShapeProperty("center"),f=e.getShapeProperty("xSemiAxis"),h=e.getShapeProperty("ySemiAxis"),m=e.getShapeProperty("angle");if(!Array.isArray(l)||typeof f!="number"||typeof h!="number"||typeof m!="number")return ie.error("BaseDrag.moveEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",e),null;const d=ta(s,u),v=[l[0]+d.lng,l[1]+d.lat];return aa({center:v,xSemiAxis:f,ySemiAxis:h,angle:m})}moveCircle(e,s,u){if(e.shape!=="circle")return ie.error("BaseDrag.moveCircle: invalid shape type",e),null;const l=e.getShapeProperty("center");if(!Array.isArray(l))return ie.error("BaseDrag.moveCircle: missing center in the featureData",e),null;const f=e.getGeoJson(),h=ta(s,u),m=tu(f);if(!m)return ie.error("BaseDrag.moveCircle: missing center circleRimLngLat"),null;const d=[l[0]+h.lng,l[1]+h.lat],v=nu({center:d,radius:this.gm.mapAdapter.getDistance(l,m)});return{type:"Feature",properties:{shape:"circle",center:d},geometry:v.geometry}}}const Xg=(n,r)=>(n%r+r)%r,ao=n=>new Intl.NumberFormat("nb-NO",{minimumFractionDigits:0,maximumFractionDigits:2}).format(n),Nk=n=>{const e=[{range:[0,1],unit:"cm",factor:100},{range:[1,1e4],unit:"m",factor:1},{range:[1e4,1/0],unit:"km",factor:.001}].find(s=>n>=s.range[0]&&n<s.range[1]);return e?`${ao(n*e.factor)} ${e.unit}`:ao(n)},Pk=n=>{const e=[{range:[0,1],unit:"cm",factor:1e4},{range:[1,1e4],unit:"m",factor:1},{range:[1e5,1/0],unit:"km",factor:1e-6}].find(s=>n>=s.range[0]&&n<s.range[1]);return e?`${ao(n*e.factor)} ${e.unit}`:ao(n)};class Ok extends so{constructor(){super(...arguments);O(this,"mode","change");O(this,"cutVertexShapeTypes",["line","polygon","rectangle"]);O(this,"markerData",null);O(this,"shapeUpdateHandlers",{marker:this.updateSingleVertex.bind(this),circle:this.updateCircle.bind(this),circle_marker:this.updateSingleVertex.bind(this),ellipse:this.updateEllipse.bind(this),text_marker:this.updateSingleVertex.bind(this),line:this.updateSingleVertex.bind(this),rectangle:this.updateRectangle.bind(this),polygon:this.updateSingleVertex.bind(this)})}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return Bg(e)?e:null}onStartAction(){}onEndAction(){var e;(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmEdit(e){var s;if(!Pr(e))return{next:!0};if(e.action==="marker_move"&&e.lngLatStart&&e.markerData){if(e.markerData.type==="vertex")return this.moveVertex(e),{next:!1};if(e.lngLatEnd)return this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}}return e.action==="marker_right_click"?(this.cutVertex(e),this.fireFeatureEditEndEvent({feature:e.featureData})):e.action==="edge_marker_click"?this.insertVertex(e):e.action==="marker_captured"?(e.featureData.changeSource({sourceName:se.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.markerData=null,(s=this.snapGuidesInstance)==null||s.removeSnapGuides(),e.featureData.changeSource({sourceName:se.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}}moveVertex(e){var f,h,m;this.markerData||(this.markerData=e.markerData||null,(f=this.snapGuidesInstance)==null||f.updateSnapGuides(e.featureData.getGeoJson(),e.lngLatStart));const s=e.featureData,u=s.shape,l=((m=(h=this.shapeUpdateHandlers)[u])==null?void 0:m.call(h,e))||null;l?(this.fireBeforeFeatureUpdate({features:[s],geoJsonFeatures:[l]}),this.updateFeatureGeoJson({featureData:s,featureGeoJson:l})):ie.error("EditChange.moveVertex: invalid geojson",l,e)}cutVertex(e){const s=e.featureData;if(e.markerData.type!=="vertex"||!this.cutVertexShapeTypes.includes(s.shape))return;let u=!1;const l=s.getGeoJson(),f=e.markerData.instance;if(Ui(l)){if(sa(l)<=2){this.gm.features.delete(s);return}}else if(ea(l)){if(sa(l)<=3){this.gm.features.delete(s);return}}else if(Qs(l)&&sa(l)<=3){this.gm.features.delete(s);return}const h=du(f);h&&(u=i_(l,h)),u?(s.convertToPolygon(),s.updateGeoJsonGeometry(l.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[s],targetFeatures:[s],markerData:e.markerData})):ie.error("EditChange.cutVertex: feature not updated",e)}insertVertex(e){if(e.markerData.type!=="edge")return;const s=e.featureData.getGeoJson(),u=e.markerData.segment.end.path,l=u.pop(),f=Xr(s,u);typeof l=="number"&&(f.splice(l,0,[...e.markerData.position.coordinate]),e.featureData.updateGeoJsonGeometry(s.geometry),e.featureData.convertToPolygon(),this.fireFeatureUpdatedEvent({sourceFeatures:[e.featureData],targetFeatures:[e.featureData],markerData:e.markerData}))}updateSingleVertex({featureData:e,lngLatEnd:s,markerData:u}){const l=an(e.getGeoJson()),f=an(u.position.path),h=f.pop(),m=Xr(l,f);return Array.isArray(m)&&typeof h=="number"?(m[h]=[...s],h===0&&e.shape==="polygon"&&(m[m.length-1]=[...s])):ie.error("BaseDrag.moveSingleVertex: invalid coordinates",l,f),l}updateCircle({featureData:e,lngLatEnd:s}){if(e.shape!=="circle"||e.shapeProperties.center===null)return ie.error("BaseDrag.moveCircle: invalid shape type / missing center",e),null;const u=e.shapeProperties.center,l=nu({center:u,radius:this.gm.mapAdapter.getDistance(u,s)});return{type:"Feature",properties:{shape:"circle",center:u},geometry:l.geometry}}updateEllipse(e){const{featureData:s,lngLatEnd:u,markerData:l}=e;if(s.shape!=="ellipse")return ie.error("EditChange.updateEllipse: invalid shape type",s),null;const f=s.getShapeProperty("center");let h=s.getShapeProperty("xSemiAxis"),m=s.getShapeProperty("ySemiAxis");const d=s.getShapeProperty("angle");if(!Array.isArray(f)||typeof h!="number"||typeof m!="number"||typeof d!="number")return ie.error("updateEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",s),null;const v=this.gm.mapAdapter.getDistance(f,u),y=l.position.path[3],E=Math.floor(y/gh*4);return(E===0||E===2?"x":"y")==="x"?h=v:m=v,aa({center:f,xSemiAxis:h,ySemiAxis:m,angle:d})}updateRectangle({featureData:e,lngLatStart:s,lngLatEnd:u}){const f=e.getGeoJson(),h=f.geometry.coordinates[0],{absCoordIndex:m}=ia(f,s);if(m===-1)return ie.error("EditChange.updateRectangle: start vertex not found",e),null;const d=Xg(m-2,4),v=h[d];return $o(u,v)}}const sl=n=>n.length>0;function Rk(n,r,{ignoreSelfIntersections:e=!0}={ignoreSelfIntersections:!0}){let s=!0;return rr(n,u=>{rr(r,l=>{if(s===!1)return!1;s=Dk(u.geometry,l.geometry,e)})}),s}function Dk(n,r,e){switch(n.type){case"Point":switch(r.type){case"Point":return!Uk(n.coordinates,r.coordinates);case"LineString":return!Wg(r,n);case"Polygon":return!Lr(n,r)}break;case"LineString":switch(r.type){case"Point":return!Wg(n,r);case"LineString":return!Fk(n,r,e);case"Polygon":return!Zg(r,n,e)}break;case"Polygon":switch(r.type){case"Point":return!Lr(r,n);case"LineString":return!Zg(n,r,e);case"Polygon":return!Gk(r,n,e)}}return!1}function Wg(n,r){for(let e=0;e<n.coordinates.length-1;e++)if(Bk(n.coordinates[e],n.coordinates[e+1],r.coordinates))return!0;return!1}function Fk(n,r,e){return Yi(n,r,{ignoreSelfIntersections:e}).features.length>0}function Zg(n,r,e){for(const u of r.coordinates)if(Lr(u,n))return!0;return Yi(r,Mo(n),{ignoreSelfIntersections:e}).features.length>0}function Gk(n,r,e){for(const u of n.coordinates[0])if(Lr(u,r))return!0;for(const u of r.coordinates[0])if(Lr(u,n))return!0;return Yi(Mo(n),Mo(r),{ignoreSelfIntersections:e}).features.length>0}function Bk(n,r,e){const s=e[0]-n[0],u=e[1]-n[1],l=r[0]-n[0],f=r[1]-n[1];return s*f-u*l!==0?!1:Math.abs(l)>=Math.abs(f)?l>0?n[0]<=e[0]&&e[0]<=r[0]:r[0]<=e[0]&&e[0]<=n[0]:f>0?n[1]<=e[1]&&e[1]<=r[1]:r[1]<=e[1]&&e[1]<=n[1]}function Uk(n,r){return n[0]===r[0]&&n[1]===r[1]}function zk(n,r,{ignoreSelfIntersections:e=!0}={}){let s=!1;return rr(n,u=>{rr(r,l=>{if(s===!0)return!0;s=!Rk(u.geometry,l.geometry,{ignoreSelfIntersections:e})})}),s}var jg=zk,qk=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,al=Math.ceil,Jt=Math.floor,Mt="[BigNumber Error] ",$g=Mt+"Number primitive has more than 15 significant digits: ",hn=1e14,ke=14,Kg=9007199254740991,ol=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],pr=1e7,Dt=1e9;function Qg(n){var r,e,s,u=I.prototype={constructor:I,toString:null,valueOf:null},l=new I(1),f=20,h=4,m=-7,d=21,v=-1e7,y=1e7,E=!1,S=1,M=0,D={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},U="0123456789abcdefghijklmnopqrstuvwxyz",G=!0;function I(x,k){var b,A,T,F,P,N,R,Y,z=this;if(!(z instanceof I))return new I(x,k);if(k==null){if(x&&x._isBigNumber===!0){z.s=x.s,!x.c||x.e>y?z.c=z.e=null:x.e<v?z.c=[z.e=0]:(z.e=x.e,z.c=x.c.slice());return}if((N=typeof x=="number")&&x*0==0){if(z.s=1/x<0?(x=-x,-1):1,x===~~x){for(F=0,P=x;P>=10;P/=10,F++);F>y?z.c=z.e=null:(z.e=F,z.c=[x]);return}Y=String(x)}else{if(!qk.test(Y=String(x)))return s(z,Y,N);z.s=Y.charCodeAt(0)==45?(Y=Y.slice(1),-1):1}(F=Y.indexOf("."))>-1&&(Y=Y.replace(".","")),(P=Y.search(/e/i))>0?(F<0&&(F=P),F+=+Y.slice(P+1),Y=Y.substring(0,P)):F<0&&(F=Y.length)}else{if(Xe(k,2,U.length,"Base"),k==10&&G)return z=new I(x),W(z,f+z.e+1,h);if(Y=String(x),N=typeof x=="number"){if(x*0!=0)return s(z,Y,N,k);if(z.s=1/x<0?(Y=Y.slice(1),-1):1,I.DEBUG&&Y.replace(/^0\.0*|\./,"").length>15)throw Error($g+x)}else z.s=Y.charCodeAt(0)===45?(Y=Y.slice(1),-1):1;for(b=U.slice(0,k),F=P=0,R=Y.length;P<R;P++)if(b.indexOf(A=Y.charAt(P))<0){if(A=="."){if(P>F){F=R;continue}}else if(!T&&(Y==Y.toUpperCase()&&(Y=Y.toLowerCase())||Y==Y.toLowerCase()&&(Y=Y.toUpperCase()))){T=!0,P=-1,F=0;continue}return s(z,String(x),N,k)}N=!1,Y=e(Y,k,10,z.s),(F=Y.indexOf("."))>-1?Y=Y.replace(".",""):F=Y.length}for(P=0;Y.charCodeAt(P)===48;P++);for(R=Y.length;Y.charCodeAt(--R)===48;);if(Y=Y.slice(P,++R)){if(R-=P,N&&I.DEBUG&&R>15&&(x>Kg||x!==Jt(x)))throw Error($g+z.s*x);if((F=F-P-1)>y)z.c=z.e=null;else if(F<v)z.c=[z.e=0];else{if(z.e=F,z.c=[],P=(F+1)%ke,F<0&&(P+=ke),P<R){for(P&&z.c.push(+Y.slice(0,P)),R-=ke;P<R;)z.c.push(+Y.slice(P,P+=ke));P=ke-(Y=Y.slice(P)).length}else P-=R;for(;P--;Y+="0");z.c.push(+Y)}}else z.c=[z.e=0]}I.clone=Qg,I.ROUND_UP=0,I.ROUND_DOWN=1,I.ROUND_CEIL=2,I.ROUND_FLOOR=3,I.ROUND_HALF_UP=4,I.ROUND_HALF_DOWN=5,I.ROUND_HALF_EVEN=6,I.ROUND_HALF_CEIL=7,I.ROUND_HALF_FLOOR=8,I.EUCLID=9,I.config=I.set=function(x){var k,b;if(x!=null)if(typeof x=="object"){if(x.hasOwnProperty(k="DECIMAL_PLACES")&&(b=x[k],Xe(b,0,Dt,k),f=b),x.hasOwnProperty(k="ROUNDING_MODE")&&(b=x[k],Xe(b,0,8,k),h=b),x.hasOwnProperty(k="EXPONENTIAL_AT")&&(b=x[k],b&&b.pop?(Xe(b[0],-1e9,0,k),Xe(b[1],0,Dt,k),m=b[0],d=b[1]):(Xe(b,-1e9,Dt,k),m=-(d=b<0?-b:b))),x.hasOwnProperty(k="RANGE"))if(b=x[k],b&&b.pop)Xe(b[0],-1e9,-1,k),Xe(b[1],1,Dt,k),v=b[0],y=b[1];else if(Xe(b,-1e9,Dt,k),b)v=-(y=b<0?-b:b);else throw Error(Mt+k+" cannot be zero: "+b);if(x.hasOwnProperty(k="CRYPTO"))if(b=x[k],b===!!b)if(b)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))E=b;else throw E=!b,Error(Mt+"crypto unavailable");else E=b;else throw Error(Mt+k+" not true or false: "+b);if(x.hasOwnProperty(k="MODULO_MODE")&&(b=x[k],Xe(b,0,9,k),S=b),x.hasOwnProperty(k="POW_PRECISION")&&(b=x[k],Xe(b,0,Dt,k),M=b),x.hasOwnProperty(k="FORMAT"))if(b=x[k],typeof b=="object")D=b;else throw Error(Mt+k+" not an object: "+b);if(x.hasOwnProperty(k="ALPHABET"))if(b=x[k],typeof b=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(b))G=b.slice(0,10)=="0123456789",U=b;else throw Error(Mt+k+" invalid: "+b)}else throw Error(Mt+"Object expected: "+x);return{DECIMAL_PLACES:f,ROUNDING_MODE:h,EXPONENTIAL_AT:[m,d],RANGE:[v,y],CRYPTO:E,MODULO_MODE:S,POW_PRECISION:M,FORMAT:D,ALPHABET:U}},I.isBigNumber=function(x){if(!x||x._isBigNumber!==!0)return!1;if(!I.DEBUG)return!0;var k,b,A=x.c,T=x.e,F=x.s;e:if({}.toString.call(A)=="[object Array]"){if((F===1||F===-1)&&T>=-1e9&&T<=Dt&&T===Jt(T)){if(A[0]===0){if(T===0&&A.length===1)return!0;break e}if(k=(T+1)%ke,k<1&&(k+=ke),String(A[0]).length==k){for(k=0;k<A.length;k++)if(b=A[k],b<0||b>=hn||b!==Jt(b))break e;if(b!==0)return!0}}}else if(A===null&&T===null&&(F===null||F===1||F===-1))return!0;throw Error(Mt+"Invalid BigNumber: "+x)},I.maximum=I.max=function(){return J(arguments,-1)},I.minimum=I.min=function(){return J(arguments,1)},I.random=function(){var x=9007199254740992,k=Math.random()*x&2097151?function(){return Jt(Math.random()*x)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(b){var A,T,F,P,N,R=0,Y=[],z=new I(l);if(b==null?b=f:Xe(b,0,Dt),P=al(b/ke),E)if(crypto.getRandomValues){for(A=crypto.getRandomValues(new Uint32Array(P*=2));R<P;)N=A[R]*131072+(A[R+1]>>>11),N>=9e15?(T=crypto.getRandomValues(new Uint32Array(2)),A[R]=T[0],A[R+1]=T[1]):(Y.push(N%1e14),R+=2);R=P/2}else if(crypto.randomBytes){for(A=crypto.randomBytes(P*=7);R<P;)N=(A[R]&31)*281474976710656+A[R+1]*1099511627776+A[R+2]*4294967296+A[R+3]*16777216+(A[R+4]<<16)+(A[R+5]<<8)+A[R+6],N>=9e15?crypto.randomBytes(7).copy(A,R):(Y.push(N%1e14),R+=7);R=P/7}else throw E=!1,Error(Mt+"crypto unavailable");if(!E)for(;R<P;)N=k(),N<9e15&&(Y[R++]=N%1e14);for(P=Y[--R],b%=ke,P&&b&&(N=ol[ke-b],Y[R]=Jt(P/N)*N);Y[R]===0;Y.pop(),R--);if(R<0)Y=[F=0];else{for(F=-1;Y[0]===0;Y.splice(0,1),F-=ke);for(R=1,N=Y[0];N>=10;N/=10,R++);R<ke&&(F-=ke-R)}return z.e=F,z.c=Y,z}}(),I.sum=function(){for(var x=1,k=arguments,b=new I(k[0]);x<k.length;)b=b.plus(k[x++]);return b},e=function(){var x="0123456789";function k(b,A,T,F){for(var P,N=[0],R,Y=0,z=b.length;Y<z;){for(R=N.length;R--;N[R]*=A);for(N[0]+=F.indexOf(b.charAt(Y++)),P=0;P<N.length;P++)N[P]>T-1&&(N[P+1]==null&&(N[P+1]=0),N[P+1]+=N[P]/T|0,N[P]%=T)}return N.reverse()}return function(b,A,T,F,P){var N,R,Y,z,j,K,re,me,he=b.indexOf("."),oe=f,le=h;for(he>=0&&(z=M,M=0,b=b.replace(".",""),me=new I(A),K=me.pow(b.length-he),M=z,me.c=k(Xn(Xt(K.c),K.e,"0"),10,T,x),me.e=me.c.length),re=k(b,A,T,P?(N=U,x):(N=x,U)),Y=z=re.length;re[--z]==0;re.pop());if(!re[0])return N.charAt(0);if(he<0?--Y:(K.c=re,K.e=Y,K.s=F,K=r(K,me,oe,le,T),re=K.c,j=K.r,Y=K.e),R=Y+oe+1,he=re[R],z=T/2,j=j||R<0||re[R+1]!=null,j=le<4?(he!=null||j)&&(le==0||le==(K.s<0?3:2)):he>z||he==z&&(le==4||j||le==6&&re[R-1]&1||le==(K.s<0?8:7)),R<1||!re[0])b=j?Xn(N.charAt(1),-oe,N.charAt(0)):N.charAt(0);else{if(re.length=R,j)for(--T;++re[--R]>T;)re[R]=0,R||(++Y,re=[1].concat(re));for(z=re.length;!re[--z];);for(he=0,b="";he<=z;b+=N.charAt(re[he++]));b=Xn(b,Y,N.charAt(0))}return b}}(),r=function(){function x(A,T,F){var P,N,R,Y,z=0,j=A.length,K=T%pr,re=T/pr|0;for(A=A.slice();j--;)R=A[j]%pr,Y=A[j]/pr|0,P=re*R+Y*K,N=K*R+P%pr*pr+z,z=(N/F|0)+(P/pr|0)+re*Y,A[j]=N%F;return z&&(A=[z].concat(A)),A}function k(A,T,F,P){var N,R;if(F!=P)R=F>P?1:-1;else for(N=R=0;N<F;N++)if(A[N]!=T[N]){R=A[N]>T[N]?1:-1;break}return R}function b(A,T,F,P){for(var N=0;F--;)A[F]-=N,N=A[F]<T[F]?1:0,A[F]=N*P+A[F]-T[F];for(;!A[0]&&A.length>1;A.splice(0,1));}return function(A,T,F,P,N){var R,Y,z,j,K,re,me,he,oe,le,we,Ne,V,fn,be,fe,C,De=A.s==T.s?1:-1,Oe=A.c,Ie=T.c;if(!Oe||!Oe[0]||!Ie||!Ie[0])return new I(!A.s||!T.s||(Oe?Ie&&Oe[0]==Ie[0]:!Ie)?NaN:Oe&&Oe[0]==0||!Ie?De*0:De/0);for(he=new I(De),oe=he.c=[],Y=A.e-T.e,De=F+Y+1,N||(N=hn,Y=Vt(A.e/ke)-Vt(T.e/ke),De=De/ke|0),z=0;Ie[z]==(Oe[z]||0);z++);if(Ie[z]>(Oe[z]||0)&&Y--,De<0)oe.push(1),j=!0;else{for(fn=Oe.length,fe=Ie.length,z=0,De+=2,K=Jt(N/(Ie[0]+1)),K>1&&(Ie=x(Ie,K,N),Oe=x(Oe,K,N),fe=Ie.length,fn=Oe.length),V=fe,le=Oe.slice(0,fe),we=le.length;we<fe;le[we++]=0);C=Ie.slice(),C=[0].concat(C),be=Ie[0],Ie[1]>=N/2&&be++;do{if(K=0,R=k(Ie,le,fe,we),R<0){if(Ne=le[0],fe!=we&&(Ne=Ne*N+(le[1]||0)),K=Jt(Ne/be),K>1)for(K>=N&&(K=N-1),re=x(Ie,K,N),me=re.length,we=le.length;k(re,le,me,we)==1;)K--,b(re,fe<me?C:Ie,me,N),me=re.length,R=1;else K==0&&(R=K=1),re=Ie.slice(),me=re.length;if(me<we&&(re=[0].concat(re)),b(le,re,we,N),we=le.length,R==-1)for(;k(Ie,le,fe,we)<1;)K++,b(le,fe<we?C:Ie,we,N),we=le.length}else R===0&&(K++,le=[0]);oe[z++]=K,le[0]?le[we++]=Oe[V]||0:(le=[Oe[V]],we=1)}while((V++<fn||le[0]!=null)&&De--);j=le[0]!=null,oe[0]||oe.splice(0,1)}if(N==hn){for(z=1,De=oe[0];De>=10;De/=10,z++);W(he,F+(he.e=z+Y*ke-1)+1,P,j)}else he.e=Y,he.r=+j;return he}}();function H(x,k,b,A){var T,F,P,N,R;if(b==null?b=h:Xe(b,0,8),!x.c)return x.toString();if(T=x.c[0],P=x.e,k==null)R=Xt(x.c),R=A==1||A==2&&(P<=m||P>=d)?uo(R,P):Xn(R,P,"0");else if(x=W(new I(x),k,b),F=x.e,R=Xt(x.c),N=R.length,A==1||A==2&&(k<=F||F<=m)){for(;N<k;R+="0",N++);R=uo(R,F)}else if(k-=P,R=Xn(R,F,"0"),F+1>N){if(--k>0)for(R+=".";k--;R+="0");}else if(k+=F-N,k>0)for(F+1==N&&(R+=".");k--;R+="0");return x.s<0&&T?"-"+R:R}function J(x,k){for(var b,A,T=1,F=new I(x[0]);T<x.length;T++)A=new I(x[T]),(!A.s||(b=Or(F,A))===k||b===0&&F.s===k)&&(F=A);return F}function X(x,k,b){for(var A=1,T=k.length;!k[--T];k.pop());for(T=k[0];T>=10;T/=10,A++);return(b=A+b*ke-1)>y?x.c=x.e=null:b<v?x.c=[x.e=0]:(x.e=b,x.c=k),x}s=function(){var x=/^(-?)0([xbo])(?=\w[\w.]*$)/i,k=/^([^.]+)\.$/,b=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,T=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(F,P,N,R){var Y,z=N?P:P.replace(T,"");if(A.test(z))F.s=isNaN(z)?null:z<0?-1:1;else{if(!N&&(z=z.replace(x,function(j,K,re){return Y=(re=re.toLowerCase())=="x"?16:re=="b"?2:8,!R||R==Y?K:j}),R&&(Y=R,z=z.replace(k,"$1").replace(b,"0.$1")),P!=z))return new I(z,Y);if(I.DEBUG)throw Error(Mt+"Not a"+(R?" base "+R:"")+" number: "+P);F.s=null}F.c=F.e=null}}();function W(x,k,b,A){var T,F,P,N,R,Y,z,j=x.c,K=ol;if(j){e:{for(T=1,N=j[0];N>=10;N/=10,T++);if(F=k-T,F<0)F+=ke,P=k,R=j[Y=0],z=Jt(R/K[T-P-1]%10);else if(Y=al((F+1)/ke),Y>=j.length)if(A){for(;j.length<=Y;j.push(0));R=z=0,T=1,F%=ke,P=F-ke+1}else break e;else{for(R=N=j[Y],T=1;N>=10;N/=10,T++);F%=ke,P=F-ke+T,z=P<0?0:Jt(R/K[T-P-1]%10)}if(A=A||k<0||j[Y+1]!=null||(P<0?R:R%K[T-P-1]),A=b<4?(z||A)&&(b==0||b==(x.s<0?3:2)):z>5||z==5&&(b==4||A||b==6&&(F>0?P>0?R/K[T-P]:0:j[Y-1])%10&1||b==(x.s<0?8:7)),k<1||!j[0])return j.length=0,A?(k-=x.e+1,j[0]=K[(ke-k%ke)%ke],x.e=-k||0):j[0]=x.e=0,x;if(F==0?(j.length=Y,N=1,Y--):(j.length=Y+1,N=K[ke-F],j[Y]=P>0?Jt(R/K[T-P]%K[P])*N:0),A)for(;;)if(Y==0){for(F=1,P=j[0];P>=10;P/=10,F++);for(P=j[0]+=N,N=1;P>=10;P/=10,N++);F!=N&&(x.e++,j[0]==hn&&(j[0]=1));break}else{if(j[Y]+=N,j[Y]!=hn)break;j[Y--]=0,N=1}for(F=j.length;j[--F]===0;j.pop());}x.e>y?x.c=x.e=null:x.e<v&&(x.c=[x.e=0])}return x}function $(x){var k,b=x.e;return b===null?x.toString():(k=Xt(x.c),k=b<=m||b>=d?uo(k,b):Xn(k,b,"0"),x.s<0?"-"+k:k)}return u.absoluteValue=u.abs=function(){var x=new I(this);return x.s<0&&(x.s=1),x},u.comparedTo=function(x,k){return Or(this,new I(x,k))},u.decimalPlaces=u.dp=function(x,k){var b,A,T,F=this;if(x!=null)return Xe(x,0,Dt),k==null?k=h:Xe(k,0,8),W(new I(F),x+F.e+1,k);if(!(b=F.c))return null;if(A=((T=b.length-1)-Vt(this.e/ke))*ke,T=b[T])for(;T%10==0;T/=10,A--);return A<0&&(A=0),A},u.dividedBy=u.div=function(x,k){return r(this,new I(x,k),f,h)},u.dividedToIntegerBy=u.idiv=function(x,k){return r(this,new I(x,k),0,1)},u.exponentiatedBy=u.pow=function(x,k){var b,A,T,F,P,N,R,Y,z,j=this;if(x=new I(x),x.c&&!x.isInteger())throw Error(Mt+"Exponent not an integer: "+$(x));if(k!=null&&(k=new I(k)),N=x.e>14,!j.c||!j.c[0]||j.c[0]==1&&!j.e&&j.c.length==1||!x.c||!x.c[0])return z=new I(Math.pow(+$(j),N?x.s*(2-oo(x)):+$(x))),k?z.mod(k):z;if(R=x.s<0,k){if(k.c?!k.c[0]:!k.s)return new I(NaN);A=!R&&j.isInteger()&&k.isInteger(),A&&(j=j.mod(k))}else{if(x.e>9&&(j.e>0||j.e<-1||(j.e==0?j.c[0]>1||N&&j.c[1]>=24e7:j.c[0]<8e13||N&&j.c[0]<=9999975e7)))return F=j.s<0&&oo(x)?-0:0,j.e>-1&&(F=1/F),new I(R?1/F:F);M&&(F=al(M/ke+2))}for(N?(b=new I(.5),R&&(x.s=1),Y=oo(x)):(T=Math.abs(+$(x)),Y=T%2),z=new I(l);;){if(Y){if(z=z.times(j),!z.c)break;F?z.c.length>F&&(z.c.length=F):A&&(z=z.mod(k))}if(T){if(T=Jt(T/2),T===0)break;Y=T%2}else if(x=x.times(b),W(x,x.e+1,1),x.e>14)Y=oo(x);else{if(T=+$(x),T===0)break;Y=T%2}j=j.times(j),F?j.c&&j.c.length>F&&(j.c.length=F):A&&(j=j.mod(k))}return A?z:(R&&(z=l.div(z)),k?z.mod(k):F?W(z,M,h,P):z)},u.integerValue=function(x){var k=new I(this);return x==null?x=h:Xe(x,0,8),W(k,k.e+1,x)},u.isEqualTo=u.eq=function(x,k){return Or(this,new I(x,k))===0},u.isFinite=function(){return!!this.c},u.isGreaterThan=u.gt=function(x,k){return Or(this,new I(x,k))>0},u.isGreaterThanOrEqualTo=u.gte=function(x,k){return(k=Or(this,new I(x,k)))===1||k===0},u.isInteger=function(){return!!this.c&&Vt(this.e/ke)>this.c.length-2},u.isLessThan=u.lt=function(x,k){return Or(this,new I(x,k))<0},u.isLessThanOrEqualTo=u.lte=function(x,k){return(k=Or(this,new I(x,k)))===-1||k===0},u.isNaN=function(){return!this.s},u.isNegative=function(){return this.s<0},u.isPositive=function(){return this.s>0},u.isZero=function(){return!!this.c&&this.c[0]==0},u.minus=function(x,k){var b,A,T,F,P=this,N=P.s;if(x=new I(x,k),k=x.s,!N||!k)return new I(NaN);if(N!=k)return x.s=-k,P.plus(x);var R=P.e/ke,Y=x.e/ke,z=P.c,j=x.c;if(!R||!Y){if(!z||!j)return z?(x.s=-k,x):new I(j?P:NaN);if(!z[0]||!j[0])return j[0]?(x.s=-k,x):new I(z[0]?P:h==3?-0:0)}if(R=Vt(R),Y=Vt(Y),z=z.slice(),N=R-Y){for((F=N<0)?(N=-N,T=z):(Y=R,T=j),T.reverse(),k=N;k--;T.push(0));T.reverse()}else for(A=(F=(N=z.length)<(k=j.length))?N:k,N=k=0;k<A;k++)if(z[k]!=j[k]){F=z[k]<j[k];break}if(F&&(T=z,z=j,j=T,x.s=-x.s),k=(A=j.length)-(b=z.length),k>0)for(;k--;z[b++]=0);for(k=hn-1;A>N;){if(z[--A]<j[A]){for(b=A;b&&!z[--b];z[b]=k);--z[b],z[A]+=hn}z[A]-=j[A]}for(;z[0]==0;z.splice(0,1),--Y);return z[0]?X(x,z,Y):(x.s=h==3?-1:1,x.c=[x.e=0],x)},u.modulo=u.mod=function(x,k){var b,A,T=this;return x=new I(x,k),!T.c||!x.s||x.c&&!x.c[0]?new I(NaN):!x.c||T.c&&!T.c[0]?new I(T):(S==9?(A=x.s,x.s=1,b=r(T,x,0,3),x.s=A,b.s*=A):b=r(T,x,0,S),x=T.minus(b.times(x)),!x.c[0]&&S==1&&(x.s=T.s),x)},u.multipliedBy=u.times=function(x,k){var b,A,T,F,P,N,R,Y,z,j,K,re,me,he,oe,le=this,we=le.c,Ne=(x=new I(x,k)).c;if(!we||!Ne||!we[0]||!Ne[0])return!le.s||!x.s||we&&!we[0]&&!Ne||Ne&&!Ne[0]&&!we?x.c=x.e=x.s=null:(x.s*=le.s,!we||!Ne?x.c=x.e=null:(x.c=[0],x.e=0)),x;for(A=Vt(le.e/ke)+Vt(x.e/ke),x.s*=le.s,R=we.length,j=Ne.length,R<j&&(me=we,we=Ne,Ne=me,T=R,R=j,j=T),T=R+j,me=[];T--;me.push(0));for(he=hn,oe=pr,T=j;--T>=0;){for(b=0,K=Ne[T]%oe,re=Ne[T]/oe|0,P=R,F=T+P;F>T;)Y=we[--P]%oe,z=we[P]/oe|0,N=re*Y+z*K,Y=K*Y+N%oe*oe+me[F]+b,b=(Y/he|0)+(N/oe|0)+re*z,me[F--]=Y%he;me[F]=b}return b?++A:me.splice(0,1),X(x,me,A)},u.negated=function(){var x=new I(this);return x.s=-x.s||null,x},u.plus=function(x,k){var b,A=this,T=A.s;if(x=new I(x,k),k=x.s,!T||!k)return new I(NaN);if(T!=k)return x.s=-k,A.minus(x);var F=A.e/ke,P=x.e/ke,N=A.c,R=x.c;if(!F||!P){if(!N||!R)return new I(T/0);if(!N[0]||!R[0])return R[0]?x:new I(N[0]?A:T*0)}if(F=Vt(F),P=Vt(P),N=N.slice(),T=F-P){for(T>0?(P=F,b=R):(T=-T,b=N),b.reverse();T--;b.push(0));b.reverse()}for(T=N.length,k=R.length,T-k<0&&(b=R,R=N,N=b,k=T),T=0;k;)T=(N[--k]=N[k]+R[k]+T)/hn|0,N[k]=hn===N[k]?0:N[k]%hn;return T&&(N=[T].concat(N),++P),X(x,N,P)},u.precision=u.sd=function(x,k){var b,A,T,F=this;if(x!=null&&x!==!!x)return Xe(x,1,Dt),k==null?k=h:Xe(k,0,8),W(new I(F),x,k);if(!(b=F.c))return null;if(T=b.length-1,A=T*ke+1,T=b[T]){for(;T%10==0;T/=10,A--);for(T=b[0];T>=10;T/=10,A++);}return x&&F.e+1>A&&(A=F.e+1),A},u.shiftedBy=function(x){return Xe(x,-9007199254740991,Kg),this.times("1e"+x)},u.squareRoot=u.sqrt=function(){var x,k,b,A,T,F=this,P=F.c,N=F.s,R=F.e,Y=f+4,z=new I("0.5");if(N!==1||!P||!P[0])return new I(!N||N<0&&(!P||P[0])?NaN:P?F:1/0);if(N=Math.sqrt(+$(F)),N==0||N==1/0?(k=Xt(P),(k.length+R)%2==0&&(k+="0"),N=Math.sqrt(+k),R=Vt((R+1)/2)-(R<0||R%2),N==1/0?k="5e"+R:(k=N.toExponential(),k=k.slice(0,k.indexOf("e")+1)+R),b=new I(k)):b=new I(N+""),b.c[0]){for(R=b.e,N=R+Y,N<3&&(N=0);;)if(T=b,b=z.times(T.plus(r(F,T,Y,1))),Xt(T.c).slice(0,N)===(k=Xt(b.c)).slice(0,N))if(b.e<R&&--N,k=k.slice(N-3,N+1),k=="9999"||!A&&k=="4999"){if(!A&&(W(T,T.e+f+2,0),T.times(T).eq(F))){b=T;break}Y+=4,N+=4,A=1}else{(!+k||!+k.slice(1)&&k.charAt(0)=="5")&&(W(b,b.e+f+2,1),x=!b.times(b).eq(F));break}}return W(b,b.e+f+1,h,x)},u.toExponential=function(x,k){return x!=null&&(Xe(x,0,Dt),x++),H(this,x,k,1)},u.toFixed=function(x,k){return x!=null&&(Xe(x,0,Dt),x=x+this.e+1),H(this,x,k)},u.toFormat=function(x,k,b){var A,T=this;if(b==null)x!=null&&k&&typeof k=="object"?(b=k,k=null):x&&typeof x=="object"?(b=x,x=k=null):b=D;else if(typeof b!="object")throw Error(Mt+"Argument not an object: "+b);if(A=T.toFixed(x,k),T.c){var F,P=A.split("."),N=+b.groupSize,R=+b.secondaryGroupSize,Y=b.groupSeparator||"",z=P[0],j=P[1],K=T.s<0,re=K?z.slice(1):z,me=re.length;if(R&&(F=N,N=R,R=F,me-=F),N>0&&me>0){for(F=me%N||N,z=re.substr(0,F);F<me;F+=N)z+=Y+re.substr(F,N);R>0&&(z+=Y+re.slice(F)),K&&(z="-"+z)}A=j?z+(b.decimalSeparator||"")+((R=+b.fractionGroupSize)?j.replace(new RegExp("\\d{"+R+"}\\B","g"),"$&"+(b.fractionGroupSeparator||"")):j):z}return(b.prefix||"")+A+(b.suffix||"")},u.toFraction=function(x){var k,b,A,T,F,P,N,R,Y,z,j,K,re=this,me=re.c;if(x!=null&&(N=new I(x),!N.isInteger()&&(N.c||N.s!==1)||N.lt(l)))throw Error(Mt+"Argument "+(N.isInteger()?"out of range: ":"not an integer: ")+$(N));if(!me)return new I(re);for(k=new I(l),Y=b=new I(l),A=R=new I(l),K=Xt(me),F=k.e=K.length-re.e-1,k.c[0]=ol[(P=F%ke)<0?ke+P:P],x=!x||N.comparedTo(k)>0?F>0?k:Y:N,P=y,y=1/0,N=new I(K),R.c[0]=0;z=r(N,k,0,1),T=b.plus(z.times(A)),T.comparedTo(x)!=1;)b=A,A=T,Y=R.plus(z.times(T=Y)),R=T,k=N.minus(z.times(T=k)),N=T;return T=r(x.minus(b),A,0,1),R=R.plus(T.times(Y)),b=b.plus(T.times(A)),R.s=Y.s=re.s,F=F*2,j=r(Y,A,F,h).minus(re).abs().comparedTo(r(R,b,F,h).minus(re).abs())<1?[Y,A]:[R,b],y=P,j},u.toNumber=function(){return+$(this)},u.toPrecision=function(x,k){return x!=null&&Xe(x,1,Dt),H(this,x,k,2)},u.toString=function(x){var k,b=this,A=b.s,T=b.e;return T===null?A?(k="Infinity",A<0&&(k="-"+k)):k="NaN":(x==null?k=T<=m||T>=d?uo(Xt(b.c),T):Xn(Xt(b.c),T,"0"):x===10&&G?(b=W(new I(b),f+T+1,h),k=Xn(Xt(b.c),b.e,"0")):(Xe(x,2,U.length,"Base"),k=e(Xn(Xt(b.c),T,"0"),10,x,A,!0)),A<0&&b.c[0]&&(k="-"+k)),k},u.valueOf=u.toJSON=function(){return $(this)},u._isBigNumber=!0,u[Symbol.toStringTag]="BigNumber",u[Symbol.for("nodejs.util.inspect.custom")]=u.valueOf,n!=null&&I.set(n),I}function Vt(n){var r=n|0;return n>0||n===r?r:r-1}function Xt(n){for(var r,e,s=1,u=n.length,l=n[0]+"";s<u;){for(r=n[s++]+"",e=ke-r.length;e--;r="0"+r);l+=r}for(u=l.length;l.charCodeAt(--u)===48;);return l.slice(0,u+1||1)}function Or(n,r){var e,s,u=n.c,l=r.c,f=n.s,h=r.s,m=n.e,d=r.e;if(!f||!h)return null;if(e=u&&!u[0],s=l&&!l[0],e||s)return e?s?0:-h:f;if(f!=h)return f;if(e=f<0,s=m==d,!u||!l)return s?0:!u^e?1:-1;if(!s)return m>d^e?1:-1;for(h=(m=u.length)<(d=l.length)?m:d,f=0;f<h;f++)if(u[f]!=l[f])return u[f]>l[f]^e?1:-1;return m==d?0:m>d^e?1:-1}function Xe(n,r,e,s){if(n<r||n>e||n!==Jt(n))throw Error(Mt+(s||"Argument")+(typeof n=="number"?n<r||n>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function oo(n){var r=n.c.length-1;return Vt(n.e/ke)==r&&n.c[r]%2!=0}function uo(n,r){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(r<0?"e":"e+")+r}function Xn(n,r,e){var s,u;if(r<0){for(u=e+".";++r;u+=e);n=u+n}else if(s=n.length,++r>s){for(u=e,r-=s;--r;u+=e);n+=u}else r<s&&(n=n.slice(0,r)+"."+n.slice(r));return n}var bn=Qg(),Yk=class{constructor(n){O(this,"key");O(this,"left",null);O(this,"right",null);this.key=n}},ds=class extends Yk{constructor(n){super(n)}},Hk=class{constructor(){O(this,"size",0);O(this,"modificationCount",0);O(this,"splayCount",0)}splay(n){const r=this.root;if(r==null)return this.compare(n,n),-1;let e=null,s=null,u=null,l=null,f=r;const h=this.compare;let m;for(;;)if(m=h(f.key,n),m>0){let d=f.left;if(d==null||(m=h(d.key,n),m>0&&(f.left=d.right,d.right=f,f=d,d=f.left,d==null)))break;e==null?s=f:e.left=f,e=f,f=d}else if(m<0){let d=f.right;if(d==null||(m=h(d.key,n),m<0&&(f.right=d.left,d.left=f,f=d,d=f.right,d==null)))break;u==null?l=f:u.right=f,u=f,f=d}else break;return u!=null&&(u.right=f.left,f.left=l),e!=null&&(e.left=f.right,f.right=s),this.root!==f&&(this.root=f,this.splayCount++),m}splayMin(n){let r=n,e=r.left;for(;e!=null;){const s=e;r.left=s.right,s.right=r,r=s,e=r.left}return r}splayMax(n){let r=n,e=r.right;for(;e!=null;){const s=e;r.right=s.left,s.left=r,r=s,e=r.right}return r}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const s=e,u=e.left;if(this.size--,u==null)this.root=e.right;else{const l=e.right;e=this.splayMax(u),e.right=l,this.root=e}return this.modificationCount++,s}addNewRoot(n,r){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=n;return}r<0?(n.left=e,n.right=e.right,e.right=null):(n.right=e,n.left=e.left,e.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,r)=>n<r?-1:n>r?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},lo=class Ns extends Hk{constructor(e,s){super();O(this,"root",null);O(this,"compare");O(this,"validKey");O(this,wd,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=s??(u=>u!=null&&u!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const s of e)this.delete(s)}forEach(e){const s=this[Symbol.iterator]();let u;for(;u=s.next(),!u.done;)e(u.value,u.value,this)}add(e){const s=this.splay(e);return s!=0&&this.addNewRoot(new ds(e),s),this}addAndReturn(e){const s=this.splay(e);return s!=0&&this.addNewRoot(new ds(e),s),this.root.key}addAll(e){for(const s of e)this.add(s)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let u=this.root.left;if(u==null)return null;let l=u.right;for(;l!=null;)u=l,l=u.right;return u.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let u=this.root.right;if(u==null)return null;let l=u.left;for(;l!=null;)u=l,l=u.left;return u.key}retainAll(e){const s=new Ns(this.compare,this.validKey),u=this.modificationCount;for(const l of e){if(u!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(l)&&this.splay(l)==0&&s.add(this.root.key)}s.size!=this.size&&(this.root=s.root,this.size=s.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const s=new Ns(this.compare,this.validKey);for(const u of this)e.has(u)&&s.add(u);return s}difference(e){const s=new Ns(this.compare,this.validKey);for(const u of this)e.has(u)||s.add(u);return s}union(e){const s=this.clone();return s.addAll(e),s}clone(){const e=new Ns(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function s(l,f){let h,m;do{if(h=l.left,m=l.right,h!=null){const d=new ds(h.key);f.left=d,s(h,d)}if(m!=null){const d=new ds(m.key);f.right=d,l=m,f=d}}while(m!=null)}const u=new ds(e.key);return s(e,u),u}toSet(){return this.clone()}entries(){return new Vk(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(kd=Symbol.iterator,wd=Symbol.toStringTag,kd)](){return new Jk(this.wrap())}},ed=class{constructor(n){O(this,"tree");O(this,"path",new Array);O(this,"modificationCount",null);O(this,"splayCount");this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],r=n.right;if(r!=null){for(;r!=null;)this.path.push(r),r=r.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},Jk=class extends ed{getValue(n){return n.key}},Vk=class extends ed{getValue(n){return[n.key,n.key]}},td=n=>()=>n,ul=n=>{const r=n?(e,s)=>s.minus(e).abs().isLessThanOrEqualTo(n):td(!1);return(e,s)=>r(e,s)?0:e.comparedTo(s)};function Xk(n){const r=n?(e,s,u,l,f)=>e.exponentiatedBy(2).isLessThanOrEqualTo(l.minus(s).exponentiatedBy(2).plus(f.minus(u).exponentiatedBy(2)).times(n)):td(!1);return(e,s,u)=>{const l=e.x,f=e.y,h=u.x,m=u.y,d=f.minus(m).times(s.x.minus(h)).minus(l.minus(h).times(s.y.minus(m)));return r(d,l,f,h,m)?0:d.comparedTo(0)}}var Wk=n=>n,Zk=n=>{if(n){const r=new lo(ul(n)),e=new lo(ul(n)),s=(l,f)=>f.addAndReturn(l),u=l=>({x:s(l.x,r),y:s(l.y,e)});return u({x:new bn(0),y:new bn(0)}),u}return Wk},ll=n=>({set:r=>{Wn=ll(r)},reset:()=>ll(n),compare:ul(n),snap:Zk(n),orient:Xk(n)}),Wn=ll(),ps=(n,r)=>n.ll.x.isLessThanOrEqualTo(r.x)&&r.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(r.y)&&r.y.isLessThanOrEqualTo(n.ur.y),cl=(n,r)=>{if(r.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(r.ll.x)||r.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(r.ll.y))return null;const e=n.ll.x.isLessThan(r.ll.x)?r.ll.x:n.ll.x,s=n.ur.x.isLessThan(r.ur.x)?n.ur.x:r.ur.x,u=n.ll.y.isLessThan(r.ll.y)?r.ll.y:n.ll.y,l=n.ur.y.isLessThan(r.ur.y)?n.ur.y:r.ur.y;return{ll:{x:e,y:u},ur:{x:s,y:l}}},co=(n,r)=>n.x.times(r.y).minus(n.y.times(r.x)),nd=(n,r)=>n.x.times(r.x).plus(n.y.times(r.y)),ho=n=>nd(n,n).sqrt(),jk=(n,r,e)=>{const s={x:r.x.minus(n.x),y:r.y.minus(n.y)},u={x:e.x.minus(n.x),y:e.y.minus(n.y)};return co(u,s).div(ho(u)).div(ho(s))},$k=(n,r,e)=>{const s={x:r.x.minus(n.x),y:r.y.minus(n.y)},u={x:e.x.minus(n.x),y:e.y.minus(n.y)};return nd(u,s).div(ho(u)).div(ho(s))},rd=(n,r,e)=>r.y.isZero()?null:{x:n.x.plus(r.x.div(r.y).times(e.minus(n.y))),y:e},id=(n,r,e)=>r.x.isZero()?null:{x:e,y:n.y.plus(r.y.div(r.x).times(e.minus(n.x)))},Kk=(n,r,e,s)=>{if(r.x.isZero())return id(e,s,n.x);if(s.x.isZero())return id(n,r,e.x);if(r.y.isZero())return rd(e,s,n.y);if(s.y.isZero())return rd(n,r,e.y);const u=co(r,s);if(u.isZero())return null;const l={x:e.x.minus(n.x),y:e.y.minus(n.y)},f=co(l,r).div(u),h=co(l,s).div(u),m=n.x.plus(h.times(r.x)),d=e.x.plus(f.times(s.x)),v=n.y.plus(h.times(r.y)),y=e.y.plus(f.times(s.y)),E=m.plus(d).div(2),S=v.plus(y).div(2);return{x:E,y:S}},An=class lp{constructor(r,e){O(this,"point");O(this,"isLeft");O(this,"segment");O(this,"otherSE");O(this,"consumedBy");r.events===void 0?r.events=[this]:r.events.push(this),this.point=r,this.isLeft=e}static compare(r,e){const s=lp.comparePoints(r.point,e.point);return s!==0?s:(r.point!==e.point&&r.link(e),r.isLeft!==e.isLeft?r.isLeft?1:-1:go.compare(r.segment,e.segment))}static comparePoints(r,e){return r.x.isLessThan(e.x)?-1:r.x.isGreaterThan(e.x)?1:r.y.isLessThan(e.y)?-1:r.y.isGreaterThan(e.y)?1:0}link(r){if(r.point===this.point)throw new Error("Tried to link already linked events");const e=r.point.events;for(let s=0,u=e.length;s<u;s++){const l=e[s];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}checkForConsuming(){const r=this.point.events.length;for(let e=0;e<r;e++){const s=this.point.events[e];if(s.segment.consumedBy===void 0)for(let u=e+1;u<r;u++){const l=this.point.events[u];l.consumedBy===void 0&&s.otherSE.point.events===l.otherSE.point.events&&s.segment.consume(l.segment)}}}getAvailableLinkedEvents(){const r=[];for(let e=0,s=this.point.events.length;e<s;e++){const u=this.point.events[e];u!==this&&!u.segment.ringOut&&u.segment.isInResult()&&r.push(u)}return r}getLeftmostComparator(r){const e=new Map,s=u=>{const l=u.otherSE;e.set(u,{sine:jk(this.point,r.point,l.point),cosine:$k(this.point,r.point,l.point)})};return(u,l)=>{e.has(u)||s(u),e.has(l)||s(l);const{sine:f,cosine:h}=e.get(u),{sine:m,cosine:d}=e.get(l);return f.isGreaterThanOrEqualTo(0)&&m.isGreaterThanOrEqualTo(0)?h.isLessThan(d)?1:h.isGreaterThan(d)?-1:0:f.isLessThan(0)&&m.isLessThan(0)?h.isLessThan(d)?-1:h.isGreaterThan(d)?1:0:m.isLessThan(f)?-1:m.isGreaterThan(f)?1:0}}},Qk=class Ll{constructor(r){O(this,"events");O(this,"poly");O(this,"_isExteriorRing");O(this,"_enclosingRing");this.events=r;for(let e=0,s=r.length;e<s;e++)r[e].segment.ringOut=this;this.poly=null}static factory(r){const e=[];for(let s=0,u=r.length;s<u;s++){const l=r[s];if(!l.isInResult()||l.ringOut)continue;let f=null,h=l.leftSE,m=l.rightSE;const d=[h],v=h.point,y=[];for(;f=h,h=m,d.push(h),h.point!==v;)for(;;){const E=h.getAvailableLinkedEvents();if(E.length===0){const D=d[0].point,U=d[d.length-1].point;throw new Error(`Unable to complete output ring starting at [${D.x}, ${D.y}]. Last matching segment found ends at [${U.x}, ${U.y}].`)}if(E.length===1){m=E[0].otherSE;break}let S=null;for(let D=0,U=y.length;D<U;D++)if(y[D].point===h.point){S=D;break}if(S!==null){const D=y.splice(S)[0],U=d.splice(D.index);U.unshift(U[0].otherSE),e.push(new Ll(U.reverse()));continue}y.push({index:d.length,point:h.point});const M=h.getLeftmostComparator(f);m=E.sort(M)[0].otherSE;break}e.push(new Ll(d))}return e}getGeom(){let r=this.events[0].point;const e=[r];for(let d=1,v=this.events.length-1;d<v;d++){const y=this.events[d].point,E=this.events[d+1].point;Wn.orient(y,r,E)!==0&&(e.push(y),r=y)}if(e.length===1)return null;const s=e[0],u=e[1];Wn.orient(s,r,u)===0&&e.shift(),e.push(e[0]);const l=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,m=[];for(let d=f;d!=h;d+=l)m.push([e[d].x.toNumber(),e[d].y.toNumber()]);return m}isExteriorRing(){if(this._isExteriorRing===void 0){const r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var u,l;let r=this.events[0];for(let f=1,h=this.events.length;f<h;f++){const m=this.events[f];An.compare(r,m)>0&&(r=m)}let e=r.segment.prevInResult(),s=e?e.prevInResult():null;for(;;){if(!e)return null;if(!s)return e.ringOut;if(s.ringOut!==e.ringOut)return((u=s.ringOut)==null?void 0:u.enclosingRing())!==e.ringOut?e.ringOut:(l=e.ringOut)==null?void 0:l.enclosingRing();e=s.prevInResult(),s=e?e.prevInResult():null}}},sd=class{constructor(n){O(this,"exteriorRing");O(this,"interiorRings");this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const r=[n];for(let e=0,s=this.interiorRings.length;e<s;e++){const u=this.interiorRings[e].getGeom();u!==null&&r.push(u)}return r}},e2=class{constructor(n){O(this,"rings");O(this,"polys");this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let r=0,e=this.polys.length;r<e;r++){const s=this.polys[r].getGeom();s!==null&&n.push(s)}return n}_composePolys(n){var e;const r=[];for(let s=0,u=n.length;s<u;s++){const l=n[s];if(!l.poly)if(l.isExteriorRing())r.push(new sd(l));else{const f=l.enclosingRing();f!=null&&f.poly||r.push(new sd(f)),(e=f==null?void 0:f.poly)==null||e.addInterior(l)}}return r}},t2=class{constructor(n,r=go.compare){O(this,"queue");O(this,"tree");O(this,"segments");this.queue=n,this.tree=new lo(r),this.segments=[]}process(n){const r=n.segment,e=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(r),e;n.isLeft&&this.tree.add(r);let s=r,u=r;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do u=this.tree.firstAfter(u);while(u!=null&&u.consumedBy!=null);if(n.isLeft){let l=null;if(s){const h=s.getIntersection(r);if(h!==null&&(r.isAnEndpoint(h)||(l=h),!s.isAnEndpoint(h))){const m=this._splitSafely(s,h);for(let d=0,v=m.length;d<v;d++)e.push(m[d])}}let f=null;if(u){const h=u.getIntersection(r);if(h!==null&&(r.isAnEndpoint(h)||(f=h),!u.isAnEndpoint(h))){const m=this._splitSafely(u,h);for(let d=0,v=m.length;d<v;d++)e.push(m[d])}}if(l!==null||f!==null){let h=null;l===null?h=f:f===null?h=l:h=An.comparePoints(l,f)<=0?l:f,this.queue.delete(r.rightSE),e.push(r.rightSE);const m=r.split(h);for(let d=0,v=m.length;d<v;d++)e.push(m[d])}e.length>0?(this.tree.delete(r),e.push(n)):(this.segments.push(r),r.prev=s)}else{if(s&&u){const l=s.getIntersection(u);if(l!==null){if(!s.isAnEndpoint(l)){const f=this._splitSafely(s,l);for(let h=0,m=f.length;h<m;h++)e.push(f[h])}if(!u.isAnEndpoint(l)){const f=this._splitSafely(u,l);for(let h=0,m=f.length;h<m;h++)e.push(f[h])}}}this.tree.delete(r)}return e}_splitSafely(n,r){this.tree.delete(n);const e=n.rightSE;this.queue.delete(e);const s=n.split(r);return s.push(e),n.consumedBy===void 0&&this.tree.add(n),s}},n2=class{constructor(){O(this,"type");O(this,"numMultiPolys")}run(n,r,e){ms.type=n;const s=[new od(r,!0)];for(let d=0,v=e.length;d<v;d++)s.push(new od(e[d],!1));if(ms.numMultiPolys=s.length,ms.type==="difference"){const d=s[0];let v=1;for(;v<s.length;)cl(s[v].bbox,d.bbox)!==null?v++:s.splice(v,1)}if(ms.type==="intersection")for(let d=0,v=s.length;d<v;d++){const y=s[d];for(let E=d+1,S=s.length;E<S;E++)if(cl(y.bbox,s[E].bbox)===null)return[]}const u=new lo(An.compare);for(let d=0,v=s.length;d<v;d++){const y=s[d].getSweepEvents();for(let E=0,S=y.length;E<S;E++)u.add(y[E])}const l=new t2(u);let f=null;for(u.size!=0&&(f=u.first(),u.delete(f));f;){const d=l.process(f);for(let v=0,y=d.length;v<y;v++){const E=d[v];E.consumedBy===void 0&&u.add(E)}u.size!=0?(f=u.first(),u.delete(f)):f=null}Wn.reset();const h=Qk.factory(l.segments);return new e2(h).getGeom()}},ms=new n2,fo=ms,r2=0,go=class Eo{constructor(r,e,s,u){O(this,"id");O(this,"leftSE");O(this,"rightSE");O(this,"rings");O(this,"windings");O(this,"ringOut");O(this,"consumedBy");O(this,"prev");O(this,"_prevInResult");O(this,"_beforeState");O(this,"_afterState");O(this,"_isInResult");this.id=++r2,this.leftSE=r,r.segment=this,r.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=r,this.rings=s,this.windings=u}static compare(r,e){const s=r.leftSE.point.x,u=e.leftSE.point.x,l=r.rightSE.point.x,f=e.rightSE.point.x;if(f.isLessThan(s))return 1;if(l.isLessThan(u))return-1;const h=r.leftSE.point.y,m=e.leftSE.point.y,d=r.rightSE.point.y,v=e.rightSE.point.y;if(s.isLessThan(u)){if(m.isLessThan(h)&&m.isLessThan(d))return 1;if(m.isGreaterThan(h)&&m.isGreaterThan(d))return-1;const y=r.comparePoint(e.leftSE.point);if(y<0)return 1;if(y>0)return-1;const E=e.comparePoint(r.rightSE.point);return E!==0?E:-1}if(s.isGreaterThan(u)){if(h.isLessThan(m)&&h.isLessThan(v))return-1;if(h.isGreaterThan(m)&&h.isGreaterThan(v))return 1;const y=e.comparePoint(r.leftSE.point);if(y!==0)return y;const E=r.comparePoint(e.rightSE.point);return E<0?1:E>0?-1:1}if(h.isLessThan(m))return-1;if(h.isGreaterThan(m))return 1;if(l.isLessThan(f)){const y=e.comparePoint(r.rightSE.point);if(y!==0)return y}if(l.isGreaterThan(f)){const y=r.comparePoint(e.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(!l.eq(f)){const y=d.minus(h),E=l.minus(s),S=v.minus(m),M=f.minus(u);if(y.isGreaterThan(E)&&S.isLessThan(M))return 1;if(y.isLessThan(E)&&S.isGreaterThan(M))return-1}return l.isGreaterThan(f)?1:l.isLessThan(f)||d.isLessThan(v)?-1:d.isGreaterThan(v)?1:r.id<e.id?-1:r.id>e.id?1:0}static fromRing(r,e,s){let u,l,f;const h=An.comparePoints(r,e);if(h<0)u=r,l=e,f=1;else if(h>0)u=e,l=r,f=-1;else throw new Error(`Tried to create degenerate segment at [${r.x}, ${r.y}]`);const m=new An(u,!0),d=new An(l,!1);return new Eo(m,d,[s],[f])}replaceRightSE(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const r=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r.isLessThan(e)?r:e},ur:{x:this.rightSE.point.x,y:r.isGreaterThan(e)?r:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(r){return r.x.eq(this.leftSE.point.x)&&r.y.eq(this.leftSE.point.y)||r.x.eq(this.rightSE.point.x)&&r.y.eq(this.rightSE.point.y)}comparePoint(r){return Wn.orient(this.leftSE.point,r,this.rightSE.point)}getIntersection(r){const e=this.bbox(),s=r.bbox(),u=cl(e,s);if(u===null)return null;const l=this.leftSE.point,f=this.rightSE.point,h=r.leftSE.point,m=r.rightSE.point,d=ps(e,h)&&this.comparePoint(h)===0,v=ps(s,l)&&r.comparePoint(l)===0,y=ps(e,m)&&this.comparePoint(m)===0,E=ps(s,f)&&r.comparePoint(f)===0;if(v&&d)return E&&!y?f:!E&&y?m:null;if(v)return y&&l.x.eq(m.x)&&l.y.eq(m.y)?null:l;if(d)return E&&f.x.eq(h.x)&&f.y.eq(h.y)?null:h;if(E&&y)return null;if(E)return f;if(y)return m;const S=Kk(l,this.vector(),h,r.vector());return S===null||!ps(u,S)?null:Wn.snap(S)}split(r){const e=[],s=r.events!==void 0,u=new An(r,!0),l=new An(r,!1),f=this.rightSE;this.replaceRightSE(l),e.push(l),e.push(u);const h=new Eo(u,f,this.rings.slice(),this.windings.slice());return An.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),An.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(u.checkForConsuming(),l.checkForConsuming()),e}swapEvents(){const r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,s=this.windings.length;e<s;e++)this.windings[e]*=-1}consume(r){let e=this,s=r;for(;e.consumedBy;)e=e.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const u=Eo.compare(e,s);if(u!==0){if(u>0){const l=e;e=s,s=l}if(e.prev===s){const l=e;e=s,s=l}for(let l=0,f=s.rings.length;l<f;l++){const h=s.rings[l],m=s.windings[l],d=e.rings.indexOf(h);d===-1?(e.rings.push(h),e.windings.push(m)):e.windings[d]+=m}s.rings=null,s.windings=null,s.consumedBy=e,s.leftSE.consumedBy=e.leftSE,s.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,s=this._afterState.windings,u=this._afterState.multiPolys;for(let h=0,m=this.rings.length;h<m;h++){const d=this.rings[h],v=this.windings[h],y=e.indexOf(d);y===-1?(e.push(d),s.push(v)):s[y]+=v}const l=[],f=[];for(let h=0,m=e.length;h<m;h++){if(s[h]===0)continue;const d=e[h],v=d.poly;if(f.indexOf(v)===-1)if(d.isExterior)l.push(v);else{f.indexOf(v)===-1&&f.push(v);const y=l.indexOf(d.poly);y!==-1&&l.splice(y,1)}}for(let h=0,m=l.length;h<m;h++){const d=l[h].multiPoly;u.indexOf(d)===-1&&u.push(d)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const r=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(fo.type){case"union":{const s=r.length===0,u=e.length===0;this._isInResult=s!==u;break}case"intersection":{let s,u;r.length<e.length?(s=r.length,u=e.length):(s=e.length,u=r.length),this._isInResult=u===fo.numMultiPolys&&s<u;break}case"xor":{const s=Math.abs(r.length-e.length);this._isInResult=s%2===1;break}case"difference":{const s=u=>u.length===1&&u[0].isSubject;this._isInResult=s(r)!==s(e);break}}return this._isInResult}},ad=class{constructor(n,r,e){O(this,"poly");O(this,"isExterior");O(this,"segments");O(this,"bbox");if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=e,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Wn.snap({x:new bn(n[0][0]),y:new bn(n[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let u=s;for(let l=1,f=n.length;l<f;l++){if(typeof n[l][0]!="number"||typeof n[l][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const h=Wn.snap({x:new bn(n[l][0]),y:new bn(n[l][1])});h.x.eq(u.x)&&h.y.eq(u.y)||(this.segments.push(go.fromRing(u,h,this)),h.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=h.x),h.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=h.y),h.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=h.x),h.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=h.y),u=h)}(!s.x.eq(u.x)||!s.y.eq(u.y))&&this.segments.push(go.fromRing(u,s,this))}getSweepEvents(){const n=[];for(let r=0,e=this.segments.length;r<e;r++){const s=this.segments[r];n.push(s.leftSE),n.push(s.rightSE)}return n}},i2=class{constructor(n,r){O(this,"multiPoly");O(this,"exteriorRing");O(this,"interiorRings");O(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ad(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,s=n.length;e<s;e++){const u=new ad(n[e],this,!1);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=r}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let r=0,e=this.interiorRings.length;r<e;r++){const s=this.interiorRings[r].getSweepEvents();for(let u=0,l=s.length;u<l;u++)n.push(s[u])}return n}},od=class{constructor(n,r){O(this,"isSubject");O(this,"polys");O(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new bn(Number.POSITIVE_INFINITY),y:new bn(Number.POSITIVE_INFINITY)},ur:{x:new bn(Number.NEGATIVE_INFINITY),y:new bn(Number.NEGATIVE_INFINITY)}};for(let e=0,s=n.length;e<s;e++){const u=new i2(n[e],this);u.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=r}getSweepEvents(){const n=[];for(let r=0,e=this.polys.length;r<e;r++){const s=this.polys[r].getSweepEvents();for(let u=0,l=s.length;u<l;u++)n.push(s[u])}return n}},s2=(n,...r)=>fo.run("union",n,r),a2=(n,...r)=>fo.run("difference",n,r);Wn.set;function o2(n){const r=[];if(nr(n,u=>{r.push(u.coordinates)}),r.length<2)throw new Error("Must have at least two features");const e=n.features[0].properties||{},s=a2(r[0],...r.slice(1));return s.length===0?null:s.length===1?Dn(s[0],e):xo(s,e)}var ud=o2;function ld(n){var r=new Ht(n);return r.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:_n(e),Ht.prototype.insert.call(this,e)},r.load=function(e){var s=[];return Array.isArray(e)?e.forEach(function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:_n(u),s.push(u)}):yn(e,function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:_n(u),s.push(u)}),Ht.prototype.load.call(this,s)},r.remove=function(e,s){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:_n(e),Ht.prototype.remove.call(this,e,s)},r.clear=function(){return Ht.prototype.clear.call(this)},r.search=function(e){var s=Ht.prototype.search.call(this,this.toBBox(e));return $e(s)},r.collides=function(e){return Ht.prototype.collides.call(this,this.toBBox(e))},r.all=function(){var e=Ht.prototype.all.call(this);return $e(e)},r.toJSON=function(){return Ht.prototype.toJSON.call(this)},r.fromJSON=function(e){return Ht.prototype.fromJSON.call(this,e)},r.toBBox=function(e){var s;if(e.bbox)s=e.bbox;else if(Array.isArray(e)&&e.length===4)s=e;else if(Array.isArray(e)&&e.length===6)s=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")s=_n(e);else if(e.type==="FeatureCollection")s=_n(e);else throw new Error("invalid geojson");return{minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]}},r}function u2(n){var r=n[0],e=n[1],s=n[2],u=n[3],l=Tt(n.slice(0,2),[s,e]),f=Tt(n.slice(0,2),[r,u]);if(l>=f){var h=(e+u)/2;return[r,h-(s-r)/2,s,h+(s-r)/2]}else{var m=(r+s)/2;return[m-(u-e)/2,e,m+(u-e)/2,u]}}function l2(n,r){if(r=r??{},!Ds(r))throw new Error("options is invalid");var e=r.precision,s=r.coordinates,u=r.mutate;if(e=e==null||isNaN(e)?6:e,s=s==null||isNaN(s)?3:s,!n)throw new Error("<geojson> is required");if(typeof e!="number")throw new Error("<precision> must be a number");if(typeof s!="number")throw new Error("<coordinates> must be a number");(u===!1||u===void 0)&&(n=JSON.parse(JSON.stringify(n)));var l=Math.pow(10,e);return tr(n,function(f){c2(f,l,s)}),n}function c2(n,r,e){n.length>e&&n.splice(e,n.length);for(var s=0;s<n.length;s++)n[s]=Math.round(n[s]*r)/r;return n}function h2(n){if(!n)throw new Error("geojson is required");const r=[];return rr(n,e=>{f2(e,r)}),$e(r)}function f2(n,r){let e=[];const s=n.geometry;if(s!==null){switch(s.type){case"Polygon":e=Ct(s);break;case"LineString":e=[Ct(s)]}e.forEach(u=>{g2(u,n.properties).forEach(f=>{f.id=r.length,r.push(f)})})}}function g2(n,r){const e=[];return n.reduce((s,u)=>{const l=qr([s,u],r);return l.bbox=d2(s,u),e.push(l),u}),e}function d2(n,r){const e=n[0],s=n[1],u=r[0],l=r[1],f=e<u?e:u,h=s<l?s:l,m=e>u?e:u,d=s>l?s:l;return[f,h,m,d]}var p2=Object.defineProperty,m2=Object.defineProperties,v2=Object.getOwnPropertyDescriptors,cd=Object.getOwnPropertySymbols,y2=Object.prototype.hasOwnProperty,_2=Object.prototype.propertyIsEnumerable,hd=(n,r,e)=>r in n?p2(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,fd=(n,r)=>{for(var e in r||(r={}))y2.call(r,e)&&hd(n,e,r[e]);if(cd)for(var e of cd(r))_2.call(r,e)&&hd(n,e,r[e]);return n},gd=(n,r)=>m2(n,v2(r));function E2(n,r,e={}){if(!n||!r)throw new Error("lines and pt are required arguments");const s=We(r);let u=vn([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),l=0;return rr(n,function(f,h,m){const d=Ct(f);for(let v=0;v<d.length-1;v++){const y=vn(d[v]);y.properties.dist=Tt(r,y,e);const E=We(y),S=vn(d[v+1]);S.properties.dist=Tt(r,S,e);const M=We(S),D=Tt(y,S,e);let U,G;E[0]===s[0]&&E[1]===s[1]?[U,,G]=[E,void 0,!1]:M[0]===s[0]&&M[1]===s[1]?[U,,G]=[M,void 0,!0]:[U,,G]=k2(y.geometry.coordinates,S.geometry.coordinates,We(r));let I;U&&(I=vn(U,{dist:Tt(r,U,e),multiFeatureIndex:m,location:l+Tt(y,U,e)})),I&&I.properties.dist<u.properties.dist&&(u=gd(fd({},I),{properties:gd(fd({},I.properties),{index:G?v+1:v})})),l+=D}}),u}function x2(n,r){const[e,s,u]=n,[l,f,h]=r;return e*l+s*f+u*h}function w2(n,r){const[e,s,u]=n,[l,f,h]=r;return[s*h-u*f,u*l-e*h,e*f-s*l]}function dd(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}function Rr(n,r){const e=x2(n,r)/(dd(n)*dd(r));return Math.acos(Math.min(Math.max(e,-1),1))}function hl(n){const r=nt(n[1]),e=nt(n[0]);return[Math.cos(r)*Math.cos(e),Math.cos(r)*Math.sin(e),Math.sin(r)]}function Dr(n){const[r,e,s]=n,u=wr(Math.asin(s));return[wr(Math.atan2(e,r)),u]}function k2(n,r,e){const s=hl(n),u=hl(r),l=hl(e),[f,h,m]=l,[d,v,y]=w2(s,u),E=v*m-y*h,S=y*f-d*m,M=d*h-v*f,D=M*v-S*y,U=E*y-M*d,G=S*d-E*v,I=1/Math.sqrt(Math.pow(D,2)+Math.pow(U,2)+Math.pow(G,2)),H=[D*I,U*I,G*I],J=[-1*D*I,-1*U*I,-1*G*I],X=Rr(s,u),W=Rr(s,H),$=Rr(u,H),x=Rr(s,J),k=Rr(u,J);let b;return W<x&&W<k||$<x&&$<k?b=H:b=J,Rr(s,b)>X||Rr(u,b)>X?Tt(Dr(b),Dr(s))<=Tt(Dr(b),Dr(u))?[Dr(s),!0,!1]:[Dr(u),!1,!0]:[Dr(b),!1,!1]}function S2(n,r){if(!n)throw new Error("line is required");if(!r)throw new Error("splitter is required");var e=Rl(n),s=Rl(r);if(e!=="LineString")throw new Error("line must be LineString");if(s==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(s==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var u=l2(r,{precision:7});switch(s){case"Point":return fl(n,u);case"MultiPoint":return pd(n,u);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return pd(n,Yi(n,u,{ignoreSelfIntersections:!0}))}}function pd(n,r){var e=[],s=ld();return rr(r,function(u){if(e.forEach(function(h,m){h.id=m}),!e.length)e=fl(n,u).features,e.forEach(function(h){h.bbox||(h.bbox=u2(_n(h)))}),s.load($e(e));else{var l=s.search(u);if(l.features.length){var f=md(u,l);e=e.filter(function(h){return h.id!==f.id}),s.remove(f),yn(fl(f,u),function(h){e.push(h),s.insert(h)})}}}),$e(e)}function fl(n,r){var e=[],s=Ct(n)[0],u=Ct(n)[n.geometry.coordinates.length-1];if(gl(s,We(r))||gl(u,We(r)))return $e([n]);var l=ld(),f=h2(n);l.load(f);var h=l.search(r);if(!h.features.length)return $e([n]);var m=md(r,h),d=[s],v=mp(f,function(y,E,S){var M=Ct(E)[1],D=We(r);return S===m.id?(y.push(D),e.push(qr(y)),gl(D,M)?[D]:[D,M]):(y.push(M),y)},d);return v.length>1&&e.push(qr(v)),$e(e)}function md(n,r){if(!r.features.length)throw new Error("lines must contain features");if(r.features.length===1)return r.features[0];var e,s=1/0;return yn(r,function(u){var l=E2(u,n),f=l.properties.dist;f<s&&(e=u,s=f)}),e}function gl(n,r){return n[0]===r[0]&&n[1]===r[1]}var M2=S2;class I2 extends Nr{constructor(){super(...arguments);O(this,"mode","cut");O(this,"lineDrawer",new to(this.gm,{snappingMarkers:"first",targetShape:"polygon"}));O(this,"cutShapesAllowed",["ellipse","circle","line","rectangle","polygon"]);O(this,"mapEventHandlers",{[`${pe}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.cutPolygonFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return Ke(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}cutPolygonFinished(e){this.lineDrawer.endShape();const s=tl(e.geoJson),u=this.getBBoxFeaturesByPolygon(s);this.cutFeaturesByPolygon(u,s)}getBBoxFeaturesByPolygon(e){const s=Qo(e),u=this.gm.mapAdapter.coordBoundsToScreenBounds(s);return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:u,sourceNames:[se.main]})}cutFeaturesByPolygon(e,s){e.forEach(u=>{if(gu(u.getGeoJson(),s)){this.gm.features.delete(u),this.fireFeatureRemovedEvent(u);return}if(jg(u.getGeoJson(),s)&&this.cutShapesAllowed.includes(u.shape)){if(u.shape==="line"){this.cutLineFeatureByPolygon(u,s);return}this.cutPolygonFeatureByPolygon(u.id,s)}})}cutLineFeatureByPolygon(e,s){const u=e.getGeoJson(),l=hE(this.gm.mapAdapter,s),f=M2(u,s);if(!l||f.features.length===0)return;const h=[];if(f.features.filter(m=>!gu(m,l)).forEach(m=>{const d=this.createLineFeature(Yl(m));d&&h.push(d)}),this.gm.features.delete(e),!sl(h)){ie.error("cutLineFeatureByPolygon: resultFeatures not found",f);return}this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:h})}createLineFeature(e){const s={...e,properties:{shape:"line"}};return this.gm.features.createFeature({shapeGeoJson:s,sourceName:se.main})}cutPolygonFeatureByPolygon(e,s){const u=this.gm.features.get(se.main,e);if(!u){ie.warn("cutPolygonFeatureByPolygon: featureData not found",e);return}u.convertToPolygon();const l=u.getGeoJson(),f=this.getGeoJsonDifference(l,s);f&&(u.updateGeoJsonGeometry(f.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[u],targetFeatures:[u]}))}getGeoJsonDifference(e,s){const u=$e([e,s]),l=ud(u);return l?l.type==="Feature"?l:(l.type==="FeatureCollection"&&ie.error("getGeoJsonDifference: FeatureCollection detected (not supported)",l),null):null}}class L2 extends Nr{constructor(){super(...arguments);O(this,"mode","delete");O(this,"mapEventHandlers",{click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0}),this.gm.markerPointer.pauseSnapping()}onEndAction(){this.gm.markerPointer.resumeSnapping(),this.gm.markerPointer.disable()}onMouseClick(e){if(!Ke(e,{warning:!0}))return{next:!1};const s=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[se.main]});return s&&(this.gm.features.delete(s),this.fireFeatureRemovedEvent(s)),{next:!1}}}class b2 extends so{constructor(){super(...arguments);O(this,"mode","drag")}onStartAction(){}onEndAction(){}handleGmEdit(e){return Pr(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(this.previousLngLat||(this.previousLngLat=e.lngLatStart),this.moveFeature(e.featureData,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(this.isDragging=!0,e.featureData.changeSource({sourceName:se.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.previousLngLat=null,this.isDragging=!1,e.featureData.changeSource({sourceName:se.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(ie.error("EditDrag.handleGmEdit: not an edit event",e),{next:!0})}}class A2 extends so{constructor(){super(...arguments);O(this,"mode","rotate");O(this,"convertFeaturesTypes",["rectangle"]);O(this,"shapeRotateHandlers",{marker:this.rotateFeature.bind(this),circle:this.rotateFeature.bind(this),circle_marker:this.rotateFeature.bind(this),text_marker:this.rotateFeature.bind(this),line:this.rotateFeature.bind(this),rectangle:this.rotateFeature.bind(this),polygon:this.rotateFeature.bind(this),ellipse:this.rotateEllipse.bind(this)})}onStartAction(){}onEndAction(){}handleGmEdit(e){var s;return Pr(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(((s=e.markerData)==null?void 0:s.type)==="vertex"?this.moveVertex(e):this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(e.featureData.changeSource({sourceName:se.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(e.featureData.changeSource({sourceName:se.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(ie.error("EditChange.handleGmEdit: not an edit event",e),{next:!1})}moveVertex(e){var l,f;const s=e.featureData,u=((f=(l=this.shapeRotateHandlers)[s.shape])==null?void 0:f.call(l,e))||null;u?(this.fireBeforeFeatureUpdate({features:[s],geoJsonFeatures:[u]}),this.updateFeatureGeoJson({featureData:s,featureGeoJson:u})&&this.convertFeaturesTypes.includes(s.shape)&&s.convertToPolygon()):ie.error("EditRotate.moveVertex: invalid geojson",u,e)}rotateEllipse(e){const{featureData:s}=e;if(s.shape!=="ellipse")return ie.error("EditRotate.rotateEllipse: invalid shape type",s),null;const u=s.getShapeProperty("center"),l=s.getShapeProperty("xSemiAxis"),f=s.getShapeProperty("ySemiAxis"),h=s.getShapeProperty("angle");if(!Array.isArray(u)||typeof l!="number"||typeof f!="number"||typeof h!="number")return ie.error("rotateEllipse: missing center, xSemiAxis, ySemiAxis or angle in the featureData",s),null;const m=this.calculateRotationAngle(u,e.lngLatStart,e.lngLatEnd,!1);return aa({center:u,xSemiAxis:l,ySemiAxis:f,angle:h+m})}rotateFeature(e){const s=e.featureData,u=an(s.getGeoJson()),l=Ko(Gl(u)),f=this.calculateRotationAngle(l,e.lngLatStart,e.lngLatEnd);return u.geometry=Ip(u,f,{pivot:l}).geometry,u}calculateRotationAngle(e,s,u,l=!0){const f=Gs(e,s),m=Gs(e,u)-f;return l?(m+360)%360:m}}const vd={drag:b2,change:Ok,rotate:A2,scale:null,copy:null,cut:I2,split:null,union:null,difference:null,line_simplification:null,lasso:null,delete:L2},C2=(n,r)=>{let e=null;try{n.forEach(s=>{if(r(s))throw e=s,new Error("found")})}catch{}return e};class yd extends Vn{constructor(){super(...arguments);O(this,"mode","shape_markers");O(this,"pinEnabled",((Sd=this.gm.options.controls.helper.pin)==null?void 0:Sd.active)||!1);O(this,"previousPosition",null);O(this,"activeMarker",null);O(this,"activeFeatureData",null);O(this,"sharedMarkers",[]);O(this,"allowedShapes",["circle","line","rectangle","polygon","ellipse"]);O(this,"edgeMarkersAllowed",!1);O(this,"edgeMarkerAllowedShapes",["line","rectangle","polygon"]);O(this,"shapeMarkerAllowedModes",["drag","change","cut","split"]);O(this,"mapEventHandlers",{[`${pe}:draw`]:this.handleGmDraw.bind(this),[`${pe}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this),mousemove:this.onMouseMove.bind(this),touchmove:this.onMouseMove.bind(this),contextmenu:this.onMouseRightButtonClick.bind(this)});O(this,"throttledMethods",dr({sendMarkerMoveEvent:this.sendMarkerMoveEvent,sendMarkerRightClickEvent:this.sendMarkerRightClickEvent},this,this.gm.options.settings.throttlingDelay));O(this,"debouncedMethods",ek({refreshMarkers:this.refreshMarkers},this,this.gm.options.settings.throttlingDelay*10))}onStartAction(){this.isShapeMarkerAllowed()&&this.gm.markerPointer.enable({invisibleMarker:!0}),this.edgeMarkersAllowed=this.gm.getActiveEditModes().includes("change"),this.addMarkers()}onEndAction(){this.gm.markerPointer.disable(),this.removeMarkers()}setPin(e){this.pinEnabled=e}onMouseDown(e){var l;const s=["mousedown","touchstart"];if(!Ke(e,{warning:!0})||!s.includes(e.type))return{next:!0};if(e.type==="mousedown"&&e.originalEvent.button!==0)return{next:!0};const u=this.getFeatureMarkerByMouseEvent(e);return this.activeMarker=u||null,this.activeFeatureData=(u==null?void 0:u.instance.parent)||null,this.activeMarker&&this.activeFeatureData?(this.previousPosition=du(this.activeMarker.instance),this.gm.mapAdapter.setDragPan(!1),this.activeMarker.type==="edge"&&this.sendMarkerEvent("edge_marker_click",this.activeFeatureData,this.activeMarker),this.pinEnabled&&this.pinHelperInstance?(this.sharedMarkers=this.pinHelperInstance.getSharedMarkers(this.activeMarker.position.coordinate),this.sharedMarkers.forEach(f=>{var h;return(h=this.snappingHelper)==null?void 0:h.addExcludedFeature(f.featureData)})):(l=this.snappingHelper)==null||l.addExcludedFeature(this.activeFeatureData),this.sendMarkerEvent("marker_captured",this.activeFeatureData,this.activeMarker),{next:!1}):{next:!0}}onMouseUp(){var s;if(!this.activeMarker)return{next:!0};const e={featureData:this.activeFeatureData,markerData:this.activeMarker};return this.activeMarker=null,this.activeFeatureData=null,this.sharedMarkers=[],(s=this.snappingHelper)==null||s.clearExcludedFeatures(),this.previousPosition=null,this.gm.mapAdapter.setDragPan(!0),e.featureData&&e.markerData?(this.sendMarkerEvent("marker_released",e.featureData,e.markerData),{next:!1}):(ie.debug("ShapeMarkersHelper.onMouseUp: no active marker or featureData",e),{next:!0})}onMouseMove(e){return!this.activeMarker||!Ke(e,{warning:!0})?{next:!0}:(this.throttledMethods.sendMarkerMoveEvent(e),{next:!1})}onMouseRightButtonClick(e){const s=this.getFeatureMarkerByMouseEvent(e);return s&&s.instance.parent?(this.throttledMethods.sendMarkerRightClickEvent(s.instance.parent,s),{next:!1}):{next:!0}}get pinHelperInstance(){return this.pinEnabled&&Object.values(this.gm.actionInstances).find(ak)||null}isShapeMarkerAllowed(){return B1(this.shapeMarkerAllowedModes,this.gm.getActiveEditModes()).length>0}convertToVertexMarker(e){if(e.type==="edge"&&e.instance.parent){const s=e.position,u=e.instance.parent;this.removeMarker(e);const l=this.createMarker({type:"vertex",positionData:s,parentFeature:u}),f=u.getGeoJson(),h=uh(f,s.coordinate);if(h){const m=h.path.join("."),d=u.markers.get(m);return d&&this.removeMarker(d),u.markers.set(m,l),l}}return ie.error("ShapeMarkersHelper.convertToVertexMarker: invalid marker type",e),e}getFeatureMarkerByMouseEvent(e){var u;const s=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[se.main]});if((u=s==null?void 0:s.parent)!=null&&u.markers){const l=C2(s.parent.markers,f=>f.instance===s);if((l==null?void 0:l.type)!=="dom")return l}return null}addMarkers(){this.gm.features.forEach(e=>{if(!e||!this.allowedShapes.includes(e.shape))return;this.addCenterMarker(e);const s=this.getAllShapeSegments(e);s.forEach((u,l)=>{if(this.isMarkerIndexAllowed(e.shape,l,s.length)){const h=this.createOrUpdateVertexMarker(u.segment.start,e);if(e.markers.set(h.markerKey,h.markerData),e.shape==="line"&&l===s.length-1){const m=this.createOrUpdateVertexMarker(u.segment.end,e);e.markers.set(m.markerKey,m.markerData)}}if(this.isEdgeMarkerAllowed(e)){const h=this.createOrUpdateEdgeMarker(u,e);e.markers.set(h.markerKey,h.markerData)}})})}addCenterMarker(e){if(e.shapeProperties.center){const s=this.createMarker({type:"center",positionData:{path:[],coordinate:e.shapeProperties.center},parentFeature:e});e.markers.set("center",s)}}getAllShapeSegments(e){const s=e.getGeoJson(),u=[];return ra(s,(l,f)=>{u.push({segment:l,middle:this.getSegmentMiddlePosition(l),edgeMarkerKey:this.getEdgeMarkerKey(f)})}),u}isEdgeMarkerAllowed(e){return this.edgeMarkersAllowed&&this.edgeMarkerAllowedShapes.includes(e.shape)}isMarkerIndexAllowed(e,s,u){const l=Math.floor(u/4);return e==="circle"?(s+l/2)%l===0:e==="ellipse"?s%l===0:!0}getEdgeMarkerKey(e){return`edge.${e}`}getSegmentMiddlePosition(e){const s=this.gm.mapAdapter.project(e.start.coordinate),u=this.gm.mapAdapter.project(e.end.coordinate),l=[(s[0]+u[0])/2,(s[1]+u[1])/2],f=e.start.path.slice(0,e.start.path.length-1).concat([-1]);return{coordinate:this.gm.mapAdapter.unproject(l),path:f}}removeMarkers(){this.gm.features.forEach((e,s)=>{const u=this.gm.features.get(se.main,s);u&&(u.markers.forEach(l=>{l.type!=="dom"?this.gm.features.delete(l.instance):ie.error("Non a FeatureData marker",l)}),u.markers=new Map)})}removeMarker(e){if(e.type==="dom"){ie.error("Wrong marker type",e);return}const s=e.instance.parent;if(!s){ie.error("Missing parent feature data",e);return}try{s.markers.forEach((u,l)=>{if(u===e)throw this.gm.features.delete(u.instance),s.markers.delete(l),new Error("break")})}catch{}}createMarker({type:e,segment:s,positionData:u,parentFeature:l}){const f=u.coordinate,h=this.gm.features.createMarkerFeature({sourceName:l.sourceName,parentFeature:l,type:e,coordinate:f});if(!h)throw new Error(`Missine feature data for the "${e}" marker`);if(e==="edge"&&s)return{type:e,instance:h,position:an(u),segment:s};if(e==="vertex"||e==="center")return{type:e,instance:h,position:an(u)};throw new Error(`Invalid marker type "${e}" with segment: ${s}`)}handleGmDraw(e){return ba(e)?(e.action==="feature_created"&&this.debouncedMethods.refreshMarkers(),{next:!0}):(ie.error("ShapeMarkersHelper.handleGmDraw: not a draw event",e),{next:!0})}refreshMarkers(){this.removeMarkers(),this.addMarkers()}handleGmEdit(e){return Pr(e)?(e.action==="feature_updated"&&this.gm.features.withAtomicSourcesUpdate(()=>{this.handleShapeUpdate(e)}),{next:!0}):(ie.error("ShapeMarkersHelper.handleGmEdit: not an edit event",e),{next:!0})}handleShapeUpdate(e){var f;const s=e.targetFeatures[0];if(!s){ie.error("ShapeMarkersHelper.handleShapeUpdate: no featureData",e);return}((f=this.activeMarker)==null?void 0:f.type)==="edge"&&(this.activeMarker=this.convertToVertexMarker(this.activeMarker));const u=this.getAllShapeSegments(s),l=new Set(s.markers.keys());u.forEach((h,m)=>{if(this.isMarkerIndexAllowed(s.shape,m,u.length)){const v=this.createOrUpdateVertexMarker(h.segment.start,s);if(l.delete(v.markerKey),s.shape==="line"&&m===u.length-1){const y=this.createOrUpdateVertexMarker(h.segment.end,s);l.delete(y.markerKey)}}if(this.isEdgeMarkerAllowed(s)){const v=this.createOrUpdateEdgeMarker(h,s);l.delete(v.markerKey)}}),this.updateCenterMarkerPosition(s),l.delete("center"),l.forEach(h=>{const m=s.markers.get(h);m&&m.type!=="dom"?this.gm.features.delete(m.instance):ie.error("Non a FeatureData marker"),s.markers.delete(h)})}createOrUpdateVertexMarker(e,s){const u=e.path.join(".");let l=s.markers.get(u)||null;if(l&&(l==null?void 0:l.type)!=="vertex")throw new Error(`Invalid marker type "${l==null?void 0:l.type}" for edge marker`);return l?(jo(l.position.coordinate,e.coordinate)||this.gm.features.updateMarkerFeaturePosition(l.instance,e.coordinate),l.position=e):(l=this.createMarker({type:"vertex",positionData:e,parentFeature:s}),s.markers.set(u,l)),{markerKey:u,markerData:l}}createOrUpdateEdgeMarker(e,s){let u=s.markers.get(e.edgeMarkerKey)||null;if(u&&(u==null?void 0:u.type)!=="edge")throw new Error(`Invalid marker type "${u==null?void 0:u.type}" for edge marker`);return u?(jo(u.position.coordinate,e.middle.coordinate)||u.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.middle.coordinate}),u.position=e.middle,u.segment=e.segment):(u=this.createMarker({type:"edge",positionData:e.middle,segment:e.segment,parentFeature:s}),s.markers.set(e.edgeMarkerKey,u)),{markerKey:e.edgeMarkerKey,markerData:u}}updateCenterMarkerPosition(e){const s=e.markers.get("center")||null;s&&s.type!=="dom"&&e.shapeProperties.center&&(s.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.shapeProperties.center}),s.position.coordinate=e.shapeProperties.center)}sendMarkerEvent(e,s,u){const l={level:"system",type:"edit",mode:"change",action:e,featureData:s,markerData:u};this.gm.events.fire(`${pe}:edit`,l)}sendMarkerRightClickEvent(e,s){const u={level:"system",type:"edit",mode:"change",action:"marker_right_click",featureData:e,markerData:s};this.gm.events.fire(`${pe}:edit`,u)}sendMarkerMoveEvent(e){var u;const s=((u=this.gm.markerPointer.marker)==null?void 0:u.getLngLat())||e.lngLat.toArray();this.activeMarker&&this.activeFeatureData&&(this.pinEnabled?this.sharedMarkers:[{markerData:this.activeMarker,featureData:this.activeFeatureData}]).forEach(f=>{if(this.previousPosition){const h={level:"system",type:"edit",mode:"drag",action:"marker_move",featureData:f.featureData,markerData:f.markerData,lngLatStart:this.previousPosition,lngLatEnd:s};this.gm.events.fire(`${pe}:edit`,h)}}),this.previousPosition=s}}class T2 extends Vn{constructor(){super(...arguments);O(this,"mode","snapping");O(this,"tolerance",18);O(this,"excludedFeature",new Set);O(this,"customSnappingLngLats",new Map);O(this,"customSnappingFeatures",new Set);O(this,"lineSnappingShapes",["circle","line","rectangle","polygon","snap_guide"]);O(this,"mapEventHandlers",{});O(this,"shapeSnappingHandlers",{marker:this.getPointsSnapping.bind(this),circle:this.getLineSnapping.bind(this),circle_marker:this.getPointsSnapping.bind(this),text_marker:this.getPointsSnapping.bind(this),line:this.getLineSnapping.bind(this),rectangle:this.getLineSnapping.bind(this),polygon:this.getLineSnapping.bind(this),snap_guide:this.getLineSnapping.bind(this)})}onStartAction(){this.gm.markerPointer.setSnapping(!0)}onEndAction(){this.gm.markerPointer.setSnapping(!1)}addExcludedFeature(e){this.excludedFeature.add(e)}clearExcludedFeatures(){this.excludedFeature.clear()}addCustomSnappingFeature(e){this.customSnappingFeatures.add(e)}removeCustomSnappingFeature(e){this.customSnappingFeatures.delete(e)}clearCustomSnappingFeature(){this.customSnappingFeatures.clear()}setCustomSnappingCoordinates(e,s){this.customSnappingLngLats.set(e,s)}clearCustomSnappingCoordinates(e){this.customSnappingLngLats.delete(e)}getSnappedLngLat(e,s){let u=this.getCustomLngLatsSnapping(s);if(u)return u;const l=this.getFeaturesInPointBounds(s).filter(f=>!this.excludedFeature.has(f));return u=this.getFeaturePointsSnapping(l,e,s),u||(u=this.getFeatureLinesSnapping(l,e,s),u)?u:e}getCustomLngLatsSnapping(e){const s={distance:1/0,lngLat:null};return this.customSnappingLngLats.forEach(u=>{u.forEach(l=>{const f=this.gm.mapAdapter.project(l),h=zi(e,f);h<this.tolerance&&h<s.distance&&(s.distance=h,s.lngLat=l)})}),s.lngLat}getFeaturePointsSnapping(e,s,u){let l=e.map(f=>({shape:f.shape,...this.getPointsSnapping(f,s,u)})).filter(f=>f.distance<this.tolerance);return l.length?(l=rh(l,["distance"]),l[0].lngLat):null}getFeatureLinesSnapping(e,s,u){let l=e.filter(f=>this.lineSnappingShapes.includes(f.shape)).map(f=>{const h=this.shapeSnappingHandlers[f.shape];return h?{shape:f.shape,...h(f,s,u)}:null}).filter(f=>f!==null&&f.distance<this.tolerance);return l.length?(l=rh(l,["distance"]),l[0].lngLat):null}getFeaturesInPointBounds(e){const s=[[e[0]-this.tolerance,e[1]-this.tolerance],[e[0]+this.tolerance,e[1]+this.tolerance]];return this.gm.features.getFeaturesByScreenBounds({bounds:s,sourceNames:[se.main,se.temporary]}).filter(u=>u.temporary?this.customSnappingFeatures.has(u):!0)||[]}getPointsSnapping(e,s,u){const l=e.getGeoJson(),f={distance:1/0,coord:null};return jr(l,h=>{const m=this.gm.mapAdapter.project(h.coordinate),d=zi(u,m);d<this.tolerance&&d<f.distance&&(f.distance=d,f.coord=h.coordinate)},!0),{lngLat:f.coord?f.coord:s,distance:f.distance}}getLineSnapping(e,s,u){const l=e.getGeoJson();return this.getNearestLinePointData(l,s,u)}getNearestLinePointData(e,s,u){const l={lngLat:s,distance:1/0},f=this.gm.mapAdapter.getEuclideanNearestLngLat(e,s),h=this.gm.mapAdapter.project(f);return l.distance=zi(h,u),l.distance<this.tolerance&&(l.lngLat=f),l}}class N2 extends Vn{constructor(){super(...arguments);O(this,"mode","zoom_to_features");O(this,"mapEventHandlers",{})}onStartAction(){this.fitMapToFeatures(),setTimeout(()=>{this.gm.options.disableMode("helper","zoom_to_features")})}onEndAction(){}fitMapToFeatures(){const e=this.gm.features.asGeoJsonFeatureCollection({sourceNames:[se.main]}),s=Ol(e),u=[[s[0],s[1]],[s[2],s[3]]];try{this.gm.mapAdapter.fitBounds(u,{padding:20})}catch{ie.warn("Wrong bounds for zooming to features",u,e)}}}const _d={shape_markers:yd,pin:null,snapping:T2,snap_guides:null,measurements:null,auto_trace:null,geofencing:null,zoom_to_features:N2,click_to_edit:null};class Ed{constructor(r){O(this,"gm");O(this,"marker",null);O(this,"tmpMarker",null);O(this,"snapping",!1);O(this,"oldSnapping");this.gm=r,this.initEventHandlers()}initEventHandlers(){this.throttledMethods=dr({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay),this.mapEventHandlers={mousemove:this.throttledMethods.onMouseMove.bind(this)}}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}setSnapping(r){if(r&&!this.snappingHelper){ie.error("MarkerPointer: snapping is not available");return}this.snapping=r}pauseSnapping(){this.oldSnapping!==void 0&&ie.error("MarkerPointer: snapping is already paused"),this.oldSnapping=this.snapping,this.setSnapping(!1)}resumeSnapping(){this.oldSnapping===void 0?(ie.error("MarkerPointer: resumeSnapping is called before pauseSnapping"),this.setSnapping(!0)):(this.setSnapping(this.oldSnapping),this.oldSnapping=void 0)}enable({lngLat:r,customMarker:e,invisibleMarker:s}={lngLat:[0,0],customMarker:void 0,invisibleMarker:!1}){if(!Qw()){if(e&&s)throw new Error("MarkerPointer: customMarker and invisibleMarker can't be used together");if(this.marker)throw new Error("MarkerPointer: marker is already enabled");this.gm.events.bus.attachEvents(this.mapEventHandlers),s?this.marker=this.createInvisibleMarker(r||[0,0]):this.marker=e||this.createMarker(r||[0,0]),this.gm.getActiveDrawModes().length&&this.gm.mapAdapter.setCursor("crosshair")}}disable(){this.marker&&(this.gm.events.bus.detachEvents(this.mapEventHandlers),this.marker.remove(),this.marker=null),this.gm.mapAdapter.setCursor("")}createMarker(r=[0,0]){return this.gm.mapAdapter.createDomMarker({anchor:"center",element:Dg("dom",{pointerEvents:"none"})},r)}createInvisibleMarker(r=[0,0]){const e=document.createElement("div");return e.style.width="0px",e.style.height="0px",this.gm.mapAdapter.createDomMarker({anchor:"center",element:e},r)}onMouseMove(r){if(Ke(r,{warning:!0})&&this.marker)if(this.snapping&&this.snappingHelper){const e=[r.point.x,r.point.y],s=this.snappingHelper.getSnappedLngLat(r.lngLat.toArray(),e);this.marker.setLngLat(s)}else this.marker.setLngLat(r.lngLat.toArray());return{next:!0}}syncTmpMarker(r){this.tmpMarker||(this.tmpMarker=this.createMarker(r)),this.tmpMarker.setLngLat(r)}}const P2={type:"Feature",properties:{shape:"polygon"},geometry:{type:"MultiPolygon",coordinates:[[[[4,51.2],[5.4,52.4],[6.8,51.2],[4,51.2]]]]}},O2={type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[-.47,51.67],[1.43,51.67],[1.43,53.32],[-.47,53.32],[-.47,51.67]]]}};function R2(n,r={}){const e=[];if(nr(n,u=>{e.push(u.coordinates)}),e.length<2)throw new Error("Must have at least 2 geometries");const s=s2(e[0],...e.slice(1));return s.length===0?null:s.length===1?Dn(s[0],r.properties):xo(s,r.properties)}var D2=R2;class F2 extends Nr{constructor(){super(...arguments);O(this,"features",[]);O(this,"featureData",null);O(this,"mapEventHandlers",{click:this.onMouseClick.bind(this)})}onStartAction(){}onEndAction(){this.features.forEach(e=>{e.changeSource({sourceName:se.main,atomic:!0})}),this.features=[]}onMouseClick(e){if(this.unselectFeature(e))return{next:!0};const u=this.getAllowedFeatureByMouseEvent({event:e,sourceNames:[se.main]});return u&&this.isFeatureAllowedToGroup(u)&&(u.changeSource({sourceName:se.temporary,atomic:!0}),this.features.push(u)),this.features.length>1?(this.groupFeatures(),{next:!0}):{next:!0}}unselectFeature(e){const s=this.getAllowedFeatureByMouseEvent({event:e,sourceNames:[se.temporary]});if(s){const u=this.features.findIndex(l=>l===s);return u>-1&&this.features.splice(u,1),s.changeSource({sourceName:se.main,atomic:!0}),!0}return!1}getAllowedFeatureByMouseEvent({event:e,sourceNames:s}){const u=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:s});return u&&this.allowedShapeTypes.includes(u.shape)?u:null}isFeatureAllowedToGroup(e){if(!this.allowedShapeTypes.includes(e.shape))return!1;if(this.features.length===0)return!0;const s=e.getGeoJson();return this.features.every(u=>jg(u.getGeoJson(),s))}groupFeatures(){if(!this.features.length){ie.error("BaseGroupEdit.groupFeatures: no features to group");return}const e={type:"FeatureCollection",features:this.features.map(u=>{const l=u.getGeoJson();return["Polygon","MultiPolygon"].includes(l.geometry.type)?l:null}).filter(u=>!!u)};let s=null;if(this.mode==="union"?s=D2(e):this.mode==="difference"&&(s=ud(e)),s){const u=this.gm.features.createFeature({shapeGeoJson:{...s,properties:{...s.properties,shape:"polygon"}},sourceName:se.main});this.features.forEach(l=>{this.gm.features.delete(l)}),u&&sl(this.features)&&this.fireFeatureUpdatedEvent({sourceFeatures:this.features,targetFeatures:[u]}),this.features=[]}}}class xd{constructor(r,e={}){O(this,"mapAdapterInstance",null);O(this,"globalLngLatBounds",this.getGlobalLngLatBounds());O(this,"features");O(this,"loaded",!1);O(this,"options");O(this,"events");O(this,"control");O(this,"actionInstances",{});O(this,"markerPointer");const s=Object.assign(r,{gm:this});this.options=this.initCoreOptions(e),this.events=this.initCoreEvents(),this.features=this.initCoreFeatures(),this.control=this.initCoreControls(),this.markerPointer=this.initMarkerPointer(),lf(r)&&(this.isMapInstanceLoaded(r)?this.init(s).then():r.once("load",async()=>{await this.init(s)}))}initCoreOptions(r={}){return new Rg(this,r)}initCoreEvents(){return new Jw(this)}initCoreFeatures(){return new LE(this)}initCoreControls(){return new Fw(this)}initMarkerPointer(){return new Ed(this)}get drawClassMap(){return Vg}get editClassMap(){return vd}get helperClassMap(){return _d}get mapAdapter(){if(this.mapAdapterInstance)return this.mapAdapterInstance;throw ie.trace("Map adapter is not initialized"),new Error("Map adapter is not initialized")}addControls(r=void 0){return new Promise(e=>{(async()=>{r?this.control.createControls(r):this.mapAdapter.addControl(this.control),await this.onMapLoad(),e()})().then()})}isMapInstanceLoaded(r){return"_fullyLoaded"in r&&r._fullyLoaded}async init(r){this.mapAdapterInstance=await $w(this,r),this.features.init(),await this.addControls()}destroy(){this.removeControls(),this.events.bus.detachAllEvents(),"gm"in this.mapAdapter.mapInstance&&delete this.mapAdapter.mapInstance.gm}removeControls(){this.disableAllModes(),this.mapAdapter.removeControl(this.control)}async onMapLoad(){this.loaded||(await this.mapAdapter.loadImage({id:"default-marker",image:xr}),this.events.fire(`${pe}:control`,{level:"system",type:"control",action:"loaded"}),this.loaded=!0)}disableAllModes(){ot(this.actionInstances).forEach(r=>{const[e,s]=r.split("__");Mg(e)&&Ag(s)&&this.options.disableMode(e,s)})}getActiveDrawModes(){return ot(this.actionInstances).map(r=>{const e=this.actionInstances[r];return e instanceof kn?e.mode:null}).filter(r=>r!==null)}getActiveEditModes(){return ot(this.actionInstances).map(r=>{const e=this.actionInstances[r];return e instanceof Nr?e.mode:null}).filter(r=>r!==null)}getActiveHelperModes(){return ot(this.actionInstances).map(r=>{const e=this.actionInstances[r];return e instanceof Vn?e.mode:null}).filter(r=>r!==null)}getGlobalLngLatBounds(){return[[-179.99999,-85.051129],[179.99999,85.051129]]}createDrawInstance(r){return this.drawClassMap[r]?new this.drawClassMap[r](this):(ie.error(`Draw "${r}" is not available`),null)}createEditInstance(r){return this.editClassMap[r]?new this.editClassMap[r](this):(ie.error(`Edit "${r}" is not available`),null)}createHelperInstance(r){return this.helperClassMap[r]?new this.helperClassMap[r](this):(ie.error(`Helper "${r}" is not available`),null)}setGlobalEventsListener(r=null){this.events.bus.forwarder.globalEventsListener=r}enableMode(r,e){this.options.enableMode(r,e)}disableMode(r,e){this.options.disableMode(r,e)}toggleMode(r,e){this.options.toggleMode(r,e)}isModeEnabled(r,e){return this.options.isModeEnabled(r,e)}enableDraw(r){this.options.enableMode("draw",r)}disableDraw(){this.getActiveDrawModes().forEach(r=>this.options.disableMode("draw",r))}toggleDraw(r){this.options.toggleMode("draw",r)}drawEnabled(r){return this.options.isModeEnabled("draw",r)}enableGlobalDragMode(){this.options.enableMode("edit","drag")}disableGlobalDragMode(){this.options.disableMode("edit","drag")}toggleGlobalDragMode(){this.options.toggleMode("edit","drag")}globalDragModeEnabled(){return this.options.isModeEnabled("edit","drag")}enableGlobalEditMode(){this.options.enableMode("edit","change")}disableGlobalEditMode(){this.options.disableMode("edit","change")}toggleGlobalEditMode(){this.options.toggleMode("edit","change")}globalEditModeEnabled(){return this.options.isModeEnabled("edit","change")}enableGlobalRotateMode(){this.options.enableMode("edit","rotate")}disableGlobalRotateMode(){this.options.disableMode("edit","rotate")}toggleGlobalRotateMode(){this.options.toggleMode("edit","rotate")}globalRotateModeEnabled(){return this.options.isModeEnabled("edit","rotate")}enableGlobalCutMode(){this.options.enableMode("edit","cut")}disableGlobalCutMode(){this.options.disableMode("edit","cut")}toggleGlobalCutMode(){this.options.toggleMode("edit","cut")}globalCutModeEnabled(){return this.options.isModeEnabled("edit","cut")}enableGlobalRemovalMode(){this.options.enableMode("edit","delete")}disableGlobalRemovalMode(){this.options.disableMode("edit","delete")}toggleGlobalRemovalMode(){this.options.toggleMode("edit","delete")}globalRemovalModeEnabled(){return this.options.isModeEnabled("edit","delete")}}const G2=async(n,r)=>{const s=new xd(n,r);return await Promise.race([new Promise(u=>{s.mapAdapter.once(`${pe}:loaded`,u)}),new Promise((u,l)=>{setTimeout(()=>l(new Error(`Timeout ${6e4/1e3} seconds: can't init geoman`)),6e4)})]),s};ee.BaseAction=La,ee.BaseDomMarker=Os,ee.BaseDrag=so,ee.BaseDraw=kn,ee.BaseEdit=Nr,ee.BaseGroupEdit=F2,ee.BaseHelper=Vn,ee.BaseLayer=Tg,ee.BaseMapAdapter=Cg,ee.BasePopup=Ng,ee.BaseSource=af,ee.FEATURE_ID_PROPERTY=ar,ee.FeatureData=Vi,ee.Geoman=xd,ee.GmOptions=Rg,ee.LineDrawer=to,ee.MarkerPointer=Ed,ee.SOURCES=se,ee.ShapeMarkersHelper=yd,ee.boundsContains=Q1,ee.boundsToBBox=lh,ee.calculatePerimeter=s_,ee.controlIcons=ht,ee.convertToLineStringFeatureCollection=a_,ee.convertToThrottled=dr,ee.createGeomanInstance=G2,ee.customShapeRectangle=O2,ee.customShapeTriangle=P2,ee.defaultLayerStyles=mf,ee.drawClassMap=Vg,ee.drawModes=vu,ee.eachCoordinateWithPath=jr,ee.eachSegmentWithPath=ra,ee.editClassMap=vd,ee.editModes=ju,ee.extraDrawModes=of,ee.findCoordinateWithPath=uh,ee.formatArea=Pk,ee.formatDistance=Nk,ee.geoJsonPointToLngLat=Ko,ee.getEuclideanDistance=zi,ee.getEuclideanSegmentNearestPoint=ch,ee.getGeoJsonCoordinatesCount=sa,ee.getGeoJsonFirstPoint=tu,ee.getLngLatDiff=ta,ee.gmPrefix=pe,ee.hasMapOnceMethod=lf,ee.helperClassMap=_d,ee.helperModes=$u,ee.includesWithType=er,ee.isActionType=Mg,ee.isBaseMapEventName=IE,ee.isDrawModeName=Ig,ee.isEditModeName=Lg,ee.isEqualPosition=jo,ee.isGeoJsonFeatureInPolygon=gu,ee.isGmControlEvent=pu,ee.isGmDrawEvent=ba,ee.isGmDrawFreehandDrawerEvent=kE,ee.isGmDrawLineDrawerEvent=mu,ee.isGmDrawShapeEvent=wE,ee.isGmEditEvent=Pr,ee.isGmEvent=Pt,ee.isGmFeatureBeforeCreateEvent=mE,ee.isGmFeatureBeforeUpdateEvent=vE,ee.isGmHelperEvent=Xi,ee.isGmModeEvent=Ma,ee.isHelperModeName=bg,ee.isMapPointerEvent=Ke,ee.isModeName=Ag,ee.isMultiPolygonFeature=ea,ee.isNonEmptyArray=sl,ee.isPointerEventName=ME,ee.isPolygonFeature=Qs,ee.lngLatToGeoJsonPoint=hh,ee.mergeByTypeCustomizer=Og,ee.moveFeatureData=fE,ee.moveGeoJson=nf,ee.shapeNames=ri,ee.toMod=Xg,ee.twoCoordsToLineString=$1,ee.typedKeys=ot,Object.defineProperty(ee,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=maplibre-geoman.umd.js.map
